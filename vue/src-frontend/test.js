/* Spotify JS-SDK - v1.10.0-e9dc0b8 */

!function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defer=void 0,r.defer=function(){var e=function(){},t=function(){};return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Backoff=void 0;var n=e("./counter"),i=e("./_internal/defer");function o(){return Promise.reject(new Error("Backoff already consumed"))}var a={backoffInitial:!1,baseTime:200,ceiling:0,curve:"linear",maxDuration:1/0,maxRetries:1/0,maxTime:1/0,retryPredicate:function(){return!0}},s=function(){function e(e,t){this._resolver=i.defer(),this._ts=0,this._callCount=0,this._tickInterval=0,this._isRunning=!1;var r=t||{};this._fn=e,this._maxDuration=r.maxDuration||a.maxDuration,this._maxRetries="maxRetries"in r?r.maxRetries:a.maxRetries,this._maxTime=r.maxTime||a.maxTime,this._retryPredicate=r.retryPredicate||a.retryPredicate,this._backoffInitial=!!r.backoffInitial,this._counter=new n.Counter({curve:r.curve,baseTime:r.baseTime,ceiling:r.ceiling}),this._backoffInitial&&(this._maxRetries+=1)}return e.init=function(t,r){return void 0===r&&(r={}),new e(t,r).start()},e.prototype._destroy=function(){this._fn=o,this._resolver=i.defer()},e.prototype._failure=function(e){var t=this;if(e&&"retryAfter"in e)this._retryAfter(e);else{var r=this._counter.getTime(this._callCount);this._shouldRetry(r,e)?(this._callCount++,this._tickInterval=setTimeout((function(){return t._tick()}),r)):(this._resolver.reject(e),this._destroy())}},e.prototype._retryAfter=function(e){var t=this;this._callCount++,this._tickInterval=setTimeout((function(){return t._tick()}),e.retryAfter)},e.prototype._success=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=this._resolver).resolve.apply(e,t),this._destroy()},e.prototype._shouldRetry=function(e,t){var r=Date.now()-this._ts+e;return this._callCount<this._maxRetries&&e<this._maxTime&&r<this._maxDuration&&this._retryPredicate(t)},e.prototype._tick=function(){var e=this;this._fn().then((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e._success.apply(e,t)})).catch((function(t){return e._failure(t)}))},e.prototype.getResolver=function(){return this._resolver.promise},e.prototype.start=function(e){var t=this;return!this._fn&&e&&(this._fn=e),this._isRunning||(this._ts=Date.now(),this._isRunning=!0,this._backoffInitial?(this._callCount=1,this._tickInterval=setTimeout((function(){return t._tick()}),this._counter.getTime(0))):this._tick()),this._resolver.promise},e.prototype.stop=function(){clearTimeout(this._tickInterval),this._isRunning=!1,this._destroy()},e.prototype.getRetryCount=function(){return this._callCount},e}();r.Backoff=s},{"./_internal/defer":1,"./counter":3}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Counter=void 0;var n=200,i=0,o="linear",a=!0,s=function(){function e(e){void 0===e&&(e={}),this._curve=e.curve||o,this._baseTime=e.baseTime||n,this._ceiling=e.ceiling||i,this._jitter="jitter"in e?!!e.jitter:a}return e.prototype.getTime=function(e){var t;switch(this._curve){case"static":t=1;break;case"logarithmic":t=Math.log(e);break;case"exponential":t=Math.pow(Math.E,e);break;case"linear":default:t=e+1}var r,n,i=Math.min(4294967296,Math.floor(t*this._baseTime));return this._ceiling&&(i=Math.min(i,this._ceiling)),this._jitter?(n=(r=i)/5,Math.floor(r-n/2+Math.random()*n)):i},e}();r.Counter=s},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),e("tslib").__exportStar(e("./backoff"),r)},{"./backoff":2,tslib:5}],5:[function(e,t,r){(function(e){(function(){
  /*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
  var r,n,i,o,a,s,u,l,c,d,_,p,f,h,y,v,E,m,g,T,S,P,b;!function(r){var n="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function i(e,t){return e!==n&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}"function"==typeof define&&define.amd?define("tslib",["exports"],(function(e){r(i(n,i(e)))})):"object"==typeof t&&"object"==typeof t.exports?r(i(n,i(t.exports))):r(i(n))}((function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};r=function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},o=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){return function(r,n){t(r,n,e)}},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},l=function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},b=function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},c=function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},d=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},p=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e},f=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},h=function(e){return this instanceof h?(this.v=e,this):new h(e)},y=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=i[e](t)).value instanceof h?Promise.resolve(r.value.v).then(u,l):c(o[0][2],r)}catch(e){c(o[0][3],e)}var r}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},v=function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:h(e[n](t)),done:"return"===n}:i?i(t):t}:i}},E=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=d(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},m=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},T=function(e){return e&&e.__esModule?e:{default:e}},S=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},P=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},e("__extends",r),e("__assign",n),e("__rest",i),e("__decorate",o),e("__param",a),e("__metadata",s),e("__awaiter",u),e("__generator",l),e("__exportStar",c),e("__createBinding",b),e("__values",d),e("__read",_),e("__spread",p),e("__spreadArrays",f),e("__await",h),e("__asyncGenerator",y),e("__asyncDelegator",v),e("__asyncValues",E),e("__makeTemplateObject",m),e("__importStar",g),e("__importDefault",T),e("__classPrivateFieldGet",S),e("__classPrivateFieldSet",P)}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("tslib");n.__exportStar(e("./promise_resolver"),r),n.__exportStar(e("./user_agent"),r)},{"./promise_resolver":7,"./user_agent":8,tslib:201}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createPromiseResolver=void 0,r.createPromiseResolver=function(){var e,t;return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("tslib");n.__exportStar(e("./interpolate_ua"),r),n.__exportStar(e("./parse_ua"),r)},{"./interpolate_ua":9,"./parse_ua":10,tslib:201}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.interpolateUA=void 0;var n=e("./parse_ua");r.interpolateUA=function(e){if(!e)return e;var t=n.parseUA(navigator.userAgent,navigator.platform);return e.replace(/\{\{([^}]+?)\}\}/g,(function(e,r){return n=r,(i=t)&&i.hasOwnProperty(n)?t[r]:"";var n,i}))}},{"./parse_ua":10}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parseUA=void 0;var n=/(edge)[\s\/:]([\w\d\.]+)/,i=new RegExp("(opera|ie|firefox|chrome|trident|crios|version)[\\s/:]([\\w\\d\\.]+)?.*?(safari|(?:rv[\\s\\/:]|version[\\s\\/:])([\\w\\d\\.]+)|$)"),o={};r.parseUA=function(e,t){var r,a,s,u=e.toLowerCase(),l=t?t.toLowerCase():"",c=u+":"+l,d=o[c];if(d)return d;var _=u.match(n),p=u.match(i)||[null,"unknown",0],f=_||p;"trident"===f[1]?(f[1]="ie",f[4]&&(f[2]=f[4])):"crios"===f[1]&&(f[1]="chrome"),"win"===(l=u.match(/ip(?:ad|od|hone)/)?"ios":null!==(r=(u.match(/(?:webos|android)/)||u.match(/mac|win|linux|cros/)||[])[0])&&void 0!==r?r:"other")&&(l="windows");var h="version"===f[1]?f[3]:f[1],y="opera"===f[1]&&f[4]?f[4]:f[2],v={name:null!==(a=null==h?void 0:h.toString())&&void 0!==a?a:"unknown",version:null!==(s=null==y?void 0:y.toString())&&void 0!==s?s:"unknown",platform:l};return o[c]=v,v}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defer=function(){var e,t;return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./_internal/defer"),i=1e3,o=0,a=!1,s=function(){function e(e,t){void 0===t&&(t={}),this._cancelFn=null,this._deferredTimer=0,this._fn=e,this._cancelFn=t.cancel||null,this._threshold=t.threshold||i,this._ts=t.initialTimetamp||o,this._blockInital=t.blockInitial||a}return e.prototype._deferFn=function(e){this._fn.apply(this._fn,e)},e.prototype._deferPromise=function(e,t){this._fn.apply(this._fn,e).then((function(e){t.resolve(e)}))},e.prototype.sync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Date.now()-this._ts;if(this._ts=Date.now(),r<this._threshold)return this._cancelFn&&this._deferredTimer&&this._cancelFn(),clearTimeout(this._deferredTimer),void(this._deferredTimer=setTimeout(this._deferFn.bind(this,e),this._threshold));!0!==this._blockInital?this._fn.apply(this._fn,e):this.sync.apply(this,e)},e.prototype.async=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Date.now()-this._ts;if(this._ts=Date.now(),r<this._threshold){this._cancelFn&&this._deferredTimer&&this._cancelFn(),clearTimeout(this._deferredTimer);var i=n.defer();return this._deferredTimer=setTimeout(this._deferPromise.bind(this,e,i),this._threshold),i.promise}return!0===this._blockInital?this.async.apply(this,e):this._fn.apply(this._fn,e)},e.prototype.setCancel=function(e){this._cancelFn=e},e}();r.Debouncer=s},{"./_internal/defer":11}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DummyLogger=void 0;var n=function(){function e(){this.tag="",this.description=""}return e.prototype.matchesTag=function(){return!1},e.prototype.setLevel=function(){},e.prototype.enable=function(){},e.prototype.disable=function(){},e.prototype.log=function(){},e.prototype.debug=function(){},e.prototype.info=function(){},e.prototype.warn=function(){},e.prototype.error=function(){},e}();r.DummyLogger=n},{}],14:[function(e,t,r){(function(t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DebugLogger=void 0;var n=e("tslib"),i=e("./enums/log_level"),o=e("./_internal/dummy_logger"),a=function(){function e(e,t,r){void 0===t&&(t=""),void 0===r&&(r=function(){return!1}),this._tagParts=[],this._tagText="",this._enabled=!0,this._level=i.LogLevel.NONE,this.tag="",this.description="",this._predicate=function(){return!1},this.tag=e,this.description=t,this._predicate=r,this._tagParts=e.split("."),this._tagText="["+e+"]"}return e.prototype._print=function(e,t,r){if(this._enabled||this._level&t){var i={args:r,type:e,tag:this.tag};this._predicate(i)||console[e].apply(console,n.__spreadArray([this._tagText],r))}},e.prototype.matchesTag=function(e){var t=Array.isArray(e)?e:e.split("."),r=this._tagParts;if(t.length>r.length)return!1;for(var n=0,i=t.length;n<i;n++)if(("*"!==t[n]||!r[n])&&t[n]!==r[n])return!1;return!0},e.prototype.setLevel=function(e){var t=0;switch(e){case"error":t=i.LogLevel.ERROR;break;case"warn":t=i.LogLevel.WARN|i.LogLevel.ERROR;break;case"info":t=i.LogLevel.INFO|i.LogLevel.WARN|i.LogLevel.ERROR;break;case"debug":t=i.LogLevel.DEBUG|i.LogLevel.INFO|i.LogLevel.WARN|i.LogLevel.ERROR;break;case"log":default:t=i.LogLevel.LOG|i.LogLevel.DEBUG|i.LogLevel.INFO|i.LogLevel.WARN|i.LogLevel.ERROR}this._level=t},e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("log",i.LogLevel.LOG,e)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("debug",i.LogLevel.DEBUG,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("info",i.LogLevel.INFO,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("warn",i.LogLevel.WARN,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("error",i.LogLevel.ERROR,e)},e}();r.DebugLogger=void 0!==t&&"true"===t.env.DEBUG?a:o.DummyLogger}).call(this)}).call(this,e("_process"))},{"./_internal/dummy_logger":13,"./enums/log_level":15,_process:197,tslib:201}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LogLevel=void 0,function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.DEBUG=2]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=8]="WARN",e[e.ERROR=16]="ERROR"}(r.LogLevel||(r.LogLevel={}))},{}],16:[function(e,t,r){(function(e,t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.expose=void 0,r.expose=function(r,n){var i;void 0!==e&&"true"===(null===(i=null==e?void 0:e.env)||void 0===i?void 0:i.DEBUG)&&(t[r]=n)}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:197}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.logging=r.expose=void 0;var n=e("./expose");Object.defineProperty(r,"expose",{enumerable:!0,get:function(){return n.expose}});var i=e("./logging");r.logging=i},{"./expose":16,"./logging":18}],18:[function(e,t,r){(function(t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.remove=r.forTag=r.disableAll=r.enableAll=r.setLevel=r.disable=r.enable=r.list=r.unintercept=r.intercept=void 0;var n=e("./debug_logger"),i=t.__dbgLoggerRegistry;i||(i={map:{},list:[],loggingPredicate:function(){}},Object.defineProperty?Object.defineProperty(t,"__dbgLoggerRegistry",{value:i}):t.__dbgLoggerRegistry=i);var o=i.map,a=i.list;function s(e){return!(!i.loggingPredicate||!i.loggingPredicate(e))}var u="log";r.intercept=function(e){if("function"!=typeof e)throw new TypeError("Logging.intercept requires a function predicate.");i.loggingPredicate=e},r.unintercept=function(){i.loggingPredicate=function(){}},r.list=function(e){var t=Object.keys(o).filter((function(e){return o[e]})).sort();return e?t.map((function(e){return{tag:e,description:o[e].description||"No description."}})):t.reduce((function(e,t){return e[t]=o[t].description||"No description",e}),{})},r.enable=function(e){for(var t,r=Array.isArray(e)?e:[e],n=r.length;n--;)for(var i=null===(t=r[n])||void 0===t?void 0:t.toLowerCase(),o=a.length;o--;){var s=a[o];s.matchesTag(i)&&s.enable()}},r.disable=function(e){for(var t,r=Array.isArray(e)?e:[e],n=r.length;n--;)for(var i=null===(t=r[n])||void 0===t?void 0:t.toLowerCase(),o=a.length;o--;){var s=a[o];s.matchesTag(i)&&s.disable()}},r.setLevel=function(e){u=e;for(var t=a.length;t--;){var r=a[t];r&&r.setLevel(e)}},r.enableAll=function(){for(var e=a.length;e--;)a[e]&&a[e].enable()},r.disableAll=function(){for(var e=a.length;e--;)a[e]&&a[e].disable()},r.forTag=function(e,t){var r,i;if("string"==typeof e?(r=e.toLowerCase(),i=t):(r=e.tag,i=e.description),o.hasOwnProperty(r)&&o[r])return o[r];var l=new n.DebugLogger(r,i,s);return l.setLevel(u),o[r]=l,a.push(l),l},r.remove=function(e){var t=e.toLowerCase();if(o.hasOwnProperty(t)&&o[t]){var r=o[t];o[t]=null;var n=a.indexOf(r);-1!==n&&a.splice(n,1)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug_logger":14}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromHex=r.toHex=r.toBytes=r.fromBytes=void 0;var n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i={},o={};function a(e,t,r){for(var n=0,i=0;i<e.length;++i){var o=e[i]*t+n;e[i]=o%r,n=~~(o/r)}for(;n;)e.push(n%r),n=~~(n/r)}function s(e,t,r,n){var i,o,a=0;for(o=0;o<t.length;++o)i=~~e[o]+t[o]*r+a,e[o]=i%n,a=~~(i/n);for(;a;)i=~~e[o]+a,e[o]=i%n,a=~~(i/n),++o}function u(e,t,r){for(var n=[0],i=[1],o=0,u=e;o<u.length;o++){s(n,i,u[o],r),a(i,t,r)}return n}function l(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];r.push(t[o])}return r.reverse()}function c(e,t){for(void 0===t&&(t=0);e.length<t;)e.push(0);return e}!function(){for(var e=0,t=n.length;e<t;++e)o[n[e]]=e;for(e=0;e<16;++e)i["0123456789abcdef"[e]]=e;for(e=0;e<16;++e)i["0123456789ABCDEF"[e]]=e}(),r.fromBytes=function(e,t){return l(c(u(e.slice(0).reverse(),256,62),t),n).join("")},r.toBytes=function(e,t){return c(u(l(e.split(""),o),62,256),t).reverse()},r.toHex=function(e,t){var r=u(l(e.split(""),o),62,16);return l(c(r,t),n).join("")},r.fromHex=function(e,t){var r=u(l(e.split(""),i),16,62);return l(c(r,t),n).join("")}},{}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decode=r.encode=void 0;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(){for(var e=[],t=0;t<256;++t)e[t]=255;for(t=0;t<n.length;++t)e[n.charCodeAt(t)]=t;return String.fromCharCode.apply(String,e)}();var o=function(e){for(var t=String(e),r=[],i=t.length,o=0;o<i;){var a=255&t.charCodeAt(o++);if(o===i){r.push(n.charAt(a>>2),n.charAt((3&a)<<4),"==");break}var s=t.charCodeAt(o++);if(o===i){r.push(n.charAt(a>>2),n.charAt((3&a)<<4|(240&s)>>4),n.charAt((15&s)<<2),"=");break}var u=t.charCodeAt(o++);r.push(n.charAt(a>>2),n.charAt((3&a)<<4|(240&s)>>4),n.charAt((15&s)<<2|(192&u)>>6),n.charAt(63&u))}return r.join("")};r.encode=o;var a=function(e){for(var t,r,n=String(e),o=[],a=n.length,s=0;;){do{t=i.charCodeAt(255&n.charCodeAt(s++))}while(255===t&&s<a);do{r=i.charCodeAt(255&n.charCodeAt(s++))}while(255===r&&s<a);if(255===r)break;o.push(255&(t<<2|r>>4));do{t=i.charCodeAt(255&n.charCodeAt(s++))}while(255===t&&s<a);if(255===t)break;o.push(255&(r<<4|t>>2));do{r=i.charCodeAt(255&n.charCodeAt(s++))}while(255===r&&s<a);if(255===r)break;o.push(255&(t<<6|r))}return function(e){if(e.length<4096)return String.fromCharCode.apply(String,e);var t=0,r=[];do{r.push(String.fromCharCode.apply(String,e.slice(t,t+4096))),t+=4096}while(t<e.length);return r.join("")}(o)};r.decode=a,"undefined"!=typeof window&&window.btoa&&window.atob&&(r.encode=o=function(e){return window.btoa(e)},r.decode=a=function(e){return window.atob(e)})},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Base64=r.Base62=void 0;var n=e("./base62");r.Base62=n;var i=e("./base64");r.Base64=i},{"./base62":19,"./base64":20}],22:[function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e,i;e="undefined"!=typeof self?self:this,i=function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(e,t,r){(function(t){var r;r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(t,r(6))},function(e,t){function r(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function i(e,t){var r=b(e)||function(e){return function(e){return function(e){return!!e&&"object"==n(e)}(e)&&l(e)}(e)&&E.call(e,"callee")&&(!g.call(e,"callee")||m.call(e)==p)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=r.length,o=!!i;for(var s in e)!t&&!E.call(e,s)||o&&("length"==s||a(s,i))||r.push(s);return r}function o(e,t,r){var n=e[t];E.call(e,t)&&u(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function a(e,t){return!!(t=null==t?_:t)&&("number"==typeof e||y.test(e))&&e>-1&&e%1==0&&e<t}function s(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||v)}function u(e,t){return e===t||e!=e&&t!=t}function l(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=_}(e.length)&&!function(e){var t=c(e)?m.call(e):"";return t==f||t==h}(e)}function c(e){var t=n(e);return!!e&&("object"==t||"function"==t)}function d(e){return l(e)?i(e):function(e){if(!s(e))return T(e);var t=[];for(var r in Object(e))E.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}var _=9007199254740991,p="[object Arguments]",f="[object Function]",h="[object GeneratorFunction]",y=/^(?:0|[1-9]\d*)$/,v=Object.prototype,E=v.hasOwnProperty,m=v.toString,g=v.propertyIsEnumerable,T=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),S=Math.max,P=!g.call({valueOf:1},"valueOf"),b=Array.isArray,R=function(e){return function(e,t){return t=S(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=S(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=a,r(e,this,s)}}((function(t,r){var i=-1,o=r.length,s=o>1?r[o-1]:void 0,d=o>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(o--,s):void 0,d&&function(e,t,r){if(!c(r))return!1;var i=n(t);return!!("number"==i?l(r)&&a(t,r.length):"string"==i&&t in r)&&u(r[t],e)}(r[0],r[1],d)&&(s=o<3?void 0:s,o=1),t=Object(t);++i<o;){var _=r[i];_&&e(t,_)}return t}))}((function(e,t){if(P||s(t)||l(t))!function(e,t,r,n){r||(r={});for(var i=-1,a=t.length;++i<a;){var s=t[i],u=n?n(r[s],e[s],s,r,e):void 0;o(r,s,void 0===u?e[s]:u)}}(t,d(t),e);else for(var r in t)E.call(t,r)&&o(e,r,t[r])}));e.exports=R},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){r=void 0===r?1:r,e[t]=e[t]||0,e[t]+=r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i={now:function(){var e=n.default.performance,t=e&&e.timing;return t&&"number"==typeof t.navigationStart&&"function"==typeof e.now?t.navigationStart+e.now():Date.now()}};t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(20)),i=n.default.methodFactory;n.default.methodFactory=function(e,t,r){var n=i(e,t,r);return function(){for(var e=["[mux]"],t=0;t<arguments.length;t++)e.push(arguments[t]);n.apply(void 0,e)}},n.default.setLevel(n.default.getLevel()),t.default=n.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if("string"!=typeof e||""===e)return["localhost"];var t=(e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4],r=void 0;return t&&(r=(t.match(/[^\.]+\.[^\.]+$/)||[])[0]),[t,r]};t.extractHostnameAndDomain=n,t.extractHostname=function(e){return n(e)[0]},t.extractDomain=function(e){return n(e)[1]}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"==typeof window?"undefined":n(window))&&(r=window)}e.exports=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.generateShortID=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return(e=e||"").trim().split(/[\r\n]+/).forEach((function(e){if(e){var r=e.split(": "),i=r.shift();i&&n.indexOf(i.toLowerCase())>=0&&(t[i]=r.join(": "))}})),t};var n=["x-cdn","content-type"]},function(e,t,r){var i=SyntaxError,o=Function,a=TypeError,s=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(e){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(e){u=null}var l=function(){throw new a},c=u?function(){try{return l}catch(e){try{return u(arguments,"callee").get}catch(e){return l}}}():l,d=r(46)(),_=Object.getPrototypeOf||function(e){return e.__proto__},p={},f="undefined"==typeof Uint8Array?void 0:_(Uint8Array),h={"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":d?_([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?_(_([][Symbol.iterator]())):void 0,"%JSON%":"object"==("undefined"==typeof JSON?"undefined":n(JSON))?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?_((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?_((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?_(""[Symbol.iterator]()):void 0,"%Symbol%":d?Symbol:void 0,"%SyntaxError%":i,"%ThrowTypeError%":c,"%TypedArray%":f,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet},y=function e(t){var r;if("%AsyncFunction%"===t)r=s("async function () {}");else if("%GeneratorFunction%"===t)r=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=s("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(r=_(i.prototype))}return h[t]=r,r},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},E=r(10),m=r(49),g=E.call(Function.call,Array.prototype.concat),T=E.call(Function.apply,Array.prototype.splice),S=E.call(Function.call,String.prototype.replace),P=E.call(Function.call,String.prototype.slice),b=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,R=/\\(\\)?/g,A=function(e){var t=P(e,0,1),r=P(e,-1);if("%"===t&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return S(e,b,(function(e,t,r,i){n[n.length]=r?S(i,R,"$1"):t||e})),n},I=function(e,t){var r,n=e;if(m(v,n)&&(n="%"+(r=v[n])[0]+"%"),m(h,n)){var o=h[n];if(o===p&&(o=y(n)),void 0===o&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');var r=A(e),n=r.length>0?r[0]:"",o=I("%"+n+"%",t),s=o.name,l=o.value,c=!1,d=o.alias;d&&(n=d[0],T(r,g([0,1],d)));for(var _=1,p=!0;_<r.length;_+=1){var f=r[_],y=P(f,0,1),v=P(f,-1);if(('"'===y||"'"===y||"`"===y||'"'===v||"'"===v||"`"===v)&&y!==v)throw new i("property names with quotes must have matching quotes");if("constructor"!==f&&p||(c=!0),m(h,s="%"+(n+="."+f)+"%"))l=h[s];else if(null!=l){if(!(f in l)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(u&&_+1>=r.length){var E=u(l,f);l=(p=!!E)&&"get"in E&&!("originalValue"in E.get)?E.get:l[f]}else p=m(l,f),l=l[f];p&&!c&&(h[s]=l)}}return l}},function(e,t,r){var n=r(48);e.exports=Function.prototype.bind||n},function(e,t,r){var n=String.prototype.replace,i=/%20/g,o="RFC1738",a="RFC3986";e.exports={default:a,formatters:{RFC1738:function(e){return n.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:o,RFC3986:a}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.findMediaElement=t.getMuxPlayerId=void 0;var n=r(7),i=function(e){return e&&void 0!==e.nodeName?(e.muxId||(e.muxId=e.id||(0,n.generateShortID)()),e.muxId):e};t.getMuxPlayerId=i,t.findMediaElement=function(e){var t=void 0;return e&&void 0!==e.nodeName?e=i(t=e):t=document.querySelector(e),[t,e,t&&t.nodeName?t.nodeName.toLowerCase():""]}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"1"===(n.default.doNotTrack||n.default.navigator&&(n.default.navigator.doNotTrack||n.default.navigator.msDoNotTrack))};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i={exists:function(){var e=n.default.performance;return void 0!==(e&&e.timing)},domContentLoadedEventEnd:function(){var e=n.default.performance,t=e&&e.timing;return t&&t.domContentLoadedEventEnd},navigationStart:function(){var e=n.default.performance,t=e&&e.timing;return t&&t.navigationStart}};t.default=i},function(e,t,r){var n=r(44),i=r(54),o=r(11);e.exports={formats:o,parse:i,stringify:n}},function(e,t,r){var i=r(11),o=Object.prototype.hasOwnProperty,a=Array.isArray,s=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),u=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(a(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}},l=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:l,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var o=t[i],a=o.obj[o.prop],s=Object.keys(a),l=0;l<s.length;++l){var c=s[l],d=a[c];"object"==n(d)&&null!==d&&-1===r.indexOf(d)&&(t.push({obj:a,prop:c}),r.push(d))}return u(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r,o,a){if(0===e.length)return e;var u=e;if("symbol"==n(e)?u=Symbol.prototype.toString.call(e):"string"!=typeof e&&(u=String(e)),"iso-8859-1"===r)return escape(u).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<u.length;++c){var d=u.charCodeAt(c);45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||a===i.RFC1738&&(40===d||41===d)?l+=u.charAt(c):d<128?l+=s[d]:d<2048?l+=s[192|d>>6]+s[128|63&d]:d<55296||d>=57344?l+=s[224|d>>12]+s[128|d>>6&63]+s[128|63&d]:(c+=1,d=65536+((1023&d)<<10|1023&u.charCodeAt(c)),l+=s[240|d>>18]+s[128|d>>12&63]+s[128|d>>6&63]+s[128|63&d])}return l},isBuffer:function(e){return!(!e||"object"!=n(e)||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(a(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,i){if(!r)return t;if("object"!=n(r)){if(a(t))t.push(r);else{if(!t||"object"!=n(t))return[t,r];(i&&(i.plainObjects||i.allowPrototypes)||!o.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=n(t))return[t].concat(r);var s=t;return a(t)&&!a(r)&&(s=l(t,i)),a(t)&&a(r)?(r.forEach((function(r,a){if(o.call(t,a)){var s=t[a];s&&"object"==n(s)&&r&&"object"==n(r)?t[a]=e(s,r,i):t.push(r)}else t[a]=r})),t):Object.keys(r).reduce((function(t,n){var a=r[n];return o.call(t,n)?t[n]=e(t[n],a,i):t[n]=a,t}),s)}}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={},r={};return Object.keys(e).forEach((function(n){var i=!1;if(e.hasOwnProperty(n)&&void 0!==e[n]){var a=n.split("_"),l=a[0],c=s[l];c||(o.default.info("Data key word `"+a[0]+"` not expected in "+n),c=l+"_"),a.splice(1).forEach((function(e){"url"===e&&(i=!0),u[e]?c+=u[e]:Number(e)&&Math.floor(Number(e))===Number(e)?c+=e:(o.default.info("Data key word `"+e+"` not expected in "+n),c+="_"+e+"_")})),i?r[c]=e[n]:t[c]=e[n]}})),(0,a.default)(t,r)};var o=n(r(4)),a=n(r(1)),s=i({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),u=i({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"})},function(e,t,r){e.exports=r(19).default},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=n(r(0)),a=r(12),s=n(r(4)),u=n(r(13)),l=n(r(3)),c=n(r(21)),d=n(r(61)),_=n(r(62)),p={},f=function e(t){var r=arguments;"string"==typeof t?e.hasOwnProperty(t)?o.default.setTimeout((function(){r=Array.prototype.splice.call(r,1),e[t].apply(null,r)}),0):s.default.warn("`"+t+"` is an unknown task"):"function"==typeof t?o.default.setTimeout((function(){t(e)}),0):s.default.warn("`"+t+"` is invalid.")};f.loaded=l.default.now(),f.NAME="mux-embed",f.VERSION="4.2.3",f.API_VERSION="2.1",f.PLAYER_TRACKED=!1,f.monitor=function(e,t){return(0,d.default)(f,e,t)},f.destroyMonitor=function(e){var t=(0,a.findMediaElement)(e),r=i(t,1)[0];r&&r.mux&&"function"==typeof r.mux.destroy?r.mux.destroy():s.default.error("A video element monitor for `"+e+"` has not been initialized via `mux.monitor`.")},f.addHLSJS=function(e,t){var r=(0,a.getMuxPlayerId)(e);p[r]?p[r].addHLSJS(t):s.default.error("A monitor for `"+r+"` has not been initialized.")},f.addDashJS=function(e,t){var r=(0,a.getMuxPlayerId)(e);p[r]?p[r].addDashJS(t):s.default.error("A monitor for `"+r+"` has not been initialized.")},f.removeHLSJS=function(e){var t=(0,a.getMuxPlayerId)(e);p[t]?p[t].removeHLSJS():s.default.error("A monitor for `"+t+"` has not been initialized.")},f.removeDashJS=function(e){var t=(0,a.getMuxPlayerId)(e);p[t]?p[t].removeDashJS():s.default.error("A monitor for `"+t+"` has not been initialized.")},f.init=function(e,t){(0,u.default)()&&t&&t.respectDoNotTrack&&s.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var r=(0,a.getMuxPlayerId)(e);p[r]=new c.default(f,r,t)},f.emit=function(e,t,r){var n=(0,a.getMuxPlayerId)(e);p[n]?(p[n].emit(t,r),"destroy"===t&&delete p[n]):s.default.error("A monitor for `"+n+"` has not been initialized.")},void 0!==o.default&&"function"==typeof o.default.addEventListener&&o.default.addEventListener("unload",(function(){f.WINDOW_UNLOADING=!0}),!1),f.checkDoNotTrack=u.default,f.log=s.default,f.utils=_.default,t.default=f},function(e,t,r){var i,o;i=function(){function e(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function t(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":n(console))!==l&&("trace"===r&&c?t:void 0!==console[r]?e(console,r):void 0!==console.log?e(console,"log"):u)}function i(e,t){for(var r=0;r<d.length;r++){var n=d[r];this[n]=r<e?u:this.methodFactory(n,e,t)}this.log=this.debug}function o(e,t,r){return function(){("undefined"==typeof console?"undefined":n(console))!==l&&(i.call(this,t,r),this[e].apply(this,arguments))}}function a(e,t,n){return r(e)||o.apply(this,arguments)}function s(e,t,r){function o(){var e;if(("undefined"==typeof window?"undefined":n(window))!==l&&c){try{e=window.localStorage[c]}catch(e){}if(n(e)===l)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}var s,u=this,c="loglevel";"string"==typeof e?c+=":"+e:"symbol"==n(e)&&(c=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=r||a,u.getLevel=function(){return s},u.setLevel=function(t,r){if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(s=t,!1!==r&&function(e){var t=(d[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":n(window))!==l&&c){try{return void(window.localStorage[c]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+t+";"}catch(e){}}}(t),i.call(u,t,e),("undefined"==typeof console?"undefined":n(console))===l&&t<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){o()||u.setLevel(e,!1)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var _=o();null==_&&(_=null==t?"WARN":t),u.setLevel(_,!1)}var u=function(){},l="undefined",c=("undefined"==typeof window?"undefined":n(window))!==l&&n(window.navigator)!==l&&/Trident\/|MSIE /.test(window.navigator.userAgent),d=["trace","debug","info","warn","error"],_=new s,p={};_.getLogger=function(e){if("symbol"!=n(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new s(e,_.getLevel(),_.methodFactory)),t};var f=("undefined"==typeof window?"undefined":n(window))!==l?window.log:void 0;return _.noConflict=function(){return("undefined"==typeof window?"undefined":n(window))!==l&&window.log===_&&(window.log=f),_},_.getLoggers=function(){return p},_.default=_,_},void 0!==(o="function"==typeof i?i.call(t,r,t,e):i)&&(e.exports=o)},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=n(r(4)),a=n(r(1)),s=r(7),u=r(5),l=n(r(0)),c=n(r(14)),d=n(r(2)),_=n(r(22)),p=r(27),f=r(28),h=n(r(29)),y=n(r(30)),v=n(r(31)),E=n(r(32)),m=n(r(33)),g=n(r(34)),T=n(r(35)),S=n(r(36)),P=n(r(37)),b=n(r(38)),R=n(r(39)),A=n(r(40)),I=n(r(41)),L=n(r(42)),O=n(r(60)),C=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],D=function(e,t,r){var n=this;this.DOM_CONTENT_LOADED_EVENT_END=c.default.domContentLoadedEventEnd(),this.NAVIGATION_START=c.default.navigationStart(),this.mux=e,this.id=t,(r=(0,a.default)({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(e){return e}},r)).data=r.data||{},r.data.property_key&&(r.data.env_key=r.data.property_key,delete r.data.property_key),o.default.setLevel(r.debug?"debug":"warn"),this.getPlayheadTime=r.getPlayheadTime,this.getStateData=r.getStateData||function(){},this.getAdData=r.getAdData||function(){},this.minimumRebufferDuration=r.minimumRebufferDuration,this.sustainedRebufferThreshold=r.sustainedRebufferThreshold,this.playbackHeartbeatTime=r.playbackHeartbeatTime,this.disableRebufferTracking=r.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=r.errorTranslator,this.playbackEventDispatcher=new L.default(e,r.data.env_key,r),this.data={player_instance_id:(0,s.generateUUID)(),mux_sample_rate:r.sampleRate,beacon_domain:r.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(e,t){t=(0,a.default)({viewer_time:this.mux.utils.now()},t),this.oldEmit(e,t)};var i=function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",(function(e,t){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,a.default)(this.data,t),this._initializeViewData(),this.one("play",i),this.one("adbreakstart",i)}));var u=function(e){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",e)}.bind(this);this.on("videochange",(function(e,t){u(t)})),this.on("programchange",(function(e,t){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),u((0,a.default)(t,{view_program_changed:!0})),i(),this.emit("play"),this.emit("playing")})),this.on("destroy",this.destroy);var d=this.destroy.bind(this);void 0!==l.default&&"function"==typeof l.default.addEventListener&&l.default.addEventListener("unload",d,!1),this.on("destroy",(function(){void 0!==l.default&&"function"==typeof l.default.removeEventListener&&l.default.removeEventListener("unload",d)})),this.on("playerready",(function(e,t){(0,a.default)(this.data,t)})),C.forEach((function(e){n.on(e,(function(t,r){0!==e.indexOf("ad")&&this._updateStateData(),(0,a.default)(this.data,r),this._sanitizeData()})),n.on("after"+e,(function(){("error"!==e||this.viewErrored)&&this.send(e)}))})),this.on("viewend",(function(e,t){(0,a.default)(n.data,t)})),this.one("playerready",(function(e){var t=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=t-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time})),v.default.apply(this),I.default.apply(this),b.default.apply(this),g.default.apply(this),y.default.apply(this),P.default.apply(this),E.default.apply(this),m.default.apply(this),R.default.apply(this),T.default.apply(this),S.default.apply(this),A.default.apply(this),O.default.apply(this),r.hlsjs&&this.addHLSJS(r),r.dashjs&&this.addDashJS(r),this.emit("viewinit",r.data)};(0,a.default)(D.prototype,h.default.prototype),(0,a.default)(D.prototype,g.default.prototype),(0,a.default)(D.prototype,b.default.prototype),(0,a.default)(D.prototype,y.default.prototype),(0,a.default)(D.prototype,E.default.prototype),(0,a.default)(D.prototype,m.default.prototype),(0,a.default)(D.prototype,R.default.prototype),(0,a.default)(D.prototype,T.default.prototype),(0,a.default)(D.prototype,S.default.prototype),D.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),l.default.clearTimeout(this._heartBeatTimeout))},D.prototype.send=function(e){var t=(0,a.default)({},this.data);if(1===t.player_error_code&&(delete t.player_error_code,delete t.player_error_message),t.player_source_duration===1/0||t.video_source_duration===1/0?t.video_source_is_live=!0:(t.player_source_duration>0||t.video_source_duration>0)&&(t.video_source_is_live=!1),t.video_source_url=t.video_source_url||t.player_source_url,t.video_source_url){var r=(0,u.extractHostnameAndDomain)(t.video_source_url),n=i(r,2),o=n[0],s=n[1];t.video_source_domain=s,t.video_source_hostname=o}delete t.ad_request_id,this.playbackEventDispatcher.send(e,t),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},D.prototype._updateStateData=function(){(0,a.default)(this.data,this.getStateData()),this.getPlayheadTime&&(this.data.player_playhead_time=this.getPlayheadTime()),this._sanitizeData()},D.prototype._sanitizeData=function(){var e=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach((function(t){var r=parseInt(e.data[t],10);e.data[t]=isNaN(r)?void 0:r})),["player_source_url","video_source_url"].forEach((function(t){if(e.data[t]){var r=e.data[t].toLowerCase();0!==r.indexOf("data:")&&0!==r.indexOf("blob:")||(e.data[t]="MSE style URL")}}))},D.prototype._resetVideoData=function(e,t){var r=this;Object.keys(this.data).forEach((function(e){0===e.indexOf("video_")&&delete r.data[e]}))},D.prototype._resetViewData=function(){var e=this;Object.keys(this.data).forEach((function(t){0===t.indexOf("view_")&&delete e.data[t]})),this.data.view_sequence_number=1},D.prototype._resetErrorData=function(e,t){delete this.data.player_error_code,delete this.data.player_error_message},D.prototype._initializeViewData=function(){var e=this,t=this.data.view_id=(0,s.generateUUID)();this.data.video_id||(this.data.video_id=(0,_.default)(this.data.player_source_url));var r=function(){t===e.data.view_id&&(0,d.default)(e.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",r):r()},D.prototype._restartHeartBeat=function(){var e=this;l.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=l.default.setTimeout((function(){e.data.player_is_paused||e.emit("hb")}),1e4))},D.prototype.addHLSJS=function(e){return e.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=e.hlsjs,void(0,p.monitorHlsJs)(this.mux,this.id,e.hlsjs,{},e.Hls||l.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},D.prototype.removeHLSJS=function(){this.hlsjs&&((0,p.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},D.prototype.addDashJS=function(e){return e.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=e.dashjs,void(0,f.monitorDashJS)(this.mux,this.id,e.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},D.prototype.removeDashJS=function(){this.dashjs&&((0,f.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},t.default=D},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=i.default.createElement("a");t.href=e;var r=t.pathname.replace(/\.[^/.]+$/,"");return o.default.encode(t.host+r).split("=")[0]};var i=n(r(23)),o=n(r(25))},function(e,t,r){(function(t){var n,i=void 0!==t?t:"undefined"!=typeof window?window:{},o=r(24);"undefined"!=typeof document?n=document:(n=i["__GLOBAL_DOCUMENT_CACHE@4"])||(n=i["__GLOBAL_DOCUMENT_CACHE@4"]=o),e.exports=n}).call(t,r(6))},function(e,t){},function(e,t,r){(function(e,i){var o;!function(a){n(t),"object"==n(e)&&e&&e.exports,n(i);var s=function(e){this.message=e};(s.prototype=new Error).name="InvalidCharacterError";var u=function(e){throw new s(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=/[\t\n\f\r ]/g,d={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,n,i,o=e.length%3,a="",s=-1,c=e.length-o;++s<c;)t=e.charCodeAt(s)<<16,r=e.charCodeAt(++s)<<8,n=e.charCodeAt(++s),a+=l.charAt((i=t+r+n)>>18&63)+l.charAt(i>>12&63)+l.charAt(i>>6&63)+l.charAt(63&i);return 2==o?(t=e.charCodeAt(s)<<8,r=e.charCodeAt(++s),a+=l.charAt((i=t+r)>>10)+l.charAt(i>>4&63)+l.charAt(i<<2&63)+"="):1==o&&(i=e.charCodeAt(s),a+=l.charAt(i>>2)+l.charAt(i<<4&63)+"=="),a},decode:function(e){var t=(e=String(e).replace(c,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&u("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,i=0,o="",a=-1;++a<t;)n=l.indexOf(e.charAt(a)),r=i%4?64*r+n:n,i++%4&&(o+=String.fromCharCode(255&r>>(-2*i&6)));return o},version:"0.1.0"};void 0!==(o=function(){return d}.call(t,r,t,e))&&(e.exports=o)}()}).call(t,r(26)(e),r(6))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.stopMonitoringHlsJs=t.monitorHlsJs=void 0;var i=n(r(8)),o=n(r(14)),a=r(5),s=function(e){if(!e)return{};var t=o.default.navigationStart(),r=e.loading,n=r?r.start:e.trequest,i=r?r.first:e.tfirst,a=r?r.end:e.tload;return{bytesLoaded:e.total,requestStart:Math.round(t+n),responseStart:Math.round(t+i),responseEnd:Math.round(t+a)}},u=function(e){if(e&&"function"==typeof e.getAllResponseHeaders)return(0,i.default)(e.getAllResponseHeaders())};t.monitorHlsJs=function(e,t,r){var n=arguments[4],i=e.log;if(o.default.exists()){var l=function(r,n){return e.emit(t,r,n)},c=function(e,t){var r=t.levels,n=t.audioTracks,i=t.url,o=t.stats,c=t.networkDetails,d={},_={};r.forEach((function(e,t){d[t]={width:e.width,height:e.height,bitrate:e.bitrate,attrs:e.attrs}})),n.forEach((function(e,t){_[t]={name:e.name,language:e.lang,bitrate:e.bitrate}}));var p=s(o),f=p.bytesLoaded,h=p.requestStart,y=p.responseStart,v=p.responseEnd;l("requestcompleted",{request_event_type:e,request_bytes_loaded:f,request_start:h,request_response_start:y,request_response_end:v,request_type:"manifest",request_hostname:(0,a.extractHostname)(i),request_response_headers:u(c),request_rendition_lists:{media:d,audio:_,video:{}}})};r.on(n.Events.MANIFEST_LOADED,c);var d=function(e,t){var r=t.details,n=t.level,i=t.networkDetails,o=t.stats,c=s(o),d=c.bytesLoaded,_=c.requestStart,p=c.responseStart,f=c.responseEnd;l("requestcompleted",{request_event_type:e,request_bytes_loaded:d,request_start:_,request_response_start:p,request_response_end:f,request_current_level:n,request_type:"manifest",request_hostname:(0,a.extractHostname)(r.url),request_response_headers:u(i)})};r.on(n.Events.LEVEL_LOADED,d);var _=function(e,t){var r=t.details,n=t.networkDetails,i=t.stats,o=s(i),c=o.bytesLoaded,d=o.requestStart,_=o.responseStart,p=o.responseEnd;l("requestcompleted",{request_event_type:e,request_bytes_loaded:c,request_start:d,request_response_start:_,request_response_end:p,request_type:"manifest",request_hostname:(0,a.extractHostname)(r.url),request_response_headers:u(n)})};r.on(n.Events.AUDIO_TRACK_LOADED,_);var p=function(e,t){var n=t.stats,i=t.networkDetails,o=t.frag,c=s(n),d=c.bytesLoaded,_=c.requestStart,p=c.responseStart,f={request_event_type:e,request_bytes_loaded:d,request_start:_,request_response_start:p,request_response_end:c.responseEnd,request_hostname:i?(0,a.extractHostname)(i.responseURL):void 0,request_response_headers:u(i),request_media_duration:o.duration};"main"===o.type?(f.request_type="media",f.request_current_level=o.level,f.request_video_width=(r.levels[o.level]||{}).width,f.request_video_height=(r.levels[o.level]||{}).height):f.request_type=o.type,l("requestcompleted",f)};r.on(n.Events.FRAG_LOADED,p);var f=function(e,t){var r=t.details,i=t.response,o=t.context,s=t.frag;if(r===n.ErrorDetails.MANIFEST_LOAD_ERROR||r===n.ErrorDetails.MANIFEST_LOAD_TIMEOUT||r===n.ErrorDetails.FRAG_LOAD_ERROR||r===n.ErrorDetails.FRAG_LOAD_TIMEOUT||r===n.ErrorDetails.LEVEL_LOAD_ERROR||r===n.ErrorDetails.LEVEL_LOAD_TIMEOUT){var u=s&&s.url||o&&o.url||"";l("requestfailed",{request_error:r,request_url:u,request_hostname:(0,a.extractHostname)(u),request_type:r===n.ErrorDetails.FRAG_LOAD_ERROR||r===n.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:i&&i.code,request_error_text:i&&i.text})}};r.on(n.Events.ERROR,f);var h=function(e,t){var r=t.frag,n=r&&r._url||"";l("requestcanceled",{request_cancel:e,request_url:n,request_type:"media",request_hostname:(0,a.extractHostname)(n)})};r.on(n.Events.FRAG_LOAD_EMERGENCY_ABORTED,h);var y=function(e,t){var n=t.level,o=r.levels[n];if(o&&o.attrs&&o.attrs.BANDWIDTH){var a=o.attrs.BANDWIDTH;a?l("renditionchange",{video_source_bitrate:a,video_source_width:o.width,video_source_height:o.height}):i.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};r.on(n.Events.LEVEL_SWITCHED,y),r._stopMuxMonitor=function(){r.off(n.Events.MANIFEST_LOADED,c),r.off(n.Events.LEVEL_LOADED,d),r.off(n.Events.AUDIO_TRACK_LOADED,_),r.off(n.Events.FRAG_LOADED,p),r.off(n.Events.ERROR,f),r.off(n.Events.FRAG_LOAD_EMERGENCY_ABORTED,h),r.off(n.Events.LEVEL_SWITCHED,y),r.off(n.Events.DESTROYING,r._stopMuxMonitor),delete r._stopMuxMonitor},r.on(n.Events.DESTROYING,r._stopMuxMonitor)}else i.warn("performance timing not supported. Not tracking HLS.js.")},t.stopMonitoringHlsJs=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.stopMonitoringDashJS=t.monitorDashJS=void 0;var i=n(r(0)),o=n(r(8)),a=r(5),s=function(e,t){if(!e||"function"!=typeof e.getRequests)return{};var r=e.getRequests({state:"executed"});if(0===r.length)return{};var n=r[r.length-1],i=(0,a.extractHostname)(n.url),s=n.bytesLoaded,u=new Date(n.requestStartDate).getTime(),l=new Date(n.firstByteDate).getTime(),c=new Date(n.requestEndDate).getTime(),d=isNaN(n.duration)?0:n.duration,_="function"==typeof t.getMetricsFor?t.getMetricsFor(n.mediaType).HttpList:t.getDashMetrics().getHttpRequests(n.mediaType),p=void 0;return _.length>0&&(p=(0,o.default)(_[_.length-1]._responseHeaders||"")),{requestStart:u,requestResponseStart:l,requestResponseEnd:c,requestBytesLoaded:s,requestResponseHeaders:p,requestMediaDuration:d,requestHostname:i}},u=function(e,t){var r=t.getQualityFor(e),n=t.getCurrentTrackFor(e).bitrateList;return n?{currentLevel:r,renditionWidth:n[r].width||null,renditionHeight:n[r].height||null,renditionBitrate:n[r].bandwidth}:{}};t.monitorDashJS=function(e,t,r){var n=e.log;if(r&&r.on){var o=function(r,n){return e.emit(t,r,n)},l=function(e){var t=e.type,r=(e.data||{}).url;o("requestcompleted",{request_event_type:t,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,a.extractHostname)(r)})};r.on("manifestLoaded",l);var c={},d=function(e){var t=e.type,n=e.fragmentModel,i=(e.chunk||{}).mediaInfo||{},a=i.type,u=i.bitrateList,l={};(u=u||[]).forEach((function(e,t){l[t]={},l[t].width=e.width,l[t].height=e.height,l[t].bitrate=e.bandwidth,l[t].attrs={}})),"video"===a?c.video=l:"audio"===a?c.audio=l:c.media=l;var d=s(n,r),_=d.requestStart,p=d.requestResponseStart,f=d.requestResponseEnd,h=d.requestResponseHeaders,y=d.requestMediaDuration,v=d.requestHostname;o("requestcompleted",{request_event_type:t,request_start:_,request_response_start:p,request_response_end:f,request_bytes_loaded:-1,request_type:a+"_init",request_response_headers:h,request_hostname:v,request_media_duration:y,request_rendition_lists:c})};r.on("initFragmentLoaded",d);var _=function(e){var t=e.type,n=e.fragmentModel,i=e.chunk||{},a=i.mediaInfo,l=i.start,c=(a||{}).type,d=s(n,r),_=d.requestStart,p=d.requestResponseStart,f=d.requestResponseEnd,h=d.requestBytesLoaded,y=d.requestResponseHeaders,v=d.requestMediaDuration,E=d.requestHostname,m=u(c,r),g=m.currentLevel,T=m.renditionWidth,S=m.renditionHeight,P=m.renditionBitrate;o("requestcompleted",{request_event_type:t,request_start:_,request_response_start:p,request_response_end:f,request_bytes_loaded:h,request_type:c,request_response_headers:y,request_hostname:E,request_media_start_time:l,request_media_duration:v,request_current_level:g,request_labeled_bitrate:P,request_video_width:T,request_video_height:S})};r.on("mediaFragmentLoaded",_);var p={video:void 0,audio:void 0,totalBitrate:void 0},f=function(){if(p.video&&"number"==typeof p.video.bitrate){if(!p.video.width||!p.video.height)return void n.warn("have bitrate info for video but missing width/height");var e=p.video.bitrate;return p.audio&&"number"==typeof p.audio.bitrate&&(e+=p.audio.bitrate),e!==p.totalBitrate?(p.totalBitrate=e,{video_source_bitrate:e,video_source_height:p.video.height,video_source_width:p.video.width}):void 0}},h=function(e,t,i){if("number"==typeof e.newQuality){var a=e.mediaType;if("audio"===a||"video"===a){var s=r.getBitrateInfoListFor(a).find((function(t){return t.qualityIndex===e.newQuality}));if(!s||"number"!=typeof s.bitrate)return void n.warn("missing bitrate info for "+a);p[a]=s;var u=f();u&&o("renditionchange",u)}}else n.warn("missing evt.newQuality in qualityChangeRendered event",e)};r.on("qualityChangeRendered",h);var y=function(e){var t=e.error,r=e.event,n=(r=r||{}).request||{},s=i.default.event&&i.default.event.currentTarget||{};o("requestfailed",{request_error:t+"_"+r.id+"_"+n.type,request_url:r.url,request_hostname:(0,a.extractHostname)(r.url),request_type:n.mediaType,request_error_code:s.status,request_error_type:s.statusText})};r.on("error",y),r._stopMuxMonitor=function(){r.off("manifestLoaded",l),r.off("initFragmentLoaded",d),r.off("mediaFragmentLoaded",_),r.off("qualityChangeRendered",h),r.off("error",y),delete r._stopMuxMonitor}}else n.warn("Invalid dash.js player reference. Monitoring blocked.")},t.stopMonitoringDashJS=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){},i=0;n.prototype.on=function(e,t,r){return t._eventEmitterGuid=t._eventEmitterGuid||++i,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],r&&(t=t.bind(r)),this._listeners[e].push(t),t},n.prototype.off=function(e,t){var r=this._listeners&&this._listeners[e];r&&r.forEach((function(e,n){e._eventEmitterGuid===t._eventEmitterGuid&&r.splice(n,1)}))},n.prototype.one=function(e,t,r){var n=this;t._eventEmitterGuid=t._eventEmitterGuid||++i;var o=function i(){n.off(e,i),t.apply(r||this,arguments)};o._eventEmitterGuid=t._eventEmitterGuid,this.on(e,o)},n.prototype.emit=function(e,t){var r=this;if(this._listeners){t=t||{};var n=this._listeners["before*"]||[],i=this._listeners[e]||[],o=this._listeners["after"+e]||[],a=function(t,n){(t=t.slice()).forEach((function(t){t.call(r,{type:e},n)}))};a(n,t),a(i,t),a(o,t)}},t.default=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",(function(){this._playheadShouldBeProgressing=!0})),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",(function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()})),this.on("timeupdate",(function(){null!==this._playbackHeartbeatInterval&&this.emit("playbackheartbeat")})),this.on("devicesleep",(function(e,t){null!==this._playbackHeartbeatInterval&&(n.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:t.viewer_time}),this._playbackHeartbeatInterval=null)}))};i.prototype._startPlaybackHeartbeatInterval=function(){var e=this;null===this._playbackHeartbeatInterval&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=n.default.setInterval((function(){e.emit("playbackheartbeat")}),this.playbackHeartbeatTime))},i.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(n.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;this.on("viewinit",(function(){e.viewErrored=!1})),this.on("error",(function(){try{var t=e.errorTranslator({player_error_code:e.data.player_error_code,player_error_message:e.data.player_error_message});t?(e.data.player_error_code=t.player_error_code,e.data.player_error_message=t.player_error_message,e.viewErrored=!0):(delete e.data.player_error_code,delete e.data.player_error_message)}catch(t){e.mux.log.warn("Exception in error translator callback.",t),e.viewErrored=!0}}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2)),i=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};i.prototype._updateWatchTime=function(e,t){var r=t.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=r),(0,n.default)(this.data,"view_watch_time",r-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=r},i.prototype._clearWatchTimeState=function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2)),i=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};i.prototype._updatePlaybackTime=function(){var e=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition){var t=e-this._playbackTimeTrackerLastPlayheadPosition;t<=1e3&&(0,n.default)(this.data,"view_content_playback_time",t)}this._playbackTimeTrackerLastPlayheadPosition=e},i.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",(function(){this.off("timeupdate",this._updatePlayheadTime)}))};n.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=void 0===this.data.view_max_playhead_position?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},n.prototype._updatePlayheadTime=function(e,t){if(t.player_playhead_time)this.data.player_playhead_time=t.player_playhead_time,this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var r=this.getPlayheadTime();void 0!==r&&(this.data.player_playhead_time=r,this._updateMaxPlayheadPosition())}},t.default=n},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(3)),o=n(r(2)),a=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",(function(){this._cleanupRebufferTracker(null,{viewer_time:i.default.now()})}))};a.prototype._checkIfRebuffering=function(e,t){if(!this.disableRebufferTracking){if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(e,t);if(null===this._lastCheckedTime)return this._prepareRebufferTrackerState(t.viewer_time),void this._updateRebufferMetrics();if(this._lastPlayheadTime!==this.data.player_playhead_time)return void this._cleanupRebufferTracker(e,t,!0);var r=t.viewer_time-this._lastPlayheadTimeUpdatedTime;r>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(t.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,o.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(r),this.emit("rebufferstart"))),this._lastCheckedTime=t.viewer_time}},a.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},a.prototype._prepareRebufferTrackerState=function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e},a.prototype._cleanupRebufferTracker=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(t.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:t.viewer_time});else{if(null===this._lastCheckedTime)return void this._updateRebufferMetrics();var n=this.data.player_playhead_time-this._lastPlayheadTime,i=t.viewer_time-this._lastPlayheadTimeUpdatedTime;n>0&&i-n>this.minimumRebufferDuration?((0,o.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(i-n),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+i-n})):this._updateRebufferMetrics()}r?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}},a.prototype._updateRebufferMetrics=function(e){e>0&&(0,o.default)(this.data,"view_rebuffer_duration",e),this.data.view_watch_time>=0&&this.data.view_rebuffer_count>0&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},t.default=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),i=function(){this.on("viewinit",(function(){var e=this.data,t=e.view_id;if(!e.view_program_changed){var r=function(e,r){var i=r.viewer_time;"playing"===e.type&&void 0===this.data.view_time_to_first_frame?this.calculateTimeToFirstFrame(i||n.default.now(),t):"adplaying"!==e.type||void 0!==this.data.view_time_to_first_frame&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(i||n.default.now(),t)};this.one("playing",r),this.one("adplaying",r),this.one("viewend",(function(){this.off("playing",r),this.off("adplaying",r)}))}}))};i.prototype.calculateTimeToFirstFrame=function(e,t){t===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:e}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;this.on("viewinit",(function(){this._lastPlayheadPosition=-1})),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach((function(t){e.on(t,(function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var e=this.data.player_playhead_time-this._lastPlayheadPosition;if(e<0)return void(this._lastPlayheadPosition=-1);var t=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),r=Math.max(0,t-1),i=Math.max(0,1-t);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,r),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,i),(0,n.default)(this.data,"view_total_content_playback_time",e),(0,n.default)(this.data,"view_total_upscaling",r*e),(0,n.default)(this.data,"view_total_downscaling",i*e)}this._lastPlayheadPosition=-1}))})),["playing","hb"].forEach((function(t){e.on(t,(function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height}))}))};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2))},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){this.isSeeking=!1,this.on("seeking",(function(e,t){(0,a.default)(this.data,t),this._lastSeekingTime=i.default.now(),!1===this.isSeeking&&(this.isSeeking=!0,this.send("seeking"))})),this.on("seeked",(function(){this.isSeeking=!1;var e=this._lastSeekingTime||i.default.now(),t=i.default.now()-e;(0,o.default)(this.data,"view_seek_count",1),(0,o.default)(this.data,"view_seek_duration",t);var r=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(r,t)})),this.on("viewend",(function(){this.isSeeking=!1}))};var i=n(r(3)),o=n(r(2)),a=n(r(1))},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=n(r(2)),a=r(5),s=n(r(1)),u=function(e,t){e.push(t),e.sort((function(e,t){return e.viewer_time-t.viewer_time}))},l=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],c=function(){var e=this;this.on("viewinit",(function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0})),l.forEach((function(t){return e.on(t,e._updateAdData)}));var t=function(){e.isAdBreak=!1};this.on("adbreakstart",(function(){this.isAdBreak=!0})),this.on("play",t),this.on("playing",t),this.on("viewend",t),this.on("adrequest",(function(e,t){t=(0,s.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},t),u(this._adRequests,t),(0,o.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,o.default)(this.data,"view_preroll_request_count"))})),this.on("adresponse",(function(e,t){t=(0,s.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},t),u(this._adResponses,t);var r=this.findAdRequest(t.ad_request_id);r&&(0,o.default)(this.data,"view_ad_request_time",Math.max(0,t.viewer_time-r.viewer_time))})),this.on("adplay",(function(e,t){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,o.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,t.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,t.viewer_time-this.data.view_start)),this._prerollPlayTime=t.viewer_time)})),this.on("adplaying",(function(e,t){this.inPrerollPosition()&&void 0===this.data.view_preroll_load_time&&void 0!==this._prerollPlayTime&&(this.data.view_preroll_load_time=t.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=t.viewer_time-this._prerollPlayTime)})),this.on("adended",(function(){this._wouldBeNewAdPlay=!0})),this.on("aderror",(function(){this._wouldBeNewAdPlay=!0}))};c.prototype.inPrerollPosition=function(){return void 0===this.data.view_content_playback_time||this.data.view_content_playback_time<=1e3},c.prototype.findAdRequest=function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]},c.prototype._updateAdData=function(e,t){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var r=(0,a.extractHostnameAndDomain)(t.ad_tag_url),n=i(r,2),o=n[0],s=n[1];this.data.view_preroll_ad_tag_domain=s,this.data.view_preroll_ad_tag_hostname=o}if(!this.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var u=(0,a.extractHostnameAndDomain)(t.ad_asset_url),l=i(u,2),c=l[0],d=l[1];this.data.view_preroll_ad_asset_domain=d,this.data.view_preroll_ad_asset_hostname=c}}},t.default=c},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this,t=void 0,r=void 0,n=function(){e.disableRebufferTracking||t&&((0,o.default)(e.data,"view_waiting_rebuffer_duration",i.default.now()-t),t=!1,window.clearInterval(r))},a=!1,s=function(){a=!1,n()};this.on("waiting",(function(){a&&(e.disableRebufferTracking||((0,o.default)(e.data,"view_waiting_rebuffer_count",1),t=i.default.now(),r=window.setInterval((function(){if(t){var r=i.default.now();(0,o.default)(e.data,"view_waiting_rebuffer_duration",r-t),t=r}}),250)))})),this.on("playing",(function(){n(),a=!0})),this.on("pause",s),this.on("seeking",s)};var i=n(r(3)),o=n(r(2))},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;this.one("playbackheartbeat",a),this.on("playbackheartbeatend",(function(){e.off("before*",s),e.one("playbackheartbeat",a)}))};var i=n(r(1)),o=n(r(3)),a=function(){this.lastWallClockTime=o.default.now(),this.on("before*",s)},s=function(e){var t=o.default.now(),r=this.lastWallClockTime;this.lastWallClockTime=t,t-r>3e4&&(this.emit("devicesleep",{viewer_time:r}),(0,i.default)(this.data,{viewer_time:r}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:t}),(0,i.default)(this.data,{viewer_time:t}),this.send("devicewake"))}},function(e,t,r){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},a=i(r(0)),s=r(43),u=i(r(4)),l=i(r(56)),c=i(r(13)),d=i(r(57)),_=i(r(17)),p=i(r(58)),f=i(r(1)),h=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],y=["viewstart","error","ended","viewend"],v=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.mux=e,this.envKey=t,this.eventQueue=new p.default((0,l.default)(t,r.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=r.sampleRate,this.disableCookies=r.disableCookies,this.respectDoNotTrack=r.respectDoNotTrack;var n=r.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:n.name,viewer_application_version:n.version,viewer_application_engine:n.layout,viewer_device_name:n.product,viewer_device_category:"",viewer_device_manufacturer:n.manufacturer,viewer_os_family:n.os&&n.os.family,viewer_os_architecture:n.os&&n.os.architecture,viewer_os_version:n.os&&n.os.version};var i=(0,d.default)();i&&(this.pageLevelData=(0,f.default)(this.pageLevelData,{viewer_connection_type:i})),void 0!==a.default&&a.default.location&&a.default.location.href&&(this.pageLevelData.page_url=a.default.location.href),this.viewerData=this.disableCookies?{}:(0,s.getAndUpdateViewerData)()};v.prototype.send=function(e,t){if(e){if(this.respectDoNotTrack&&(0,c.default)())return u.default.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||"object"!==(void 0===t?"undefined":o(t)))return u.default.error("A data object was expected in send() but was not provided");var r=this.disableCookies?{}:(0,s.getAndUpdateSessionData)(),n={};(0,f.default)(n,this.pageLevelData),(0,f.default)(n,t),(0,f.default)(n,r),(0,f.default)(n,this.viewerData),n.event=e,n.env_key=this.envKey,n.user_id&&(n.viewer_user_id=n.user_id,delete n.user_id);var i=n.mux_sample_number>=this.sampleRate,a=this._deduplicateBeaconData(e,n),l=(0,_.default)(a);if(this.lastEventTime=this.mux.utils.now(),i)return u.default.info("Not sending event due to sample rate restriction",e,n,l);if(!this.envKey)return u.default.info("Not sending event due to missing environment key",e,n,l);if(!this.rateLimited)if(u.default.info("Sending event",e,n,l),this.rateLimited=!this.eventQueue.queueEvent(e,l),this.mux.WINDOW_UNLOADING&&"viewend"===e)this.eventQueue.destroy(!0);else if(y.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return n.event="eventrateexceeded",l=(0,_.default)(n),this.eventQueue.queueEvent(n.event,l),u.default.error("Beaconing disabled due to rate limit.")}},v.prototype.destroy=function(){this.eventQueue.destroy(!1)};var E=function(e,t,r,n){return!(!e||0!==t.indexOf("request_")||"request_response_headers"!==t&&"object"===(void 0===r?"undefined":o(r))&&"object"===(void 0===n?"undefined":o(n))&&Object.keys(r||{}).length===Object.keys(n||{}).length)};v.prototype._deduplicateBeaconData=function(e,t){var r=this,n={},i=t.view_id;if(!i||"viewstart"===e||"viewend"===e||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)n=(0,f.default)({},t),i&&(this.previousBeaconData=n),i&&"viewend"===e&&(this.previousBeaconData=null);else{var o=0===e.indexOf("request");Object.keys(t).forEach((function(i){var a=t[i];(a!==r.previousBeaconData[i]||h.indexOf(i)>-1||E(o,i,a,r.previousBeaconData[i])||function(e,t){return"renditionchange"===e&&0===t.indexOf("video_source_")}(e,i))&&(n[i]=a,r.previousBeaconData[i]=a)}))}return n},t.default=v},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateSessionData=t.getAndUpdateViewerData=void 0;var i=n(r(15)),o=n(r(55)),a=r(7),s=n(r(3)),u=function(){var e=void 0;try{e=i.default.parse(o.default.get("muxData")||"")}catch(t){e={}}return e},l=function(e){try{o.default.set("muxData",i.default.stringify(e),{expires:7300})}catch(e){}};t.getAndUpdateViewerData=function(){var e=u();return e.mux_viewer_id=e.mux_viewer_id||(0,a.generateUUID)(),e.msn=e.msn||Math.random(),l(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},t.getAndUpdateSessionData=function(){var e=u(),t=s.default.now();return e.session_start&&(e.sst=e.session_start,delete e.session_start),e.session_id&&(e.sid=e.session_id,delete e.session_id),e.session_expires&&(e.sex=e.session_expires,delete e.session_expires),(!e.sex||e.sex<t)&&(e.sid=(0,a.generateUUID)(),e.sst=t),e.sex=t+15e5,l(e),{session_id:e.sid,session_start:e.sst,session_expires:e.sex}}},function(e,t,r){var i=r(45),o=r(16),a=r(11),s=Object.prototype.hasOwnProperty,u={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,d=function(e,t){c.apply(e,l(t)?t:[t])},_=Date.prototype.toISOString,p=a.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:p,formatter:a.formatters[p],indices:!1,serializeDate:function(e){return _.call(e)},skipNulls:!1,strictNullHandling:!1},h=function e(t,r,a,s,u,c,_,p,h,y,v,E,m,g,T){var S=t;if(T.has(t))throw new RangeError("Cyclic object value");if("function"==typeof _?S=_(r,S):S instanceof Date?S=y(S):"comma"===a&&l(S)&&(S=o.maybeMap(S,(function(e){return e instanceof Date?y(e):e}))),null===S){if(s)return c&&!m?c(r,f.encoder,g,"key",v):r;S=""}if(function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==n(e)||"bigint"==typeof e}(S)||o.isBuffer(S))return c?[E(m?r:c(r,f.encoder,g,"key",v))+"="+E(c(S,f.encoder,g,"value",v))]:[E(r)+"="+E(String(S))];var P,b=[];if(void 0===S)return b;if("comma"===a&&l(S))P=[{value:S.length>0?S.join(",")||null:void 0}];else if(l(_))P=_;else{var R=Object.keys(S);P=p?R.sort(p):R}for(var A=0;A<P.length;++A){var I=P[A],L="object"==n(I)&&void 0!==I.value?I.value:S[I];if(!u||null!==L){var O=l(S)?"function"==typeof a?a(r,I):r:r+(h?"."+I:"["+I+"]");T.set(t,!0);var C=i();d(b,e(L,O,a,s,u,c,_,p,h,y,v,E,m,g,C))}}return b},y=function(e){if(!e)return f;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||f.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=a.default;if(void 0!==e.format){if(!s.call(a.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=a.formatters[r],i=f.filter;return("function"==typeof e.filter||l(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===e.allowDots?f.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:f.charsetSentinel,delimiter:void 0===e.delimiter?f.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:f.encode,encoder:"function"==typeof e.encoder?e.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:f.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:f.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:f.strictNullHandling}};e.exports=function(e,t){var r,o=e,a=y(t);"function"==typeof a.filter?o=(0,a.filter)("",o):l(a.filter)&&(r=a.filter);var s,c=[];if("object"!=n(o)||null===o)return"";s=t&&t.arrayFormat in u?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var _=u[s];r||(r=Object.keys(o)),a.sort&&r.sort(a.sort);for(var p=i(),f=0;f<r.length;++f){var v=r[f];a.skipNulls&&null===o[v]||d(c,h(o[v],v,_,a.strictNullHandling,a.skipNulls,a.encode?a.encoder:null,a.filter,a.sort,a.allowDots,a.serializeDate,a.format,a.formatter,a.encodeValuesOnly,a.charset,p))}var E=c.join(a.delimiter),m=!0===a.addQueryPrefix?"?":"";return a.charsetSentinel&&("iso-8859-1"===a.charset?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),E.length>0?m+E:""}},function(e,t,r){var i=r(9),o=r(50),a=r(52),s=i("%TypeError%"),u=i("%WeakMap%",!0),l=i("%Map%",!0),c=o("WeakMap.prototype.get",!0),d=o("WeakMap.prototype.set",!0),_=o("WeakMap.prototype.has",!0),p=o("Map.prototype.get",!0),f=o("Map.prototype.set",!0),h=o("Map.prototype.has",!0),y=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};e.exports=function(){var e,t,r,i={assert:function(e){if(!i.has(e))throw new s("Side channel does not contain "+a(e))},get:function(i){if(u&&i&&("object"==n(i)||"function"==typeof i)){if(e)return c(e,i)}else if(l){if(t)return p(t,i)}else if(r)return function(e,t){var r=y(e,t);return r&&r.value}(r,i)},has:function(i){if(u&&i&&("object"==n(i)||"function"==typeof i)){if(e)return _(e,i)}else if(l){if(t)return h(t,i)}else if(r)return function(e,t){return!!y(e,t)}(r,i);return!1},set:function(i,o){u&&i&&("object"==n(i)||"function"==typeof i)?(e||(e=new u),d(e,i,o)):l?(t||(t=new l),f(t,i,o)):(r||(r={key:{},next:null}),function(e,t,r){var n=y(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(r,i,o))}};return i}},function(e,t,r){var i="undefined"!=typeof Symbol&&Symbol,o=r(47);e.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==n(i("foo"))&&"symbol"==n(Symbol("bar"))&&o()}},function(e,t,r){e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==n(Symbol.iterator))return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},function(e,t,r){var n=Array.prototype.slice,i=Object.prototype.toString;e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==i.call(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var r,o=n.call(arguments,1),a=function(){if(this instanceof r){var i=t.apply(this,o.concat(n.call(arguments)));return Object(i)===i?i:this}return t.apply(e,o.concat(n.call(arguments)))},s=Math.max(0,t.length-o.length),u=[],l=0;l<s;l++)u.push("$"+l);if(r=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var c=function(){};c.prototype=t.prototype,r.prototype=new c,c.prototype=null}return r}},function(e,t,r){var n=r(10);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},function(e,t,r){var n=r(9),i=r(51),o=i(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&o(e,".prototype.")>-1?i(r):r}},function(e,t,r){var n=r(10),i=r(9),o=i("%Function.prototype.apply%"),a=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||n.call(a,o),u=i("%Object.getOwnPropertyDescriptor%",!0),l=i("%Object.defineProperty%",!0),c=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=s(n,a,arguments);return u&&l&&u(t,"length").configurable&&l(t,"length",{value:1+c(0,e.length-(arguments.length-1))}),t};var d=function(){return s(n,o,arguments)};l?l(e.exports,"apply",{value:d}):e.exports.apply=d},function(e,t,r){function i(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function o(e){return String(e).replace(/"/g,"&quot;")}function a(e){return!("[object Array]"!==l(e)||q&&"object"==n(e)&&q in e)}function s(e){if(H)return e&&"object"==n(e)&&e instanceof Symbol;if("symbol"==n(e))return!0;if(!e||"object"!=n(e)||!j)return!1;try{return j.call(e),!0}catch(e){}return!1}function u(e,t){return G.call(e,t)}function l(e){return k.call(e)}function c(e){if(e.name)return e.name;var t=U.call(M.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function d(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function _(e){if(!C||!e||"object"!=n(e))return!1;try{C.call(e,C);try{D.call(e,D)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}function p(e){if(!N||!e||"object"!=n(e))return!1;try{return N.call(e),!0}catch(e){}return!1}function f(e){if(!D||!e||"object"!=n(e))return!1;try{D.call(e,D);try{C.call(e,C)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}function h(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return h(e.slice(0,t.maxStringLength),t)+n}return i(e.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,y),"single",t)}function y(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+t.toString(16).toUpperCase()}function v(e){return"Object("+e+")"}function E(e){return e+" { ? }"}function m(e,t,r,n){return e+" ("+t+") {"+(n?g(r,n):r.join(", "))+"}"}function g(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+e.join(","+r)+"\n"+t.prev}function T(e,t){var r=a(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=u(e,i)?t(e[i],e):""}var o,s="function"==typeof x?x(e):[];if(H){o={};for(var l=0;l<s.length;l++)o["$"+s[l]]=s[l]}for(var c in e)u(e,c)&&(r&&String(Number(c))===c&&c<e.length||H&&o["$"+c]instanceof Symbol||(/[^\w$]/.test(c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof x)for(var d=0;d<s.length;d++)B.call(e,s[d])&&n.push("["+t(s[d])+"]: "+t(e[s[d]],e));return n}var S="function"==typeof Map&&Map.prototype,P=Object.getOwnPropertyDescriptor&&S?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,b=S&&P&&"function"==typeof P.get?P.get:null,R=S&&Map.prototype.forEach,A="function"==typeof Set&&Set.prototype,I=Object.getOwnPropertyDescriptor&&A?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,L=A&&I&&"function"==typeof I.get?I.get:null,O=A&&Set.prototype.forEach,C="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,D="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,N="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,w=Boolean.prototype.valueOf,k=Object.prototype.toString,M=Function.prototype.toString,U=String.prototype.match,F="function"==typeof BigInt?BigInt.prototype.valueOf:null,x=Object.getOwnPropertySymbols,j="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?Symbol.prototype.toString:null,H="function"==typeof Symbol&&"object"==n(Symbol.iterator),B=Object.prototype.propertyIsEnumerable,Y=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null),V=r(53).custom,K=V&&s(V)?V:null,q="function"==typeof Symbol&&void 0!==Symbol.toStringTag?Symbol.toStringTag:null;e.exports=function e(t,r,y,S){function P(t,r,n){if(r&&(S=S.slice()).push(r),n){var i={depth:A.depth};return u(A,"quoteStyle")&&(i.quoteStyle=A.quoteStyle),e(t,i,y+1,S)}return e(t,A,y+1,S)}var A=r||{};if(u(A,"quoteStyle")&&"single"!==A.quoteStyle&&"double"!==A.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(u(A,"maxStringLength")&&("number"==typeof A.maxStringLength?A.maxStringLength<0&&A.maxStringLength!==1/0:null!==A.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var I=!u(A,"customInspect")||A.customInspect;if("boolean"!=typeof I&&"symbol"!==I)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(u(A,"indent")&&null!==A.indent&&"\t"!==A.indent&&!(parseInt(A.indent,10)===A.indent&&A.indent>0))throw new TypeError('options "indent" must be "\\t", an integer > 0, or `null`');if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return h(t,A);if("number"==typeof t)return 0===t?1/0/t>0?"0":"-0":String(t);if("bigint"==typeof t)return String(t)+"n";var C=void 0===A.depth?5:A.depth;if(void 0===y&&(y=0),y>=C&&C>0&&"object"==n(t))return a(t)?"[Array]":"[Object]";var D=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=Array(e.indent+1).join(" ")}return{base:r,prev:Array(t+1).join(r)}}(A,y);if(void 0===S)S=[];else if(d(S,t)>=0)return"[Circular]";if("function"==typeof t){var N=c(t),k=T(t,P);return"[Function"+(N?": "+N:" (anonymous)")+"]"+(k.length>0?" { "+k.join(", ")+" }":"")}if(s(t)){var M=H?String(t).replace(/^(Symbol\(.*\))_[^)]*$/,"$1"):j.call(t);return"object"!=n(t)||H?M:v(M)}if(function(e){return!(!e||"object"!=n(e))&&("undefined"!=typeof HTMLElement&&e instanceof HTMLElement||"string"==typeof e.nodeName&&"function"==typeof e.getAttribute)}(t)){for(var U="<"+String(t.nodeName).toLowerCase(),x=t.attributes||[],B=0;B<x.length;B++)U+=" "+x[B].name+"="+i(o(x[B].value),"double",A);return U+=">",t.childNodes&&t.childNodes.length&&(U+="..."),U+"</"+String(t.nodeName).toLowerCase()+">"}if(a(t)){if(0===t.length)return"[]";var V=T(t,P);return D&&!function(e){for(var t=0;t<e.length;t++)if(d(e[t],"\n")>=0)return!1;return!0}(V)?"["+g(V,D)+"]":"[ "+V.join(", ")+" ]"}if(function(e){return!("[object Error]"!==l(e)||q&&"object"==n(e)&&q in e)}(t)){var G=T(t,P);return 0===G.length?"["+String(t)+"]":"{ ["+String(t)+"] "+G.join(", ")+" }"}if("object"==n(t)&&I){if(K&&"function"==typeof t[K])return t[K]();if("symbol"!==I&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!b||!e||"object"!=n(e))return!1;try{b.call(e);try{L.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var W=[];return R.call(t,(function(e,r){W.push(P(r,t,!0)+" => "+P(e,t))})),m("Map",b.call(t),W,D)}if(function(e){if(!L||!e||"object"!=n(e))return!1;try{L.call(e);try{b.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var Q=[];return O.call(t,(function(e){Q.push(P(e,t))})),m("Set",L.call(t),Q,D)}if(_(t))return E("WeakMap");if(f(t))return E("WeakSet");if(p(t))return E("WeakRef");if(function(e){return!("[object Number]"!==l(e)||q&&"object"==n(e)&&q in e)}(t))return v(P(Number(t)));if(function(e){if(!e||"object"!=n(e)||!F)return!1;try{return F.call(e),!0}catch(e){}return!1}(t))return v(P(F.call(t)));if(function(e){return!("[object Boolean]"!==l(e)||q&&"object"==n(e)&&q in e)}(t))return v(w.call(t));if(function(e){return!("[object String]"!==l(e)||q&&"object"==n(e)&&q in e)}(t))return v(P(String(t)));if(!function(e){return!("[object Date]"!==l(e)||q&&"object"==n(e)&&q in e)}(t)&&!function(e){return!("[object RegExp]"!==l(e)||q&&"object"==n(e)&&q in e)}(t)){var z=T(t,P),X=Y?Y(t)===Object.prototype:t instanceof Object||t.constructor===Object,J=t instanceof Object?"":"null prototype",Z=!X&&q&&Object(t)===t&&q in t?l(t).slice(8,-1):J?"Object":"",$=(X||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(Z||J?"["+[].concat(Z||[],J||[]).join(": ")+"] ":"");return 0===z.length?$+"{}":D?$+"{"+g(z,D)+"}":$+"{ "+z.join(", ")+" }"}return String(t)};var G=Object.prototype.hasOwnProperty||function(e){return e in this}},function(e,t){},function(e,t,r){var n=r(16),i=Object.prototype.hasOwnProperty,o=Array.isArray,a={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},u=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t){var r,l={},c=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,_=c.split(t.delimiter,d),p=-1,f=t.charset;if(t.charsetSentinel)for(r=0;r<_.length;++r)0===_[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===_[r]?f="utf-8":"utf8=%26%2310003%3B"===_[r]&&(f="iso-8859-1"),p=r,r=_.length);for(r=0;r<_.length;++r)if(r!==p){var h,y,v=_[r],E=v.indexOf("]="),m=-1===E?v.indexOf("="):E+1;-1===m?(h=t.decoder(v,a.decoder,f,"key"),y=t.strictNullHandling?null:""):(h=t.decoder(v.slice(0,m),a.decoder,f,"key"),y=n.maybeMap(u(v.slice(m+1),t),(function(e){return t.decoder(e,a.decoder,f,"value")}))),y&&t.interpretNumericEntities&&"iso-8859-1"===f&&(y=s(y)),v.indexOf("[]=")>-1&&(y=o(y)?[y]:y),i.call(l,h)?l[h]=n.combine(l[h],y):l[h]=y}return l},c=function(e,t,r,n){for(var i=n?t:u(t,r),o=e.length-1;o>=0;--o){var a,s=e[o];if("[]"===s&&r.parseArrays)a=[].concat(i);else{a=r.plainObjects?Object.create(null):{};var l="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(l,10);r.parseArrays||""!==l?!isNaN(c)&&s!==l&&String(c)===l&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(a=[])[c]=i:a[l]=i:a={0:i}}i=a}return i},d=function(e,t,r,n){if(e){var o=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,s=r.depth>0&&/(\[[^[\]]*])/.exec(o),u=s?o.slice(0,s.index):o,l=[];if(u){if(!r.plainObjects&&i.call(Object.prototype,u)&&!r.allowPrototypes)return;l.push(u)}for(var d=0;r.depth>0&&null!==(s=a.exec(o))&&d<r.depth;){if(d+=1,!r.plainObjects&&i.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;l.push(s[1])}return s&&l.push("["+o.slice(s.index)+"]"),c(l,t,r,n)}},_=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}};e.exports=function(e,t){var r=_(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var i="string"==typeof e?l(e,r):e,o=r.plainObjects?Object.create(null):{},a=Object.keys(i),s=0;s<a.length;++s){var u=a[s],c=d(u,i[u],r,"string"==typeof e);o=n.merge(o,c,r)}return!0===r.allowSparse?o:n.compact(o)}},function(e,t,r){var i,o,a="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)};!function(n){var s=!1;if(void 0!==(o="function"==typeof(i=n)?i.call(t,r,t,e):i)&&(e.exports=o),s=!0,"object"===a(t)&&(e.exports=n(),s=!0),!s){var u=window.Cookies,l=window.Cookies=n();l.noConflict=function(){return window.Cookies=u,l}}}((function(){var e=function(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t};return function t(r){function n(t,i,o){var a;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(o=e({path:"/"},n.defaults,o)).expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*o.expires),o.expires=s}try{a=JSON.stringify(i),/^[\{\[]/.test(a)&&(i=a)}catch(t){}return i=r.write?r.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[t,"=",i,o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("")}t||(a={});for(var u=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,c=0;c<u.length;c++){var d=u[c].split("="),_=d.slice(1).join("=");'"'===_.charAt(0)&&(_=_.slice(1,-1));try{var p=d[0].replace(l,decodeURIComponent);if(_=r.read?r.read(_,p):r(_,p)||_.replace(l,decodeURIComponent),this.json)try{_=JSON.parse(_)}catch(t){}if(t===p){a=_;break}t||(a[p]=_)}catch(t){}}return a}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,r){n(t,"",e(r,{expires:-1}))},n.withConverter=t,n}((function(){}))}))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t=t||"litix.io",(e=e||"").match(/^[a-z0-9]+$/)?"https://"+e+"."+t:"https://img.litix.io/a.gif"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i=function(){var e=n.default.navigator,t=e&&(e.connection||e.mozConnection||e.webkitConnection);return t&&t.type};t.default=function(){var e=void 0;switch(i()){case"cellular":e="cellular";break;case"ethernet":e="wired";break;case"wifi":e="wifi";break;case void 0:break;default:e="other"}return e}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(0)),o=n(r(4)),a=n(r(59)),s=n(r(1)),u=n(r(17)),l=!!i.default.XMLHttpRequest&&"withCredentials"in new i.default.XMLHttpRequest,c={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},d=function(e,t){this._beaconUrl=e||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,s.default)({},c,t)};d.prototype.queueEvent=function(e,t){var r=(0,s.default)({},t);return l?(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===e)&&(this._eventQueue.push(r),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(a.default.send(this._beaconUrl,r),!0)},d.prototype.flushEvents=function(){l&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},d.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,e?this._clearBeaconQueue():this.flushEvents(),i.default.clearTimeout(this._sendTimeout)},d.prototype._clearBeaconQueue=function(){var e=i.default.navigator,t=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,r=this._eventQueue.slice(t);if(t>0&&(0,s.default)(r[r.length-1],(0,u.default)({mux_view_message:"event queue truncated"})),e.sendBeacon)e.sendBeacon(this._beaconUrl,JSON.stringify({events:r}));else if(i.default.XMLHttpRequest){var n=new i.default.XMLHttpRequest;n.open("POST",this._beaconUrl),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify({events:r}))}else a.default.send(this._beaconUrl,r[r.length-1])},d.prototype._sendBeaconQueue=function(){var e=this;if(i.default.XMLHttpRequest&&!this._postInFlight){var t=new i.default.XMLHttpRequest,r=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,t.onreadystatechange=function(){4===t.readyState&&(200!==t.status?(e._eventQueue=r.concat(e._eventQueue),e._failureCount+=1,o.default.info("Error sending beacon: "+t.status),o.default.info(t.responseText)):e._failureCount=0,e._postInFlight=!1)},t.open("POST",this._beaconUrl),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({events:r}))}},d.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var e=Math.pow(2,this._failureCount-1);return(1+(e*=Math.random()))*this._options.baseTimeBetweenBeacons},d.prototype._startBeaconSending=function(){var e=this;i.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=i.default.setTimeout((function(){e._eventQueue.length&&e._sendBeaconQueue(),e._startBeaconSending()}),this._getNextBeaconTime()))},t.default=d},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(15)),o=n(r(0)),a={send:function(e,t){function r(){n.src=s+(a?"&rc="+a:"")}var n=new Image,a=0,s=e+"?"+i.default.stringify(t);return n.addEventListener("error",(function(){a>3||o.default.setTimeout((function(){a++,r()}),5e3*a)})),r(),n}};t.default=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=0,t=0,r=0,n=0,i=0,o=0,a=0;this.on("requestcompleted",(function(o,a){var s=a.request_start,u=a.request_response_start,l=a.request_response_end,c=a.request_bytes_loaded;n++;var d=void 0,_=void 0;if(u?(d=u-s,_=l-u):_=l-s,_>0&&c>0){var p=c/_*8e3;i++,t+=c,r+=_,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,p),this.data.view_average_request_throughput=t/r*8e3,this.data.view_request_count=n,d>0&&(e+=d,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,d),this.data.view_average_request_latency=e/i)}})),this.on("requestfailed",(function(e,t){n++,o++,this.data.view_request_count=n,this.data.view_request_failed_count=o})),this.on("requestcanceled",(function(e,t){n++,a++,this.data.view_request_count=n,this.data.view_request_canceled_count=a}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.default=function(e,t,r){var n=(0,s.findMediaElement)(t),c=o(n,3),d=c[0],_=c[1],p=c[2],f=e.log,h=e.utils.getComputedStyle,y=e.utils.secondsToMs;if(!d)return f.error("No element was found with the `"+_+"` query selector.");if("video"!==p&&"audio"!==p)return f.error("The element of `"+_+"` was not a media element.");(r=(0,a.default)({automaticErrorTracking:!0},r)).data=(0,a.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.2.3"},r.data),r.getPlayheadTime=function(){return y(d.currentTime)},r.getStateData=function(){var e=this.hlsjs&&this.hlsjs.url,t=this.dashjs&&i("function"===this.dashjs.getSource)&&this.dashjs.getSource();return{player_is_paused:d.paused,player_playhead_time:y(d.currentTime),player_width:parseInt(h(d,"width")),player_height:parseInt(h(d,"height")),player_autoplay_on:d.autoplay,player_preload_on:d.preload,video_poster_url:d.poster,video_source_url:e||t||d.currentSrc,video_source_duration:y(d.duration),video_source_height:d.videoHeight,video_source_width:d.videoWidth}},d.mux=d.mux||{},d.mux.deleted=!1,d.mux.emit=function(t,r){e.emit(_,t,r)};var v=function(){f.error("The monitor for this video element has already been destroyed.")};d.mux.destroy=function(){Object.keys(d.mux.listeners).forEach((function(e){d.removeEventListener(e,d.mux.listeners[e],!1)})),delete d.mux.listeners,d.mux.destroy=v,d.mux.swapElement=v,d.mux.emit=v,d.mux.addHLSJS=v,d.mux.addDashJS=v,d.mux.removeHLSJS=v,d.mux.removeDashJS=v,d.mux.deleted=!0,e.emit(_,"destroy")},d.mux.swapElement=function(t){var r=(0,s.findMediaElement)(t),n=o(r,3),i=n[0],u=n[1],l=n[2];return i?"video"!==l&&"audio"!==l?e.log.error("The element of `"+u+"` was not a media element."):(i.muxId=d.muxId,delete d.muxId,i.mux=i.mux||{},i.mux.listeners=(0,a.default)({},d.mux.listeners),delete d.mux.listeners,Object.keys(i.mux.listeners).forEach((function(e){d.removeEventListener(e,i.mux.listeners[e],!1),i.addEventListener(e,i.mux.listeners[e],!1)})),i.mux.swapElement=d.mux.swapElement,i.mux.destroy=d.mux.destroy,delete d.mux,void(d=i)):e.log.error("No element was found with the `"+u+"` query selector.")},d.mux.addHLSJS=function(t){e.addHLSJS(_,t)},d.mux.addDashJS=function(t){e.addDashJS(_,t)},d.mux.removeHLSJS=function(){e.removeHLSJS(_)},d.mux.removeDashJS=function(){e.removeDashJS(_)},e.init(_,r),e.emit(_,"playerready"),d.paused||(e.emit(_,"play"),d.readyState>2&&e.emit(_,"playing")),d.mux.listeners={},u.forEach((function(t){("error"!==t||r.automaticErrorTracking)&&(d.mux.listeners[t]=function(){var r={};if("error"===t){if(!d.error)return;r.player_error_code=d.error.code,r.player_error_message=l[d.error.code]||d.error.message}e.emit(_,t,r)},d.addEventListener(t,d.mux.listeners[t],!1))}))};var a=function(e){return e&&e.__esModule?e:{default:e}}(r(1)),s=r(12),u=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],l={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(63)),o=n(r(2)),a=n(r(64)),s=n(r(65)),u=n(r(1)),l=n(r(8)),c=r(5),d=n(r(3)),_={};_.safeCall=i.default,_.safeIncrement=o.default,_.getComputedStyle=a.default,_.secondsToMs=s.default,_.assign=u.default,_.headersStringToObject=l.default,_.extractHostnameAndDomain=c.extractHostnameAndDomain,_.extractHostname=c.extractHostname,_.now=d.default.now,t.default=_},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=i;if(e&&"function"==typeof e[t])try{o=e[t].apply(e,r)}catch(e){n.default.info("safeCall error",e)}return o};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&t&&n.default&&"function"==typeof n.default.getComputedStyle){var r=void 0;return i&&i.has(e)&&(r=i.get(e)),r||(r=n.default.getComputedStyle(e,null),i&&i.set(e,r)),r.getPropertyValue(t)}};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i=void 0;n.default&&n.default.WeakMap&&(i=new WeakMap)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Math.floor(1e3*e)}}])},"object"==(void 0===r?"undefined":n(r))&&"object"==(void 0===t?"undefined":n(t))?t.exports=i():"object"==(void 0===r?"undefined":n(r))?r.mux=i():e.mux=i()}()},{}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioContent=void 0;var n=e("tslib"),i=e("../enums/errors"),o=e("../enums/key_system"),a=e("../enums/audio_file_format"),s=e("../enums/audio_file_codec"),u=e("../enums/media_format"),l=e("../error/file"),c=e("../error/fragment"),d=e("./content"),_=e("./helpers/hls");var p=function(e){function t(t){var r=e.call(this,t)||this;if(r._lastResolveTimestamp=0,r._profileId=""+Date.now(),r._initBufferPromise=null,r._lastFetchedBuffer=null,r._hlsURL=null,r._bypassResolve=!!r._resolvedURL,r._emitWarning=t.emitWarning||function(){},r._mediaType="audio",r._noManifest=!!t.noManifest,r._preloadedManifest=t.preloadedManifest,r._resolver=t.resolver,r._segmentLength=0,r._fileFormat=t.fileFormat,r._fileFormat)r._audioCodec=s.AudioFileCodec[r._fileFormat];else switch(r._format){case u.MediaFormat.MP3:r._audioCodec=s.AudioFileCodec[a.AudioFileFormat.MP3_160];break;case u.MediaFormat.MP4:case u.MediaFormat.MP4_DUAL:case u.MediaFormat.MP4_CBCS:r._audioCodec=s.AudioFileCodec[a.AudioFileFormat.MP4_128];break;default:throw new TypeError("Unknown audio format "+r._format)}return r._fileId&&(r._profileId=r._fileId),r._parseFragmentResponse=r._parseFragmentResponse.bind(r),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._parseFragmentResponse=function(e){var t=this,r=e.metadata,o=r.requestURL,a=r.fragment,s=r.byteRangeHeader,u=r.expectedLength,l=a.timeStart+"-"+a.timeEnd;switch(e.status){case 0:if(e.offline)return Promise.reject(new c.FragmentError(i.Errors.FRAGMENT_OFFLINE_REQUEST_FAILED_WITH_ZERO,"Request failed with status 0.",0,{time_range:l,byte_range:s}));var d=new c.FragmentError(i.Errors.FRAGMENT_ONLINE_REQUEST_FAILED_WITH_ZERO,"Request failed with status 0.",0),_=!1;return this._resolvedURL!==o?_=!0:this._fallbackURLs.length&&this._resolvedURL===o&&(_=!0,this._resolvedURL=this._fallbackURLs.shift()),d.debug.has_fallback=_,_?(this._emitWarning(d,this.toLogJSON()),this.getBufferForFragment(a)):Promise.reject(d);case 200:case 206:var p=e.body;if(!p)return Promise.reject(new c.FragmentError(i.Errors.FRAGMENT_REQUEST_EMPTY_RESPONSE,"Empty response for successful buffer.",e.status,{time_range:l,byte_range:s}));if(p.byteLength!==u)return Promise.reject(new c.FragmentError(i.Errors.FRAGMENT_REQUEST_UNEXPECTED_LENGTH,"Received buffer of unexpected length.",e.status,{time_range:l,byte_range:s,received_length:p.byteLength,expected_length:u}));var f={audio:{profileId:this._profileId,bufferURL:o,byteStart:a.byteRanges.audio.start,byteEnd:a.byteRanges.audio.end,buffer:p,mimetype:this._audioCodec,bandwidth:8e3*p.byteLength/e.timing.completed}};if(a.cacheBufferSet&&p&&p.byteLength){a.bufferSet=f;var h=a.sliceInto;if(null==h?void 0:h.length)for(var y=0,v=h;y<v.length;y++){var E=v[y],m=E.fragment;(null==m?void 0:m.cacheBufferSet)&&(m.bufferSet={audio:n.__assign(n.__assign({},f.audio),{buffer:p.slice(E.start,E.end),byteStart:m.byteRanges.audio.start,byteEnd:m.byteRanges.audio.end})})}}return this._abrManager.sample(p.byteLength,e.timing.completed),Promise.resolve(f);case 403:return this.resolve().then((function(){return t.getBufferForFragment(a)}));default:_=!1;return this._resolvedURL!==o?_=!0:this._fallbackURLs.length&&this._resolvedURL===o&&(_=!0,this._resolvedURL=this._fallbackURLs.shift()),_?this.getBufferForFragment(a):Promise.reject(new c.FragmentError(i.Errors.FRAGMENT_REQUEST_FAILED_WITH_STATUS,"Buffer request failed with status "+e.status,e.status,{time_range:l,byte_range:s}))}},t.prototype._getInitBuffer=function(){var e,t;if(!this._initFragment)throw new l.FileError(i.Errors.FILE_NOT_RESOLVED,"Cannot return HLS Manifest URL: File not resolved.");return(null===(t=null===(e=this._initFragment.bufferSet)||void 0===e?void 0:e.audio)||void 0===t?void 0:t.buffer.byteLength)?Promise.resolve(this._initFragment.bufferSet.audio.buffer):(this._initBufferPromise||(this._initBufferPromise=this.getBufferForFragment(this._initFragment).then((function(e){var t;if(!(null===(t=e.audio)||void 0===t?void 0:t.buffer.byteLength))throw new Error("Empty initialization segment buffer");return e.audio.buffer}))),this._initBufferPromise)},t.prototype._calculateFragments=function(e){var t=e.offset;this._initFragment={init:!0,cacheBufferSet:!this._disableCache,timeStart:0,timeEnd:0,byteRanges:{audio:{start:0,end:t-1}}};for(var r=e.segments,n=e.timescale,i=r.length,o=new Array(i),a=0,s=0,u=0,l=i;u<l;u++){var c=r[u];if(null==c?void 0:c.length){var d=c[0],_=c[1],p=_/n,f={init:!1,cacheBufferSet:!u&&!this._disableCache,timeStart:a,timeEnd:a+p,byteRanges:{audio:{start:t,end:t+(d-1)}}};o[u]=f,t+=d,s+=_,a+=p,Math.floor(p)>this._segmentLength&&(this._segmentLength=Math.floor(p))}}o[o.length-1].isLastFragment=!0,this._fragments=o,this._duration=s/n},t.prototype._calculateFragmentsV1=function(e){var t=e.offset;this._initFragment={init:!0,cacheBufferSet:!this._disableCache,timeStart:0,timeEnd:0,byteRanges:{audio:{start:0,end:t-1}}};for(var r=e.references,n=e.timescale,i=r.length,o=new Array(i),a=0,s=0,u=0,l=i;u<l;u++){var c=r[u];if(c){var d=c.duration/n,_={init:!1,cacheBufferSet:!u&&!this._disableCache,timeStart:s,timeEnd:s+d,byteRanges:{audio:{start:t,end:t+(c.size-1)}}};o[u]=_,t+=c.size,a+=c.duration,s+=d,Math.floor(d)>this._segmentLength&&(this._segmentLength=Math.floor(d))}}o[o.length-1].isLastFragment=!0,this._fragments=o,this._duration=a/n},t.prototype._getManifest=function(e){if(this._noManifest)return e&&(e.manifestLatency=0),Promise.resolve(null);if(this._preloadedManifest)return e&&(e.manifestLatency=0),Promise.resolve(this._preloadedManifest);if(!this._fileId)throw new TypeError("Missing: fileId");var t=Date.now();return this._resolver.getManifest(this._fileId).then((function(r){return e&&(e.manifestLatency=Date.now()-t),r}))},t.prototype.getHLSURL=function(){var e,t,r=this._resolvedURL,n=this._initFragment;if(!r||!n)throw new l.FileError(i.Errors.FILE_NOT_RESOLVED,"Cannot return HLS Manifest URL: File not resolved.");this.releaseHLSURL();var o={url:r,byteStart:null===(e=n.byteRanges.audio)||void 0===e?void 0:e.start,byteEnd:null===(t=n.byteRanges.audio)||void 0===t?void 0:t.end},a=this._fragments.map((function(e){var t,n;return{url:r,duration:e.timeEnd-e.timeStart,byteStart:null===(t=e.byteRanges.audio)||void 0===t?void 0:t.start,byteEnd:null===(n=e.byteRanges.audio)||void 0===n?void 0:n.end}})),s="undefined"==typeof MediaSource?_.createProtectedManifestURL:_.createProtectedManifestDataURL;return this._hlsURL=s({assetID:this._fileId,targetDuration:10,map:o,segments:a}),this._hlsURL},t.prototype.releaseHLSURL=function(){this._hlsURL&&URL.revokeObjectURL(this._hlsURL),this._hlsURL=null},t.prototype.clearCachedBuffers=function(){this._headFragment&&delete this._headFragment,this._initFragment&&(this._initFragment.bufferSet=null),this._fragments[0]&&(this._fragments[0].bufferSet=null),this._lastFetchedBuffer=null},t.prototype.getPlayableCodecs=function(){return[this._audioCodec]},t.prototype.getFirstFragment=function(){var e;return null!==(e=this._fragments[0])&&void 0!==e?e:null},t.prototype.getHeadFragment=function(){var e=this._initFragment,t=this._fragments[0];if(!(null==e?void 0:e.byteRanges.audio)||!(null==t?void 0:t.byteRanges.audio))throw new l.FileError(i.Errors.FILE_NOT_RESOLVED,"Cannot return HLS Manifest URL: File not resolved.");return this._headFragment||(this._headFragment={init:!0,cacheBufferSet:!0,timeStart:0,timeEnd:0,byteRanges:{audio:{start:e.byteRanges.audio.start,end:t.byteRanges.audio.end}},sliceInto:[{fragment:e,start:0,end:t.byteRanges.audio.start},{fragment:t,start:t.byteRanges.audio.start,end:void 0}]}),this._headFragment},t.prototype.getFragmentAfterTime=function(e){var t,r;if(!(null===(t=this._fragments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return null!==(r=this._fragments[1])&&void 0!==r?r:null;for(var n=0,i=this._fragments;n<i.length;n++){var o=i[n];if(o.timeStart>e)return o}return null},t.prototype.getFragmentForTime=function(e){var t,r;if(!(null===(t=this._fragments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return null!==(r=this._fragments[0])&&void 0!==r?r:null;for(var n=0,i=this._fragments;n<i.length;n++){var o=i[n];if(o.timeStart<=e&&o.timeEnd>=e)return o}return null},t.prototype.getBufferForFragment=function(e){var t,r=this;if(!e)return Promise.reject(new Error("FIXME: error type?"));if((null===(t=this._lastFetchedBuffer)||void 0===t?void 0:t.fragment)===e)return Promise.resolve(this._lastFetchedBuffer.bufferSet);if(e.bufferSet)return Promise.resolve(e.bufferSet);if(!this._resolvedURL)return Promise.reject(new l.FileError(i.Errors.FILE_NOT_RESOLVED,"Cannot fetch buffer: No resolved URL"));var n=e.byteRanges.audio,o=n.start+"-"+n.end,a=n.end+1-n.start,s=this._resolvedURL,u=e.init?Promise.resolve(null):this._getInitBuffer();return Promise.all([u,this._transport.request(s,{method:"GET",responseType:"arraybuffer",headers:{Range:"bytes="+o},timing:!0,metadata:{requestURL:s,fragment:e,byteRangeHeader:o,expectedLength:a},retry:{condition:function(e,t){if(0===e.status)return e.offline;var r=e.getStatusFamily();return r===t.CONNECTION_ERROR||r===t.SERVER_ERROR||!(r!==t.SUCCESS||!e.body)&&e.body.byteLength!==a}}}).then(this._parseFragmentResponse)]).then((function(t){var n=t[0],i=t[1];return n&&i.audio&&(i.audio.initBuffer=n),r._lastFetchedBuffer={fragment:e,bufferSet:i},i}))},t.prototype.resolve=function(e){var t=this,r=this._fileId;if(this._bypassResolve)return e&&(e.resolveLatency=0),Promise.resolve({uri:this._resolvedURL,uris:[],protection:this._preloadedManifest||!this._noManifest?"cenc":void 0});if(!r)throw new TypeError("Missing: fileId is required to resolve content URL");clearTimeout(this._lastResolveToken);var n=function(){return t._lastResolveTimestamp=Date.now(),t._resolver.getCDNURL(r,t._fileFormat).then((function(r){return e&&(e.resolveLatency=Date.now()-t._lastResolveTimestamp),r}))},i=Date.now()-this._lastResolveTimestamp;return(i<1001?new Promise((function(e,r){t._lastResolveToken=setTimeout((function(){n().then(e,r)}),1001-i)})):n()).then((function(e){t._resolvedURLs=[];for(var r=0,n=e.uris;r<n.length;r++){var i=n[r].split("?")[0];t._resolvedURLs.push(i)}return t._fallbackURLs=e.uris,t._resolvedURL=t._fallbackURLs.shift(),e})).catch((function(e){return e&&(e.track=t.toLogJSON()),Promise.reject(e)}))},t.prototype.load=function(e){var t=this;return void 0===e&&(e={resolveLatency:0,manifestLatency:0}),this._loaded?(e.resolveLatency=0,e.manifestLatency=0,Promise.resolve(this)):Promise.all([this.resolve(e),this._getManifest(e)]).then((function(e){var r,n,a=e[0],s=e[1];if(t._loaded=!0,!a.protection||!s)return t;if(t._keySystem===o.KeySystem.INVALID_SPOTIFY_KEY)return t._protection=s.protection||"cenc",t._psshBox=new Uint8Array(0),t;var u=t._keySystemSettings.pssh_field.audio,c=function(e,t){return t.hasOwnProperty(e)}(u,s)?s[u]:null;if(!c&&"pssh_widevine"===u&&"pssh"in s&&(c=null!==(r=s.pssh)&&void 0!==r?r:null),!c)return(n=new l.FileError(i.Errors.FILE_FORMAT_NOT_SUPPORTED,"KeySystem does not support the file format.")).track=t.toLogJSON(),Promise.reject(n);if(t._protection=s.protection||"cenc",t._psshBox=t._parsePSSHBox(c),"segments"in s&&s.segments)t._calculateFragments(s);else{if(!("references"in s)||!s.references)return(n=new l.FileError(i.Errors.FILE_MALFORMED_SEEKTABLE,"Malformed seektable.")).track=t.toLogJSON(),Promise.reject(n);t._calculateFragmentsV1(s)}return t}))},t.prototype.adaptToBandwidth=function(){return Promise.resolve(!1)},t}(d.Content);r.AudioContent=p},{"../enums/audio_file_codec":55,"../enums/audio_file_format":56,"../enums/errors":58,"../enums/key_system":60,"../enums/media_format":62,"../error/file":72,"../error/fragment":73,"./content":27,"./helpers/hls":40,tslib:201}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BandwidthEstimator=void 0;var n=e("./moving_average"),i=function(){function e(e){void 0===e&&(e=4e5),this._totalBytes=0,this._overrideBitrate=0,this._currentBandwidth=e,this._short=new n.MovingAverage(2),this._long=new n.MovingAverage(5),this._init()}return e.prototype._init=function(){if("undefined"!=typeof navigator){var e=navigator;e.connection&&e.connection.downlink&&(this._currentBandwidth=1e6*e.connection.downlink,this._onConnectionChange=this._onConnectionChange.bind(this),e.connection.addEventListener("change",this._onConnectionChange))}},e.prototype._onConnectionChange=function(e){var t=e.target.downlink||0;this._setBandwidth(t)},e.prototype._setBandwidth=function(e){this._currentBandwidth=1e6*e},e.prototype.getBandwidthEstimate=function(){if(this._overrideBitrate)return this._overrideBitrate;if(this._totalBytes<128e3)return this._currentBandwidth;var e=this._short.getEstimate(),t=this._long.getEstimate();return Math.min(e,t)},e.prototype.sample=function(e,t){if(!(e<16e3)){var r=t/1e3,n=8*e/r;this._totalBytes+=e,this._short.sample(r,n),this._long.sample(r,n)}},e.prototype.overrideBitrate=function(e){this._overrideBitrate=e<=0?0:e},e}();r.BandwidthEstimator=i},{"./moving_average":45}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ContentBuffer=void 0;var n,i=e("tslib"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("@js-sdk/debug-tools/es5"),u=e("../enums/event"),l=s.logging.forTag("playback.content_buffer");function c(){}!function(e){e[e.AUDIO=10]="AUDIO",e[e.VIDEO=20]="VIDEO"}(n||(n={}));var d=function(e){function t(t,r,n){void 0===r&&(r=[]),void 0===n&&(n={});var i=e.call(this)||this;return i._mediaSource=null,i._sourceBuffers={},i._appendingFragments=[],i._currentInitSegments={},i._updateQueue=[],i._codecs=[],i._playId=0,i._lastBufferClearTime=Date.now(),i._customSourceBufferParams="",i._codecs=r,i._tracker=t,i._disableBufferAbort=!!n.disableBufferAbort,i._customSourceBufferParams=i._parseCodecParam(n.customSourceBufferParams),i._onSourceOpen=i._onSourceOpen.bind(i),i._onSourceClose=i._onSourceClose.bind(i),i.dequeueUpdates=i.dequeueUpdates.bind(i),n.noInit||i._init(),i}return i.__extends(t,e),t.create=function(e,r,n){return void 0===r&&(r=[]),void 0===n&&(n={}),new t(e,r,n)},t.prototype._init=function(){this._mediaSource=new MediaSource,this._mediaSource.addEventListener(u.Event.MEDIA_SOURCE_OPEN,this._onSourceOpen),this._mediaSource.addEventListener(u.Event.MEDIA_SOURCE_CLOSE,this._onSourceClose),this._sourceBuffers={},this._currentInitSegments={}},t.prototype._parseCodecParam=function(e){if(!e)return"";var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r]?'="'+e[r]+'"':"";t.push(""+r+n)}return t.length?"; "+t.join("; "):""},t.prototype._onSourceOpen=function(){l.info("MediaSource opened.");var e=this._mediaSource;if(e&&0===e.sourceBuffers.length&&"open"===e.readyState){l.info("Creating source buffers for codecs",this._codecs);for(var t=0,r=this._codecs;t<r.length;t++){var n=r[t];this._addSourceBuffer(n)}}this.dequeueUpdates(),this.emit(u.Event.BUFFER_SOURCE_OPEN,null)},t.prototype._onSourceClose=function(){l.info("MediaSource closed."),this._destroySourceBuffers(),this.emit(u.Event.BUFFER_SOURCE_CLOSE,null)},t.prototype._removeAppendingFragment=function(e){if(e){var t=this._appendingFragments,r=t.indexOf(e);-1!==r&&t.splice(r,1)}},t.prototype._addSourceBuffer=function(e){if(this._mediaSource){var t=this._mediaSource.addSourceBuffer(e+this._customSourceBufferParams);t.addEventListener(u.Event.SOURCE_BUFFER_UPDATE_END,this.dequeueUpdates),this._sourceBuffers[e]=t}},t.prototype._trackBufferingProgress=function(e){e.audio&&e.audio.buffer&&this._tracker.trackBytesDownloaded(e.audio.buffer.byteLength),e.video&&e.video.buffer&&this._tracker.trackBytesDownloaded(e.video.buffer.byteLength)},t.prototype._checkStalling=function(e,t,r){var n,i,o,a=t.byteRanges.video?t.byteRanges.video.start:null!==(i=null===(n=t.byteRanges.audio)||void 0===n?void 0:n.start)&&void 0!==i?i:-1;e>9e3&&this.emit(u.Event.BUFFER_STALLED,{byteStart:a,timeStart:(o=t.timeStart,Math.ceil(1e3*o)),stallAmount:e-9e3,didTimeout:r})},t.prototype._appendBufferData=function(e,t,r,n){void 0===n&&(n=Date.now()),this.emit(u.Event.BUFFERING_END,null);var i=[];if(e.audio){var o=a.createPromiseResolver();this.tryUpdate({playId:r,timestamp:n,fragment:t,type:"append",profileId:e.audio.profileId,buffer:e.audio.buffer,initBuffer:e.audio.initBuffer,codec:e.audio.mimetype,init:!!t.init,resolve:o.resolve}),i.push(o.promise),null!==e.audio.bandwidth&&this._tracker.trackBufferURL(e.audio.bufferURL||"",{bandwidth:e.audio.bandwidth||0})}if(e.video){var s=a.createPromiseResolver();this.tryUpdate({playId:r,timestamp:n,fragment:t,type:"append",profileId:e.video.profileId,buffer:e.video.buffer,initBuffer:e.video.initBuffer,codec:e.video.mimetype,init:!!t.init,resolve:s.resolve}),i.push(s.promise),null!==e.video.bandwidth&&this._tracker.trackBufferURL(e.video.bufferURL||"",{bandwidth:e.video.bandwidth||0})}return Promise.all(i)},t.prototype._appendUpdate=function(e){var t,r,n=this,i=this._sourceBuffers[e.codec];if(i&&!i.updating){var o=e.buffer;if(e.fragment.init&&this._currentInitSegments[e.codec]===e.profileId)return null===(t=e.resolve)||void 0===t||t.call(e,!0),void Promise.resolve().then(this.dequeueUpdates);if(e.initBuffer&&e.buffer&&this._currentInitSegments[e.codec]!==e.profileId){var a=new Uint8Array(e.initBuffer.byteLength+e.buffer.byteLength);a.set(new Uint8Array(e.initBuffer),0),a.set(new Uint8Array(e.buffer),e.initBuffer.byteLength),o=a.buffer}try{i.appendBuffer(o)}catch(t){var s=!1;return"QuotaExceededError"===t.name?(l.warn("Failed to append buffer: exceeded quota."),s=!0,this.emitSync(u.Event.BUFFER_QUOTA_EXCEEDED,null)):l.warn("Failed to append buffer",t),void new Promise((function(e){s?setTimeout(e,500):e()})).then((function(){n._removeAppendingFragment(e.fragment),n.dequeueUpdates()})).then((function(){e.init&&n._updateQueue.push(e)}))}this._removeAppendingFragment(e.fragment);var c=o.byteLength>e.buffer.byteLength;(e.fragment.init||c)&&(this._currentInitSegments[e.codec]=e.profileId),null===(r=e.resolve)||void 0===r||r.call(e,!0),c?l.info("Injected combined init segment and playable segment ("+e.codec+", "+e.profileId+")"):e.init&&l.info("Injected individual init segment ("+e.codec+", "+e.profileId+")")}else this._updateQueue.push(e)},t.prototype._abortUpdate=function(e){"fragment"in e&&this._removeAppendingFragment(e.fragment),e.resolve&&e.resolve(!1),Promise.resolve().then(this.dequeueUpdates)},t.prototype._processUpdate=function(e){"end"===e.type?this._endUpdate(e):"duration"===e.type?this._durationUpdate(e):"append"===e.type&&this._appendUpdate(e)},t.prototype._isUpdating=function(){if(!this._mediaSource)return!1;for(var e=this._mediaSource.sourceBuffers,t=0,r=e.length;t<r;t++){var n=e[t];if(n&&n.updating)return!0}return!1},t.prototype._endUpdate=function(e){this._isUpdating()?this._updateQueue.push(e):this._mediaSource&&"open"===this._mediaSource.readyState&&(this._mediaSource.endOfStream(),e.resolve&&e.resolve(!0))},t.prototype._durationUpdate=function(e){this._isUpdating()?this._updateQueue.push(e):(this._mediaSource&&(this._mediaSource.duration=e.duration),e.resolve&&e.resolve(!0))},t.prototype._destroySourceBuffers=function(){var e=this._mediaSource;if(e){var t=e.sourceBuffers;if(t.length)for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i){i.removeEventListener("updateend",this.dequeueUpdates);try{e.removeSourceBuffer(i),l.info("Removed source buffer")}catch(e){l.warn("Failed to remove sourcebuffer",e)}}}this._sourceBuffers={},this._currentInitSegments={}}},t.prototype._endOfStream=function(){this._mediaSource&&"ended"!==this._mediaSource.readyState&&this.tryUpdate({playId:this._playId,timestamp:Date.now(),type:"end"})},t.prototype.dequeueUpdates=function(){var e=this._updateQueue.shift();e&&this.tryUpdate(e)},t.prototype.appendFragment=function(e,t,r){var n=this;if(void 0===r&&(r=!1),-1!==this._appendingFragments.indexOf(t))return Promise.resolve([]);this._appendingFragments.push(t),this.emit(u.Event.BUFFERING_START,null);var i=Date.now(),o=this._playId,a=e.toLogJSON();return e.getBufferForFragment(t).then((function(e){return n._trackBufferingProgress(e),o!==n._playId?(l.info("Append fragment dropped: playId has changed."),[]):(r||n._checkStalling(Date.now()-i,t,!1),n._appendBufferData(e,t,o,i))})).catch((function(e){return n._removeAppendingFragment(t),r||n._checkStalling(Date.now()-i,t,!0),n.emit(u.Event.BUFFER_APPEND_ERROR,{error:e,canPlayNext:!0,track:a}),Promise.reject(e)}))},t.prototype.abort=function(e){if(void 0===e&&(e=!1),this._lastBufferClearTime=Date.now(),this._appendingFragments=[],this._disableBufferAbort)l.info("MediaSource abort skipped; action disabled.");else{var t=this._mediaSource;if(t)for(var r=t.sourceBuffers,n=0,i=r.length;n<i;n++){var o=r[n];if("open"===t.readyState&&o)try{o.abort();var a=o.buffered;if(e&&a.length){var s=a.start(0),u=a.end(a.length-1);o.remove(s,u),l.info("Cleared buffer range",s,u)}}catch(e){l.warn("ContentBuffer.clear failed.",e)}}this._currentInitSegments={}}},t.prototype.getMediaSource=function(){return this._mediaSource},t.prototype.tryUpdate=function(e){if(e){if(e.playId!==this._playId)return l.info("Try update dropped: playId has changed"),void this._abortUpdate(e);if(e.timestamp<this._lastBufferClearTime)return l.info("Try update dropped: update is older than the last clear"),void this._abortUpdate(e);var t=this._mediaSource;t&&"open"!==t.readyState&&"ended"!==t.readyState?this._updateQueue.push(e):this._processUpdate(e)}},t.prototype.destroy=function(){var e=this._mediaSource;e&&(l.info("Source destroyed"),e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceclose",this._onSourceClose),this._destroySourceBuffers(),this._mediaSource=null)},t.prototype.progress=function(e,t,r){var i=this._mediaSource;if(i){var o="video"===e.getMediaType()?n.VIDEO:n.AUDIO;if("open"===i.readyState||"ended"===i.readyState){var a=void 0,s=function(e,t){var r,n=null===(r=e.sourceBuffers[e.sourceBuffers.length-1])||void 0===r?void 0:r.buffered;if(n)for(var i=void 0,o=void 0,a=0;a<n.length;a++)if(i=n.start(a),o=n.end(a),i<=t&&t<=o)return{start:i,end:o};return null}(i,r);if(s){if(r+o>i.duration)return void("open"===i.readyState&&this._endOfStream());var u=e.getFragmentLength();Math.ceil(r/u)>Math.floor(s.end/u)&&(a=e.getFragmentForTime(r))&&this.appendFragment(e,a,t).catch(c);var l=Math.floor(s.end-r);if(l>o)return;var d=Math.min(e.getFragmentLength(),o-l);if(d<1)return;var _=Math.floor(s.end+d);(a=e.getFragmentForTime(_))?this.appendFragment(e,a,t).catch(c):this._endOfStream()}else if(a=e.getFragmentForTime(r)){if(this.appendFragment(e,a,t).catch(c),a.timeEnd<r+5){var p=e.getFragmentAfterTime(a.timeStart);p?this.appendFragment(e,p,t).catch(c):this._endOfStream()}}else this._endOfStream()}}},t.prototype.recreate=function(e){this.abort(),this.destroy(),this._codecs=e,this._init()},t.prototype.setDuration=function(e){this.tryUpdate({playId:this._playId,timestamp:Date.now(),type:"duration",duration:e})},t.prototype.setPlayId=function(e){this._playId=e},t}(o.EventEmitter);r.ContentBuffer=d},{"../enums/event":59,"@js-sdk/common/es5/promise_resolver":91,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,tslib:201}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CDNURLTracker=void 0;var n=function(){function e(){this._version="1.0.0",this._map={}}return e.prototype.clear=function(){this._map={}},e.prototype.track=function(e,t){var r=this._map[e];r||(r={url:e,segments:0,bandwidths:[],totalBandwidth:0},this._map[e]=r),r.segments+=1,r.bandwidths.push(t.bandwidth),r.totalBandwidth+=t.bandwidth},e.prototype.toJSON=function(){var e=[];for(var t in this._map)if(this._map[t]){var r=this._map[t];r&&e.push({url:t,segments:r.segments,avg_bw:parseFloat((r.totalBandwidth/r.bandwidths.length).toFixed(7))})}return{version:this._version,urls:e}},e}();r.CDNURLTracker=n},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Content=void 0;var n=e("@js-sdk/encoding/es5"),i=e("../enums/errors"),o=e("../error/file"),a=e("./eme/keysystem_setting"),s=function(){function e(e){var t;if(this._fallbackURLs=[],this._fragments=[],this._loaded=!1,this._mediaType="audio",this._noAuth=!1,this._resolvedURLs=[],this._segmentLength=0,this._duration=0,!e.fileId&&!e.resolvedURL)throw new TypeError("Missing: provide either fileId or resolvedURL");this._abrManager=e.abrManager,this._mediator=e.mediator,this._disableCache=e.disableCache,this._fileId=e.fileId,this._format=e.format,this._isAd=e.isAd||!1,this._keySystem=e.keySystem,this._keySystemSettings=a.KeySystemSetting[this._keySystem],this._licenseEndpoint=e.licenseEndpoint,this._logData=e.logData||{displayTrack:"",playbackId:""},this._resolver=e.resolver,this._resolvedURL=e.resolvedURL,this._noAuth=null!==(t=e.noAuth)&&void 0!==t&&t,this._transport=e.transport,this._uri=e.uri}return e.prototype._parsePSSHBox=function(e){for(var t=n.Base64.decode(e),r=new Uint8Array(t.length),i=0,o=t.length;i<o;i++)r[i]=t.charCodeAt(i);return r},e.prototype._parseAssetID=function(e){for(var t=n.Base64.decode(e),r=new Array(t.length),i=0,o=t.length;i<o;i++){var a=t.charCodeAt(i).toString(16);r[i]=1===a.length?"0"+a:a}return r.join("")},e.prototype.getCalculatedDuration=function(){return this._duration},e.prototype.getFileId=function(){return this._fileId},e.prototype.getFormat=function(){return this._format||""},e.prototype.getFragmentLength=function(){return this._segmentLength},e.prototype.canLowerBitrate=function(){return!1},e.prototype.getInitFragment=function(){return this._initFragment},e.prototype.getInitParams=function(){var e={keySystem:this._keySystem,initDataType:this._protection,initData:this._psshBox,licenseServer:null};return Promise.resolve(e)},e.prototype.getKeySystem=function(){return this._keySystem},e.prototype.getLicenseEndpoint=function(){return this._licenseEndpoint},e.prototype.getLogData=function(){return this._logData||{}},e.prototype.getMediaType=function(){return this._mediaType},e.prototype.getResolvedURL=function(){return this._resolvedURL},e.prototype.getResolvedURLs=function(){return this._resolvedURLs},e.prototype.getHLSURL=function(){throw new o.FileError(i.Errors.FILE_NOT_RESOLVED,"Cannot return HLS Manifest URL: File not resolved.")},e.prototype.releaseHLSURL=function(){},e.prototype.getURI=function(){return this._uri},e.prototype.isAd=function(){return this._isAd},e.prototype.isProtected=function(){return!!this._protection&&!!this._psshBox},e.prototype.setLogData=function(e){return this._logData=e,this},e.prototype.toLogJSON=function(){return{uri:this._uri,fileId:this._fileId,format:this._format||"",resolved_url:this._resolvedURL}},e}();r.Content=s},{"../enums/errors":58,"../error/file":72,"./eme/keysystem_setting":29,"@js-sdk/encoding/es5":21}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EMEConfigs=void 0,r.EMEConfigs=[{label:"video-sw-decode",initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/webm; codecs="opus"',robustness:"SW_SECURE_CRYPTO"},{contentType:'audio/mp4; codecs="flac"',robustness:"SW_SECURE_CRYPTO"},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[{contentType:'video/webm; codecs="vp9"',robustness:"SW_SECURE_DECODE"},{contentType:'video/webm; codecs="vp8"',robustness:"SW_SECURE_DECODE"},{contentType:'video/mp4; codecs="avc1.4d401f"',robustness:"SW_SECURE_DECODE"},{contentType:'video/mp2t; codecs="avc1.4d401f"',robustness:"SW_SECURE_DECODE"}],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]},{label:"video-sw-crypto",initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/webm; codecs="opus"',robustness:"SW_SECURE_CRYPTO"},{contentType:'audio/mp4; codecs="flac"',robustness:"SW_SECURE_CRYPTO"},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[{contentType:'video/webm; codecs="vp9"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/webm; codecs="vp8"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/mp4; codecs="avc1.4d401f"',robustness:"SW_SECURE_CRYPTO"},{contentType:'video/mp2t; codecs="avc1.4d401f"',robustness:"SW_SECURE_CRYPTO"}],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]},{label:"video-no-robustness",initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/webm; codecs="opus"',robustness:""},{contentType:'audio/mp4; codecs="flac"',robustness:""},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:""}],videoCapabilities:[{contentType:'video/webm; codecs="vp9"',robustness:""},{contentType:'video/webm; codecs="vp8"',robustness:""},{contentType:'video/mp4; codecs="avc1.4d401f"',robustness:""},{contentType:'video/mp2t; codecs="avc1.4d401f"',robustness:""}],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]},{label:"audio-flac-sw-crypto",initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4; codecs="flac"',robustness:"SW_SECURE_CRYPTO"},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]},{label:"audio-flac-no-robustness",initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4; codecs="flac"',robustness:""},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:""}],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]},{label:"audio-sw-crypto",initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]},{label:"audio-no-robustness",initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:""}],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]}]},{}],29:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.KeySystemSetting=void 0;var i=e("../../enums/key_system");r.KeySystemSetting=((n={})[i.KeySystem.WIDEVINE]={commonName:"widevine",licenseServer:"https://@webgate/widevine-license",withCertificate:!0,pssh_field:{audio:"pssh_widevine",video:"encryption_data"}},n[i.KeySystem.PLAYREADY]={commonName:"playready",licenseServer:"https://@webgate/playready-license",withCertificate:!1,pssh_field:{audio:"pssh_playready",video:"encryption_data"}},n[i.KeySystem.PLAYREADY_HARDWARE]={commonName:"playready",licenseServer:"https://@webgate/playready-license",withCertificate:!1,pssh_field:{audio:"pssh_playready",video:"encryption_data"}},n[i.KeySystem.FAIRPLAY]={commonName:"fairplay",licenseServer:"https://@webgate/fairplay-license",withCertificate:!0,pssh_field:{audio:"pssh_fairplay",video:"asset_id"}},n[i.KeySystem.INVALID_SPOTIFY_KEY]={commonName:"spotify-invalid",licenseServer:"https://@webgate",withCertificate:!1,pssh_field:{audio:"pssh_invalid",video:"encryption_data"}},n)},{"../../enums/key_system":60}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EMEManager=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/debug-tools/es5"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../../enums/event"),u=e("../../enums/errors"),l=e("../../enums/key_system"),c=e("../../error/eme"),d=e("../../error/capping"),_=e("./polyfills"),p=e("./keysystem_setting"),f=e("./configs"),h=e("../helpers/eme"),y=/([^;]+)(?:;\s?codecs="(.*)")?/,v=o.logging.forTag("playback.eme_manager"),E={EMPTY:"-no-robustness",SW_CRYPTO:"-sw-crypto",SW_DECODE:"-sw-decode",HW_CRYPTO:"-hw-crypto",HW_DECODE:"-hw-decode",HW_ALL:"-hw-all"};function m(e,t){for(var r,n=[],i=new RegExp('codecs="('+t.join("|")+')"'),o=0,a=e;o<a.length;o++){var s=a[o];i.test(null!==(r=s.contentType)&&void 0!==r?r:"")||n.push(s)}return n.length?n:null}function g(e,t){var r,i,o,a,s=t.audio,u=t.video;if(!(null==s?void 0:s.length)&&!(null==u?void 0:u.length))return e;var l=e.audioCapabilities,c=e.videoCapabilities;return(null==s?void 0:s.length)&&(null===(r=e.audioCapabilities)||void 0===r?void 0:r.length)&&!(l=null!==(i=m(e.audioCapabilities,s))&&void 0!==i?i:void 0)||(null==u?void 0:u.length)&&(null===(o=e.videoCapabilities)||void 0===o?void 0:o.length)&&!(c=null!==(a=m(e.videoCapabilities,u))&&void 0!==a?a:void 0)?null:n.__assign(n.__assign({},e),{audioCapabilities:l,videoCapabilities:c})}var T=function(e){function t(t){var r,n=e.call(this)||this;return n._unauthServerCertificateBase="",n._disallowCodecs={},n._keySystemDeferred=a.createPromiseResolver(),n._configuration=a.createPromiseResolver(),n._keySystemSettings=null,n._keySessions=[],n._configs=[],n._pendingCertificateRequest=null,n._certificate=null,n._transport=t.transport,n._emeImpl=t.emeImpl,n._noServerCertificate=!!t.noServerCertificate,n._precacheServerCertificate=null===(r=t.precacheServerCertificate)||void 0===r||r,n._unauthServerCertificateBase=t.unauthServerCertificateBase||"https://spclient.wg.spotify.com",n._configFilter=function(e){var t=["--ensure-no-match--"];if(null==e?void 0:e.length)for(var r=e.length;r--;){var n=e[r];n&&E.hasOwnProperty(n)&&t.push(E[n])}return new RegExp("("+t.join("|")+")$")}(t.disallowRobustnessValues||[]),n._disallowCodecs=t.disallowCodecs,n._preferredKeySystems=t.preferredKeySystems||[l.KeySystem.WIDEVINE,l.KeySystem.PLAYREADY,l.KeySystem.PLAYREADY_HARDWARE,l.KeySystem.FAIRPLAY],n}return n.__extends(t,e),t.create=function(e){return new Promise((function(r){var i=_.install();if(!i)throw c.EMEError.fatal(u.Errors.EME_API_NOT_SUPPORTED,"Platform does not support navigator.requestMediaKeySystemAccess");r(new t(n.__assign(n.__assign({},e),{emeImpl:i})).init())}))},t.prototype._prepareConfiguration=function(e){var t=e.getConfiguration();v.info("KeySystem configured as ",t.label),t.audioCapabilities&&t.audioCapabilities.length||this._appendProbableMediaCapabilities(e.keySystem,t);var r={keySystem:e.keySystem,keySystemImpl:this._emeImpl,audioFormats:this._parseCapabilities(t.audioCapabilities),videoFormats:this._parseCapabilities(t.videoCapabilities)};return this._keySystemSettings=p.KeySystemSetting[e.keySystem],this._configuration.resolve(r),r},t.prototype._parseCapabilities=function(e){var t;if(!e)return[];for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];if(null==o?void 0:o.contentType){var a=null!==(t=o.contentType.match(y))&&void 0!==t?t:[],s=a[1],u=a[2];s&&r.push({contentType:o.contentType,mimeType:s,codec:null!=u?u:""})}}return r},t.prototype._appendProbableMediaCapabilities=function(e,t){var r=h.getMediaKeySystemConfiguration(this._configs,(function(t){return(-1===t.indexOf("webm")||e!==l.KeySystem.PLAYREADY&&e!==l.KeySystem.PLAYREADY_HARDWARE)&&!!MediaSource.isTypeSupported(t)}));r&&(t.audioCapabilities=r.audioCapabilities,t.videoCapabilities=r.videoCapabilities)},t.prototype._trySetServerCertificate=function(e,t){var r=this,n=this._certificate;return(n&&n.expiry>Date.now()?Promise.resolve(n):this._requestServerCertificate(e)).then((function(e){return t.setServerCertificate(e.contents)})).then((function(){return r})).catch((function(e){return v.warn("Error from setting server certificate",e),r}))},t.prototype._cacheServerCertificate=function(e){var t=this,r="";switch(e){case l.KeySystem.FAIRPLAY:r="fairplay";break;case l.KeySystem.WIDEVINE:r="widevine";break;default:return Promise.resolve(this)}return this._requestServerCertificate(this._unauthServerCertificateBase+"/"+r+"-license",!1).then((function(){return t}),(function(e){return v.warn("Cannot precache server certificate",e),t}))},t.prototype._requestServerCertificate=function(e,t){var r=this;return void 0===t&&(t=!0),this._pendingCertificateRequest?this._pendingCertificateRequest:this._transport.request(e+"/v1/application-certificate",{authorize:t,responseType:"arraybuffer",parseResponseHeaders:!0,retry:{condition:function(e,t){return e.getStatusFamily()===t.SERVER_ERROR}}}).then((function(e){var t;if(!e.body)throw new TypeError("Response body is invalid");r._pendingCertificateRequest=null;var n=3600,i=null===(t=e.headers)||void 0===t?void 0:t.get("cache-control");if(i){var o=i.match(/(?:^|,|\s)max-age=(\d+)(?:,|$)/);o&&o[1]&&(n=1e3*parseInt(o[1],10))}return r._certificate={expiry:Date.now()+(n-600),contents:e.body},r._certificate}))},t.prototype._extractPlayReadyChallenge=function(e,t){var r,n=null,i=new Uint16Array(e),o=String.fromCharCode.apply(null,i);if(-1===o.indexOf("PlayReadyKeyMessage"))return v.info("Using unextracted PlayReady message."),e;var a=(new DOMParser).parseFromString(o,"application/xml"),l=a.getElementsByTagName("Challenge")[0],d=null===(r=null==l?void 0:l.childNodes[0])||void 0===r?void 0:r.nodeValue;if(d)try{n=atob(d);var _=a.getElementsByTagName("name"),p=a.getElementsByTagName("value");if(_.length!==p.length)throw new c.EMEError(u.Errors.EME_HEADER_KEY_VALUE_MISMATCH,"Mismatched header <name>/<value> pair in key message")}catch(e){this.emit(s.Event.EME_LICENSE_REQUEST_ERROR,{playId:t,error:e}),n=null}else this.emit(s.Event.EME_LICENSE_REQUEST_ERROR,{playId:t,error:new c.EMEError(u.Errors.EME_HEADER_KEY_VALUE_MISMATCH,"Mismatched header <name>/<value> pair in key message")});return n},t.prototype._onMessage=function(e,t){e.timeMap.generate.end=Date.now();var r="message"in t?t.message:null,n="messageType"in t?t.messageType:void 0;if(v.info("Got EME message event with type",n),r&&e.keySystem===l.KeySystem.PLAYREADY&&(r=this._extractPlayReadyChallenge(r,e.playId)),r)if(e.licenseServer){e.timeMap.request.start=Date.now();var i=e.licenseServer;e.keySystem===l.KeySystem.FAIRPLAY&&(i=i+(-1!==i.indexOf("?")?"&":"?")+"assetId=hex"),this._transport.request(i,{method:"POST",payload:r,responseType:"arraybuffer",retry:{condition:function(e,t){return 400!==e.status&&402!==e.status&&403!==e.status&&(!e.body||e.getStatusFamily()!==t.SUCCESS)}}}).then(this._handleLicenseResponse.bind(this,e))}else v.info("Ignoring message event: no licenseServer url");else v.info("Ignoring message event: no valid request payload")},t.prototype._handleLicenseResponse=function(e,t){var r,n=this,i=function(t){t.playId=e.playId,e.licenseServer&&(t.licenseServer=e.licenseServer),n.emit(s.Event.EME_LICENSE_REQUEST_ERROR,{playId:e.playId,error:t})};if(e.timeMap.request.end=Date.now(),200!==t.status){var o;try{if(t.body){var a=new Uint8Array(t.body),l=String.fromCharCode.apply(String,a);o=JSON.parse(l).errorMsg}}catch(e){}402===t.status?this.emit(s.Event.EME_LICENSE_REQUEST_CAPPED,{playId:e.playId,error:new d.CappingError(u.Errors.CAPPING_USER_IS_CAPPED,"User is capped.")}):400===t.status&&"widevine error"===o?((r=c.EMEError.fatal(u.Errors.EME_LICENSE_REQUEST_WIDEVINE_ERROR,"Widevine license server failed to parse request.")).status=t.status,r.shouldRefreshEndpoint=!0,i(r)):((r=new c.EMEError(u.Errors.EME_LICENSE_REQUEST_FAILED_WITH_STATUS,"License request failed ("+(o||"unknown")+")")).status=t.status,r.shouldRefreshEndpoint=400===t.status||403===t.status,i(r))}else{if(!t.body)return(r=new c.EMEError(u.Errors.EME_LICENSE_REQUEST_EMPTY_RESPONSE,"Empty license response body")).status=t.status,void i(r);try{e.timeMap.update.start=Date.now(),e.keySession.update(t.body).catch((function(e){i(new c.EMEError(u.Errors.EME_LICENSE_UPDATE_FAILED,e.message||"License update failed."))})),v.info("KeySession updated.")}catch(e){var _=e.message;i(new c.EMEError(u.Errors.EME_LICENSE_UPDATE_FAILED,_||"License update failed."))}}},t.prototype._selectKeySystem=function(e){for(var t=this._preferredKeySystems,r=0,n=t.length;r<n;r++){var i=t[r];if(i&&i in e)return e[i]}return null},t.prototype._testMediaKeys=function(e){return new Promise((function(t){t(e.createMediaKeys())})).then((function(t){if(!t)return Promise.reject(c.EMEError.fatal(u.Errors.EME_MEDIA_KEYS_NOT_SUPPORTED,"Cannot create MediaKeys from KeySystemAccess"));e.keySystem===l.KeySystem.FAIRPLAY&&t.setServerCertificate(new ArrayBuffer(0));try{if(!t.createSession())throw new Error("")}catch(e){var r=e.message;return Promise.reject(c.EMEError.fatal(u.Errors.EME_MEDIA_KEY_SESSION_NOT_SUPPORTED,r||"Cannot create MediaKeySession from KeySystemAccess"))}return Promise.resolve(e)}),(function(e){return v.error(e.name),Promise.reject(c.EMEError.fatal(u.Errors.EME_MEDIA_KEYS_NOT_SUPPORTED,e.message||"Unknown error"))}))},t.prototype._saveSession=function(e){this._keySessions.push(e)},t.prototype.destroySessions=function(){for(var e=[],t=0,r=this._keySessions;t<r.length;t++){var n=r[t];try{var i=n.keySession;if(!i)continue;n.onMessageListener&&i.removeEventListener(s.Event.KEY_SESSION_MESSAGE,n.onMessageListener),n.onKeyStatusChangeListener&&i.removeEventListener(s.Event.KEY_SESSION_STATUSES_CHANGE,n.onKeyStatusChangeListener);var o=Promise.resolve(i.close()).catch((function(e){v.warn("Failed to close KeySession",e)}));e.push(o),n.keySession=null,n.onMessageListener=null,n.onKeyStatusChangeListener=null,v.info("Closed KeySession")}catch(e){v.warn("Failed to close KeySession",e)}}return this._keySessions=[],Promise.all(e)},t.prototype.init=function(){for(var e=this,t=this._keySystemDeferred,r={},n=[],i=[],o=0,a=f.EMEConfigs;o<a.length;o++){var s=a[o];if(!s.label||!this._configFilter.test(s.label)){if(this._disallowCodecs){var d=g(s,this._disallowCodecs);if(!d)continue;s=d}i.push(s)}}for(var _ in this._configs=i,l.KeySystem)if(Object.prototype.hasOwnProperty.call(l.KeySystem,_)){var p=_;n.push(navigator.requestMediaKeySystemAccess(l.KeySystem[p],i).then((function(e){r[e.keySystem]=e})).catch((function(){})))}return Promise.all(n).then(this._selectKeySystem.bind(this,r)).then((function(t){return t?e._testMediaKeys(t):Promise.reject(new c.EMEError(u.Errors.EME_NO_SUPPORTED_KEYSYSTEM,"No supported keysystem was found."))})).then((function(r){return e._prepareConfiguration(r),t.resolve(r),e._precacheServerCertificate?e._cacheServerCertificate(r.keySystem):e})).catch((function(r){var n=r.code||u.Errors.EME_NO_SUPPORTED_KEYSYSTEM,i=r.message||"No supported keysystem";return t.reject(c.EMEError.fatal(n,i)),t.promise.then((function(){return e}))}))},t.prototype.createMediaKeys=function(e){var t=this;return this._keySystemDeferred.promise.then((function(e){return e.createMediaKeys()})).then((function(t){return Promise.all([e.setMediaKeys(t),t])})).then((function(r){r[0];var n=r[1];if(!e.mediaKeys)throw new c.EMEError(u.Errors.EME_PLAYER_MEDIA_KEYS_SETTING_FAILED,"Failed to set MediaKeys on HTMLMediaElement");return t._configuration.promise.then((function(){var e=t._keySystemSettings;return e&&!t._noServerCertificate&&e.withCertificate?t._trySetServerCertificate(e.licenseServer,n):t}))}))},t.prototype.removeMediaKeys=function(e){var t=this;return Promise.resolve(e.setMediaKeys(null)).then((function(){return t}))},t.prototype.getKeySystemInfo=function(){return this._configuration.promise},t.prototype.getKeySystemImpl=function(){return this._emeImpl},t.prototype.createSessionWithParams=function(e){var t=this;return new Promise((function(r,n){v.info("Creating KeySession",e.keySystem);var i=e.mediaKeys.createSession(),o={generate:{start:0,end:0},request:{start:0,end:0},update:{start:0,end:0}},a=t._keySystemSettings&&t._keySystemSettings.licenseServer||void 0,l=t._onMessage.bind(t,{keySystem:e.keySystem,keySession:i,licenseServer:e.licenseServer||a,playId:e.playId,timeMap:o});i.addEventListener(s.Event.KEY_SESSION_MESSAGE,l);var d=function(){v.info("KeyStatus change"),o.update.end=Date.now(),r({elapsed:{generate:Math.max(o.generate.end-o.generate.start,0),request:Math.max(o.request.end-o.request.start,0),update:Math.max(o.update.end-o.update.start,0)}})};return i.addEventListener(s.Event.KEY_SESSION_STATUSES_CHANGE,d),t._saveSession({keySession:i,onMessageListener:l,onKeyStatusChangeListener:d}),v.info("Generating KeySession request",e.keySystem),o.generate.start=Date.now(),Promise.resolve(i.generateRequest(e.initDataType,e.initData.buffer)).catch((function(e){if(e){var t;switch(e.name){case"NotSupportedError":t=u.Errors.EME_NOT_SUPPORTED_ERROR;break;case"InvalidStateError":t=u.Errors.EME_INVALID_STATE_ERROR;break;default:t=u.Errors.EME_UNKNOWN_ERROR}n(new c.EMEError(t,e.message||"Unknown error message."))}}))}))},t}(i.EventEmitter);r.EMEManager=T},{"../../enums/errors":58,"../../enums/event":59,"../../enums/key_system":60,"../../error/capping":70,"../../error/eme":71,"../helpers/eme":39,"./configs":28,"./keysystem_setting":29,"./polyfills":32,"@js-sdk/common/es5/promise_resolver":91,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,tslib:201}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.emitEncrypted=void 0,r.emitEncrypted=function(e){var t=document.createEvent("Event");t.initEvent("encrypted",!1,!1),t.initDataType="cenc",t.initData=e.initData,t.fromPolyfill=!0,this.dispatchEvent(t)}},{}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.install=void 0;var n=e("@js-sdk/debug-tools/es5"),i=e("./ms_ie"),o=e("./v0_1b"),a=e("./safari"),s=n.logging.forTag("eme_polyfills.tester");r.install=function(){return"undefined"!=typeof navigator&&(null===navigator||void 0===navigator?void 0:navigator.requestMediaKeySystemAccess)&&"undefined"==typeof WebKitMediaKeys&&"undefined"!=typeof MediaKeySystemAccess&&(null===MediaKeySystemAccess||void 0===MediaKeySystemAccess?void 0:MediaKeySystemAccess.prototype.getConfiguration)?(s.log("Using native EME implementation."),"native"):"undefined"!=typeof HTMLMediaElement&&(null===HTMLMediaElement||void 0===HTMLMediaElement?void 0:HTMLMediaElement.prototype.webkitGenerateKeyRequest)?(s.log('Detected "webkit" Prefixed EME v0.1b. Polyfilling.'),o.setup("webkit"),"v0.1b-webkit"):"undefined"!=typeof HTMLMediaElement&&(null===HTMLMediaElement||void 0===HTMLMediaElement?void 0:HTMLMediaElement.prototype.generateKeyRequest)?(s.log("Detected Unprefixed EME v0.1b. Polyfilling."),o.setup(),"v0.1b"):"undefined"!=typeof MSMediaKeys?(s.log("Detected MS IE EME. Polyfilling."),i.setup(),"ms-ie"):"function"==typeof WebKitMediaKeys?(s.log("Detected Safari EME. Polyfilling."),a.setup(),"safari"):(s.warn("Detected no EME APIs."),null)}},{"./ms_ie":34,"./safari":35,"./v0_1b":36,"@js-sdk/debug-tools/es5":17}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LicenseRequestEvent=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../../../enums/event"),a=function(e){function t(t){var r=e.call(this,o.Event.KEY_SESSION_MESSAGE,null)||this;return r.messageType="license-request",r.message=t,r}return n.__extends(t,e),t}(i.EmittedEvent);r.LicenseRequestEvent=a},{"../../../enums/event":59,"@spotify-internal/emitter/es5":98,tslib:201}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/promise_resolver"),a=e("../../../enums/errors"),s=e("../../../enums/event"),u=e("../../../error/eme"),l=e("./emit_encrypted"),c=e("./license_request_event"),d=function(e){function t(t){var r=e.call(this)||this;return r._nativeKeySession=null,r._lastUpdateDeferred=o.createPromiseResolver(),r._lastGenerateDeferred=o.createPromiseResolver(),r.addEventListener=r.addListener,r.removeEventListener=r.removeListener,r._nativeMediaKeys=t,r._onKeyMessage=r._onKeyMessage.bind(r),r._onKeyAdded=r._onKeyAdded.bind(r),r._onKeyError=r._onKeyError.bind(r),r}return n.__extends(t,e),t.prototype._attach=function(){var e=this._nativeKeySession;e&&(e.addEventListener(s.Event.MS_KEY_ADDED,this._onKeyAdded),e.addEventListener(s.Event.MS_KEY_ERROR,this._onKeyError),e.addEventListener(s.Event.MS_KEY_MESSAGE,this._onKeyMessage))},t.prototype._detach=function(){var e=this._nativeKeySession;e&&(e.removeEventListener(s.Event.MS_KEY_ADDED,this._onKeyAdded),e.removeEventListener(s.Event.MS_KEY_ERROR,this._onKeyError),e.removeEventListener(s.Event.MS_KEY_MESSAGE,this._onKeyMessage))},t.prototype._onKeyMessage=function(e){e.message&&e.message.buffer&&(this.emitEvent(new c.LicenseRequestEvent(e.message.buffer)),this._lastGenerateDeferred&&(this._lastGenerateDeferred.resolve(!0),this._lastGenerateDeferred=null))},t.prototype._onKeyAdded=function(){this._lastUpdateDeferred&&(this._lastUpdateDeferred.resolve(!0),this._lastUpdateDeferred=null),this._lastGenerateDeferred&&(this._lastGenerateDeferred.resolve(!0),this._lastGenerateDeferred=null),this.emit(s.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype._onKeyError=function(){var e=this._nativeKeySession&&this._nativeKeySession.error;this._lastGenerateDeferred&&(this._lastGenerateDeferred.reject(e),this._lastGenerateDeferred=null),this._lastUpdateDeferred&&(this._lastUpdateDeferred.reject(e),this._lastUpdateDeferred=null),this.emit(s.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype.generateRequest=function(e,t){var r=this;return new Promise((function(e,n){r._lastGenerateDeferred&&(r._lastGenerateDeferred.resolve=e,r._lastGenerateDeferred.reject=n),r._nativeKeySession=r._nativeMediaKeys.createSession("audio/mp4",new Uint8Array(t),null),r._attach()}))},t.prototype.update=function(e){var t=this;return new Promise((function(r,n){t._lastGenerateDeferred&&(t._lastGenerateDeferred.resolve=r,t._lastGenerateDeferred.reject=n),t._nativeKeySession&&t._nativeKeySession.update(new Uint8Array(e))}))},t.prototype.close=function(){var e=this;return new Promise((function(t){e._nativeKeySession&&e._nativeKeySession.close(),e._detach(),t(!0)}))},t}(i.EventEmitter),_=function(){function e(e){this._lastBoundSetter=null,this.shouldRefreshPerTrack=!0,this._nativeMediaKeys=new MSMediaKeys(e)}return e.prototype.attach=function(e){var t=this;return new Promise((function(r){if(e.readyState>=1)return e.msSetMediaKeys(t._nativeMediaKeys),void r();var n=function r(){e.removeEventListener(s.Event.MEDIA_LOADEDMETADATA,r),t._lastBoundSetter=null,e.msSetMediaKeys(t._nativeMediaKeys)};t._lastBoundSetter=n,e.addEventListener(s.Event.MEDIA_LOADEDMETADATA,n),e.addEventListener(s.Event.MS_NEEDKEY,l.emitEncrypted),r()}))},e.prototype.detach=function(e){this._lastBoundSetter&&(e.removeEventListener(s.Event.MS_NEEDKEY,l.emitEncrypted),e.removeEventListener(s.Event.MEDIA_LOADEDMETADATA,this._lastBoundSetter),this._lastBoundSetter=null)},e.prototype.setServerCertificate=function(){return Promise.reject(new u.EMEError(a.Errors.EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM,"Cannot set server certificate on this platform."))},e.prototype.createSession=function(){return new d(this._nativeMediaKeys)},e}();function p(e){var t=this.mediaKeys;return t&&t!==e&&t.detach(this),delete this.mediaKeys,this.mediaKeys=e,e&&e.attach(this),Promise.resolve()}var f=function(){function e(e,t){if(this._configuration=null,this.keySystem=e,!this._checkConfig(t))throw new u.EMEError(a.Errors.EME_NO_SUPPORTED_CONFIGURATION,"No supported configurations")}return e.prototype._checkConfig=function(e){for(var t,r,n=this.keySystem,i=0,o=e;i<o.length;i++){var a=o[i],s={initDataTypes:a.initDataTypes,audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",sessionTypes:["temporary"],label:a.label},u=void 0;if(a.audioCapabilities&&a.audioCapabilities.length&&s.audioCapabilities){u=!1;for(var l=0,c=a.audioCapabilities;l<c.length;l++){var d=null===(t=(f=c[l]).contentType)||void 0===t?void 0:t.split(";")[0];MSMediaKeys.isTypeSupported(n,d)&&(s.audioCapabilities.push(f),u=!0)}}if(a.videoCapabilities&&a.videoCapabilities.length&&s.videoCapabilities){u=!1;for(var _=0,p=a.videoCapabilities;_<p.length;_++){var f;d=null===(r=(f=p[_]).contentType)||void 0===r?void 0:r.split(";")[0];MSMediaKeys.isTypeSupported(n,d)&&(s.videoCapabilities.push(f),u=!0)}}if(u)return this._configuration=s,!0}return!1},e.prototype.getConfiguration=function(){return this._configuration},e.prototype.createMediaKeys=function(){var e=this;return new Promise((function(t){t(new _(e.keySystem))}))},e}();r.setup=function(){navigator.requestMediaKeySystemAccess=function(e,t){return new Promise((function(r){r(new f(e,t))}))};var e=HTMLMediaElement.prototype;delete e.mediaKeys,e.setMediaKeys=p}},{"../../../enums/errors":58,"../../../enums/event":59,"../../../error/eme":71,"./emit_encrypted":31,"./license_request_event":33,"@js-sdk/common/es5/promise_resolver":91,"@spotify-internal/emitter/es5":98,tslib:201}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;var n=e("tslib"),i=e("@js-sdk/debug-tools/es5"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../../../enums/errors"),u=e("../../../enums/event"),l=e("../../../error/eme"),c=e("./emit_encrypted"),d=e("./license_request_event"),_=i.logging.forTag("eme_polyfill.safari");var p=function(e){function t(t,r){var n=e.call(this)||this;return n._attached=!1,n._nativeKeySession=null,n._lastGenerateResolver=a.createPromiseResolver(),n._lastUpdateResolver=a.createPromiseResolver(),n.addEventListener=n.addListener,n.removeEventListener=n.removeListener,n._nativeMediaKeys=t,n._serverCertificate=r,n._onKeyMessage=n._onKeyMessage.bind(n),n._onKeyAdded=n._onKeyAdded.bind(n),n._onKeyError=n._onKeyError.bind(n),n}return n.__extends(t,e),t.prototype._attach=function(){if(!this._attached){var e=this._nativeKeySession;e?(e.addEventListener(u.Event.WEBKIT_KEY_MESSAGE,this._onKeyMessage),e.addEventListener(u.Event.WEBKIT_KEY_ADDED,this._onKeyAdded),e.addEventListener(u.Event.WEBKIT_KEY_ERROR,this._onKeyError)):_.warn("Tried to attach with no WebKitMediaKeySession")}},t.prototype._detach=function(){if(this._attached){var e=this._nativeKeySession;e?(e.removeEventListener(u.Event.WEBKIT_KEY_MESSAGE,this._onKeyMessage),e.removeEventListener(u.Event.WEBKIT_KEY_ADDED,this._onKeyAdded),e.removeEventListener(u.Event.WEBKIT_KEY_ERROR,this._onKeyError)):_.warn("Tried to detach with no WebKitMediaKeySession")}},t.prototype._onKeyMessage=function(e){e.message&&e.message.buffer&&(this.emitEvent(new d.LicenseRequestEvent(e.message.buffer)),this._lastGenerateResolver&&(this._lastGenerateResolver.resolve(!0),this._lastGenerateResolver=null))},t.prototype._onKeyAdded=function(){this._lastUpdateResolver&&(this._lastUpdateResolver.resolve(!0),this._lastUpdateResolver=null),this.emit(u.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype._onKeyError=function(){var e=this._nativeKeySession&&this._nativeKeySession.error,t=new l.EMEError(s.Errors.EME_MEDIA_KEY_SESSION_SAFARI_ERROR,e&&e.message||"MediaKeySession Safari Error");e&&(t.debug.errorCode=e.code,t.debug.systemCode=e.systemCode),this._lastGenerateResolver?(this._lastGenerateResolver.reject(t),this._lastGenerateResolver=null):this._lastUpdateResolver&&(this._lastUpdateResolver.reject(t),this._lastUpdateResolver=null)},t.prototype._rebuildInitData=function(e){var t=new Uint8Array(e);if(new DataView(t.buffer).getUint32(0,!0)+4!==t.byteLength)throw new l.EMEError(s.Errors.EME_INIT_DATA_MALFORMED,"Malformed init data");var r=function(e){for(var t=Math.floor(e.byteLength/2),r=new Uint16Array(t),n=new DataView(e.buffer),i=0;i<t;i++)r[i]=n.getUint16(2*i,!0);return String.fromCharCode.apply(null,r)}(t.slice(4)).match(/^skd:\/\/([0-9a-fA-F]+)/);if(!(null==r?void 0:r[1]))throw new l.EMEError(s.Errors.EME_INIT_DATA_MALFORMED,"Invalid content ID");var n=r[1],i=new Uint8Array(function(e){for(var t=new Uint8Array(2*e.length),r=new DataView(t.buffer),n=e.split(""),i=0,o=n.length;i<o;i++){var a=n[i].charCodeAt(0);r.setUint16(2*i,a,!0)}return t.buffer}(n)),o=this._serverCertificate,a=new Uint8Array(t.byteLength+4+i.byteLength+4+o.byteLength),u=0;a.set(t,u),u+=t.byteLength;var c=new DataView(a.buffer);return c.setUint32(u,i.byteLength,!0),u+=4,a.set(i,u),u+=i.byteLength,c.setUint32(u,o.byteLength,!0),u+=4,a.set(o,u),a},t.prototype.generateRequest=function(e,t){var r=this;return new Promise((function(e,n){r._lastGenerateResolver={resolve:e,reject:n};try{var i=r._rebuildInitData(t);r._nativeKeySession=r._nativeMediaKeys.createSession("video/mp4",new Uint8Array(i),null),r._attach()}catch(e){r._lastGenerateResolver=null,n(e)}}))},t.prototype.update=function(e){var t=a.createPromiseResolver();if(this._lastUpdateResolver=t,!this._nativeKeySession)return _.warn("Tried to update with no WebKitMediaKeySession"),t.promise;try{this._nativeKeySession.update(new Uint8Array(e))}catch(e){t.reject(e)}return t.promise},t.prototype.close=function(){var e=this;return new Promise((function(t){e._detach(),t(!0)}))},t}(o.EventEmitter),f=function(){function e(e){this._lastBoundSetter=null,this._serverCertificate=null,this.shouldRefreshPerTrack=!0,this._nativeMediaKeys=new WebKitMediaKeys(e)}return e.prototype.attach=function(e){var t=this;return new Promise((function(r){if(e.readyState>=1)return e.webkitSetMediaKeys(t._nativeMediaKeys),void r();var n=function r(){e.removeEventListener(u.Event.MEDIA_LOADEDMETADATA,r),t._lastBoundSetter=null,e.webkitSetMediaKeys(t._nativeMediaKeys)};t._lastBoundSetter=n,e.addEventListener(u.Event.MEDIA_LOADEDMETADATA,n),e.addEventListener(u.Event.WEBKIT_NEEDKEY,c.emitEncrypted),r()}))},e.prototype.detach=function(e){e.removeEventListener(u.Event.WEBKIT_NEEDKEY,c.emitEncrypted),this._lastBoundSetter&&(e.removeEventListener(u.Event.MEDIA_LOADEDMETADATA,this._lastBoundSetter),this._lastBoundSetter=null)},e.prototype.setServerCertificate=function(e){return this._serverCertificate=new Uint8Array(e),Promise.resolve(!0)},e.prototype.createSession=function(){if(!this._serverCertificate)throw new l.EMEError(s.Errors.EME_INVALID_STATE_ERROR,"The server certificate is not available");return new p(this._nativeMediaKeys,this._serverCertificate)},e}(),h=function(){function e(e,t){this.keySystem=e;var r=this._checkConfig(t);if(!r)throw new l.EMEError(s.Errors.EME_NO_SUPPORTED_CONFIGURATION,"No supported configurations");this._configuration=r}return e.prototype._checkConfig=function(e){for(var t=this.keySystem,r=!1,n=0,i=e;n<i.length;n++){var o=i[n],a={initDataTypes:o.initDataTypes,audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",sessionTypes:["temporary"]};if(o.audioCapabilities)for(var s=0,u=o.audioCapabilities;s<u.length;s++){if((_=u[s]).contentType){var l=_.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(t,l)&&(a.audioCapabilities.push(_),r=!0)}}if(o.videoCapabilities)for(var c=0,d=o.videoCapabilities;c<d.length;c++){var _;if((_=d[c]).contentType){l=_.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(t,l)&&(a.videoCapabilities.push(_),r=!0)}}if(r)return a}return null},e.prototype.getConfiguration=function(){return this._configuration},e.prototype.createMediaKeys=function(){var e=this;return new Promise((function(t){t(new f(e.keySystem))}))},e}();function y(e){var t=this.mediaKeys;return t&&t!==e&&t.detach(this),delete this.mediaKeys,this.mediaKeys=e,e?e.attach(this):Promise.resolve()}r.setup=function(){navigator.requestMediaKeySystemAccess=function(e,t){return new Promise((function(r){r(new h(e,t))}))};var e=HTMLMediaElement.prototype;delete e.mediaKeys,e.setMediaKeys=y}},{"../../../enums/errors":58,"../../../enums/event":59,"../../../error/eme":71,"./emit_encrypted":31,"./license_request_event":33,"@js-sdk/common/es5/promise_resolver":91,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,tslib:201}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;var n=e("tslib"),i=e("@js-sdk/debug-tools/es5"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../../../enums/errors"),u=e("../../../enums/event"),l=e("../../../error/eme"),c=e("./emit_encrypted"),d=e("./license_request_event"),_=i.logging.forTag("eme_polyfill.v0_1b"),p=function(e){function t(t,r,n){var i=e.call(this)||this;return i._mediaElement=null,i._lastUpdateDeferred=null,i._lastGenerateResolver=null,i.sessionId=null,i._keySystem=t,i._mediaElement=r,i._prefix=n,i.addEventListener=i.addListener,i.removeEventListener=i.removeListener,i}return n.__extends(t,e),t.prototype._addPrefix=function(e){return this._prefix?this._prefix+e.replace(/\b[a-z]/,(function(e){return e.toUpperCase()})):e},t.prototype.generateComplete=function(e){this.emitEvent(new d.LicenseRequestEvent(e)),this._lastGenerateResolver&&(this._lastGenerateResolver.resolve(!0),this._lastGenerateResolver=null)},t.prototype.updateComplete=function(){this._lastUpdateDeferred&&(this._lastUpdateDeferred.resolve(!0),this._lastUpdateDeferred=null),this.emit(u.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype.handleErrorEvent=function(e){var t=new l.EMEError(s.Errors.EME_MEDIA_KEY_SESSION_V0_1B_ERROR,"MediaKeySession v0.1b Error");t.debug.errorCode=e.errorCode,t.debug.systemCode=e.systemCode,!e.sessionId&&this._lastGenerateResolver?(this._lastGenerateResolver.reject(t),this._lastGenerateResolver=null):e.sessionId&&this._lastUpdateDeferred?(this._lastUpdateDeferred.reject(t),this._lastUpdateDeferred=null):this.emit(u.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype.generateRequest=function(e,t){var r=this;return this._mediaElement?new Promise((function(e,n){r._lastGenerateResolver={resolve:e,reject:n};try{r._mediaElement[r._addPrefix("generateKeyRequest")](r._keySystem,new Uint8Array(t))}catch(e){n(e),r._lastGenerateResolver=null}})):Promise.reject(new ReferenceError("InvalidState: Media keys are not attached."))},t.prototype.update=function(e){if(!this._mediaElement)return Promise.reject(new ReferenceError("InvalidState: Media keys are not attached."));if(this._lastUpdateDeferred){var t=this.update.bind(this,e);return this._lastUpdateDeferred.promise.then(t,t)}var r=a.createPromiseResolver();this._lastUpdateDeferred=r;try{this._mediaElement[this._addPrefix("addKey")](this._keySystem,new Uint8Array(e),null,this.sessionId)}catch(e){r.reject(e),this._lastUpdateDeferred=null}return r.promise},t.prototype.close=function(){if(this.sessionId&&this._mediaElement)try{this._mediaElement[this._addPrefix("cancelKeyRequest")](this._keySystem,this.sessionId)}catch(e){_.warn("Could not close keysession",e)}return Promise.resolve(!0)},t}(o.EventEmitter),f=function(){function e(e,t){void 0===t&&(t=""),this._mediaElement=null,this._waitingForSessionIds=[],this._sessionMap={},this.shouldRefreshPerTrack=!0,this._keySystem=e,this._prefix=t,this._onKeyMessage=this._onKeyMessage.bind(this),this._onKeyAdded=this._onKeyAdded.bind(this),this._onKeyError=this._onKeyError.bind(this)}return e.prototype.attach=function(e){this._mediaElement=e;var t=this._prefix;e.addEventListener(t+u.Event.V0_1B_NEEDKEY,c.emitEncrypted);var r=e.addEventListener.bind(e);r(t+u.Event.V0_1B_KEY_ADDED,this._onKeyAdded),r(t+u.Event.V0_1B_KEY_ERROR,this._onKeyError),r(t+u.Event.V0_1B_KEY_MESSAGE,this._onKeyMessage)},e.prototype.detach=function(e){this._mediaElement=null;var t=this._prefix;e.removeEventListener(t+u.Event.V0_1B_NEEDKEY,c.emitEncrypted);var r=e.removeEventListener.bind(e);r(t+u.Event.V0_1B_KEY_ADDED,this._onKeyAdded),r(t+u.Event.V0_1B_KEY_ERROR,this._onKeyError),r(t+u.Event.V0_1B_KEY_MESSAGE,this._onKeyMessage)},e.prototype._getSession=function(e){var t=this._sessionMap[e];if(t)return t;var r=this._waitingForSessionIds.shift();return r?(r.sessionId=e,this._sessionMap[e]=r,r):null},e.prototype._onKeyMessage=function(e){var t=this._getSession(e.sessionId);t?t.generateComplete(e.message):_.warn("Got keymessage without session.")},e.prototype._onKeyAdded=function(e){var t=this._getSession(e.sessionId);t?t.updateComplete():_.warn("Got keyadded without session.")},e.prototype._onKeyError=function(e){var t=this._getSession(e.sessionId);t?t.handleErrorEvent(e):_.warn("Got keyerror without session.")},e.prototype.setServerCertificate=function(){return Promise.reject(new l.EMEError(s.Errors.EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM,"Cannot set server certificate on this platform."))},e.prototype.createSession=function(){var e=new p(this._keySystem,this._mediaElement,this._prefix);return this._waitingForSessionIds.push(e),e},e}();function h(e){var t=this.mediaKeys;return t&&t!==e&&t.detach(this),delete this.mediaKeys,this.mediaKeys=e,e&&e.attach(this),Promise.resolve()}var y=function(){function e(e,t,r){if(this._configuration=null,this.keySystem=e,this._prefix=r,!this._checkConfig(t))throw new l.EMEError(s.Errors.EME_NO_SUPPORTED_CONFIGURATION,"No supported configurations")}return e.prototype._checkConfig=function(e){for(var t,r,n=this.keySystem,i=document.createElement("video"),o=0,a=e;o<a.length;o++){var s=a[o],u={initDataTypes:s.initDataTypes,audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",sessionTypes:["temporary"],label:s.label},l=!1;if(s.audioCapabilities&&s.audioCapabilities.length&&u.audioCapabilities){l=!1;for(var c=0,d=s.audioCapabilities;c<d.length;c++){(h=null===(t=(f=d[c]).contentType)||void 0===t?void 0:t.split(";")[0])&&i.canPlayType(h,n)&&(u.audioCapabilities.push(f),l=!0)}}if(s.videoCapabilities&&s.videoCapabilities.length&&u.videoCapabilities){l=!1;for(var _=0,p=s.videoCapabilities;_<p.length;_++){var f,h;(h=null===(r=(f=p[_]).contentType)||void 0===r?void 0:r.split(";")[0])&&i.canPlayType(h,n)&&(u.videoCapabilities.push(f),l=!0)}}if(l)return this._configuration=u,!0}return!1},e.prototype.getConfiguration=function(){return this._configuration},e.prototype.createMediaKeys=function(){var e=this;return new Promise((function(t){t(new f(e.keySystem,e._prefix))}))},e}();r.setup=function(e){navigator.requestMediaKeySystemAccess=function(t,r){return new Promise((function(n){n(new y(t,r,e))}))};var t=HTMLMediaElement.prototype;delete t.mediaKeys,t.setMediaKeys=h}},{"../../../enums/errors":58,"../../../enums/event":59,"../../../error/eme":71,"./emit_encrypted":31,"./license_request_event":33,"@js-sdk/common/es5/promise_resolver":91,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,tslib:201}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isAVC1CompatibleCodec=void 0;var n=/avc1\.(([0-9a-f]{2})[0-9a-f]{2}([0-9a-f]{2}))/;r.isAVC1CompatibleCodec=function(e,t){var r=e.toLowerCase().match(n),i=t.toLowerCase().match(n);if(!r||!i)return!1;var o=r[1],a=r[2],s=r[3],u=i[1],l=i[2],c=i[3];return o===u||"4d"===a&&"4d"===l&&parseInt(s,16)>=parseInt(c,16)}},{}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.clearChildElements=r.collectionToArray=void 0;var n=Array.prototype.slice;r.collectionToArray="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){return n.call(e)},r.clearChildElements=function(e,t){for(var n=0,i=r.collectionToArray(e.getElementsByTagName(t));n<i.length;n++){var o=i[n];e.removeChild(o)}}},{}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.toFormatInfo=r.getMediaKeySystemConfiguration=void 0,r.getMediaKeySystemConfiguration=function(e,t){for(var r,n,i=0,o=e;i<o.length;i++){var a=o[i],s={audioCapabilities:[],videoCapabilities:[]},u=void 0,l=!1;if(null===(r=a.audioCapabilities)||void 0===r?void 0:r.length){l=!1;for(var c=0,d=a.audioCapabilities;c<d.length;c++){(u=(f=d[c]).contentType)&&(t(u)&&(s.audioCapabilities.push(f),l=!0))}}if(null===(n=a.videoCapabilities)||void 0===n?void 0:n.length){l=!1;for(var _=0,p=a.videoCapabilities;_<p.length;_++){var f;(u=(f=p[_]).contentType)&&(t(u)&&(s.videoCapabilities.push(f),l=!0))}}if(l)return s}return null};var n=/([^;]+)(?:;\s?codecs="(.*)")?/;r.toFormatInfo=function(e){var t,r=null!==(t=e.match(n))&&void 0!==t?t:[],i=r[1],o=void 0===i?"unknown":i,a=r[2];return{mimeType:o,codec:void 0===a?"unknown":a,contentType:e}}},{}],40:[function(e,t,r){"use strict";function n(e){var t,r=function(e){return e.map((function(e){if(e.byteEnd&&void 0!==e.byteStart){var t=""+(1+e.byteEnd-e.byteStart);return t+="@"+e.byteStart,"#EXTINF:"+e.duration+",\n#EXT-X-BYTERANGE:"+t+"\n"+e.url}return"#EXTINF:"+e.duration+",\n"+e.url})).join("\n")}(e.segments),n=e.assetID?'#EXT-X-KEY:METHOD=SAMPLE-AES,URI="skd://'+e.assetID+'",KEYFORMATVERSIONS="1",KEYFORMAT="com.apple.streamingkeydelivery"':"",i=e.map?'#EXT-X-MAP:URI="'+e.map.url+'"':"";return(null===(t=e.map)||void 0===t?void 0:t.byteEnd)&&void 0!==e.map.byteStart&&(i+=',BYTERANGE="'+(1+e.map.byteEnd)+"@"+e.map.byteStart+'"'),"#EXTM3U\n#EXT-X-VERSION:6\n#EXT-X-TARGETDURATION:"+Math.floor(e.targetDuration)+"\n#EXT-X-MEDIA-SEQUENCE:0\n#EXT-X-PLAYLIST-TYPE:VOD\n"+(i?n+"\n"+i:n)+"\n"+r+"\n#EXT-X-ENDLIST"}function i(e){return"data:application/vnd.apple.mpegurl;base64,"+btoa(e)}function o(e){var t=new Blob([e],{type:r.HLS_MIME_TYPE});return URL.createObjectURL(t)}Object.defineProperty(r,"__esModule",{value:!0}),r.createProtectedManifestDataURL=r.createProtectedManifestURL=r.createHLSBlobURL=r.createHLSDataURL=r.createProtectedManifest=r.HLS_MIME_TYPE=void 0,r.HLS_MIME_TYPE="application/vnd.apple.mpegurl",r.createProtectedManifest=n,r.createHLSDataURL=i,r.createHLSBlobURL=o,r.createProtectedManifestURL=function(e){return o(n(e))},r.createProtectedManifestDataURL=function(e){return i(n(e))}},{}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getPreferredProfiles=r.sortProfiles=void 0;var n=e("tslib"),i=e("../../enums/key_system"),o=e("./codec_compatibility");function a(e,t){return e.sort((function(e,r){return"video_bitrate"in e&&"video_bitrate"in r?t?e.video_resolution===r.video_resolution?e.video_bitrate-r.video_bitrate:e.video_resolution-r.video_resolution:e.video_bitrate-r.video_bitrate:e.max_bitrate-r.max_bitrate}))}function s(e,t){return void 0!==t&&Array.isArray(e.encryption_indices)&&-1===e.encryption_indices.indexOf(t)}function u(e,t){return!!t&&t(n.__assign({mimeType:e.mime_type},function(e){return"video_codec"in e}(e)?{type:"video",codec:e.video_codec,bitrate:e.video_bitrate,height:e.video_height,width:e.video_width}:{type:"audio",codec:e.audio_codec,bitrate:e.audio_bitrate}))}function l(e){return"audio_codec"in e?e.audio_codec:e.video_codec}r.sortProfiles=a,r.getPreferredProfiles=function(e){for(var t=e.codec,r=e.formats,n=e.profiles,c=e.encryptionIndex,d=e.disallowProfile,_=e.preferredKeySystem,p=e.preferredVideoResolution,f=e.allowMixedAVC1Codecs,h=0,y=r;h<y.length;h++){for(var v=y[h],E=[],m="spotify/unknown-mimetype",g="unknown-codec",T=0,S=n;T<S.length;T++){var P=S[T],b=l(P);!(t in P)||s(P,c)||_===i.KeySystem.FAIRPLAY&&"ts"!==P.file_type||u(P,d)||(_!==i.KeySystem.FAIRPLAY||"ts"!==P.file_type?"unknown-codec"!==g||P.mime_type!==v.mimeType||b!==v.codec&&!o.isAVC1CompatibleCodec(v.codec,b)?P.mime_type===m&&(b===g||f&&o.isAVC1CompatibleCodec(g,b))&&(E.push(P),P.__effective_codec=g):(m=v.mimeType,g=f?v.codec:b,E.push(P),P.__effective_codec=v.codec):E.push(P))}if(E.length)return a(E,p)}return[]}},{"../../enums/key_system":60,"./codec_compatibility":37,tslib:201}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LicenseURLResolver=void 0;var n=e("../enums/errors"),i=e("../error/license"),o=function(){function e(e){var t=this;this._sdk={name:"",version:""},this._securityLevel=null,this._urls={},e.sdk&&(this._sdk=e.sdk),e.securityLevel&&(this._securityLevel=e.securityLevel),this._transport=e.transport,this._useTestLicenseServer=!!e.useTestLicenseServer,this._transport.on(this._transport.EVENT_CONNECTION_ID,(function(){t._urls={}}))}return e.prototype.get=function(e,t){var r=this,o=e+":"+t,a=this._urls[o];if(a&&a.expires>Date.now()+6e4)return Promise.resolve(a.uri);var s=this._useTestLicenseServer?"&use_test_license_server=true":"",u="@webgate/melody/v1/license_url?keysystem="+e+"&mediatype="+t+"&sdk_name="+this._sdk.name+"&sdk_version="+this._sdk.version+s;return this._transport.request(u,{responseType:"json",retry:{condition:function(e,t){var r=e.getStatusFamily();return r===t.SERVER_ERROR||r===t.CONNECTION_ERROR}}}).then((function(e){var t,a=e.body;return a&&200===e.status?(a.expires*=1e3,a.uri="@webgate/"+a.uri,r._securityLevel&&(a.uri+=[-1!==a.uri.indexOf("?")?"&":"?","sl=",r._securityLevel].join("")),r._urls[o]=a,a.uri):((t=a?400===e.status&&a&&"deprecated-version"===a.code?i.LicenseError.fatal(n.Errors.LICENSE_RESOLVER_DEPRECATED_VERSION,"This version of the SDK is no longer supported. Please upgrade"):new i.LicenseError(n.Errors.LICENSE_RESOLVER_CANT_RESOLVE_URL,"License URL endpoint responded with status "+e.status):i.LicenseError.fatal(n.Errors.LICENSE_RESOLVE_INVALID_RESPONSE,"License URL endpoint responded with invalid response")).status=e.status,Promise.reject(t))}))},e.prototype.remove=function(e,t){this._urls[e+":"+t]=null},e}();r.LicenseURLResolver=o},{"../enums/errors":58,"../error/license":74}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createLogSender=void 0;var n=e("@js-sdk/common/es5"),i=function(){function e(e){this._melodyLogger=new n.MelodyLogger(e)}return e.prototype.logTrackStreamVerification=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"track_stream_verification",message:e},{batch:!0})},e.prototype.logJSSDKPlaybackStats=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_playback_stats",message:e},{batch:!0})},e.prototype.logJSSDKPlaybackStart=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_playback_start",message:e},{batch:!0})},e.prototype.logJSSDKError=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_error",message:e},{batch:!0})},e.prototype.logJSSDKWarning=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_warning",message:e},{batch:!0})},e}();r.createLogSender=function(e){return new i(e)}},{"@js-sdk/common/es5":83}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Logger=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5"),a=e("@js-sdk/debug-tools/es5"),s=e("../../enums/event"),u=e("../../enums/errors"),l=e("../../error/logging"),c=e("../../version"),d=a.logging.forTag("playback.logger"),_=function(e){function t(t){var r=e.call(this)||this;return r._currentTrackingData=null,r._sequenceId=0,r._sequenceSessionStorage={},r._sessionId="0",r._transport=t.transport,r._logSender=t.logSender,r._player=t.player,r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e=this._player;e.on(s.Event.PLAYER_LOAD,this._onPlayerLoad.bind(this)),e.on(s.Event.PLAYER_ERROR,this._onError.bind(this,!1)),e.on(s.Event.PLAYER_WARNING,this._onError.bind(this,!0)),e.on(s.Event.PLAYER_PRELOADING_ERROR,this._onError.bind(this,!1)),e.on(s.Event.PLAYER_TRACKING_DATA_CREATED,this._onTrackingDataCreated.bind(this)),e.on(s.Event.PLAYER_TRACKING_DATA_FINALIZED,this._onTrackingDataFinalized.bind(this)),e.on(s.Event.PLAYER_PLAYBACK_START,this._onPlaybackStart.bind(this))},t.prototype._emitError=function(e,t){this.emit(s.Event.LOGGER_ERROR,{error:e,trackingData:t})},t.prototype._onError=function(e,t){var r,n,i,o=t.data,a=this._currentTrackingData;if(a&&!a.noLog){var s=o.error,l=null!==(r=null==s?void 0:s.debug)&&void 0!==r?r:{};l.position="position"in o?o.position:0;var c={track:o.track||{},debug:l,preloading:"preloading"in o&&!!o.preloading,session_id:this._sessionId,playback_id:a.playbackId||null,player_play_id:"playId"in o?o.playId:null,http_status_code:null!==(n=null==s?void 0:s.status)&&void 0!==n?n:null,license_server:null!==(i=null==s?void 0:s.licenseServer)&&void 0!==i?i:null};this._logError(s.code||u.Errors.UNKNOWN,s,c,a,e)}},t.prototype._onPlayerLoad=function(e){var t=e.data.logData;if(t)if(t.impressionURLs)for(var r=0,n=t.impressionURLs;r<n.length;r++){var i=n[r];this._logImpression(i)}else t.impressionURL&&this._logImpression(t.impressionURL)},t.prototype._onPlaybackStart=function(e){var t=e.data.trackingData;t.noLog||t.noStats||this._logPlaybackStart(t)},t.prototype._onTrackingDataCreated=function(e){var t=e.data.trackingData;t.noLog?this._currentTrackingData=null:(this._currentTrackingData=t,this._setSessionId(),t.noTSV||this._setSequenceId())},t.prototype._setSessionId=function(){this._sessionId=this._transport.getInitTime().toString()},t.prototype._setSequenceId=function(){this._sessionId&&(this._sequenceId=this._getSequenceId(this._sessionId))},t.prototype._onTrackingDataFinalized=function(e){var t=e.data.trackingData;if(!t.noLog){var r=this._sessionId!==this._transport.getInitTime().toString();if(r&&this._setSessionId(),t.playbackId&&!t.noTSV){if(r&&this._setSequenceId(),!t.playIntended&&!t.played)return void this._rollbackSequenceId(this._sessionId);this._logTrackStreamVerification(t)}t.noStats||this._logPlaybackStats(t)}},t.prototype._logTrackStreamVerification=function(e){var t=this,r={play_track:e.currentTrackUri,playback_id:e.playbackId,ms_played:e.msPlayed,ms_nominal_played:e.msNominalPlayed,session_id:this._sessionId,sequence_id:this._sequenceId,next_playback_id:e.nextPlaybackId};d.debug("Logged TrackStreamVerification",r),this._logSender.logTrackStreamVerification(r).catch((function(n){var i=new l.LoggingError(u.Errors.TSV_SENDING_FAILED,n.message||"Unknown reason.");t._logError(i.code,n,r,e,!1),t._emitError(i,e)}))},t.prototype._logPlaybackStats=function(e){var t=this,r={play_track:e.currentTrackUri,file_id:e.fileId,playback_id:e.playbackId,internal_play_id:e.internalPlayId,memory_cached:e.memoryCached,persistent_cached:e.persistentCached,audio_format:e.audiocodec||"",video_format:e.videocodec||"",manifest_id:e.fileId,protected:!1,key_system:e.keySystem,key_system_impl:e.keySystemImpl,urls_json:JSON.stringify(e.urls),start_time:e.loadTime,end_time:e.stopTime,external_start_time:e.externalLoadTime,ms_play_latency:e.msPlayLatency,ms_init_latency:e.msInitLatency,ms_head_latency:e.msHeadLatency,ms_manifest_latency:e.msManifestLatency,ms_resolve_latency:e.msResolveLatency,ms_license_session_latency:e.msLicenseSessionLatency,ms_license_generation_latency:e.msLicenseGenerationLatency,ms_license_request_latency:e.msLicenseRequestLatency,ms_license_update_latency:e.msLicenseUpdateLatency,ms_played:e.msPlayed,ms_nominal_played:e.msNominalPlayed,ms_file_duration:e.msFileDuration,ms_actual_duration:e.msActualDuration,ms_start_position:e.startPosition,ms_end_position:e.position,ms_seek_rebuffer:e.msSeekRebuffering,ms_seek_rebuffer_longest:e.maxMsSeekRebuffering,ms_stall_rebuffer:e.msStalled,ms_stall_rebuffer_longest:e.maxMsStalled,n_stalls:e.nStalls,n_rendition_upgrade:e.nRenditionUpgrade,n_rendition_downgrade:e.nRenditionDowngrade,bps_bandwidth_max:e.bpsBandwidthMax,bps_bandwidth_min:e.bpsBandwidthMin,bps_bandwidth_avg:e.bpsBandwidthAvg,n_seekback:e.nSeeksBackward,n_seekforward:e.nSeeksForward,start_bitrate:e.startBitrate||e.bitrate||0,audio_quality:e.audioQuality,time_weighted_bitrate:e.timeWeightedBitrate,reason_start:e.reasonStart,reason_end:e.reasonEnd,initially_paused:!e.playIntended,had_error:e.hadError,n_warnings:e.nWarnings,n_navigator_offline:e.nOffline,session_id:this._sessionId,sequence_id:this._sequenceId,client_id:e.clientId,correlation_id:e.correlationId,n_dropped_video_frames:e.droppedVideoFrames,n_total_video_frames:e.totalVideoFrames};d.info("Logging PlaybackStats"),this._logSender.logJSSDKPlaybackStats(r).catch((function(n){var i=new l.LoggingError(u.Errors.PLAYBACK_STATS_SENDING_FAILED,n.message||"Unknown reason.");t._logError(i.code,n,r,e,!1),t._emitError(i,e)}))},t.prototype._logPlaybackStart=function(e){var t=this,r={play_track:e.currentTrackUri,file_id:e.fileId,playback_id:e.playbackId,session_id:this._sessionId,ms_start_position:e.startPosition,initially_paused:!e.playIntended,client_id:e.clientId,correlation_id:e.correlationId};d.info("Logging PlaybackStart"),this._logSender.logJSSDKPlaybackStart(r).catch((function(n){var i=new l.LoggingError(u.Errors.PLAYBACK_START_SENDING_FAILED,n.message||"Unknown reason.");t._logError(i.code,n,r,e,!1),t._emitError(i,e)}))},t.prototype._getSequenceId=function(e){var t=this._sequenceSessionStorage[e];return t||(t=0),t+1>=9007199254740991&&(t=0),this._sequenceSessionStorage[e]=t+1,t},t.prototype._rollbackSequenceId=function(e){var t=this._sequenceSessionStorage[e];t&&(this._sequenceSessionStorage[e]=Math.max(t-1,0))},t.prototype._logImpression=function(e){this._transport.request(e,{forget:!0}).catch((function(e){d.warn("Unable to send impression request",e)}))},t.prototype._logError=function(e,t,r,n,i){var a="";t&&((a=t.stack||"")||(a=t.toString()));var s={source:"playback",source_version:c.default.tagged||o.LogValues.UNKNOWN,type:e||o.LogValues.UNKNOWN,message:t&&t.message||o.LogValues.EMPTY,stack:JSON.stringify(a),json_data:JSON.stringify(r||{}),json_data_version:"1.0.0",client_id:n.clientId,correlation_id:n.correlationId};i?this._logSender.logJSSDKWarning(s).catch((function(e){return d.warn("Failed to log warning",s,e)})):this._logSender.logJSSDKError(s).catch((function(e){return d.warn("Failed to log error",s,e)}))},t}(i.EventEmitter);r.Logger=_},{"../../enums/errors":58,"../../enums/event":59,"../../error/logging":75,"../../version":82,"@js-sdk/common/es5":83,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,tslib:201}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MovingAverage=void 0;var n=function(){function e(e){if(this._estimate=0,this._totalWeight=0,e<0)throw new TypeError("Halflife must be set to a positive value.");this._weightingDecrease=Math.exp(Math.log(.5)/e)}return e.prototype.sample=function(e,t){var r=Math.pow(this._weightingDecrease,e),n=t*(1-r)+r*this._estimate;isNaN(n)||(this._estimate=n,this._totalWeight+=t)},e.prototype.getEstimate=function(){return this._estimate/1-Math.pow(this._weightingDecrease,this._totalWeight)},e}();r.MovingAverage=n},{}],46:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.MuxReporter=r.MuxEvents=r.extractHostname=r.codeToMuxError=r.MuxErrors=void 0;var i,o=e("tslib"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../enums/event"),u=e("../enums/errors"),l=e("../version");!function(e){e[e.ABORTED=101]="ABORTED",e[e.NETWORK=102]="NETWORK",e[e.MEDIA_DECODING=103]="MEDIA_DECODING",e[e.SRC_NOT_SUPPORTED=104]="SRC_NOT_SUPPORTED",e[e.EME=105]="EME",e[e.GENERIC=100]="GENERIC"}(i=r.MuxErrors||(r.MuxErrors={}));var c,d=((n={})[u.Errors.MEDIA_ABORTED]=i.ABORTED,n[u.Errors.MEDIA_DECODING_ERROR]=i.MEDIA_DECODING,n[u.Errors.MEDIA_NOT_SUPPORTED]=i.SRC_NOT_SUPPORTED,n[u.Errors.MEDIA_NETWORK_ERROR]=i.NETWORK,n);function _(e){var t=d[e];return/_REQUEST_|_RESPONSE$/.test(e)?t=i.NETWORK:t||(t=/^EME_/.test(e)?i.EME:i.GENERIC),t}function p(e){var t,r=e.match(/^https?:\/\/([^\/]+@)?([^\/?#]+)/);return null!==(t=null==r?void 0:r[2])&&void 0!==t?t:""}r.codeToMuxError=_,r.extractHostname=p,function(e){e.READY="playerready",e.VIDEO_CHANGE="videochange",e.PLAY="play",e.PLAYING="playing",e.PAUSE="pause",e.TIMEUPDATE="timeupdate",e.SEEKING="seeking",e.SEEKED="seeked",e.ERROR="error",e.ENDED="ended",e.RENDITION_CHANGE="renditionchange",e.REQUEST_COMPLETED="requestcompleted",e.REQUEST_FAILED="requestfailed",e.REQUEST_CANCELED="requestcanceled"}(c=r.MuxEvents||(r.MuxEvents={}));var f={player_is_paused:!0,player_width:0,player_height:0,video_source_height:0,video_source_width:0,player_is_fullscreen:void 0,player_autoplay_on:void 0,player_preload_on:void 0,video_source_url:void 0,video_source_mime_type:void 0,video_source_duration:void 0,video_poster_url:void 0,player_language_code:void 0},h=function(){function e(e){this._playerId="spotify-playback-"+Date.now(),this._currentContentInfo=null,this._readyDeferred=a.createPromiseResolver(),this._isMuxInitialized=!1,this._muxInitData=null,this._player=e.player,this._mux=e.mux,this._getPlayheadTime=this._getPlayheadTime.bind(this),this._getStateData=this._getStateData.bind(this),this._init(e)}return e.create=function(t){return new e(t)},e.prototype._init=function(e){var t=this;Promise.all([Promise.resolve(e.deviceInfo)]).then((function(r){var n,i,a=r[0];t._muxInitData={data:o.__assign({env_key:e.envKey||"2qbjhhcl4u87btjbo7dh8vi2n",player_name:null!==(i=null==a?void 0:a.platform_name)&&void 0!==i?i:null==a?void 0:a.platform,player_version:null==a?void 0:a.version,viewer_device_manufacturer:null==a?void 0:a.brand,viewer_device_category:null==a?void 0:a.type,viewer_device_name:null==a?void 0:a.model,player_software_name:e.sdk||"spotify-playback",player_software_version:e.sdkVersion||l.default.version,player_mux_plugin_name:"spotify-playback-mux-reporter",player_mux_plugin_version:l.default.version},e.muxCustomDimensions),getPlayheadTime:t._getPlayheadTime,getStateData:t._getStateData},t._player.addListeners(((n={})[s.Event.PLAYER_BEFORE_LOAD]=t._onBeforeLoad.bind(t),n[s.Event.PLAYER_PLAY]=t._onPlay.bind(t),n[s.Event.PLAYER_PLAYING]=t._onPlaying.bind(t),n[s.Event.PLAYER_PAUSED]=t._onPause.bind(t),n[s.Event.PLAYER_PROGRESS]=t._onProgress.bind(t),n[s.Event.PLAYER_SEEKING]=t._onSeeking.bind(t),n[s.Event.PLAYER_POSITION_CHANGED]=t._onPositionChanged.bind(t),n[s.Event.PLAYER_ERROR]=t._onError.bind(t),n[s.Event.PLAYER_ENDED]=t._onEnded.bind(t),n[s.Event.PLAYER_DURATION_CHANGED]=t._onDurationChanged.bind(t),n[s.Event.PLAYER_VIDEO_RESIZED]=t._onVideoResized.bind(t),n[s.Event.PLAYER_VIDEO_PROFILE_CHANGED]=t._onVideoProfileChanged.bind(t),n[s.Event.PLAYER_FRAGMENT_FETCHED]=t._onFragmentFetched.bind(t),n[s.Event.PLAYER_FRAGMENT_FETCH_ERROR]=t._onFragmentFetchError.bind(t),n[s.Event.PLAYER_VIDEO_MANIFEST_RESOLVED]=t._onVideoManifestResolved.bind(t),n[s.Event.PLAYER_VIDEO_MANIFEST_RESOLVE_FAILED]=t._onVideoManifestResolveFailed.bind(t),n))})).then(this._readyDeferred.resolve,this._readyDeferred.reject)},e.prototype._getPlayheadTime=function(){return this._player.getPlayerPosition()},e.prototype._getStateData=function(){return this._currentContentInfo?o.__assign(o.__assign({},this._currentContentInfo.stateData),{player_language_code:this._player.getActiveSubtitleLanguage()}):null},e.prototype._onDurationChanged=function(e){this._currentContentInfo&&(this._currentContentInfo.stateData.video_source_duration=e.data.duration)},e.prototype._onVideoResized=function(e){this._currentContentInfo&&(this._currentContentInfo.stateData.player_width=e.data.width,this._currentContentInfo.stateData.player_height=e.data.height)},e.prototype._onBeforeLoad=function(e){var t=e.data,r=t.track,n=t.options,i=t.logData,a=!!this._currentContentInfo;if("video"!==r.mediaType||(null==i?void 0:i.noLog)||(null==i?void 0:i.noMuxEvents))return a&&this._mux.emit(this._playerId,c.VIDEO_CHANGE,{}),void(this._currentContentInfo=null);var s={video_id:r.fileId,video_title:(null==i?void 0:i.displayTitle)||void 0,video_series:(null==i?void 0:i.displayGroup)||void 0,video_duration:(null==i?void 0:i.displayDuration)||void 0},u=o.__assign({},f);this._currentContentInfo={track:r,options:n,videoData:s,stateData:u},!this._isMuxInitialized&&this._muxInitData?(this._mux.init(this._playerId,this._muxInitData),this._mux.emit(this._playerId,c.READY),this._isMuxInitialized=!0):a&&this._mux.emit(this._playerId,c.VIDEO_CHANGE,s)},e.prototype._onPlay=function(){var e,t;if(this._currentContentInfo){var r=this._currentContentInfo.stateData,n=this._player.getPlayerState(),i=n.media_info,o=(null===(t=null===(e=this._currentContentInfo)||void 0===e?void 0:e.options)||void 0===t?void 0:t.autoplay)||!1,a=n.player_element,s=a.width,u=a.height,l=a.src,d=a.poster;r.player_is_paused=!n.playing,r.player_width=s||0,r.player_height=u||0,r.video_source_height=i.video_height||0,r.video_source_width=i.video_width||0,r.player_autoplay_on=o,r.video_source_url=l,r.video_source_mime_type=i.video_format,r.video_source_duration=n.duration,r.video_poster_url=d,this._mux.emit(this._playerId,c.PLAY,this._currentContentInfo.videoData)}},e.prototype._onPlaying=function(){this._currentContentInfo&&(this._currentContentInfo.stateData.player_is_paused=!1,this._mux.emit(this._playerId,c.PLAYING))},e.prototype._onPause=function(){this._currentContentInfo&&(this._currentContentInfo.stateData.player_is_paused=!0,this._mux.emit(this._playerId,c.PAUSE))},e.prototype._onProgress=function(e){this._currentContentInfo&&this._mux.emit(this._playerId,c.TIMEUPDATE,{player_playhead_time:e.data.position})},e.prototype._onSeeking=function(){this._currentContentInfo&&this._mux.emit(this._playerId,c.SEEKING)},e.prototype._onPositionChanged=function(){this._currentContentInfo&&this._mux.emit(this._playerId,c.SEEKED)},e.prototype._onError=function(e){var t,r,n=null===(r=null===(t=e.data)||void 0===t?void 0:t.error)||void 0===r?void 0:r.code;this._currentContentInfo&&n&&this._mux.emit(this._playerId,c.ERROR,{player_error_code:_(n),player_error_message:n})},e.prototype._onEnded=function(){this._currentContentInfo&&this._mux.emit(this._playerId,c.ENDED)},e.prototype._onVideoProfileChanged=function(e){if(this._currentContentInfo){var t=e.data.profile,r=this._currentContentInfo.stateData;r.video_source_height=t.height||0,r.video_source_width=t.width||0,r.video_source_mime_type=t.mimeType,this._mux.emit(this._playerId,c.RENDITION_CHANGE,{video_source_bitrate:t.bitrate,video_source_width:t.width,video_source_height:t.height})}},e.prototype._onFragmentFetched=function(e){var t=e.data;if(this._currentContentInfo||"video"===t.media_type){var r=t.segment_type+(t.init?"_init":"");this._mux.emit(this._playerId,c.REQUEST_COMPLETED,{request_type:r,request_hostname:p(t.url),request_start:t.start_time,request_response_end:t.end_time,request_bytes_loaded:t.byte_length})}},e.prototype._onFragmentFetchError=function(e){var t=e.data;if(this._currentContentInfo||"video"===t.media_type){var r=t.segment_type+(t.init?"_init":"");this._mux.emit(this._playerId,c.REQUEST_FAILED,{request_type:r,request_hostname:p(t.url),request_start:t.start_time,request_error:t.error.code,request_error_code:t.error.status,request_error_text:""})}},e.prototype._onVideoManifestResolved=function(e){var t=e.data;this._currentContentInfo&&this._mux.emit(this._playerId,c.REQUEST_COMPLETED,{request_type:"manifest",request_hostname:p(t.url),request_start:t.start_time,request_response_end:t.end_time,request_bytes_loaded:t.manifest_size})},e.prototype._onVideoManifestResolveFailed=function(e){var t=e.data;this._currentContentInfo&&this._mux.emit(this._playerId,c.REQUEST_FAILED,{request_type:"manifest",request_hostname:p(t.url),request_start:t.start_time,request_error:t.error.code,request_error_code:t.error.status,request_error_text:""})},e.prototype.ready=function(){return this._readyDeferred.promise},e}();r.MuxReporter=h},{"../enums/errors":58,"../enums/event":59,"../version":82,"@js-sdk/common/es5/promise_resolver":91,tslib:201}],47:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.Player=void 0;var i=e("tslib"),o=e("@spotify-internal/emitter/es5"),a=e("@spotify-internal/linkedlist/es5"),s=e("@js-sdk/debug-tools/es5"),u=e("../enums/event"),l=e("../enums/key_system"),c=e("../enums/errors"),d=e("../enums/operation_result"),_=e("../enums/media_format"),p=e("../enums/content_mediator_event"),f=e("../error/player"),h=e("../error/file"),y=e("./eme/manager"),v=e("./eme/configs"),E=e("./video_content"),m=e("./audio_content"),g=e("./buffer"),T=e("./bandwidth_estimator"),S=e("./helpers/eme"),P=e("./subtitle_manager"),b=e("./helpers/hls"),R=e("./helpers/dom"),A=e("./statistics"),I=s.logging.forTag("playback.player"),L=/^blob:/,O=((n={})[_.MediaFormat.MP4]=!0,n[_.MediaFormat.MP4_DUAL]=!0,n[_.MediaFormat.MP4_CBCS]=!0,n[_.MediaFormat.MP4_FLAC]=!0,n[_.MediaFormat.MP3]=!1,n[_.MediaFormat.MANIFEST_ID]=!1,n);function C(e){return Math.ceil(1e3*e)}function D(e){return e/1e3}function N(e){return document.createElement(e)}var w=function(e){function t(t){var r=e.call(this)||this;return r._cubicVolume=!1,r._player=null,r._emeManager=null,r._mediator=new o.EventEmitter,r._currentContent=null,r._upcomingContent=null,r._preloadingTracks={},r._playId=0,r._loaded=!1,r._licenseRequested=!1,r._playerActivated=!1,r._pauseToken=0,r._syntheticEndedToken=0,r._activeCodecs=[],r._playerVolume=1,r._playerSpeed=1,r._fatalOnNextError=!1,r._canPreloadEmitted=!1,r._lastTimeUpdatePostion=0,r._buffering=!1,r._preferredBitrate=0,r._disableLicensePrefetch=!1,r._allowMixedAVC1Codecs=!1,r._disableBufferingBeforeLicense=!1,r._audioResolver=t.audioResolver,r._clearBufferOnSeek=!!t.clearBufferOnSeek,r._createPlayer=t.createPlayer||N,r._cubicVolume=t.cubicVolume,r._disableCache=!!t.disableCache,r._licenseURLResolver=t.licenseURLResolver,r._newBufferPerTrack=!!t.newBufferPerTrack,r._newElementPerTrack=!!t.newElementPerTrack,r._newMediaKeysPerTrack=!!t.newMediaKeysPerTrack,r._rebufferOnQuotaExceeded=!!t.rebufferOnQuotaExceeded,r._disableLicensePrefetch=!!t.disableLicensePrefetch,r._synthesizeEnded=!!t.synthesizeEnded,r._tracker=t.tracker,r._transport=t.transport,r._videoPlayerContainer=t.videoPlayerContainer,r._audioPlayerContainer=t.audioPlayerContainer,r._allowMixedAVC1Codecs=t.allowMixedAVC1Codecs,r._videoResolver=t.videoResolver,r._abrManager=new T.BandwidthEstimator,r._emeManager=t.disallowProtectedTracks?null:t.emeManager||null,r._disallowProfile=t.disallowProfile,r._disableBufferingBeforeLicense=!!t.disableBufferingBeforeLicense,r._cache=new a.LRUCache(t.trackCacheSize||2),r._subtitleManager=new P.SubtitleManager({language:t.preferredSubtitleLanguage||navigator.language,player:r._player}),r._videoResolution=t.videoResolution,I.info("Setting Player track cache to:",t.trackCacheSize||2),r._buffer=g.ContentBuffer.create(r._tracker,void 0,{disableBufferAbort:!!t.disableBufferAbort,reinjectInitsOnAbort:!!t.reinjectInitsOnAbort,noInit:!0,customSourceBufferParams:t.customSourceBufferParams}),r._statistics=A.Statistics.create({bandwidthEstimator:r._abrManager}),r._onCanPlay=r._onCanPlay.bind(r),r._onCanPlayThrough=r._onCanPlayThrough.bind(r),r._onTimeUpdate=r._onTimeUpdate.bind(r),r._onDurationChange=r._onDurationChange.bind(r),r._onPlay=r._onPlay.bind(r),r._onPlaying=r._onPlaying.bind(r),r._onPause=r._onPause.bind(r),r._onSeeking=r._onSeeking.bind(r),r._onEncrypted=r._onEncrypted.bind(r),r._onEnded=r._onEnded.bind(r),r._onError=r._onError.bind(r),r._onRequiresDuration=r._onRequiresDuration.bind(r),r._onQuotaExceeded=r._onQuotaExceeded.bind(r),r._onLoadedMetadata=r._onLoadedMetadata.bind(r),r._onWaiting=r._onWaiting.bind(r),r._onFragmentFetched=r._onFragmentFetched.bind(r),r._onProfileChanged=r._onProfileChanged.bind(r),r._onPlayedThresholdReached=r._onPlayedThresholdReached.bind(r),r._onSyntheticEnded=r._onSyntheticEnded.bind(r),r._onLicenseRequestCapped=r._onLicenseRequestCapped.bind(r),r._onLicenseRequestError=r._onLicenseRequestError.bind(r),r._onNavigatorOffline=r._onNavigatorOffline.bind(r),r._onBufferError=r._onBufferError.bind(r),r._emitWarning=r._emitWarning.bind(r),r._handleLoadingComplete=r._handleLoadingComplete.bind(r),r._onRateChange=r._onRateChange.bind(r),r._onVideoResize=r._onVideoResize.bind(r),r._init(),r}return i.__extends(t,e),t.create=function(e){var r=i.__assign({},e);return e.disallowProtectedTracks?t.createWithOptions(r):y.EMEManager.create({transport:e.transport,disallowRobustnessValues:e.disallowRobustnessValues,disallowCodecs:e.disallowCodecs,noServerCertificate:e.noServerCertificate,precacheServerCertificate:e.precacheServerCertificate,unauthServerCertificateBase:e.unauthServerCertificateBase,preferredKeySystems:e.preferredKeySystems}).then((function(e){r.emeManager=e;var n=new t(r);return r.preinitMediaElement?n._preinitMediaElement():n})).catch((function(n){if(e.enableWithoutEME)return t.createWithOptions(r);throw n}))},t.createWithOptions=function(e){return new Promise((function(r){var n=new t(e);r(e.preinitMediaElement?n._preinitMediaElement():n)}))},t.prototype._init=function(){var e,t,r,n,i,o,a;this._disableCache&&I.info("Cache disabled."),this._transport.on(this._transport.EVENT_CONNECTION_OFFLINE,this._onNavigatorOffline),this.proxyEmitAllSync(this._tracker,((e={})[u.Event.TRACKER_TRACKING_DATA_CREATED]=u.Event.PLAYER_TRACKING_DATA_CREATED,e[u.Event.TRACKER_TRACKING_DATA_FINALIZED]=u.Event.PLAYER_TRACKING_DATA_FINALIZED,e[u.Event.TRACKER_PLAYBACK_START]=u.Event.PLAYER_PLAYBACK_START,e)),this._tracker.on(u.Event.TRACKER_PLAYED_THRESHOLD_REACHED,this._onPlayedThresholdReached),this._emeManager&&this._emeManager.addListeners(((t={})[u.Event.EME_LICENSE_REQUEST_CAPPED]=this._onLicenseRequestCapped,t[u.Event.EME_LICENSE_REQUEST_ERROR]=this._onLicenseRequestError,t)),this._buffer.addListeners(((r={})[u.Event.BUFFER_APPEND_ERROR]=this._onBufferError,r[u.Event.BUFFER_QUOTA_EXCEEDED]=this._onQuotaExceeded,r)),this.proxyEmitAll(this._buffer,((n={})[u.Event.BUFFER_STALLED]=u.Event.PLAYER_BUFFER_STALLED,n)),this._mediator.addListeners(((i={})[p.ContentMediatorEvent.FRAGMENT_FETCHED]=this._onFragmentFetched,i[p.ContentMediatorEvent.VIDEO_PROFILE_CHANGED]=this._onProfileChanged,i)),this.proxyEmitAll(this._mediator,((o={})[p.ContentMediatorEvent.FRAGMENT_FETCH_ERROR]=u.Event.PLAYER_FRAGMENT_FETCH_ERROR,o[p.ContentMediatorEvent.SUBTITLE_LANGUAGES_LOADED]=u.Event.PLAYER_SUBTITLE_LANGUAGES_LOADED,o)),this.proxyEmitSync(this._subtitleManager,u.Event.PLAYER_DISPLAYED_CUES_CHANGED,u.Event.PLAYER_DISPLAYED_CUES_CHANGED),this.proxyEmitAll(this._videoResolver,((a={})[u.Event.VIDEO_MANIFEST_RESOLVED]=u.Event.PLAYER_VIDEO_MANIFEST_RESOLVED,a[u.Event.VIDEO_MANIFEST_RESOLVE_FAILED]=u.Event.PLAYER_VIDEO_MANIFEST_RESOLVE_FAILED,a))},t.prototype._onRateChange=function(){this._player&&(this._tracker.trackSpeedChanged(this._player.playbackRate),this.emit(u.Event.PLAYER_PLAYBACK_SPEED_CHANGED,{playback_speed:this._player.playbackRate}))},t.prototype._onLicenseRequestError=function(e){if(e.data.playId===this._playId){var t=this._currentContent;if(t){var r=e.data.error;r.shouldRefreshEndpoint&&this._licenseURLResolver.remove(t.getKeySystem(),t.getMediaType()),this._emitError(r,!r.unrecoverable,t.toLogJSON())}}},t.prototype._onFragmentFetched=function(e){var t=e.data;this._tracker.setBandwidth(t.bandwidth),this.emit(u.Event.PLAYER_FRAGMENT_FETCHED,t)},t.prototype._onProfileChanged=function(e){var t=e.data;this._tracker.setRenditionCount(t.profile.bitrate),this.emit(u.Event.PLAYER_VIDEO_PROFILE_CHANGED,t)},t.prototype._onLicenseRequestCapped=function(e){e.data.playId===this._playId&&(this._currentContent&&(this.pause(),this.emit(u.Event.PLAYER_CAPPED,null)))},t.prototype._shouldNextErrorBeFatal=function(){var e=this._currentContent;if(!e)return!1;if(e.isAd()||!e.isProtected())return!1;if(!this._player)return!1;var t=this._player.error;if(!(t&&t instanceof MediaError))return this._fatalOnNextError=!1,!1;switch(t.code){case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:case MediaError.MEDIA_ERR_DECODE:return!0;default:return!1}},t.prototype._onNavigatorOffline=function(){this._tracker.trackNavigatorOffline()},t.prototype._onBufferError=function(e){this._emitError(e.data.error,e.data.canPlayNext,e.data.track)},t.prototype._addPlayerEvents=function(e){e.addEventListener(u.Event.MEDIA_TIMEUPDATE,this._onTimeUpdate),e.addEventListener(u.Event.MEDIA_PLAY,this._onPlay),e.addEventListener(u.Event.MEDIA_PLAYING,this._onPlaying),e.addEventListener(u.Event.MEDIA_PAUSE,this._onPause),e.addEventListener(u.Event.MEDIA_SEEKING,this._onSeeking),e.addEventListener(u.Event.MEDIA_ENCRYPTED,this._onEncrypted),e.addEventListener(u.Event.MEDIA_ENDED,this._onEnded),e.addEventListener(u.Event.MEDIA_ERROR,this._onError),e.addEventListener(u.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata),e.addEventListener(u.Event.MEDIA_DURATIONCHANGE,this._onDurationChange),e.addEventListener(u.Event.MEDIA_WAITING,this._onWaiting),e.addEventListener(u.Event.MEDIA_CANPLAY,this._onCanPlay),e.addEventListener(u.Event.MEDIA_CANPLAYTHROUGH,this._onCanPlayThrough),e.addEventListener(u.Event.MEDIA_RATECHANGE,this._onRateChange),e.addEventListener(u.Event.INTERNAL_MEDIA_REQUIRES_DURATION,this._onRequiresDuration),e.addEventListener(u.Event.MEDIA_RESIZE,this._onVideoResize)},t.prototype._removePlayerEvents=function(e){e.removeEventListener(u.Event.MEDIA_TIMEUPDATE,this._onTimeUpdate),e.removeEventListener(u.Event.MEDIA_PLAY,this._onPlay),e.removeEventListener(u.Event.MEDIA_PLAYING,this._onPlaying),e.removeEventListener(u.Event.MEDIA_PAUSE,this._onPause),e.removeEventListener(u.Event.MEDIA_SEEKING,this._onSeeking),e.removeEventListener(u.Event.MEDIA_ENCRYPTED,this._onEncrypted),e.removeEventListener(u.Event.MEDIA_ENDED,this._onEnded),e.removeEventListener(u.Event.MEDIA_ERROR,this._onError),e.removeEventListener(u.Event.MEDIA_WAITING,this._onWaiting),e.removeEventListener(u.Event.MEDIA_CANPLAY,this._onCanPlay),e.removeEventListener(u.Event.MEDIA_RATECHANGE,this._onRateChange),e.removeEventListener(u.Event.MEDIA_CANPLAYTHROUGH,this._onCanPlayThrough),e.removeEventListener(u.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata),e.removeEventListener(u.Event.MEDIA_DURATIONCHANGE,this._onDurationChange),e.removeEventListener(u.Event.INTERNAL_MEDIA_REQUIRES_DURATION,this._onRequiresDuration),e.removeEventListener(u.Event.MEDIA_RESIZE,this._onVideoResize)},t.prototype._recreateMediaElement=function(e,t,r,n){if(t!==this._playId)return I.info("Recreate player dropped: playId has changed."),Promise.resolve(!1);var i=this._player;if(i){if(!this._newElementPerTrack&&("AUDIO"!==i.tagName||"video"!==r)){for(var o=!0,a=0,s=e;a<s.length;a++){var l=s[a];if('audio/mp2t;codecs="mp4a.40.2"'!==l&&!i.canPlayType(l)){o=!1;break}}if(o)return I.info("Reusing media element."),e.join(",")===this._activeCodecs.join(",")&&!this._newBufferPerTrack||n||(I.info("Recreating buffer."),this._buffer.recreate(e),this._activeCodecs=e),Promise.resolve(!0)}this._removePlayerEvents(i),i.pause(),this._emeManager&&this._emeManager.removeMediaKeys(i).catch((function(e){I.warn("Failed to remove media keys.",e)})),this._player=null;var c=this._getContainerElement(this._videoPlayerContainer);c&&i.parentNode===c&&(c.removeChild(i),this.emit(u.Event.PLAYER_VIDEO_ELEMENT_REMOVED,null));var d=this._getContainerElement(this._audioPlayerContainer);d&&i.parentNode===d&&d.removeChild(i)}I.info("Creating new media element.");var _=this._createPlayer(r),p=this._playerVolume;return _.volume=this._cubicVolume?p*p*p:p,_.autoplay=!1,_.loop=!1,"playsInline"in _&&(_.playsInline=!0),this._player=_,this._subtitleManager.setPlayer(_),this._playerActivated=!1,this._addPlayerEvents(_),n||this._buffer.recreate(e),this._activeCodecs=e,Promise.resolve(!0)},t.prototype._getContainerElement=function(e){return"string"==typeof e?document.querySelector(e):e||null},t.prototype._onVideoResize=function(){if(this._player instanceof HTMLVideoElement){var e=this._player,t=e.videoWidth,r=e.videoHeight;this.emit(u.Event.PLAYER_VIDEO_RESIZED,{width:t,height:r})}},t.prototype._onDurationChange=function(){var e=this,t=this._playId,r=function(){if(e._player)if(t===e._playId){var r=C(e._player.duration),n=C(e._player.currentTime);e._tracker.setActualDuration(r),e.emit(u.Event.PLAYER_DURATION_CHANGED,{timestamp:Date.now(),position:n,duration:r})}else I.info("Duration changed drop: playId has changed.")};this._loaded?r():this.once(u.Event.PLAYER_LOAD,r)},t.prototype._onPlay=function(){var e;if(this._player&&this._currentContent){var t=C(this._player.currentTime);this._tracker.trackPlay(t,this._player.playbackRate),this.emit(u.Event.PLAYER_PLAY,{timestamp:Date.now(),position:t,logData:null!==(e=this._currentContent.getLogData())&&void 0!==e?e:null})}},t.prototype._onPlaying=function(){if(this._player){this._playerActivated=!0;var e=this._currentContent,t=C(this._player.currentTime);this._tracker.trackPlaying(t),this.emit(u.Event.PLAYER_PLAYING,{timestamp:Date.now(),position:t,logData:e?e.getLogData():null})}},t.prototype._onPause=function(){var e=this;if(this._player){var t=C(this._player.currentTime);this._tracker.trackPaused(t);var r=this._currentContent?this._currentContent.getLogData():null;this._pauseToken=setTimeout((function(){clearTimeout(e._syntheticEndedToken),e.emit(u.Event.PLAYER_PAUSED,{position:t,logData:r})}),10)}},t.prototype._onSeeking=function(){this.emit(u.Event.PLAYER_SEEKING,null),this._buffer.abort(this._clearBufferOnSeek),this._lastTimeUpdatePostion=0,this._onTimeUpdate()},t.prototype._onRequiresDuration=function(){this._currentContent&&this._currentContent.isProtected()&&this._player&&(this._player.duration=this._currentContent.getCalculatedDuration())},t.prototype._onQuotaExceeded=function(){this._player&&this._rebufferOnQuotaExceeded&&(I.info("Exceeded quota: rebuffering current track."),this._buffer.abort(!0),this._player.currentTime=this._player.currentTime,this._onTimeUpdate())},t.prototype._onEncrypted=function(e){I.info("Got Encrypted event"),this._currentContent&&this.emitSync(u.Event.INTERNAL_ENCRYPTED,{initData:e.initData,fromPolyfill:!!e.fromPolyfill})},t.prototype._onEnded=function(){!this._currentContent||this._synthesizeEnded&&this._currentContent.isProtected()||(I.info("Native ended emitted."),this._emitEnded())},t.prototype._onSyntheticEnded=function(){this._synthesizeEnded&&this._currentContent&&this._currentContent.isProtected()&&(I.info("Synthetic ended emitted."),this._emitEnded())},t.prototype._onError=function(){if(this._player){var e,t,r,n,i=this._player.error,o=!1,a=this._currentContent,s=!1;a&&(o=a.isProtected(),e=a.toLogJSON(),s=a.isAd(),a.clearCachedBuffers());var u=!0,l=!a||s||!this._fatalOnNextError,d=i&&i.msExtendedCode?"0x"+(i.msExtendedCode>>>0).toString(16).toUpperCase():null,_="data:"+((null==e?void 0:e.fileId)||"unknown");if(i instanceof MediaError){switch(i.code){case MediaError.MEDIA_ERR_ABORTED:t=c.Errors.MEDIA_ABORTED,r="Media aborted.";break;case MediaError.MEDIA_ERR_NETWORK:t=c.Errors.MEDIA_NETWORK_ERROR,r="Network error.";break;case MediaError.MEDIA_ERR_DECODE:t=c.Errors.MEDIA_DECODING_ERROR,r="Media decoding error.",u=l;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:t=c.Errors.MEDIA_NOT_SUPPORTED,r="Media not supported.",u=l;break;default:t=c.Errors.PLAYER_MEDIA_ERROR,r="Media error.",n=!0}r+=" ("+(i.message||d||_||i.toString())+")"}else t=c.Errors.PLAYER_PLAYBACK_ERROR,r="Error message undefined",n=!0;this._buffer.abort(!0);var p=new f.PlaybackError(t,r);u||(p.unrecoverable=!0),p.listPlayerIgnore=s,p.debug.src_url=_,p.debug.protected=o,p.debug.extendedCode=d,p.debug.rawExCode=i&&i.msExtendedCode||null,n&&i&&(p.debug.nativeCode=i.code||null,p.debug.errorData=i),this._emitError(p,u,e)}},t.prototype._onLoadedMetadata=function(){this.emitSync(u.Event.INTERNAL_PLAYER_LOADED_METADATA,null)},t.prototype._onCanPlay=function(){this._buffering=!1,this.emitSync(u.Event.INTERNAL_PLAYER_CANPLAY,null),this.emit(u.Event.PLAYER_FIRST_BYTES,null)},t.prototype._onCanPlayThrough=function(){this.emitSync(u.Event.INTERNAL_PLAYER_CANPLAYTHROUGH,null)},t.prototype._onWaiting=function(){var e=this;clearTimeout(this._syntheticEndedToken);var t=this._player;if(t&&this._currentContent){var r=t.seeking;this._buffering=!0;var n=this._currentContent.canLowerBitrate(),o=this._tracker;this.emit(u.Event.PLAYER_BUFFERING_START,i.__assign({position:C(t.currentTime),msPlayed:this._tracker.getMSPlayed(),canLowerBitrate:n,seeking:r},o.getStallsInformation())),this._getBufferingLatency().then((function(a){r||e._tracker.trackMsStalled(a),e.emit(u.Event.PLAYER_BUFFERING_END,i.__assign({position:C(t.currentTime),msPlayed:e._tracker.getMSPlayed(),canLowerBitrate:n,msStalled:a,seeking:r},o.getStallsInformation()))}))}},t.prototype._onPlayedThresholdReached=function(e){this._currentContent&&this._player&&this.emit(u.Event.PLAYER_PLAYED_THRESHOLD_REACHED,{played:e.data.played,threshold:e.data.threshold,position:C(this._player.currentTime)})},t.prototype._emitEnded=function(){this._currentContent&&"video"===this._currentContent.getMediaType()&&this.emit(u.Event.PLAYER_ENDED_VIDEO,null),clearTimeout(this._pauseToken),this.emit(u.Event.PLAYER_ENDED,null)},t.prototype._emitError=function(e,t,r){I.error("Player Error",e,r,t),this._tracker.setHadError(!0),!this._disableCache&&r&&r.fileId&&this._cache.remove(r.fileId),this.emit(u.Event.PLAYER_ERROR,{playId:this._playId,error:e,track:r,canPlayNext:t,position:this._player?C(this._player.currentTime):0})},t.prototype._emitWarning=function(e,t){I.error("Player Warning",e,t,!0),this._tracker.trackWarning(),this.emit(u.Event.PLAYER_WARNING,{playId:this._playId,error:e,track:t,canPlayNext:!0,position:this._player?C(this._player.currentTime):0})},t.prototype._prepareMediaElement=function(e,t){var r=this;return t===this._playId&&this._upcomingContent?this._recreateMediaElement(this._upcomingContent.getPlayableCodecs(),t,this._upcomingContent.getMediaType(),this._upcomingContent.getKeySystem()===l.KeySystem.FAIRPLAY).then((function(n){var i;if(!n||t!==r._playId)return I.info("Loading content dropped after recreate: playId has changed."),Promise.resolve(!1);r._player.playbackRate=(null===(i=r._loadingOptions)||void 0===i?void 0:i.useDefaultPlaybackSpeed)?1:r._playerSpeed;var o=r._player;return"VIDEO"===(null==o?void 0:o.tagName)&&(e.poster?o.poster=e.poster:o.removeAttribute("poster")),o&&r._upcomingContent&&r._upcomingContent.isProtected()&&r._emeManager&&(!o.mediaKeys||o.mediaKeys.shouldRefreshPerTrack||r._newMediaKeysPerTrack)?(I.info("Creating media keys"),r._emeManager.createMediaKeys(o).then((function(){return!0})).catch((function(e){return e.unrecoverable=!0,r._emitError(e,!1,r._upcomingContent?r._upcomingContent.toLogJSON():void 0),Promise.reject(e)}))):Promise.resolve(!0)})):(I.info("Loading content dropped: playId has changed."),Promise.resolve(!1))},t.prototype._handleLoadingComplete=function(e){var t=this._currentContent&&this._currentContent.getMediaType(),r=this._getContainerElement("video"===t?this._videoPlayerContainer:this._audioPlayerContainer);return r&&this._player&&this._player.parentNode!==r&&(r.appendChild(this._player),"video"===t&&this.emit(u.Event.PLAYER_VIDEO_ELEMENT_APPENDED,null)),this._upcomingContent=null,e},t.prototype._handleLoadingError=function(e,t,r,n){if(this._upcomingContent=null,r!==this._playId)return Promise.resolve(!1);if(this._tracker.trackLoadFailed(),this.emit(u.Event.PLAYER_LOADING_FAILED,{uri:e,logData:t.logData}),n){var i=n.track||{uri:e,fileId:t.fileId,format:t.format,deviceId:t.logData.deviceId};this._emitError(n,"StorageError"!==n.name||!!n.canPlayNext,i)}return Promise.reject(n)},t.prototype._handleLoadedMetadata=function(e,t,r){var n=this;if(e===this._playId){this._loaded=!0;var i=this._player;if(i){this._buffer.dequeueUpdates();var o=r.position>i.duration?0:r.position;this._lastTimeUpdatePostion=0,i.currentTime<o&&(I.info("Resetting initial position after metadata."),i.currentTime=o),this._tracker.trackLoadDone(C(i.currentTime)),this.emitSync(u.Event.PLAYER_LOAD,{autoplay:r.autoplay,position:C(o),logData:t}),Promise.resolve().then((function(){n._onTimeUpdate()}));var a=function(){i.currentTime<o&&(I.info("Resetting initial position after playable."),i.currentTime=o)};r.autoplay&&!i.error&&(a=function(){(i.currentTime<o&&(I.info("Resetting initial position after playable."),i.currentTime=o),n._playId===e)?new Promise((function(e){return e(n._player&&n._player.play())})).catch((function(e){if(e){if("NotSupportedError"===e.name)return Promise.reject(e);if("NotAllowedError"===e.name)return n.emit(u.Event.PLAYER_AUTOPLAY_FAILED,null),Promise.reject(e)}return n._player?n._player.play():Promise.resolve()})).catch((function(){n._onPause()})):I.info("Play trigger dropped; different playId")}),i.readyState>2?(I.info("Ready to play, triggering play."),a()):(I.info("Waiting to be playable."),this.once(u.Event.INTERNAL_PLAYER_CANPLAY,a))}}else I.info("LoadedMetadata operations dropped: playId has changed.")},t.prototype._handleCanPlayThrough=function(e){e===this._playId?this._tracker.trackCanPlayThrough():I.info("CanPlayThrough operations dropped: playId has changed.")},t.prototype._loadContent=function(e,t){var r=this;if(t!==this._playId||!this._upcomingContent)return I.info("Loading content dropped: playId has changed."),Promise.resolve(!1);if(!this._player)throw new f.PlaybackError(c.Errors.PLAYER_INVALID_INTERNAL_STATE,"Cannot load content without an HTMLMediaElement");this._canPreloadEmitted=!1;var n=this._upcomingContent;this._upcomingContent=null,this._currentContent=n,this._subtitleManager.setVideoContent(n instanceof E.VideoContent?n:null);var i=e.callback;i&&this.once(u.Event.PLAYER_LOAD,(function(){r._playId&&t===r._playId?i():I.info("Load content event dropped: playId has changed.")})),this.once(u.Event.INTERNAL_PLAYER_LOADED_METADATA,this._handleLoadedMetadata.bind(this,t,this._currentContent.getLogData(),e)),this.once(u.Event.INTERNAL_PLAYER_CANPLAYTHROUGH,this._handleCanPlayThrough.bind(this,t));var o=e.position,a=n.getCalculatedDuration();a&&o>a&&(o=e.position=0);try{this._player.currentTime=o}catch(e){I.warn("Cannot set initial position before loading.",e)}var s=n.isProtected();return this._tracker.setProtected(s),n.getKeySystem()===l.KeySystem.FAIRPLAY?n instanceof m.AudioContent&&!s?Promise.resolve(this._loadUnprotectedTrack()):Promise.resolve(this._loadHLSProtectedTrack(e,t)):n instanceof E.VideoContent?this._loadVideoTrack(e,t):s?this._loadProtectedTrack(e,t):Promise.resolve(this._loadUnprotectedTrack())},t.prototype._getBufferingLatency=function(){var e=this;return new Promise((function(t){if(e._player){var r=Date.now();e._player.addEventListener("canplaythrough",(function e(){this.removeEventListener("canplaythrough",e),t(Date.now()-r)}))}else t(0)}))},t.prototype._loadVideoTrack=function(e,t){var r=this;if(!(this._player&&this._currentContent&&this._currentContent instanceof E.VideoContent))return Promise.resolve(!1);var n=this._currentContent;I.info("_loadVideoTrack");var i=function(){r._currentContent&&r._currentContent.isProtected()&&r._requestLicense(t).then((function(){r._playId===t&&(r._licenseRequested=!0,r._disableBufferingBeforeLicense&&r._onTimeUpdate())}))};this._disableLicensePrefetch?this.once(u.Event.INTERNAL_ENCRYPTED,i):this._buffer.once(u.Event.BUFFER_SOURCE_OPEN,i),this._player.src=URL.createObjectURL(this._buffer.getMediaSource());var o=n.getVideoProfile(),a=n.getAudioProfile();return a||o?(this._tracker.trackVideoLoadStart({bitrate:null==o?void 0:o.video_bitrate,audioProfile:null!=a?a:void 0,videoProfile:null!=o?o:void 0}),this._tracker.trackBufferLoadStart(),this._buffer.appendFragment(n,n.getInitFragment()).then((function(){return r._buffer.setDuration(n.getCalculatedDuration())})).then(this._onAppendedHeadSegment(t))):Promise.resolve(!1)},t.prototype._loadHLSProtectedTrack=function(e,t){var r=this;if(I.info("Load HLS Protected Track"),!this._player||!this._currentContent)return!1;var n=this._currentContent.getResolvedURL();if(!n)throw new h.FileError(c.Errors.FILE_NOT_RESOLVED,"Cannot load HLS protected track: File not resolved.");this.on(u.Event.INTERNAL_ENCRYPTED,(function e(n){n.data.fromPolyfill&&(r.removeListener(u.Event.INTERNAL_ENCRYPTED,e),r._requestLicense(t,{initData:n.data.initData}))}));var i=this._currentContent;if(i instanceof E.VideoContent){var o=i.getVideoProfile(),a=i.getAudioProfile();this._tracker.trackVideoLoadStart({bitrate:null==o?void 0:o.video_bitrate,audioProfile:null!=a?a:void 0,videoProfile:null!=o?o:void 0})}this._tracker.trackBufferLoadStart(),this._tracker.trackBufferURL(n,{bandwidth:0});var s=document.createElement("source");return s.src=this._currentContent.getHLSURL(),s.type=b.HLS_MIME_TYPE,this._player.appendChild(s),this._player.load(),!0},t.prototype._loadUnprotectedTrack=function(){if(!this._player||!this._currentContent)return!1;var e=this._currentContent.getResolvedURL();return!!e&&(I.info("_loadUnprotectedTrack",this._currentContent.getURI()),this._tracker.trackBufferLoadStart(),this._tracker.trackBufferURL(e,{bandwidth:0}),this._player.src=e,this._player.load(),!0)},t.prototype._onAppendedHeadSegment=function(e){var t=this;return function(){return e===t._playId&&(t._player&&t._player.spload&&t._player.spload(),I.info("Head segment appended."),!0)}},t.prototype._loadProtectedTrack=function(e,t){var r=this;if(!(this._currentContent&&this._player&&this._currentContent instanceof m.AudioContent))return Promise.resolve(!1);var n=this._currentContent;I.info("_loadProtectedTrack",n.getURI());var i=function(){return r._requestLicense(t).then((function(){r._playId===t&&(r._licenseRequested=!0,r._disableBufferingBeforeLicense&&r._onTimeUpdate())}))};this._disableLicensePrefetch?this.once(u.Event.INTERNAL_ENCRYPTED,i):this._buffer.once(u.Event.BUFFER_SOURCE_OPEN,i),this._player.src=URL.createObjectURL(this._buffer.getMediaSource()),this._tracker.trackBufferLoadStart();var o=n.getFragmentForTime(e.position),a=null;return o===n.getFirstFragment()?(I.info("Appending combined init and playable fragment."),a=this._buffer.appendFragment(n,n.getHeadFragment())):(I.info("Appending split init and playable fragment."),a=this._buffer.appendFragment(n,o)),a.then(this._onAppendedHeadSegment(t)).then((function(){return Promise.resolve(t===r._playId)}))},t.prototype._requestLicense=function(e,t){var r=this;if(void 0===t&&(t={}),e!==this._playId){return I.info("Request license dropped: playId has changed."),Promise.resolve(!1)}if(!this._player||!this._currentContent||!this._emeManager)return Promise.resolve(!1);var n,o=Date.now(),a=this._player.mediaKeys,s=this._currentContent,l=s.getFileId(),c=s.getLogData(),d=s.toLogJSON(),_=s.getKeySystem(),p=s.getLicenseEndpoint();if(p)n=Promise.resolve(p);else{if(!l)return Promise.reject(new TypeError("Missing: fileId or licenseEndpoint"));n=this._licenseURLResolver.get(_,s.getMediaType()).then((function(e){return e.replace(/\{contentId\}/,l)}))}var f=this._emeManager,h=this._tracker;return h.setKeySystem(_),h.setKeySystemImpl(f.getKeySystemImpl()),Promise.all([n,s.getInitParams()]).then((function(r){var n=r[0],s=r[1];h.setLicenseSessionLatency(Date.now()-o);var u=s.initDataType,l=t.initData||s.initData;if(a&&l&&u){var c=i.__assign(i.__assign({},s),{playId:e,initData:l,mediaKeys:a,licenseServer:n,initDataType:u});return f.createSessionWithParams(c)}return Promise.resolve(!1)})).then((function(t){if(e!==r._playId)return I.info("License tracking dropped: playId has changed."),Promise.resolve(!1);"boolean"!=typeof t&&"elapsed"in t&&(h.setLicenseGenerationLatency(t.elapsed.generate),h.setLicenseRequestLatency(t.elapsed.request),h.setLicenseUpdateLatency(t.elapsed.update));var n=Date.now()-o;return h.setKeyLatency(n),r.emit(u.Event.PLAYER_KEY_RECEIVED,{requestTime:n,logData:c}),I.info("License updated."),Promise.resolve(!0)})).catch((function(t){if(!t||e!==r._playId)return Promise.resolve(!1);var n=!t||!("canPlayNext"in t)||t.canPlayNext;return r._emitError(t,n,d),Promise.reject(t)}))},t.prototype._onTimeUpdate=function(){var e;if(this._loaded&&(null===(e=this._player)||void 0===e?void 0:e.readyState)&&this._currentContent){var t=this._currentContent,r=this._player.seeking,n=this._player.currentTime,i="video"===t.getMediaType();if(t.isProtected()&&this._disableBufferingBeforeLicense&&!this._licenseRequested)I.log("Dropping time update event: buffering before license disabled.");else if(r||!this._lastTimeUpdatePostion||this._lastTimeUpdatePostion!==n){this._lastTimeUpdatePostion=r?0:n,t.getKeySystem()!==l.KeySystem.FAIRPLAY&&(i||t.isProtected())&&this._buffer.progress(t,r,n);var o=this._player.duration,a=C(n),s=t.getLogData();r?(this._tracker.trackPositionChanged(a),this.emit(u.Event.PLAYER_POSITION_CHANGED,{position:a,logData:s})):(this._tracker.trackProgress(a,"getCurrentBitrate"in t?t.getCurrentBitrate():0),this.emit(u.Event.PLAYER_PROGRESS,{timestamp:Date.now(),position:a,played:this._tracker.getMSPlayed(),interval:500,logData:s})),!this._canPreloadEmitted&&o-n<=10?(this._canPreloadEmitted=!0,this.emit(u.Event.PLAYER_CAN_PRELOAD,null)):this._canPreloadEmitted=!1,clearTimeout(this._syntheticEndedToken),this._synthesizeEnded&&t.isProtected()&&this._isPlaying()&&(this._syntheticEndedToken=setTimeout(this._onSyntheticEnded,C(o-n)))}else I.warn("Dropping duplicate time update.")}},t.prototype._isPlaying=function(){return!!this._player&&!this._player.paused},t.prototype._createAudioContent=function(e,t){var r=this,n={manifestLatency:0,resolveLatency:0};return(this._emeManager?this._emeManager.getKeySystemInfo():Promise.resolve({keySystem:l.KeySystem.INVALID_SPOTIFY_KEY})).then((function(i){return m.AudioContent.create({abrManager:r._abrManager,mediator:r._mediator,keySystem:i.keySystem,licenseEndpoint:t.licenseEndpoint,transport:r._transport,resolver:r._audioResolver,uri:e,fileId:t.fileId,fileFormat:t.fileFormat,format:t.format,isAd:t.isAd,resolvedURL:t.resolvedURL,noManifest:t.noManifest,preloadedManifest:t.preloadedManifest,logData:t.logData,disableCache:r._disableCache,emitWarning:r._emitWarning}).load(n)})).then((function(e){var i=r._tracker;return i.setResolveLatency(n.resolveLatency),i.setManifestLatency(n.manifestLatency),e.isProtected()&&t.fileId&&!r._disableCache&&r._cache.set(t.fileId,e),e}))},t.prototype._createVideoContent=function(e,t){var r=this,n={manifestLatency:0,resolveLatency:0},i=t.fileId;return(this._emeManager?this._emeManager.getKeySystemInfo():this.getMediaConfig().then((function(e){return{keySystem:l.KeySystem.INVALID_SPOTIFY_KEY,audioFormats:e.formatsInfo.audio,videoFormats:e.formatsInfo.video}}))).then((function(o){return E.VideoContent.create({uri:e,abrManager:r._abrManager,mediator:r._mediator,resolver:r._videoResolver,keySystem:o.keySystem,licenseEndpoint:t.licenseEndpoint,fileId:i,noAuth:t.noAuth,format:_.MediaFormat.MANIFEST_ID,isAd:t.isAd,transport:r._transport,videoFormats:o.videoFormats,videoResolution:r._videoResolution,audioFormats:o.audioFormats,disableCache:r._disableCache,disallowProfile:r._disallowProfile,allowMixedAVC1Codecs:r._allowMixedAVC1Codecs}).load(n)})).then((function(e){var t=r._tracker;return t.setResolveLatency(n.resolveLatency),t.setManifestLatency(n.manifestLatency),e.isProtected()&&i&&!r._disableCache&&r._cache.set(i,e),e}))},t.prototype._preinitMediaElement=function(){var e=this;return this._player||!this._emeManager?Promise.resolve(this):this._emeManager.getKeySystemInfo().then((function(t){var r,n,i=[];return(null===(r=t.audioFormats)||void 0===r?void 0:r[0])&&i.push(t.audioFormats[0].contentType),(null===(n=t.videoFormats)||void 0===n?void 0:n[0])&&i.push(t.videoFormats[0].contentType),!!i.length&&e._recreateMediaElement(i,e._playId,i.length>1?"video":"audio",t.keySystem!==l.KeySystem.FAIRPLAY)})).then((function(){return e}),(function(t){return I.warn("Cannot precreate media element:",null==t?void 0:t.message),e}))},t.prototype.getCodecInfo=function(){return{audiocodec:"mp3",bitrate:160}},t.prototype.getMediaSource=function(){return this._buffer.getMediaSource()},t.prototype.load=function(e,t,r){var n,i=this,o=function(e,t){return t&&t.hasOwnProperty(e)}(t.uriProperty,e)?t.uriProperty:"uri",a=e[o];if(I.info("load",a),!a)return Promise.reject(new f.PlaybackError(c.Errors.PLAYER_CANNOT_FIND_PLAYABLE_URI,"Cannot find a playable URI."));if(!e.logData)return Promise.reject(new Error("Invalid track: logging info not specified"));this.stop(e.logData,e.mediaType),this._loaded=!1,this._licenseRequested=!1,this._buffering=!0,this._currentContent=null,this._subtitleManager.setVideoContent(null);var s,l=++this._playId,d=this._tracker;d.trackLoadStart(a,e.fileId,l.toString(),e.logData,e.metadata),this.emit(u.Event.PLAYER_BEFORE_LOAD,{track:e,options:t,logData:e.logData,uri:a,timestamp:Date.now()}),this._buffer.setPlayId(l),this._loadingOptions={position:D(t.position||0),autoplay:!("autoplay"in t)||t.autoplay,poster:e.poster,useDefaultPlaybackSpeed:!!(null===(n=e.options)||void 0===n?void 0:n.useDefaultPlaybackSpeed),callback:r},d.setPlayIntended(this._loadingOptions.autoplay),d.setPlayedThreshold(t.playedThreshold);var _=this._cache,p="video"===e.mediaType?this._createVideoContent.bind(this,a,e):this._createAudioContent.bind(this,a,e,l);if(e.fileId){var h=e.fileId,y=this._preloadingTracks[h],v=this._disableCache?null:_.get(h);y?(I.info("Waiting for preloading track.",h),s=y.then((function(e){return I.info("Preloading succeeded.",h),d.setResolveLatency(e.resolveLatency),d.setManifestLatency(e.manifestLatency),_.get(h)}),(function(){return I.info("Preloading failed, creating new track",h),p()}))):v?(I.info("Using cached track.",h,v),d.setMemoryCached(!0),s=Promise.resolve(v)):(I.info("Creating new track from fileId",h),s=p())}else I.info("Creating new track without fileId",e.resolvedURL),s=p();return s.then((function(t){return t.isProtected()&&!i._emeManager?Promise.reject(new f.PlaybackError(c.Errors.DISALLOW_PROTECTED_TRACK_ERROR,"Protected tracks not supported")):(t.setLogData(e.logData),d.setCalculatedDuration(C(t.getCalculatedDuration())),i._upcomingContent=t,Promise.resolve())})).then(this._prepareMediaElement.bind(this,this._loadingOptions,l)).then(this._loadContent.bind(this,this._loadingOptions,l)).then(this._handleLoadingComplete,this._handleLoadingError.bind(this,a,e,l))},t.prototype.preload=function(e){var t=this,r=!this._disableCache,n=e.uri,i=e.fileId,o=this._cache;if(!r||!i||!this._emeManager)return Promise.resolve(null);var a="video"===e.mediaType;if(!(O[e.format]&&!a)||o.get(i))return Promise.resolve(null);var s=this._preloadingTracks,l=s[i];if(l)return l;I.info("Preloading track",i);var c={manifestLatency:0,resolveLatency:0},d=this._emeManager.getKeySystemInfo().then((function(r){return m.AudioContent.create({abrManager:t._abrManager,keySystem:r.keySystem,licenseEndpoint:e.licenseEndpoint,transport:t._transport,resolver:t._audioResolver,uri:n,fileId:i,format:e.format,fileFormat:e.fileFormat,isAd:e.isAd,resolvedURL:e.resolvedURL,noManifest:e.noManifest,preloadedManifest:e.preloadedManifest,logData:e.logData,disableCache:t._disableCache,emitWarning:t._emitWarning}).load(c)})).then((function(t){return Promise.all([t,"MP4_CBCS"!==e.format?t.getBufferForFragment(t.getHeadFragment()):null])})).then((function(e){var t=e[0];return o.set(i,t),delete s[i],I.info("Cached",i),c})).catch((function(e){return delete s[i],I.warn("Preloading error",e),t.emit(u.Event.PLAYER_PRELOADING_ERROR,{error:e,track:e.track||null,canPlayNext:!("canPlayNext"in e)||e.canPlayNext,preloading:!0}),Promise.reject(e)}));return s[i]=d,d},t.prototype.togglePlay=function(){return this._isPlaying()?this.pause():this.resume()},t.prototype.setSubtitleLanguage=function(e){this._subtitleManager.setLanguage(e)},t.prototype.getSubtitleLanguages=function(){return this._subtitleManager.getAvailableLanguages()},t.prototype.getActiveSubtitleLanguage=function(){return this._subtitleManager.getActiveLanguage()},t.prototype.deactivateCueEvents=function(){this._subtitleManager.deactivateListeners()},t.prototype.activateCueEvents=function(){this._subtitleManager.activateListeners()},t.prototype.setVolume=function(e,t){if(!this.emitSync(u.Event.PLAYER_BEFORE_VOLUME_CHANGE,{volume:e,options:t}).defaultPrevented){if(e<0||e>1)throw new f.PlaybackError(c.Errors.PLAYER_ATTEMPTED_VOLUME_OUT_OF_RANGE,"Volume should be in range [0, 1]");this._playerVolume=e,this._player&&(this._player.volume=this._cubicVolume?e*e*e:e)}},t.prototype.getVolume=function(){return this._playerVolume},t.prototype.getPlayerState=function(){var e,t,r,n=this._player,i=this._currentContent,o={src:(null==n?void 0:n.src)?"data:"+((null==i?void 0:i.getFileId())||"unknown"):void 0,height:(null==n?void 0:n.clientWidth)||0,width:(null==n?void 0:n.clientHeight)||0},a={};if(i){var s=i.getPlayableCodecs(),u=s[0],l=s[1];a.audio_format=u,a.video_format=l,i instanceof E.VideoContent&&n instanceof HTMLVideoElement&&(a.video_height=n.videoHeight,a.video_width=n.videoWidth,o.poster=n.poster)}return{playing:null!==(e=!(null==n?void 0:n.paused))&&void 0!==e&&e,position:n?C(n.currentTime):0,duration:n?C(n.duration):0,volume:null!==(t=this._playerVolume)&&void 0!==t?t:1,playback_speed:null!==(r=null==n?void 0:n.playbackRate)&&void 0!==r?r:0,buffering:this._buffering,media_type:(null==i?void 0:i.getMediaType())||null,media_info:a,player_element:o}},t.prototype.getPlayerPosition=function(){return this._player?C(this._player.currentTime):0},t.prototype.seek=function(e){var t=this;if(this._player){var r=this._playId,n=function(){if(t._player&&r===t._playId){var n=D(e);n<0?n=0:n>=t._player.duration&&(n=t._player.duration),t._player.currentTime=n}else I.info("Seek dropped: playId has changed.")};this._loaded?n():this.once(u.Event.PLAYER_LOAD,n),this._getBufferingLatency().then((function(e){t._tracker.trackSeekRebuffering(e)}))}},t.prototype.pause=function(){var e=this;return new Promise((function(t){e._player&&e._isPlaying()?t(e._player&&e._player.pause()):t()}))},t.prototype.resume=function(){var e=this;return new Promise((function(t){e._player&&!e._isPlaying()?t(e._player&&e._player.play()):t()}))},t.prototype.stop=function(e,t){var r,n=[],i=e||{};this.emit(u.Event.PLAYER_BEFORE_STOP,{timestamp:Date.now(),logData:i}),this._tracker.trackStopped(this._player?C(this._player.currentTime):-1,e,this.getStatistics()||void 0),this._buffer.abort(!0),this._emeManager&&n.push(this._emeManager.destroySessions());var o=this._player;if(o){this._subtitleManager.clear(),this._fatalOnNextError=this._shouldNextErrorBeFatal(),this._fatalOnNextError&&I.warn("MediaError detected: next immediate media error will be fatal.");var a=o.src;if(a)L.test(a)&&URL.revokeObjectURL(a),o.removeAttribute("src");else{var s=R.collectionToArray(o.getElementsByTagName("source"));I.info("HTMLSourceElements to removed: "+s.length);for(var l=0,c=s;l<c.length;l++){var d=c[l];o.removeChild(d)}I.info("Releasing HLS URLs"),null===(r=this._currentContent)||void 0===r||r.releaseHLSURL()}o.load()}if(this._currentContent&&this._disableCache&&this._currentContent.clearCachedBuffers(),o&&this._currentContent&&"video"===this._currentContent.getMediaType()){var _=this._getContainerElement(this._videoPlayerContainer);_&&o.parentNode===_&&(this._newElementPerTrack||"video"!==t)&&(this._subtitleManager.setPlayer(null),_.removeChild(o),this.emit(u.Event.PLAYER_VIDEO_ELEMENT_REMOVED,null))}else if(o&&this._currentContent&&"audio"===this._currentContent.getMediaType()){var p=this._getContainerElement(this._audioPlayerContainer);p&&o.parentNode===p&&(this._newElementPerTrack||"audio"!==t)&&p.removeChild(o)}return this.emit(u.Event.PLAYER_STOPPED,null),Promise.all(n).then((function(){return!0}))},t.prototype.hideSubtitles=function(){this._subtitleManager.hide()},t.prototype.showSubtitles=function(){this._subtitleManager.show()},t.prototype.areSubtitlesShown=function(){return this._subtitleManager.visible()},t.prototype.getKeySystemInfo=function(){return this._emeManager?this._emeManager.getKeySystemInfo():Promise.resolve(null)},t.prototype.getVideoVariants=function(){if(!(this._currentContent&&this._currentContent instanceof E.VideoContent))return[];for(var e=[],t=0,r=this._currentContent.getVideoProfiles();t<r.length;t++){var n=r[t];e.push({width:n.video_width,height:n.video_height,bitrate:n.video_bitrate})}return e},t.prototype.setPreferredBitrate=function(e){return"number"!=typeof e?Promise.resolve(d.OperationResult.INVALID):(this._preferredBitrate=e,this._currentContent&&"video"===this._currentContent.getMediaType()&&e>0&&this._buffer.abort(!0),this._abrManager.overrideBitrate(e),Promise.resolve(d.OperationResult.SUCCESS))},t.prototype.getCurrentBandwidth=function(){return this._abrManager.getBandwidthEstimate()},t.prototype.setBackgrounded=function(e){this._abrManager.overrideBitrate(e?1e-32:this._preferredBitrate)},t.prototype.setVideoResolution=function(e){this._videoResolution=i.__assign(i.__assign({},this._videoResolution),e),this._currentContent instanceof E.VideoContent&&this._currentContent.setVideoResolution(this._videoResolution)},t.prototype.activateElement=function(){return!(this._playerActivated||!this._player||this._player.src)&&(this._player.load(),this._playerActivated=!0,!0)},t.prototype.getMediaConfig=function(){var e=this;return void 0===this._mediaConfig?function(e,t){var r=t||document.createElement("video"),n=function(e){r.canPlayType("audio/mp3")&&(e.formats.audio.push("audio/mp3"),e.formatsInfo.audio.push({mimeType:"audio/mp3",codec:"mp3",contentType:'audio/mp3; codecs="mp3"'}),e.supports.unprotected_audio=!0)};if(e)return e.getKeySystemInfo().then((function(e){var t=e.audioFormats,r=e.videoFormats,o={supports:{protected_audio:!!t.length,unprotected_audio:!0,protected_video:!!r.length,unprotected_video:!0},formats:{audio:t.map((function(e){return e.contentType})),video:r.map((function(e){return e.contentType}))},formatsInfo:{audio:i.__spreadArray([],t),video:i.__spreadArray([],r)}};return o.keysystem=e.keySystem,o.keysystem_impl=e.keySystemImpl,n(o),o}));var o="undefined"!=typeof window&&window.MediaSource?function(e){return MediaSource.isTypeSupported(e)}:function(e){return"probably"===r.canPlayType(e)||"probably"===r.canPlayType(e.split(";")[0])},a=S.getMediaKeySystemConfiguration([v.EMEConfigs[0]],o),s=[],u=[],l=[],c=[];if(a){for(var d=a.audioCapabilities,_=a.videoCapabilities,p=0,f=d;p<f.length;p++){var h=f[p];s.push(h.contentType),l.push(S.toFormatInfo(h.contentType))}for(var y=0,E=_;y<E.length;y++){h=E[y];u.push(h.contentType),c.push(S.toFormatInfo(h.contentType))}}var m={supports:{protected_audio:!1,unprotected_audio:!!s.length,protected_video:!1,unprotected_video:!!u.length},formats:{audio:s,video:u},formatsInfo:{audio:l,video:c}};return n(m),Promise.resolve(m)}(this._emeManager,this._player).then((function(t){return e._mediaConfig=t,e._mediaConfig})):Promise.resolve(this._mediaConfig)},t.prototype.setPlaybackSpeed=function(e){var t;return!(!Number.isFinite(e)||e<=0)&&(!(null===(t=this._loadingOptions)||void 0===t?void 0:t.useDefaultPlaybackSpeed)&&(this._playerSpeed=null!=e?e:1,this._player&&(this._player.playbackRate=this._playerSpeed,this._tracker.trackSpeedChanged(this._playerSpeed)),!0))},t.prototype.getStatistics=function(){return this._player&&this._currentContent?this._statistics.getSample(this._player,this._currentContent):null},t}(o.EventEmitter);r.Player=w},{"../enums/content_mediator_event":57,"../enums/errors":58,"../enums/event":59,"../enums/key_system":60,"../enums/media_format":62,"../enums/operation_result":64,"../error/file":72,"../error/player":77,"./audio_content":23,"./bandwidth_estimator":24,"./buffer":25,"./eme/configs":28,"./eme/manager":30,"./helpers/dom":38,"./helpers/eme":39,"./helpers/hls":40,"./statistics":48,"./subtitle_manager":50,"./video_content":53,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,"@spotify-internal/linkedlist/es5":155,tslib:201}],48:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Statistics=r.getBufferAvailability=void 0;var n=e("./audio_content"),i=e("./video_content");function o(e,t){for(var r=e.length,n=0;n<r;n++)if(e.start(n)<=t&&t<=e.end(n))return 1e3*(e.end(n)-t);return 0}r.getBufferAvailability=o;var a=function(){function e(e){this.bandwidthEstimator=e.bandwidthEstimator}return e.create=function(t){return new e(t)},e.prototype.getSample=function(e,t){var r,a,s=this.bandwidthEstimator.getBandwidthEstimate(),u=o(e.buffered,e.currentTime);if(t instanceof n.AudioContent){var l=null===(a=null===(r=t.getFirstFragment())||void 0===r?void 0:r.bufferSet)||void 0===a?void 0:a.audio,c=null==l?void 0:l.bitrate;return{bandwidth:s,bufferAvailability:u,audio:{contentType:null==l?void 0:l.mimetype,bitrate:c}}}var d=t.getAudioProfile(),_=t.getVideoProfile(),p=t.getVideoProfiles(),f="getVideoPlaybackQuality"in e?e.getVideoPlaybackQuality():{creationTime:void 0,droppedVideoFrames:void 0,totalVideoFrames:void 0};return{bandwidth:s,bufferAvailability:u,video:{creationTime:f.creationTime,droppedVideoFrames:f.droppedVideoFrames,totalVideoFrames:f.totalVideoFrames,bitrate:null==_?void 0:_.video_bitrate,availableBitrates:p.map((function(e){return e.video_bitrate})),height:null==_?void 0:_.video_height,width:null==_?void 0:_.video_width,resolution:null==_?void 0:_.video_resolution,contentType:i.getProfileMimeType(null!=_?_:void 0)},audio:{bitrate:null==d?void 0:d.audio_bitrate,contentType:i.getProfileMimeType(null!=d?d:void 0)}}},e}();r.Statistics=a},{"./audio_content":23,"./video_content":53}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StorageResolve=void 0;var n=e("@js-sdk/debug-tools/es5"),i=e("../enums/errors"),o=e("../error/storage"),a=n.logging.forTag("playback.storage_resolve"),s=function(){function e(e){this._transport=e}return e.prototype._parseResponse=function(e,t){var r,n;if(200!==t.status)return(n=new o.StorageError(i.Errors.STORAGE_FAILED_WITH_STATUS,"Storage Resolve responded with "+t.status)).status=t.status,n.fileId=e,Promise.reject(n);var a=t.body;if(!(null===(r=null==a?void 0:a.cdnurl)||void 0===r?void 0:r.length))return(n=new o.StorageError(i.Errors.STORAGE_RETURNED_NO_TRACKS,"Storage Resolve returned no tracks for fileId "+e)).fileId=e,Promise.reject(n);var s={uri:a.cdnurl[0],uris:a.cdnurl,protection:"cenc"};return Promise.resolve(s)},e.prototype.getCDNURL=function(e,t){a.info("Requesting CDN URL for ",e);var r="files/audio/interactive",n="@webgate/storage-resolve/"+(t?"v2/"+r+"/"+t+"/"+e:r+"/"+e)+"?version=10000000&product=9&platform=39&alt=json";return this._transport.request(n,{responseType:"json",retry:{condition:function(e,t){return e.getStatusFamily()!==t.SUCCESS}}}).then(this._parseResponse.bind(this,e))},e.prototype.getManifest=function(e){var t="https://seektables.scdn.co/seektable/"+e+".json";return a.info("Requesting JSON manifest for ",e),this._transport.request(t,{responseType:"json",retry:{condition:function(e,t){return e.getStatusFamily()!==t.SUCCESS}}}).then((function(t){var r;return 200!==t.status?((r=new o.StorageError(i.Errors.STORAGE_TRACK_MANIFEST_FAILED,"Track manifest request failed with status code "+t.status)).debug.file_id=e,r.status=t.status,Promise.reject(r)):t.body?t.body:((r=new o.StorageError(i.Errors.STORAGE_TRACK_MANIFEST_EMPTY,"Received empty manifest.")).debug.file_id=e,r.status=t.status,Promise.reject(r))}))},e}();r.StorageResolve=s},{"../enums/errors":58,"../error/storage":78,"@js-sdk/debug-tools/es5":17}],50:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SubtitleManager=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/event"),a=e("../enums/subtitle_mode"),s=e("./helpers/dom");function u(e){var t=e;return{id:t.id,text:t.text}}var l=/^[A-Za-z]{2,4}([_-][A-Za-z]{4})?([_-]([A-Za-z]{2}|[0-9]{3}))?$/,c=function(e){function t(t){var r=e.call(this)||this;return r._isVisible=!1,r._player=null,r._crossOrigin=null,r._currentVideoContent=null,r._unsubscribers=[],r._displayedCues=[],r._deactivateListeners=!1,r._activeLanguage=void 0,r._preferredLanguage=t.language.toLowerCase(),t.deactivateListeners&&(r._deactivateListeners=!0),r._onEnter=r._onEnter.bind(r),r._onExit=r._onExit.bind(r),r._onLoadedMetadata=r._onLoadedMetadata.bind(r),r.setPlayer(t.player),r}return n.__extends(t,e),t.prototype._subscribeToCueEvents=function(e){var t,r=this,n=e.track;if(!n)throw new Error("No track");if(null===(t=n.cues)||void 0===t?void 0:t.length){n.mode=this._isVisible?a.SubtitleMode.SHOWING:a.SubtitleMode.HIDDEN,this._displayedCues=n.activeCues?Array.from(n.activeCues):[],this._emitDisplayedCues();for(var i=function(e){var t=n.cues[e];if(!t)return"continue";t.addEventListener("enter",o._onEnter),t.addEventListener("exit",o._onExit),o._unsubscribers.push((function(){t.removeEventListener("enter",r._onEnter),t.removeEventListener("exit",r._onExit)}))},o=this,s=0;s<n.cues.length;s++)i(s)}else{e.addEventListener("load",(function t(){r._subscribeToCueEvents(e),e.removeEventListener("load",t)}))}},t.prototype._unsubscribeFromCueEvents=function(){this._unsubscribers.forEach((function(e){return e()})),this._unsubscribers=[]},t.prototype._onEnter=function(e){var t=e.target;this._displayedCues.indexOf(t)>-1||(this._displayedCues.push(t),this._emitDisplayedCues())},t.prototype._onExit=function(e){var t=e.target,r=this._displayedCues.indexOf(t);r>-1&&(this._displayedCues.splice(r,1),this._emitDisplayedCues())},t.prototype._emitDisplayedCues=function(){this.emit(o.Event.PLAYER_DISPLAYED_CUES_CHANGED,{cues:this._displayedCues.map(u)})},t.prototype._updateVisibleState=function(){var e,t,r=this;if(this._player){var n=this.getActiveLanguage();Array.from(null!==(t=null===(e=this._player)||void 0===e?void 0:e.querySelectorAll("track"))&&void 0!==t?t:[]).forEach((function(e){e.style.visibility=r._isVisible?"visible":"hidden"}));for(var i=this._player.textTracks,o=0,s=i.length;o<s;o++){var u=i[o];u&&(u.mode=this._isVisible&&u.language.toLowerCase()===n?a.SubtitleMode.SHOWING:a.SubtitleMode.HIDDEN)}}},t.prototype._updateTextTracks=function(){var e=this._player;e&&(e.readyState>=1?this._onLoadedMetadata():this._currentVideoContent&&e.addEventListener(o.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata))},t.prototype._onLoadedMetadata=function(){var e=this._player;if(e&&(s.clearChildElements(e,"track"),this._currentVideoContent)){e.crossOrigin="anonymous";for(var t=this._updateActiveLanguage(),r=0,n=this._currentVideoContent.getSubtitles();r<n.length;r++){var i=n[r],o=i.lang,a=i.url,u=o.toLowerCase()===t,l=document.createElement("track");l.label=o+" subtitles",l.kind="subtitles",l.srclang=o,l.src=a,l.default=u,l.style.visibility=this._isVisible?"visible":"hidden",e.appendChild(l),u&&!this._deactivateListeners&&this._subscribeToCueEvents(l)}}},t.prototype._updateActiveLanguage=function(){if(this._player&&this._currentVideoContent){for(var e=this._currentVideoContent.getSubtitleLanguages(),t=this._preferredLanguage.split("-")[0],r=null,n=0,i=e;n<i.length;n++){var o=i[n].toLowerCase();if(o===this._preferredLanguage)return this._activeLanguage=o,this._activeLanguage;o.split("-")[0]===t&&null===r&&(r=o)}return this._activeLanguage=null!=r?r:"en-us",this._activeLanguage}this._activeLanguage=void 0},t.prototype.getActiveLanguage=function(){if(this._player&&this._currentVideoContent)return this._activeLanguage},t.prototype.setVideoContent=function(e){this._unsubscribeFromCueEvents(),this._displayedCues=[],this._currentVideoContent=e,e||this.clear(),this._updateTextTracks()},t.prototype.setPlayer=function(e){var t,r="VIDEO"===(null==e?void 0:e.tagName)?e:null;this._player!==r&&this.clear(),this._player=r||null,this._crossOrigin=null!==(t=null==r?void 0:r.crossOrigin)&&void 0!==t?t:null,this._updateTextTracks()},t.prototype.getAvailableLanguages=function(){var e,t;return null!==(t=null===(e=this._currentVideoContent)||void 0===e?void 0:e.getSubtitleLanguages())&&void 0!==t?t:[]},t.prototype.setLanguage=function(e){if(!e.length)throw new TypeError("Argument `code` must be a non-empty string. Hide subtitles using `hideSubtitles()`.");if(!l.test(e))throw new TypeError("Argument `code` must be a valid BCP 47 formatted language code");this._preferredLanguage=e.toLowerCase(),this._updateTextTracks()},t.prototype.hide=function(){this._isVisible=!1,this._updateVisibleState()},t.prototype.show=function(){this._isVisible=!0,this._updateVisibleState()},t.prototype.deactivateListeners=function(){this._deactivateListeners||this._player&&(this._deactivateListeners=!0,this._unsubscribeFromCueEvents())},t.prototype.activateListeners=function(){this._deactivateListeners&&(this._deactivateListeners=!1,this._updateTextTracks())},t.prototype.areListenersActivated=function(){return!this._deactivateListeners},t.prototype.clear=function(){var e=this._player;e&&(this._unsubscribeFromCueEvents(),this._currentVideoContent=null,this._displayedCues=[],s.clearChildElements(e,"track"),e.removeEventListener(o.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata),e.crossOrigin=this._crossOrigin)},t.prototype.visible=function(){return this._isVisible},t}(i.EventEmitter);r.SubtitleManager=c},{"../enums/event":59,"../enums/subtitle_mode":69,"./helpers/dom":38,"@spotify-internal/emitter/es5":98,tslib:201}],51:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Tracker=void 0;var n=e("tslib"),i=e("@js-sdk/debug-tools/es5"),o=e("@spotify-internal/emitter/es5"),a=e("../enums/event"),s=e("./tracking_data"),u=i.logging.forTag("playback.tracker"),l=function(e){function t(t){void 0===t&&(t={});var r=e.call(this)||this;return r._playedThreshold=31e3,r._playedThresholdReached=!1,r._trackingData=null,r._playedThreshold=t.playerThreshold||31e3,r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._checkPlayedThreshold=function(){var e=this._trackingData;!e||!this._playedThreshold||this._playedThresholdReached||e.msPlayed<this._playedThreshold||(this._playedThresholdReached=!0,this.emit(a.Event.TRACKER_PLAYED_THRESHOLD_REACHED,{played:e&&e.msPlayed||0,threshold:this._playedThreshold}))},t.prototype.getMSPlayed=function(){return this._trackingData?this._trackingData.msPlayed:0},t.prototype.getStallsInformation=function(){return this._trackingData?{nStalls:this._trackingData.nStalls,msTotalStalled:this._trackingData.msStalled}:{nStalls:0,msTotalStalled:0}},t.prototype.trackLoadStart=function(e,t,r,n,i){var o=s.TrackingData.create();this._trackingData=o,this._playedThresholdReached=!1,o.fileId=null!=t?t:"",o.currentTrackUri=e,o.loadTime=Date.now(),o.internalPlayId=r,o.externalLoadTime=n.externalLoadTime||0,o.displayTrack=n.displayTrack||"",o.playbackId=n.playbackId||"",o.playContext=n.playContext||"",o.reasonStart=n.reason||"unknown",o.sourceStart=n.source||"unknown",o.clientId=n.clientId||"",o.correlationId=n.correlationId||"";var u=n.referrer||{};o.referrer=void 0!==u.name?u.name:"unknown",o.referrerVersion=void 0!==u.version?u.version:"unknown",o.referrerVendor=void 0!==u.vendor?u.vendor:"unknown";var l=n.format||{};l.codec&&(o.audiocodec=l.codec.toLowerCase()),l.bitrate&&(o.bitrate=l.bitrate),l.audioQuality&&(o.audioQuality=l.audioQuality),o.gaiaDevId=n.deviceId||"none",o.noLog=n.noLog||!1,o.noTSV=n.noTSV||!1,o.noStats=n.noStats||!1,o.contentMetadata=i,this.emit(a.Event.TRACKER_TRACKING_DATA_CREATED,{trackingData:o})},t.prototype.trackBufferLoadStart=function(){var e=this._trackingData;e&&(e.bufferLoadStartTime=Date.now())},t.prototype.trackBytesDownloaded=function(e){var t=this._trackingData;t&&(t.totalBytes+=e)},t.prototype.trackLoadDone=function(e){var t=this._trackingData;if(t){var r=Date.now();t.msInitLatency=r-t.bufferLoadStartTime,t.localTimeMs=r,t.position=e,t.addStartSegment()}},t.prototype.trackPlay=function(e,t){var r=this._trackingData;r&&(r.played||this.emit(a.Event.TRACKER_PLAYBACK_START,{trackingData:r}),r.played=!0,r.position=e,r.startPosition=e,r.addSpeedChange(t||1))},t.prototype.trackCanPlayThrough=function(){var e=this._trackingData;if(e&&!e.msPlayLatency){var t=Date.now();e.msPlayLatency=t-e.loadTime,e.msHeadLatency=t-e.bufferLoadStartTime}},t.prototype.trackBufferURL=function(e,t){var r=this._trackingData;r&&r.trackBufferURL(e,t)},t.prototype.trackNavigatorOffline=function(){var e=this._trackingData;e&&(e.nOffline+=1)},t.prototype.trackSeekRebuffering=function(e){var t=this._trackingData;t&&(e>t.maxMsSeekRebuffering&&(t.maxMsSeekRebuffering=e),t.msSeekRebuffering+=e)},t.prototype.trackMsStalled=function(e){var t=this._trackingData;t&&(e>t.maxMsStalled&&(t.maxMsStalled=e),t.msStalled+=e,t.nStalls++)},t.prototype.trackLoadFailed=function(){var e=this._trackingData;e&&(e.msPlayLatency=Date.now()-e.loadTime,e.position=0,e.addStartSegment())},t.prototype.trackStopped=function(e,t,r){var n,i,o,s,l=this._trackingData;if(l&&!l.isFinalized()){var c=Date.now();if(l.stopTime=c,l.lastPlayPosition>=0&&e>=0&&l.lastPlayPosition<e){var d=e-l.lastPlayPosition;l.addMSPlayed(d)}l.addEndSegment(),l.sourceEnd=t.source||"unknown",l.reasonEnd=t.reason||"unknown",l.nextPlaybackId=t.playbackId||"",l.droppedVideoFrames=null!==(i=null===(n=null==r?void 0:r.video)||void 0===n?void 0:n.droppedVideoFrames)&&void 0!==i?i:0,l.totalVideoFrames=null!==(s=null===(o=null==r?void 0:r.video)||void 0===o?void 0:o.totalVideoFrames)&&void 0!==s?s:0,l.finalize(),u.info("Tracker data finalized.");var _=l.getPlaybackStats();this.emit(a.Event.TRACKER_TRACKING_DATA_FINALIZED,{trackingData:l,playbackStats:_})}},t.prototype.trackPositionChanged=function(e){var t=this._trackingData;if(t){var r=t.position;e!==r&&(t.addEndSegment(),e>r?(t.nSeeksForward++,t.msSeeksForward+=e-r):e<r&&(t.nSeeksBackward++,t.msSeeksBackward+=r-e),t.position=e,t.lastPlayPosition=-1,t.addStartSegment())}},t.prototype.trackPlaying=function(e){var t=this._trackingData;if(t){if(t.lastPlayPosition>=0&&t.lastPlayPosition<e){var r=e-t.lastPlayPosition;t.addMSPlayed(r)}t.position=e,t.lastPlayPosition=e}},t.prototype.trackPaused=function(e){var t=this._trackingData;if(t){if(t.lastPlayPosition>=0&&t.lastPlayPosition<e){var r=e-t.lastPlayPosition;t.addMSPlayed(r)}t.position=e,t.lastPlayPosition=e}},t.prototype.trackProgress=function(e,t){var r=this._trackingData;if(null==r?void 0:r.played){var n=0;if(r.lastPlayPosition>=0){if((n=e-r.lastPlayPosition)<0)return void u.warn("Skipping msPlayed calculation: late progress event.");r.addMSPlayed(n)}this._checkPlayedThreshold(),r.position=e,r.lastPlayPosition=e,t&&r.trackBitrate(t,n)}},t.prototype.trackSpeedChanged=function(e){var t=this._trackingData;t&&t.addSpeedChange(e)},t.prototype.trackVideoLoadStart=function(e){var t=this._trackingData;t&&t.registerVideoVariant(e)},t.prototype.trackWarning=function(){var e=this._trackingData;e&&e.nWarnings++},t.prototype.trackOffline=function(){var e=this._trackingData;e&&e.nOffline++},t.prototype.setActualDuration=function(e){var t=this._trackingData;t&&(t.msActualDuration=e)},t.prototype.setKeySystem=function(e){var t=this._trackingData;t&&(t.keySystem=e)},t.prototype.setKeySystemImpl=function(e){var t=this._trackingData;t&&(t.keySystemImpl=e)},t.prototype.setManifestLatency=function(e){var t=this._trackingData;t&&(t.msManifestLatency=e)},t.prototype.setPlayIntended=function(e){var t=this._trackingData;t&&(t.playIntended=e)},t.prototype.setKeyLatency=function(e){var t=this._trackingData;t&&(t.msKeyLatency=e)},t.prototype.setMemoryCached=function(e){var t=this._trackingData;t&&(t.memoryCached=e)},t.prototype.setPersistentCached=function(e){var t=this._trackingData;t&&(t.persistentCached=e)},t.prototype.setProtected=function(e){var t=this._trackingData;t&&(t.isProtected=e)},t.prototype.setHadError=function(e){var t=this._trackingData;t&&(t.hadError=e)},t.prototype.setLicenseSessionLatency=function(e){var t=this._trackingData;t&&(t.msLicenseSessionLatency=e)},t.prototype.setLicenseGenerationLatency=function(e){var t=this._trackingData;t&&(t.msLicenseGenerationLatency=e)},t.prototype.setLicenseRequestLatency=function(e){var t=this._trackingData;t&&(t.msLicenseRequestLatency=e)},t.prototype.setLicenseUpdateLatency=function(e){var t=this._trackingData;t&&(t.msLicenseUpdateLatency=e)},t.prototype.setResolveLatency=function(e){var t=this._trackingData;t&&(t.msResolveLatency=e)},t.prototype.setCalculatedDuration=function(e){var t=this._trackingData;t&&(t.msFileDuration=e)},t.prototype.setPlayedThreshold=function(e){this._playedThreshold=e},t.prototype.setBandwidth=function(e){var t=this._trackingData;t&&((e<t.bpsBandwidthMin||!t.bpsBandwidthMin)&&(t.bpsBandwidthMin=e),e>t.bpsBandwidthMax&&(t.bpsBandwidthMax=e),t.totalBandwidth+=e,t.nBandwidthSamples++)},t.prototype.setRenditionCount=function(e){var t=this._trackingData;t&&(e<t.lastVideoProfileBitrate&&t.nRenditionDowngrade++,e>t.lastVideoProfileBitrate&&t.nRenditionUpgrade++,t.lastVideoProfileBitrate=e)},t}(o.EventEmitter);r.Tracker=l},{"../enums/event":59,"./tracking_data":52,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,tslib:201}],52:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackingData=void 0;var n=e("../enums/errors"),i=e("../enums/key_system"),o=e("../error/tracking"),a=e("./cdn_url_tracker"),s=function(){function e(){this._bitrates={},this._isFinalized=!1,this._needsEndSegment=!1,this._segments=[],this._cdnURLTracker=new a.CDNURLTracker,this._currentSpeed=1,this.audiocodec=null,this.bitrate=0,this.audioQuality=void 0,this.bufferingPercentage=0,this.bufferLoadStartTime=0,this.urls={},this.currentTrackUri="",this.displayTrack="",this.externalLoadTime=0,this.fileId="",this.gaiaDevId="none",this.hadError=!1,this.internalPlayId="",this.isProtected=!1,this.keySystem="",this.keySystemImpl="",this.lastPlayPosition=-1,this.loadTime=0,this.localTimeMs=-1,this.maxContinuous=0,this.maxMsSeekRebuffering=0,this.maxMsStalled=0,this.memoryCached=!1,this.msActualDuration=0,this.msFileDuration=0,this.msHeadLatency=0,this.msInitLatency=0,this.msKeyLatency=0,this.msLicenseGenerationLatency=0,this.msLicenseRequestLatency=0,this.msLicenseSessionLatency=0,this.msLicenseUpdateLatency=0,this.msManifestLatency=0,this.msPlayed=0,this.msNominalPlayed=0,this.msPlayedUnion=0,this.msPlayLatency=0,this.msResolveLatency=0,this.msSeekRebuffering=0,this.msSeeksBackward=0,this.msSeeksForward=0,this.nextPlaybackId="",this.nOffline=0,this.noLog=!1,this.noTSV=!1,this.noStats=!1,this.nWarnings=0,this.msStalled=0,this.nSeeksBackward=0,this.nSeeksForward=0,this.nSpeedChanges=!1,this.nStalls=0,this.nRenditionUpgrade=0,this.nRenditionDowngrade=0,this.bpsBandwidthMax=0,this.bpsBandwidthMin=0,this.bpsBandwidthAvg=0,this.nBandwidthSamples=0,this.totalBandwidth=0,this.lastVideoProfileBitrate=0,this.persistentCached=!1,this.playbackId="",this.playContext="",this.played=!1,this.position=0,this.reasonEnd="unknown",this.reasonStart="unknown",this.referrer="unknown",this.referrerVendor="unknown",this.referrerVersion="unknown",this.sourceEnd="unknown",this.sourceStart="unknown",this.startPosition=0,this.stopTime=0,this.streamingRule="none",this.timeWeightedBitrate=0,this.totalBytes=0,this.playIntended=!1,this.videocodec=null,this.clientId="unknown",this.correlationId="unknown",this.droppedVideoFrames=0,this.totalVideoFrames=0}return e.create=function(){return new e},e.prototype._calculateUnion=function(){for(var e=this._segments.slice(0),t=0,r=0,n=0,i=0,o=0,a=0,s=this.maxContinuous;o<e.length;o++)o%2!=0&&void 0!==e[o-1]&&"start"===e[o-1].type&&(s=(a=e[o].time-e[o-1].time)>s?a:s);for(this.maxContinuous=s,e.sort((function(e,t){return e.time-t.time}));i<e.length;i++)"start"===e[i].type&&(0===r&&(n=i),++r),"end"===e[i].type&&0===--r&&(t+=e[i].time-e[n].time);return t},e.prototype._calculateWeightedBitrate=function(e){var t=this._bitrates,r=0;for(var n in t)n&&t.hasOwnProperty(n)&&e>0&&(r+=parseInt(n,10)*t[n]/e);return Math.round(r)},e.prototype.registerVideoVariant=function(e){var t=e.bitrate;t&&(this._bitrates[t]=this._bitrates[t]||0,this.startBitrate||(this.startBitrate=t)),e.audioProfile&&e.audioProfile.audio_codec&&(this.audiocodec=e.audioProfile.audio_codec),e.videoProfile&&e.videoProfile.video_codec&&(this.lastVideoProfileBitrate=e.videoProfile.video_bitrate,this.videocodec=e.videoProfile.video_codec)},e.prototype.addStartSegment=function(){this._segments.push({type:"start",time:this.position}),this._needsEndSegment=!0},e.prototype.addEndSegment=function(){this._needsEndSegment&&(this._segments.push({type:"end",time:this.position}),this._needsEndSegment=!1)},e.prototype.addMSPlayed=function(e){if(e){if(e<0)throw new TypeError("Cannot add negative msPlayed value: "+e);this.msPlayed+=e/this._currentSpeed,this.msNominalPlayed+=e}},e.prototype.addSpeedChange=function(e){this.nSpeedChanges=!0,this._currentSpeed=e},e.prototype.trackBitrate=function(e,t){var r=e||"dummy";this._bitrates[r]=this._bitrates[r]||0,this._bitrates[r]+=t},e.prototype.trackBufferURL=function(e,t){this._cdnURLTracker.track(e,t)},e.prototype.finalize=function(){var e;if(this._isFinalized)throw new o.TrackingError(n.Errors.TRACK_DATA_ALREADY_FINALIZED,"TrackData already finalized.");this.msPlayedUnion=this._calculateUnion(),this.nSeeksBackward||this.nSeeksForward||this.nSpeedChanges||(this.msNominalPlayed=this.maxContinuous=this.msPlayedUnion,this.msPlayed=this.msNominalPlayed/this._currentSpeed,this.nSpeedChanges=!1);var t=this.msPlayed;return this.timeWeightedBitrate=this._calculateWeightedBitrate(t),this.bufferingPercentage=this.msStalled/t,this.startBitrate||(this.startBitrate=this.bitrate),this.bpsBandwidthAvg=null!==(e=this.totalBandwidth/this.nBandwidthSamples)&&void 0!==e?e:0,this.urls=this._cdnURLTracker.toJSON(),this._isFinalized=!0,!0},e.prototype.getURLsJSON=function(){var e,t;return null!==(t=null===(e=this._cdnURLTracker.toJSON().urls)||void 0===e?void 0:e.map((function(e){return e.url})))&&void 0!==t?t:[]},e.prototype.getPlaybackStats=function(){var e;switch(this.keySystem){case i.KeySystem.WIDEVINE:e="widevine";break;case i.KeySystem.PLAYREADY:case i.KeySystem.PLAYREADY_HARDWARE:e="playready";break;default:e="none"}return{ms_total_est:this.msActualDuration,ms_manifest_latency:this.msManifestLatency,ms_latency:this.msPlayLatency,start_offset_ms:this.startPosition,ms_initial_buffering:this.msPlayLatency,ms_seek_rebuffering:this.msSeekRebuffering,ms_stalled:this.msStalled,max_ms_seek_rebuffering:this.maxMsSeekRebuffering,max_ms_stalled:this.maxMsStalled,n_stalls:this.nStalls,n_rendition_upgrade:this.nRenditionUpgrade,n_rendition_downgrade:this.nRenditionDowngrade,bps_bandwidth_max:this.bpsBandwidthMax,bps_bandwidth_min:this.bpsBandwidthMin,bps_bandwidth_avg:this.bpsBandwidthAvg,audiocodec:this.audiocodec?this.audiocodec.toLowerCase():void 0,videocodec:this.videocodec?this.videocodec.toLowerCase():void 0,start_bitrate:this.startBitrate||this.bitrate||void 0,full_screen:void 0,time_weighted_bitrate:this.timeWeightedBitrate,buffering_percentage:void 0,prefetched_bytes:void 0,prefetched_bytes_loaded:void 0,prefetched_initial_bitrate:void 0,key_system:e,ms_key_latency:this.msKeyLatency,total_bytes:this.totalBytes,local_time_ms:this.localTimeMs,ms_played_background:void 0,n_dropped_video_frames:this.droppedVideoFrames,n_total_video_frames:this.totalVideoFrames}},e.prototype.isFinalized=function(){return this._isFinalized},e}();r.TrackingData=s},{"../enums/errors":58,"../enums/key_system":60,"../error/tracking":79,"./cdn_url_tracker":26}],53:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.VideoContent=r.getProfileMimeType=void 0;var n=e("tslib"),i=e("@js-sdk/debug-tools/es5"),o=e("../enums/errors"),a=e("../enums/key_system"),s=e("../enums/content_mediator_event"),u=e("../error/file"),l=e("../error/fragment"),c=e("./content"),d=e("./helpers/hls"),_=e("./helpers/preferred_profiles"),p=i.logging.forTag("playback.video_content");function f(e){if(!e)return"";var t=e.__effective_codec||("audio_codec"in e?e.audio_codec:e.video_codec);return e.mime_type+';codecs="'+t+'"'}r.getProfileMimeType=f;var h={method:"GET",responseType:"arraybuffer",timing:!0,retry:{condition:function(e,t){if(0===e.status)return!0;var r=e.getStatusFamily();return r===t.CONNECTION_ERROR||r===t.SERVER_ERROR}}},y=function(e){function t(t){var r=e.call(this,t)||this;return r._assetId="",r._endTime=0,r._videoFormats=[],r._audioFormats=[],r._subtitleLanguages=[],r._videoProfile=null,r._videoProfiles=[],r._audioProfile=null,r._audioProfiles=[],r._baseURL="",r._initTemplate="",r._segmentTemplate="",r._subtitleTemplate="",r._initSegments={},r._hlsURLs=[],r._allowMixedAVC1Codecs=!1,r._initTemplate="",r._isAd=t.isAd||!1,r._mediaType="video",r._resolver=t.resolver,r._videoFormats=t.videoFormats,r._audioFormats=t.audioFormats,r._disallowProfile=t.disallowProfile,r._videoResolution=t.videoResolution,r._allowMixedAVC1Codecs=!!t.allowMixedAVC1Codecs,r._keySystem===a.KeySystem.FAIRPLAY&&r._audioFormats.unshift({mimeType:"audio/mp2t",codec:"mp4a.40.2"}),r._parseFragmentResponse=r._parseFragmentResponse.bind(r),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._isQualityMatched=function(e,t,r){var n,i,o,a;if(this._videoResolution){var s=null!==(n=this._videoResolution.max)&&void 0!==n?n:Number.MAX_SAFE_INTEGER,u=null!==(i=this._videoResolution.min)&&void 0!==i?i:0;if(r){var l=null!==(o=this._videoResolution.start)&&void 0!==o?o:s;return e.video_resolution<=l}return e.video_resolution>=u&&e.video_resolution<=s}var c=null!==(a=null==t?void 0:t.audio_bitrate)&&void 0!==a?a:0,d=this._abrManager.getBandwidthEstimate();return e.video_bitrate+c<2*d-1e5},t.prototype._updateVariants=function(e){var t,r=this._audioProfiles[0];this._audioProfile=null!=r?r:null;var n=this._videoProfiles,i=this._videoProfile,o=null,a=n.length;if(a){for(;a--;){var u=n[a];if(u&&this._isQualityMatched(u,r,!!e)){o=u;break}}o||(o=n[0]),this._videoProfile=o,(null==i?void 0:i.id)!==o.id&&(p.log("Video profile changed. ID "+o.id+" ("+o.video_codec+"), Bitrate "+o.video_bitrate+", "+o.video_width+"x"+o.video_height),null===(t=this._mediator)||void 0===t||t.emit(s.ContentMediatorEvent.VIDEO_PROFILE_CHANGED,{profile:{type:"video",mimeType:o.mime_type,codec:o.video_codec,bitrate:o.video_bitrate,height:o.video_height,width:o.video_width}}))}},t.prototype._constructFragmentURL=function(e,t,r){if(!t&&!r)throw new Error("Both audioProfile and videoProfile is null");return e.init?this._resolver.getInitSegmentURLs(this._baseURL,this._initTemplate,t,r):this._resolver.getSegmentURLs(this._baseURL,this._segmentTemplate,e.timeStart,t,r)},t.prototype._fetchBufferData=function(e,t,r,i){return this._transport.request(e,n.__assign(n.__assign({},h),{metadata:{timeStart:Date.now(),fragment:t,profile:r,loggingURL:i}})).then(this._parseFragmentResponse)},t.prototype._fetchInitSegmentBuffers=function(e,t){var r,n=this._initFragment;if(!n)return Promise.reject(new u.FileError(o.Errors.FILE_NOT_RESOLVED,"Cannot fetch Init Segment buffers: File not resolved."));try{r=this._constructFragmentURL(n,e,t)}catch(e){return Promise.reject(e)}var i=this._initSegments,a=Promise.resolve(null);e&&((null==(s=i[e.id])?void 0:s.buffer.byteLength)?a=Promise.resolve(s):(null==r?void 0:r.audio)&&(a=this._fetchBufferData(r.audio,n,e,r.audioLogging).then((function(t){return i[e.id]=t,t}))));var s,l=Promise.resolve(null);t&&((null==(s=i[t.id])?void 0:s.buffer.byteLength)?l=Promise.resolve(s):(null==r?void 0:r.video)&&(l=this._fetchBufferData(r.video,n,t,r.videoLogging).then((function(e){return i[t.id]=e,e}))));return Promise.all([a,l]).then((function(e){return{audio:e[0],video:e[1]}}))},t.prototype._fetchBufferForFragment=function(e,t,r){var n;try{n=this._constructFragmentURL(e,t,r)}catch(e){return Promise.reject(e)}return Promise.all([this._fetchInitSegmentBuffers(t,r),!e.init&&n.audio?this._fetchBufferData(n.audio,e,t,n.audioLogging):null,!e.init&&n.video?this._fetchBufferData(n.video,e,r,n.videoLogging):null]).then((function(t){var r,n,i,o=t[0],a=t[1],s=t[2];return e.init?i={audio:null!==(r=o.audio)&&void 0!==r?r:void 0,video:null!==(n=o.video)&&void 0!==n?n:void 0}:(i={audio:null!=a?a:void 0,video:null!=s?s:void 0},e.cacheBufferSet&&(e.bufferSet=i),i.audio&&(null==o?void 0:o.audio)&&(i.audio.initBuffer=o.audio.buffer),i.video&&(null==o?void 0:o.video)&&(i.video.initBuffer=o.video.buffer)),i})).catch((function(e){return Promise.reject(e)}))},t.prototype._parseFragmentResponse=function(e){var t,r,n,i,a=e.metadata,u=a.fragment,c=a.profile,d=a.timeStart,_=a.loggingURL,p=f(c),h=function(e){return e?"audio_bitrate"in e?e.audio_bitrate:e.video_bitrate:0}(c),y="video_resolution"in c?c.video_resolution:void 0,v=u.timeStart+"-"+u.timeEnd,E="video_resolution"in c?"video":"audio";switch(e.status){case 0:var m=new l.FragmentError(o.Errors.FRAGMENT_REQUEST_FAILED_WITH_ZERO,"Request failed with status 0.",0,{time_range:v,mimetype:p,resolution:y,bitrate:h});return null===(t=this._mediator)||void 0===t||t.emit(s.ContentMediatorEvent.FRAGMENT_FETCH_ERROR,{media_type:"video",segment_type:E,url:_,start_time:d,init:u.init,error:m}),Promise.reject(m);case 200:case 206:var g=e.body;if(!(null==g?void 0:g.byteLength)){var T=new l.FragmentError(o.Errors.FRAGMENT_REQUEST_EMPTY_RESPONSE,"Empty response for successful buffer.",e.status,{time_range:v,mimetype:p,resolution:y,bitrate:h});return null===(r=this._mediator)||void 0===r||r.emit(s.ContentMediatorEvent.FRAGMENT_FETCH_ERROR,{media_type:"video",segment_type:E,url:_,start_time:d,init:u.init,error:T}),Promise.reject(T)}var S=g.byteLength;this._abrManager.sample(S,Date.now()-d),this._updateVariants();var P=8e3*S/e.timing.completed;return null===(n=this._mediator)||void 0===n||n.emit(s.ContentMediatorEvent.FRAGMENT_FETCHED,{media_type:"video",segment_type:E,url:_,init:u.init,byte_length:S,start_time:d,end_time:Date.now(),bandwidth:P}),Promise.resolve({profileId:this._fileId+"-"+c.id,bufferURL:_,buffer:g,byteStart:0,byteEnd:S-1,mimetype:p,resolution:y,bitrate:h,bandwidth:P})}var b=new l.FragmentError(o.Errors.FRAGMENT_REQUEST_FAILED_WITH_STATUS,"Buffer request failed with status "+e.status,e.status,{time_range:v,mimetype:p,resolution:y,bitrate:h});return null===(i=this._mediator)||void 0===i||i.emit(s.ContentMediatorEvent.FRAGMENT_FETCH_ERROR,{media_type:"video",segment_type:E,url:_,init:u.init,start_time:d,error:b}),Promise.reject(b)},t.prototype._getHLSURLForProfile=function(e){for(var t=this._duration,r=this._segmentLength,n=this._segmentTemplate,i=[],o=0;o<t;o+=r){var a=o+r>t?t-o:r,s=n.replace("{{profile_id}}",e.id.toString(10)).replace("{{segment_timestamp}}",o.toString(10)).replace("{{file_type}}",e.file_type);i.push({duration:a,url:""+this._baseURL+s})}var u=("undefined"==typeof MediaSource?d.createProtectedManifestURL:d.createProtectedManifestDataURL)({assetID:this._assetId,targetDuration:r,segments:i});return this._hlsURLs.push(u),u},t.prototype._calculateFragments=function(e){this._duration=e.end_time_millis/1e3;var t=this._segmentLength;this._initFragment={init:!0,cacheBufferSet:!1,timeStart:-1,timeEnd:-1,byteRanges:{}};for(var r=0;r<this._duration;r+=t)this._fragments.push({cacheBufferSet:!r&&!this._disableCache,timeStart:r,timeEnd:r+t,byteRanges:{}})},t.prototype.setVideoResolution=function(e){this._videoResolution=n.__assign(n.__assign({},this._videoResolution),e),this._updateVariants()},t.prototype.getCurrentBitrate=function(){var e,t;return null!==(t=null===(e=this._videoProfile)||void 0===e?void 0:e.video_bitrate)&&void 0!==t?t:0},t.prototype.getBufferForFragment=function(e){var t;if(!e)return Promise.reject(new TypeError("No fragment provided"));var r=this._audioProfile,n=this._videoProfile;return e.bufferSet&&(!n||(null===(t=e.bufferSet.video)||void 0===t?void 0:t.resolution)&&e.bufferSet.video.resolution>=n.video_resolution)?Promise.resolve(e.bufferSet):this._fetchBufferForFragment(e,null!=r?r:void 0,null!=n?n:void 0)},t.prototype.clearCachedBuffers=function(){this._initFragment&&(this._initSegments={}),this._fragments.forEach((function(e){e.bufferSet=null}))},t.prototype.getDuration=function(){return this._endTime},t.prototype.getFragmentAfterTime=function(e){var t;if(!(null===(t=this._fragments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return this._fragments[1];for(var r=0,n=this._fragments;r<n.length;r++){var i=n[r];if(i.timeStart>e)return i}return null},t.prototype.getFragmentForTime=function(e){var t;if(!(null===(t=this._fragments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return this._fragments[0];for(var r=0,n=this._fragments;r<n.length;r++){var i=n[r];if(i.timeStart<=e&&i.timeEnd>=e)return i}return null},t.prototype.getSubtitleLanguages=function(){return this._subtitleLanguages},t.prototype.getSubtitles=function(){var e=this;return this._subtitleLanguages.map((function(t){return{lang:t,url:e._subtitleTemplate.replace("{{language_code}}",t)}}))},t.prototype.load=function(e){var t=this;if(void 0===e&&(e={resolveLatency:0,manifestLatency:0}),this._loaded)return e.resolveLatency=0,e.manifestLatency=0,Promise.resolve(this);if(!this._fileId)throw new TypeError("Missing: provide either fileId or resolvedURL");var r=Date.now();return this._resolver.getManifest(this._fileId,this._noAuth).then((function(n){var i,a,l,c;e.resolveLatency=0,e.manifestLatency=Date.now()-r;var d=n.contents[0];if(!d)return(c=new u.FileError(o.Errors.FILE_MALFORMED_SEEKTABLE,"Malformed seektable: no contents.")).track=t.toLogJSON(),Promise.reject(c);t._resolvedURLs=n.base_urls.slice();var f=n.base_urls,h=f[0],y=f.slice(1);h&&(t._baseURL=h,t._fallbackURLs=y),t._resolvedURL=t._baseURL,t._initTemplate=n.initialization_template,t._segmentTemplate=n.segment_template,t._segmentLength=d.segment_length;var v=void 0;if(null===(i=d.encryption_infos)||void 0===i?void 0:i.length){for(var E=d.encryption_infos,m=t._keySystemSettings.commonName,g=void 0,T=0,S=E.length;T<S;T++){var P=E[T];if(P&&P.key_system===m){v=T,g=P[t._keySystemSettings.pssh_field.video];break}}if(!g)return(c=new u.FileError(o.Errors.FILE_FORMAT_NOT_SUPPORTED,"KeySystem does not support the file format.")).track=t.toLogJSON(),Promise.reject(c);switch(t._keySystemSettings.commonName){case"widevine":case"playready":t._protection="cenc";try{t._psshBox=t._parsePSSHBox(g)}catch(e){return(c=new u.FileError(o.Errors.FILE_MALFORMED_PSSH,"Invalid PSSH value.")).track=t.toLogJSON(),Promise.reject(c)}break;case"fairplay":t._protection="hls",t._psshBox=new Uint8Array([]);try{t._assetId=t._parseAssetID(g)}catch(e){return(c=new u.FileError(o.Errors.FILE_MALFORMED_PSSH,"Invalid PSSH value.")).track=t.toLogJSON(),Promise.reject(c)}break;default:return(c=new u.FileError(o.Errors.FILE_FORMAT_NOT_SUPPORTED,"KeySystem does not support the file format.")).track=t.toLogJSON(),Promise.reject(c)}}return t._endTime=n.end_time_millis,t._videoProfiles=_.getPreferredProfiles({codec:"video_codec",formats:t._videoFormats,profiles:d.profiles,encryptionIndex:v,disallowProfile:t._disallowProfile,preferredKeySystem:t._keySystem,preferredVideoResolution:t._videoResolution,allowMixedAVC1Codecs:t._allowMixedAVC1Codecs}),t._audioProfiles=_.getPreferredProfiles({codec:"audio_codec",formats:t._audioFormats,profiles:d.profiles,encryptionIndex:v,preferredKeySystem:t._keySystem}),t._updateVariants(!0),t._calculateFragments(n),t._subtitleLanguages=n.subtitle_language_codes||[],null===(a=t._mediator)||void 0===a||a.emit(s.ContentMediatorEvent.SUBTITLE_LANGUAGES_LOADED,{languages:t._subtitleLanguages}),(null===(l=n.subtitle_base_urls)||void 0===l?void 0:l.length)&&n.subtitle_template?t._subtitleTemplate=""+n.subtitle_base_urls[0]+n.subtitle_template:(p.info("No subtitles available"),t._subtitleTemplate=""),t}))},t.prototype.adaptToBandwidth=function(){return this._updateVariants(),Promise.resolve(!0)},t.prototype.getResolveLatency=function(){},t.prototype.getPlayableCodecs=function(){var e,t;return[f(null!==(e=this._videoProfile)&&void 0!==e?e:void 0),f(null!==(t=this._audioProfile)&&void 0!==t?t:void 0)].filter((function(e){return!!e}))},t.prototype.getAudioProfile=function(){return this._audioProfile},t.prototype.getVideoProfile=function(){return this._videoProfile},t.prototype.getVideoProfiles=function(){return this._videoProfiles},t.prototype.getHLSURL=function(){if(!this._resolvedURL)throw new u.FileError(o.Errors.FILE_NOT_RESOLVED,"Cannot return HLS Manifest URL: File not resolved.");this.releaseHLSURL();var e=[],t=this._audioProfiles[0];t&&e.push('#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio",LANGUAGE="eng",NAME="English",AUTOSELECT=YES,URI="'+this._getHLSURLForProfile(t)+'"');for(var r=0,n=this._videoProfiles;r<n.length;r++){var i=n[r];e.push("#EXT-X-STREAM-INF:BANDWIDTH="+i.max_bitrate+",RESOLUTION="+i.video_width+"x"+i.video_height+',CODECS="'+((null==t?void 0:t.audio_codec)?"mp4a.40.2, "+i.video_codec:i.video_codec)+'"'+((null==t?void 0:t.audio_codec)?',AUDIO="audio"':"")+"\n"+this._getHLSURLForProfile(i))}var a="#EXTM3U\n"+e.join("\n"),s=("undefined"==typeof MediaSource?d.createHLSBlobURL:d.createHLSDataURL)(a);return this._hlsURLs.push(s),s},t.prototype.releaseHLSURL=function(){for(var e=0,t=this._hlsURLs;e<t.length;e++){var r=t[e];URL.revokeObjectURL(r)}this._hlsURLs=[]},t.prototype.canLowerBitrate=function(){var e,t=this._videoProfiles[0];return(null===(e=this._videoProfile)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)},t}(c.Content);r.VideoContent=y},{"../enums/content_mediator_event":57,"../enums/errors":58,"../enums/key_system":60,"../error/file":72,"../error/fragment":73,"./content":27,"./helpers/hls":40,"./helpers/preferred_profiles":41,"@js-sdk/debug-tools/es5":17,tslib:201}],54:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.VideoResolve=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/errors"),a=e("../enums/event"),s=e("../error/storage"),u=function(e){function t(t){var r=e.call(this)||this;return r._transport=t,r._parseManifestResponse=r._parseManifestResponse.bind(r),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._parseManifestResponse=function(e){var t,r=e.metadata.startTime;if(200!==e.status){var n=new s.StorageError(o.Errors.STORAGE_VIDEO_MANIFEST_FAILED,"Video manifest request failed with status "+e.status);return n.status=e.status,this.emit(a.Event.VIDEO_MANIFEST_RESOLVE_FAILED,{url:e.url,error:n,start_time:r}),Promise.reject(n)}var i=e.body,u=null===(t=e.headers)||void 0===t?void 0:t.get("content-length");return this.emit(a.Event.VIDEO_MANIFEST_RESOLVED,{url:e.url,manifest_size:u?parseInt(u,10):JSON.stringify(i).length,start_time:r,end_time:Date.now()}),Promise.resolve(i)},t.prototype.getInitSegmentURLs=function(e,t,r,n){var i="";r&&(i=e+t.replace("{{profile_id}}",r.id.toString(10)).replace("{{file_type}}",r.file_type));var o="";return n&&(o=e+t.replace("{{profile_id}}",n.id.toString(10)).replace("{{file_type}}",n.file_type)),{audio:i,video:o,audioLogging:i,videoLogging:o}},t.prototype.getSegmentURLs=function(e,t,r,n,i){var o="";n&&(o=e+t.replace("{{profile_id}}",n.id.toString(10)).replace("{{file_type}}",n.file_type));var a="";return i&&(a=e+t.replace("{{profile_id}}",i.id.toString(10)).replace("{{file_type}}",i.file_type)),{audio:o.replace("{{segment_timestamp}}",r.toString()),video:a.replace("{{segment_timestamp}}",r.toString()),audioLogging:o,videoLogging:a}},t.prototype.getManifest=function(e,t){void 0===t&&(t=!1);var r=(t?"@webgate/manifests/v8/unauth/json/sources":"@webgate/manifests/v7/json/sources")+"/"+e+"/options/supports_drm";return this._transport.request(r,{authorize:!t,responseType:"json",parseResponseHeaders:!0,retry:{condition:function(e,t){return e.getStatusFamily()!==t.SUCCESS}},metadata:{startTime:Date.now()}}).then(this._parseManifestResponse)},t}(i.EventEmitter);r.VideoResolve=u},{"../enums/errors":58,"../enums/event":59,"../error/storage":78,"@spotify-internal/emitter/es5":98,tslib:201}],55:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.AudioFileCodec=void 0;var i=e("./audio_file_format");r.AudioFileCodec=((n={})[i.AudioFileFormat.MP3_256]="audio/mp3",n[i.AudioFileFormat.MP3_320]="audio/mp3",n[i.AudioFileFormat.MP3_160]="audio/mp3",n[i.AudioFileFormat.MP3_96]="audio/mp3",n[i.AudioFileFormat.MP4_128]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_256]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_128_DUAL]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_256_DUAL]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_128_CBCS]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_256_CBCS]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_FLAC]='audio/mp4; codecs="flac"',n)},{"./audio_file_format":56}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioFileFormat=void 0,function(e){e[e.MP3_256=3]="MP3_256",e[e.MP3_320=4]="MP3_320",e[e.MP3_160=5]="MP3_160",e[e.MP3_96=6]="MP3_96",e[e.MP4_128=10]="MP4_128",e[e.MP4_256=11]="MP4_256",e[e.MP4_128_DUAL=12]="MP4_128_DUAL",e[e.MP4_256_DUAL=13]="MP4_256_DUAL",e[e.MP4_128_CBCS=14]="MP4_128_CBCS",e[e.MP4_256_CBCS=15]="MP4_256_CBCS",e[e.MP4_FLAC=17]="MP4_FLAC"}(r.AudioFileFormat||(r.AudioFileFormat={}))},{}],57:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ContentMediatorEvent=void 0,function(e){e.FRAGMENT_FETCHED="fragment_fetched",e.FRAGMENT_FETCH_ERROR="fragment_fetch_error",e.VIDEO_PROFILE_CHANGED="video_profile",e.SUBTITLE_LANGUAGES_LOADED="subtitle_languages_loaded"}(r.ContentMediatorEvent||(r.ContentMediatorEvent={}))},{}],58:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Errors=void 0,function(e){e.CAPPING_USER_IS_CAPPED="CAPPING_USER_IS_CAPPED",e.EME_API_NOT_SUPPORTED="EME_API_NOT_SUPPORTED",e.EME_MEDIA_KEYS_NOT_SUPPORTED="EME_MEDIA_KEYS_NOT_SUPPORTED",e.EME_MEDIA_KEY_SESSION_NOT_SUPPORTED="EME_MEDIA_KEY_SESSION_NOT_SUPPORTED",e.EME_NO_SUPPORTED_KEYSYSTEM="EME_NO_SUPPORTED_KEYSYSTEM",e.EME_PLAYER_MEDIA_KEYS_SETTING_FAILED="EME_PLAYER_MEDIA_KEYS_SETTING_FAILED",e.EME_ERROR_UNKNOWN="EME_ERROR_UNKNOWN",e.EME_LICENSE_REQUEST_EMPTY_RESPONSE="EME_LICENSE_REQUEST_EMPTY_RESPONSE",e.EME_LICENSE_REQUEST_FAILED_WITH_STATUS="EME_LICENSE_REQUEST_FAILED_WITH_STATUS",e.EME_LICENSE_REQUEST_WIDEVINE_ERROR="EME_LICENSE_REQUEST_WIDEVINE_ERROR",e.EME_LICENSE_UPDATE_FAILED="EME_LICENSE_UPDATE_FAILED",e.EME_HEADER_KEY_VALUE_MISMATCH="EME_HEADER_KEY_VALUE_MISMATCH",e.EME_HEADER_MISSING_CHALLENGE="EME_HEADER_MISSING_CHALLENGE",e.EME_INIT_DATA_MALFORMED="EME_INIT_DATA_MALFORMED",e.EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM="EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM",e.EME_MEDIA_KEY_SESSION_V0_1B_ERROR="EME_MEDIA_KEY_SESSION_V0_1B_ERROR",e.EME_MEDIA_KEY_SESSION_SAFARI_ERROR="EME_MEDIA_KEY_SESSION_SAFARI_ERROR",e.EME_NO_SUPPORTED_CONFIGURATION="EME_NO_SUPPORTED_CONFIGURATION",e.EME_NOT_SUPPORTED_ERROR="EME_NOT_SUPPORTED_ERROR",e.EME_INVALID_STATE_ERROR="EME_INVALID_STATE_ERROR",e.EME_UNKNOWN_ERROR="EME_UNKNOWN_ERROR",e.DISALLOW_PROTECTED_TRACK_ERROR="DISALLOW_PROTECTED_TRACK_ERROR",e.FILE_FORMAT_NOT_SUPPORTED="FILE_FORMAT_NOT_SUPPORTED",e.FILE_MALFORMED_SEEKTABLE="FILE_MALFORMED_SEEKTABLE",e.FILE_MALFORMED_PSSH="FILE_MALFORMED_PSSH",e.FILE_NOT_RESOLVED="FILE_NOT_RESOLVED",e.FRAGMENT_ONLINE_REQUEST_FAILED_WITH_ZERO="FRAGMENT_ONLINE_REQUEST_FAILED_WITH_ZERO",e.FRAGMENT_OFFLINE_REQUEST_FAILED_WITH_ZERO="FRAGMENT_OFFLINE_REQUEST_FAILED_WITH_ZERO",e.FRAGMENT_REQUEST_FAILED_WITH_ZERO="FRAGMENT_REQUEST_FAILED_WITH_ZERO",e.FRAGMENT_REQUEST_FAILED_WITH_STATUS="FRAGMENT_REQUEST_FAILED_WITH_STATUS",e.FRAGMENT_REQUEST_EMPTY_RESPONSE="FRAGMENT_REQUEST_EMPTY_RESPONSE",e.FRAGMENT_REQUEST_UNEXPECTED_LENGTH="FRAGMENT_REQUEST_UNEXPECTED_LENGTH",e.PLAYER_ATTEMPTED_VOLUME_OUT_OF_RANGE="PLAYER_ATTEMPTED_VOLUME_OUT_OF_RANGE",e.PLAYER_BUFFER_QUOTA_EXCEEDED="PLAYER_BUFFER_QUOTA_EXCEEDED",e.PLAYER_CANNOT_FIND_PLAYABLE_URI="PLAYER_CANNOT_FIND_PLAYABLE_URI",e.PLAYER_INVALID_INTERNAL_STATE="PLAYER_INVALID_INTERNAL_STATE",e.PLAYER_MEDIA_ERROR="PLAYER_MEDIA_ERROR",e.PLAYER_PLAYBACK_ERROR="PLAYER_PLAYBACK_ERROR",e.MEDIA_ABORTED="MEDIA_ABORTED",e.MEDIA_DECODING_ERROR="MEDIA_DECODING_ERROR",e.MEDIA_NETWORK_ERROR="MEDIA_NETWORK_ERROR",e.MEDIA_NOT_SUPPORTED="MEDIA_NOT_SUPPORTED",e.LICENSE_RESOLVE_INVALID_RESPONSE="LICENSE_RESOLVE_INVALID_RESPONSE",e.LICENSE_RESOLVER_CANT_RESOLVE_URL="LICENSE_RESOLVER_CANT_RESOLVE_URL",e.LICENSE_RESOLVER_DEPRECATED_VERSION="LICENSE_RESOLVER_DEPRECATED_VERSION",e.LIST_PLAYER_NO_TRACK_PLAYER="LIST_PLAYER_NO_TRACK_PLAYER",e.LIST_PLAYER_NO_LIST="LIST_PLAYER_NO_LIST",e.LIST_PLAYER_INVALID_ARGUMENT="LIST_PLAYER_INVALID_ARGUMENT",e.LIST_PLAYER_FORBIDDEN="LIST_PLAYER_FORBIDDEN",e.STORAGE_ERROR="STORAGE_ERROR",e.STORAGE_FAILED_WITH_STATUS="STORAGE_FAILED_WITH_STATUS",e.STORAGE_RETURNED_NO_TRACKS="STORAGE_RETURNED_NO_TRACKS",e.STORAGE_TRACK_MANIFEST_FAILED="STORAGE_TRACK_MANIFEST_FAILED",e.STORAGE_TRACK_MANIFEST_EMPTY="STORAGE_TRACK_MANIFEST_EMPTY",e.STORAGE_VIDEO_MANIFEST_FAILED="STORAGE_VIDEO_MANIFEST_FAILED",e.TRACK_DATA_ALREADY_FINALIZED="TRACK_DATA_ALREADY_FINALIZED",e.TSV_SENDING_FAILED="TSV_SENDING_FAILED",e.PLAYBACK_STATS_SENDING_FAILED="PLAYBACK_STATS_SENDING_FAILED",e.PLAYBACK_START_SENDING_FAILED="PLAYBACK_START_SENDING_FAILED",e.UNKNOWN="UNKNOWN"}(r.Errors||(r.Errors={}))},{}],59:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Event=void 0,function(e){e.KEY_SESSION_MESSAGE="message",e.KEY_SESSION_STATUSES_CHANGE="keystatuseschange",e.MEDIA_SOURCE_OPEN="sourceopen",e.MEDIA_SOURCE_CLOSE="sourceclose",e.SOURCE_BUFFER_UPDATE_END="updateend",e.MS_KEY_ADDED="mskeyadded",e.MS_KEY_ERROR="mskeyerror",e.MS_KEY_MESSAGE="mskeymessage",e.MS_NEEDKEY="msneedkey",e.WEBKIT_KEY_ADDED="webkitkeyadded",e.WEBKIT_KEY_ERROR="webkitkeyerror",e.WEBKIT_KEY_MESSAGE="webkitkeymessage",e.WEBKIT_NEEDKEY="webkitneedkey",e.V0_1B_KEY_ADDED="keyadded",e.V0_1B_KEY_ERROR="keyerror",e.V0_1B_KEY_MESSAGE="keymessage",e.V0_1B_NEEDKEY="needkey",e.MEDIA_CANPLAY="canplay",e.MEDIA_CANPLAYTHROUGH="canplaythrough",e.MEDIA_DURATIONCHANGE="durationchange",e.MEDIA_ENCRYPTED="encrypted",e.MEDIA_ENDED="ended",e.MEDIA_ERROR="error",e.MEDIA_LOADEDMETADATA="loadedmetadata",e.MEDIA_PAUSE="pause",e.MEDIA_PLAY="play",e.MEDIA_PLAYING="playing",e.MEDIA_SEEKING="seeking",e.MEDIA_TIMEUPDATE="timeupdate",e.MEDIA_WAITING="waiting",e.MEDIA_RATECHANGE="ratechange",e.MEDIA_RESIZE="resize",e.INTERNAL_ENCRYPTED="__encrypted",e.INTERNAL_PLAYER_CANPLAY="__canplay",e.INTERNAL_PLAYER_CANPLAYTHROUGH="__canplaythrough",e.INTERNAL_MEDIA_REQUIRES_DURATION="__requiresduration",e.INTERNAL_PLAYER_LOADED_METADATA="__loadedmetadata",e.BUFFER_APPEND_ERROR="append_error",e.BUFFER_QUOTA_EXCEEDED="quota_exceeded",e.BUFFER_STALLED="stalled",e.BUFFER_SOURCE_OPEN="source_open",e.BUFFER_SOURCE_CLOSE="source_close",e.BUFFERING_START="buffering_start",e.BUFFERING_END="buffering_end",e.EME_LICENSE_REQUEST_ERROR="license_request_error",e.EME_LICENSE_REQUEST_CAPPED="license_request_capped",e.LIST_PLAYER_AUTOPLAY_FAILED="player_autoplay_failed",e.LIST_PLAYER_BEFORE_LIST_CHANGE="before_list_change",e.LIST_PLAYER_BEFORE_NEXT="before_next",e.LIST_PLAYER_BEFORE_PLAYER_LOAD="before_player_load",e.LIST_PLAYER_BEFORE_PREVIOUS="before_previous",e.LIST_PLAYER_BEFORE_TRACK_LOAD="before_track_load",e.LIST_PLAYER_BEFORE_VOLUME_CHANGE="before_volume_change",e.LIST_PLAYER_BUFFER_STALLED="stalled",e.LIST_PLAYER_BUFFERING_START="buffering_start",e.LIST_PLAYER_BUFFERING_END="buffering_end",e.LIST_PLAYER_CAPPED="capped",e.LIST_PLAYER_CLEARED="cleared",e.LIST_PLAYER_DURATION_CHANGED="duration_changed",e.LIST_PLAYER_ERROR="error",e.LIST_PLAYER_ERROR_SYNC="error_sync",e.LIST_PLAYER_LIST_CHANGED="list_change",e.LIST_PLAYER_LIST_ENDED="list_ended",e.LIST_PLAYER_LOAD_VIDEO="load_video",e.LIST_PLAYER_MAX_LIST_ERRORS_REACHED="max_list_errors_reached",e.LIST_PLAYER_PAUSED="paused",e.LIST_PLAYER_PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.LIST_PLAYER_PLAYER_LOAD="player_load",e.LIST_PLAYER_PLAYING="playing",e.LIST_PLAYER_POSITION_CHANGED="position_changed",e.LIST_PLAYER_PROGRESS="progress",e.LIST_PLAYER_REPEAT_MODE_CHANGED="repeat_mode_changed",e.LIST_PLAYER_SHUFFLE_CHANGED="shuffle_changed",e.LIST_PLAYER_STOPPED="stopped",e.LIST_PLAYER_STOPPED_VIDEO="stopped_video",e.LIST_PLAYER_TRACKING_DATA_CREATED="tracking_data_created",e.LIST_PLAYER_TRACKING_DATA_FINALIZED="tracking_data_finalized",e.LIST_PLAYER_TRACK_ENDED="track_ended",e.LIST_PLAYER_TRACK_LOADED="track_loaded",e.LIST_PLAYER_TRACK_TIMEOUT="track_timeout",e.LIST_PLAYER_TRACK_UNPLAYABLE="track_unplayable",e.LIST_PLAYER_DATA_CREATED="tracking_data_created",e.LIST_PLAYER_DATA_FINALIZED="tracking_data_finalized",e.LIST_PLAYER_VOLUME_CHANGED="volume_changed",e.LIST_PLAYER_VIDEO_ELEMENT_APPENDED="video_element_appended",e.LIST_PLAYER_VIDEO_ELEMENT_REMOVED="video_element_removed",e.LIST_PLAYER_VIDEO_PROFILE_CHANGED="video_profile_changed",e.LIST_PLAYER_SEEK_HANDLED="list_player_seek_handled",e.LIST_PLAYER_DISPLAYED_CUES_CHANGED="displayed_cues_changed",e.LIST_PLAYER_PLAYBACK_SPEED_CHANGED="playback_speed_changed",e.LIST_PLAYER_SUBTITLE_LANGUAGES_LOADED="subtitle_languages_loaded",e.LOGGER_ERROR="error",e.PLAYER_AUTOPLAY_FAILED="player_autoplay_failed",e.PLAYER_BEFORE_LOAD="before_load",e.PLAYER_BEFORE_STOP="before_stop",e.PLAYER_BEFORE_VOLUME_CHANGE="before_volume_change",e.PLAYER_BUFFER_STALLED="stalled",e.PLAYER_BUFFERING_START="buffering_start",e.PLAYER_BUFFERING_END="buffering_end",e.PLAYER_CAN_PRELOAD="can_preload",e.PLAYER_CAPPED="capped",e.PLAYER_DURATION_CHANGED="duration_changed",e.PLAYER_ENDED="ended",e.PLAYER_ENDED_VIDEO="ended_video",e.PLAYER_ERROR="error",e.PLAYER_WARNING="warning",e.PLAYER_FIRST_BYTES="first_bytes",e.PLAYER_KEY_RECEIVED="key",e.PLAYER_LOAD="load",e.PLAYER_LOAD_VIDEO="load_video",e.PLAYER_LOADING_FAILED="loading_failed",e.PLAYER_PAUSED="paused",e.PLAYER_PLAY="play",e.PLAYER_PLAYING="playing",e.PLAYER_POSITION_CHANGED="position_changed",e.PLAYER_PRELOADING_ERROR="preloading_error",e.PLAYER_PROGRESS="progress",e.PLAYER_STALLED="stalled",e.PLAYER_STOPPED="stopped",e.PLAYER_STOPPED_VIDEO="stopped_video",e.PLAYER_PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.PLAYER_TIMEOUT="timeout",e.PLAYER_PLAYBACK_START="playback_start",e.PLAYER_TRACKING_DATA_CREATED="tracking_data_created",e.PLAYER_TRACKING_DATA_FINALIZED="tracking_data_finalized",e.PLAYER_VIDEO_ELEMENT_APPENDED="video_element_appended",e.PLAYER_VIDEO_ELEMENT_REMOVED="video_element_removed",e.PLAYER_VIDEO_PROFILE_CHANGED="video_profile_changed",e.PLAYER_DISPLAYED_CUES_CHANGED="displayed_cues_changed",e.PLAYER_SEEKING="seeking",e.PLAYER_FRAGMENT_FETCHED="fragment_fetched",e.PLAYER_FRAGMENT_FETCH_ERROR="fragment_fetch_error",e.PLAYER_VIDEO_MANIFEST_RESOLVED="video_manifest_resolved",e.PLAYER_VIDEO_MANIFEST_RESOLVE_FAILED="video_manifest_resolve_failed",e.PLAYER_PLAYBACK_SPEED_CHANGED="playback_speed_changed",e.PLAYER_SUBTITLE_LANGUAGES_LOADED="subtitle_languages_loaded",e.PLAYER_VIDEO_RESIZED="resize",e.PLAYER_MANAGER_READY="ready",e.TRACKER_PLAYBACK_START="playback_start",e.TRACKER_PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.TRACKER_TRACKING_DATA_CREATED="tracking_data_created",e.TRACKER_TRACKING_DATA_FINALIZED="tracking_data_finalized",e.VIDEO_MANIFEST_RESOLVED="video_manifest_resolved",e.VIDEO_MANIFEST_RESOLVE_FAILED="video_manifest_resolve_failed",e.ABR_MANAGER_BITRATE_CHANGE="bitrate_change"}(r.Event||(r.Event={}))},{}],60:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.KeySystem=void 0,function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready",e.PLAYREADY_HARDWARE="com.microsoft.playready.hardware",e.FAIRPLAY="com.apple.fps.1_0",e.INVALID_SPOTIFY_KEY="com.spotify.invalid"}(r.KeySystem||(r.KeySystem={}))},{}],61:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ListConstants=void 0,function(e){e.NULL_VALUE="NULL_VALUE",e.LIST_START="LIST_START",e.LIST_END="LIST_END",e.FORBIDDEN="FORBIDDEN",e.IGNORE="IGNORE",e.PAUSE="PAUSE"}(r.ListConstants||(r.ListConstants={}))},{}],62:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MediaFormat=void 0,function(e){e.MP3="MP3",e.MP4="MP4",e.MP4_DUAL="MP4_DUAL",e.MP4_CBCS="MP4_CBCS",e.MP4_FLAC="MP4_FLAC",e.MANIFEST_ID="MANIFEST_ID"}(r.MediaFormat||(r.MediaFormat={}))},{}],63:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MediaCodec=r.MediaContainer=void 0,function(e){e.MP4_AUDIO="audio/mp4",e.MP4_VIDEO="video/mp4",e.MTS_VIDEO="video/mp2t",e.WEBM_AUDIO="audio/webm",e.WEBM_VIDEO="video/webm"}(r.MediaContainer||(r.MediaContainer={})),function(e){e.AAC_LC="mp4a.40.2",e.FLAC="flac",e.OPUS="opus",e.VP9="vp9",e.VP8="vp8",e.H264_31="avc1.4d401f"}(r.MediaCodec||(r.MediaCodec={}))},{}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OperationResult=void 0,function(e){e.SUCCESS="RESULT_SUCCESS",e.INVALID="RESULT_INVALID",e.FORBIDDEN="RESULT_FORBIDDEN",e.OUT_OF_BOUNDS="RESULT_OUT_OF_BOUNDS",e.NO_LIST="RESULT_NO_LIST",e.NO_TRACK="RESULT_NO_TRACK",e.LIST_END="RESULT_LIST_END",e.INVALID_TRACK="RESULT_INVALID_TRACK",e.CANCELLED="CANCELLED",e.NO_TRACK_PLAYER="NO_TRACK_PLAYER"}(r.OperationResult||(r.OperationResult={}))},{}],65:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlaybackQuality=void 0,function(e){e.UNKNOWN="UNKNOWN",e.DEFAULT="DEFAULT",e.LOW="LOW",e.NORMAL="NORMAL",e.HIGH="HIGH",e.VERY_HIGH="VERY_HIGH",e.HIFI="HIFI"}(r.PlaybackQuality||(r.PlaybackQuality={}))},{}],66:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Reason=void 0,function(e){e.APPLOAD="appload",e.BACK_BUTTON="backbtn",e.CLICK_ROW="clickrow",e.CLICK_SIDE="clickside",e.END_PLAY="endplay",e.FORWARD_BUTTON="fwdbtn",e.LOGOUT="logout",e.PLAY_BUTTON="playbtn",e.POPUP="popup",e.REMOTE="remote",e.TRACK_DONE="trackdone",e.TRACK_ERROR="trackerror",e.UNKNOWN="unknown",e.URI_OPEN="uriopen",e.CAPPED="capped",e.SEEK="seek"}(r.Reason||(r.Reason={}))},{}],67:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RepeatMode=void 0,function(e){e.NONE="NONE",e.CONTEXT="CONTEXT",e.TRACK="TRACK"}(r.RepeatMode||(r.RepeatMode={}))},{}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Robustness=void 0,function(e){e.EMPTY="EMPTY",e.SW_CRYPTO="SW_CRYPTO",e.SW_DECODE="SW_DECODE",e.HW_CRYPTO="HW_CRYPTO",e.HW_DECODE="HW_DECODE",e.HW_ALL="HW_ALL"}(r.Robustness||(r.Robustness={}))},{}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SubtitleMode=void 0,function(e){e.SHOWING="showing",e.HIDDEN="hidden"}(r.SubtitleMode||(r.SubtitleMode={}))},{}],70:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CappingError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.name="CappingError",n.message=r,n.code=t,n}return n.__extends(t,e),t}(Error);r.CappingError=i},{tslib:201}],71:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EMEError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r){void 0===t&&(t=i.Errors.EME_ERROR_UNKNOWN);var n=e.call(this,r)||this;return n.status=-1,n.licenseServer="",n.shouldRefreshEndpoint=!1,n.unrecoverable=!1,n.debug={},n.code=t,n.message=r,n.name="EMEError",n}return n.__extends(t,e),t.fatal=function(e,r){void 0===e&&(e=i.Errors.EME_ERROR_UNKNOWN);var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.EMEError=o},{"../enums/errors":58,tslib:201}],72:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FileError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r){void 0===t&&(t=i.Errors.STORAGE_ERROR),void 0===r&&(r="File Error");var n=e.call(this,r)||this;return n.canPlayNext=!0,n.debug={},n.code=t,n.message=r,n.name="FileError",n}return n.__extends(t,e),t}(Error);r.FileError=o},{"../enums/errors":58,tslib:201}],73:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FragmentError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n,i){void 0===i&&(i={});var o=e.call(this,r)||this;return o.code=t,o.message=r,o.status=n,o.debug=i,o.name="FragmentError",o}return n.__extends(t,e),t}(Error);r.FragmentError=i},{tslib:201}],74:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LicenseError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this)||this;return n.status=-1,n.debug={},n.canPlayNext=!0,n.unrecoverable=!1,n.name="LicenseError",n.code=t,n.message=r,n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n.canPlayNext=!1,n},t}(Error);r.LicenseError=i},{tslib:201}],75:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoggingError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.debug={},n.name="LoggingError",n.message=r,n.code=t,n}return n.__extends(t,e),t}(Error);r.LoggingError=i},{tslib:201}],76:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlaybackError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this)||this;return n.unrecoverable=!1,n.listPlayerIgnore=!1,n.debug={},n.name="PlaybackError",n.code=t,n.message=r,n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.PlaybackError=i},{tslib:201}],77:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlaybackError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.unrecoverable=!1,n.listPlayerIgnore=!1,n.debug={},n.code=t,n.message=r,n.name="PlaybackError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.PlaybackError=i},{tslib:201}],78:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StorageError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r){void 0===t&&(t=i.Errors.STORAGE_ERROR),void 0===r&&(r="Storage Error");var n=e.call(this,r)||this;return n.status=-1,n.fileId="",n.debug={},n.canPlayNext=!0,n.code=t,n.message=r,n.name="StorageError",n}return n.__extends(t,e),t}(Error);r.StorageError=o},{"../enums/errors":58,tslib:201}],79:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackingError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.debug={},n.name="TrackingError",n.message=r,n.code=t,n}return n.__extends(t,e),t}(Error);r.TrackingError=i},{tslib:201}],80:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createPlayer=r.ListPlayer=r.Robustness=r.RepeatMode=r.PlaybackQuality=r.Reason=r.OperationResult=r.MediaFormat=r.MediaCodec=r.ListConstants=r.KeySystem=r.PlaybackEvent=r.Errors=r.AudioFileFormat=void 0;var n=e("tslib"),i=e("@js-sdk/mux-embed-ts/dist/mux"),o=e("@js-sdk/debug-tools/es5"),a=e("./_internal/player"),s=e("./_internal/logging/logger"),u=e("./_internal/storage_resolve"),l=e("./_internal/tracker"),c=e("./_internal/video_resolve"),d=e("./_internal/license_url_resolver"),_=e("./_internal/logging/log_sender"),p=e("./_internal/mux_reporter"),f=e("./enums/audio_file_format");Object.defineProperty(r,"AudioFileFormat",{enumerable:!0,get:function(){return f.AudioFileFormat}});var h=e("./enums/errors");Object.defineProperty(r,"Errors",{enumerable:!0,get:function(){return h.Errors}});var y=e("./enums/event");Object.defineProperty(r,"PlaybackEvent",{enumerable:!0,get:function(){return y.Event}});var v=e("./enums/key_system");Object.defineProperty(r,"KeySystem",{enumerable:!0,get:function(){return v.KeySystem}});var E=e("./enums/list_constants");Object.defineProperty(r,"ListConstants",{enumerable:!0,get:function(){return E.ListConstants}});var m=e("./enums/media_types");Object.defineProperty(r,"MediaCodec",{enumerable:!0,get:function(){return m.MediaCodec}});var g=e("./enums/media_format");Object.defineProperty(r,"MediaFormat",{enumerable:!0,get:function(){return g.MediaFormat}});var T=e("./enums/operation_result");Object.defineProperty(r,"OperationResult",{enumerable:!0,get:function(){return T.OperationResult}});var S=e("./enums/reason");Object.defineProperty(r,"Reason",{enumerable:!0,get:function(){return S.Reason}});var P=e("./enums/playback_quality");Object.defineProperty(r,"PlaybackQuality",{enumerable:!0,get:function(){return P.PlaybackQuality}});var b=e("./enums/repeat_mode");Object.defineProperty(r,"RepeatMode",{enumerable:!0,get:function(){return b.RepeatMode}});var R=e("./enums/robustness");Object.defineProperty(r,"Robustness",{enumerable:!0,get:function(){return R.Robustness}});var A=e("./listplayer");Object.defineProperty(r,"ListPlayer",{enumerable:!0,get:function(){return A.ListPlayer}});var I=o.logging.forTag("playback.init");r.createPlayer=function(e){return new Promise((function(t,r){var o,f,h,y,v,E,m;if(e.transport){if("undefined"!=typeof window)("boolean"==typeof window.isSecureContext?window.isSecureContext:function(){if("undefined"==typeof window||!window.location)return!1;var e=window.location;if("https"===e.protocol||"file"===e.protocol)return!0;var t=e.hostname;return!!/^127(\.[0-255]){3}$|^locahost\.?$|\.localhost\.?$/.test(t)}())||null===(o=window.console)||void 0===o||o.warn("%cDRM might not be available from unsecure contexts","background: #222; color: #bada55; font-size: 40px");var g=e.transport,T=(e.sdkId||"").split(":"),S=T[0],P=void 0===S?"":S,b=T[1],R=void 0===b?"":b,A=n.__assign(n.__assign({},e),{tracker:l.Tracker.create(),audioResolver:new u.StorageResolve(g),videoResolver:new c.VideoResolve(g),licenseURLResolver:new d.LicenseURLResolver({transport:g,sdk:{name:P,version:R},securityLevel:e.securityLevel,useTestLicenseServer:e.useTestLicenseServer}),newBufferPerTrack:null===(f=e.newBufferPerTrack)||void 0===f||f,preinitMediaElement:null===(h=e.preinitMediaElement)||void 0===h||h});e.unauthenticatedLogs&&!(null===(y=e.loggerOptions)||void 0===y?void 0:y.endpoint)&&(e.loggerOptions=n.__assign(n.__assign({},e.loggerOptions),{endpoint:"https://spclient.wg.spotify.com/melody/unauth"})),(null===(v=null==e?void 0:e.loggerOptions)||void 0===v?void 0:v.deviceInfo)||Promise.all([null===(E=e.loggerOptions)||void 0===E?void 0:E.platform,null===(m=e.loggerOptions)||void 0===m?void 0:m.clientVersion]).then((function(t){var r=t[0],i=t[1];e.loggerOptions=n.__assign(n.__assign({},e.loggerOptions),{deviceInfo:{platform:r,version:i}})})),a.Player.create(A).then((function(t){var r=n.__assign({disableMux:!0},e.loggerOptions),o=_.createLogSender(n.__assign(n.__assign({},r),{transport:g,sdkId:e.sdkId,platform:Promise.resolve(r.deviceInfo).then((function(e){var t;return null!==(t=null==e?void 0:e.platform)&&void 0!==t?t:""})),clientVersion:Promise.resolve(r.deviceInfo).then((function(e){var t;return null!==(t=null==e?void 0:e.version)&&void 0!==t?t:""}))})),a=s.Logger.create({transport:g,player:t,logSender:o});return r.disableMux||p.MuxReporter.create({player:t,mux:i,envKey:null==r?void 0:r.muxEnvKey,sdk:P,sdkVersion:R,deviceInfo:r.deviceInfo,muxCustomDimensions:r.muxCustomDimensions}).ready().then((function(){return I.info("MuxReporter ready")}),(function(e){return I.error("Failed to instantiate MuxReporter",null==e?void 0:e.message)})),{player:t,logger:a}})).then(t,r)}else r(new TypeError("Argument transport is required."))}))}},{"./_internal/license_url_resolver":42,"./_internal/logging/log_sender":43,"./_internal/logging/logger":44,"./_internal/mux_reporter":46,"./_internal/player":47,"./_internal/storage_resolve":49,"./_internal/tracker":51,"./_internal/video_resolve":54,"./enums/audio_file_format":56,"./enums/errors":58,"./enums/event":59,"./enums/key_system":60,"./enums/list_constants":61,"./enums/media_format":62,"./enums/media_types":63,"./enums/operation_result":64,"./enums/playback_quality":65,"./enums/reason":66,"./enums/repeat_mode":67,"./enums/robustness":68,"./listplayer":81,"@js-sdk/debug-tools/es5":17,"@js-sdk/mux-embed-ts/dist/mux":22,tslib:201}],81:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ListPlayer=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/promise_resolver"),a=e("./enums/errors"),s=e("./enums/operation_result"),u=e("./enums/repeat_mode"),l=e("./enums/list_constants"),c=e("./enums/reason"),d=e("./enums/event"),_=e("./error/playback");function p(e){return"uri"in e}var f=function(e){function t(t){var r=e.call(this)||this;if(r._trackPlayerPromise=o.createPromiseResolver(),r._maxListErrors=5,r._uid=0,r._loadedList=null,r._loadedOptions=null,r._currentTrack=null,r._currentTrackOptions=null,r._listPlayCount=0,r._listErrorCount=0,r._shuffled=!1,r._repeatMode=u.RepeatMode.NONE,r._currentSeqId=0,!t.trackPlayer)throw new TypeError("Argument `options.trackPlayerManager` not found.");return t.maxListErrors&&(r._maxListErrors=t.maxListErrors),r._setListOptions=r._setListOptions.bind(r),r._replaceCurrentList=r._replaceCurrentList.bind(r),r._handleCapped=r._handleCapped.bind(r),r._handlePlaying=r._handlePlaying.bind(r),r._handlePaused=r._handlePaused.bind(r),r._handleEnded=r._handleEnded.bind(r),r._handleCanPreload=r._handleCanPreload.bind(r),r._handleError=r._handleError.bind(r),r._handlePositionChanged=r._handlePositionChanged.bind(r),r._handleDurationChanged=r._handleDurationChanged.bind(r),r._handleTimeout=r._handleTimeout.bind(r),r._handlePlayerInitError=r._handlePlayerInitError.bind(r),r._handleProgress=r._handleProgress.bind(r),r._handlePlayedThresholdReached=r._handlePlayedThresholdReached.bind(r),r._handleBeforeLoad=r._handleBeforeLoad.bind(r),r._init(t.trackPlayer),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(e){var t=this;this._trackPlayerPromise.promise.catch((function(){})),Promise.resolve(e).then((function(e){t._attachPlayerEvents(e),t._trackPlayerPromise.resolve(e)})).catch(this._handlePlayerInitError)},t.prototype._attachPlayerEvents=function(e){var t,r,n;e.addListeners(((t={})[d.Event.PLAYER_CAN_PRELOAD]=this._handleCanPreload,t[d.Event.PLAYER_CAPPED]=this._handleCapped,t[d.Event.PLAYER_ENDED]=this._handleEnded,t[d.Event.PLAYER_ERROR]=this._handleError,t[d.Event.PLAYER_PAUSED]=this._handlePaused,t[d.Event.PLAYER_PLAYING]=this._handlePlaying,t[d.Event.PLAYER_TIMEOUT]=this._handleTimeout,t[d.Event.PLAYER_POSITION_CHANGED]=this._handlePositionChanged,t[d.Event.PLAYER_DURATION_CHANGED]=this._handleDurationChanged,t[d.Event.PLAYER_PROGRESS]=this._handleProgress,t[d.Event.PLAYER_BEFORE_LOAD]=this._handleBeforeLoad,t[d.Event.PLAYER_PLAYED_THRESHOLD_REACHED]=this._handlePlayedThresholdReached,t)),this.proxyEmitAllSync(e,((r={})[d.Event.PLAYER_BEFORE_VOLUME_CHANGE]=d.Event.LIST_PLAYER_BEFORE_VOLUME_CHANGE,r[d.Event.PLAYER_LOAD]=d.Event.LIST_PLAYER_PLAYER_LOAD,r)),this.proxyEmitAll(e,((n={})[d.Event.PLAYER_AUTOPLAY_FAILED]=d.Event.LIST_PLAYER_AUTOPLAY_FAILED,n[d.Event.PLAYER_TRACKING_DATA_CREATED]=d.Event.LIST_PLAYER_TRACKING_DATA_CREATED,n[d.Event.PLAYER_TRACKING_DATA_FINALIZED]=d.Event.LIST_PLAYER_TRACKING_DATA_FINALIZED,n[d.Event.PLAYER_BUFFER_STALLED]=d.Event.LIST_PLAYER_BUFFER_STALLED,n[d.Event.PLAYER_BUFFERING_START]=d.Event.LIST_PLAYER_BUFFERING_START,n[d.Event.PLAYER_BUFFERING_END]=d.Event.LIST_PLAYER_BUFFERING_END,n[d.Event.PLAYER_VIDEO_ELEMENT_APPENDED]=d.Event.LIST_PLAYER_VIDEO_ELEMENT_APPENDED,n[d.Event.PLAYER_VIDEO_ELEMENT_REMOVED]=d.Event.LIST_PLAYER_VIDEO_ELEMENT_REMOVED,n[d.Event.PLAYER_DISPLAYED_CUES_CHANGED]=d.Event.LIST_PLAYER_DISPLAYED_CUES_CHANGED,n[d.Event.LIST_PLAYER_VIDEO_PROFILE_CHANGED]=d.Event.PLAYER_VIDEO_PROFILE_CHANGED,n[d.Event.LIST_PLAYER_PLAYBACK_SPEED_CHANGED]=d.Event.PLAYER_PLAYBACK_SPEED_CHANGED,n[d.Event.LIST_PLAYER_SUBTITLE_LANGUAGES_LOADED]=d.Event.PLAYER_SUBTITLE_LANGUAGES_LOADED,n))},t.prototype._translatePosition=function(e){var t,r,n;return null!==(n=null===(r=null===(t=this._loadedList)||void 0===t?void 0:t.translatePosition)||void 0===r?void 0:r.call(t,e))&&void 0!==n?n:e},t.prototype._translateDuration=function(e){var t,r,n;return null!==(n=null===(r=null===(t=this._loadedList)||void 0===t?void 0:t.translateDuration)||void 0===r?void 0:r.call(t,e))&&void 0!==n?n:e},t.prototype._handleProgress=function(e){var t=e.data;this.emit(d.Event.LIST_PLAYER_PROGRESS,n.__assign(n.__assign({},t),{position:this._translatePosition(t.position)}))},t.prototype._handleBeforeLoad=function(e){var t=e.data;this.emit(d.Event.LIST_PLAYER_BEFORE_PLAYER_LOAD,n.__assign(n.__assign({},t),{options:n.__assign(n.__assign({},t.options),{position:this._translatePosition(t.options.position)})}))},t.prototype._handlePlayerInitError=function(e){this._trackPlayerPromise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_TRACK_PLAYER,e.message||"Track player promise was rejected."))},t.prototype._handleCapped=function(){var e=this._currentTrack;e&&this.emit(d.Event.LIST_PLAYER_CAPPED,{uid:this._uid,track:e,options:this._currentTrackOptions,list:this._loadedList})},t.prototype._handlePlaying=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_PLAYING,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position)})},t.prototype._handlePaused=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_PAUSED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position)})},t.prototype._handleCanPreload=function(){this._preloadUpcomingTrack().catch((function(){}))},t.prototype._handleEnded=function(){var e=this._currentTrack;e&&(this.emit(d.Event.LIST_PLAYER_TRACK_ENDED,{uid:this._uid,track:e,options:this._currentTrackOptions,list:this._loadedList}),this.next(c.Reason.TRACK_DONE))},t.prototype._handleTimeout=function(){var e=this._currentTrack;e&&(this.emit(d.Event.LIST_PLAYER_TRACK_TIMEOUT,{uid:this._uid,track:e,options:this._currentTrackOptions,list:this._loadedList}),this.next(c.Reason.TRACK_ERROR))},t.prototype._handlePositionChanged=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_POSITION_CHANGED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position)})},t.prototype._handleDurationChanged=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_DURATION_CHANGED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position),duration:this._translateDuration(e.data.duration)})},t.prototype._handlePlayedThresholdReached=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_PLAYED_THRESHOLD_REACHED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,threshold:e.data.threshold,position:this._translatePosition(e.data.position)})},t.prototype._handleError=function(e){var t=this._currentTrack,r=e.data;if(t){r.position=this._translatePosition(e.data.position),this.emit(d.Event.LIST_PLAYER_ERROR,r),this.emitSync(d.Event.LIST_PLAYER_ERROR_SYNC,r);var n=!!r.error&&r.error.listPlayerIgnore;n||this._listErrorCount++,r.canPlayNext&&(n||this._listErrorCount<=this._maxListErrors?this.next(c.Reason.TRACK_ERROR):this.emit(d.Event.LIST_PLAYER_MAX_LIST_ERRORS_REACHED,{count:this._listErrorCount,threshold:this._maxListErrors}))}},t.prototype._handleTrackLoaded=function(e){this.emitSync(d.Event.LIST_PLAYER_TRACK_LOADED,e)},t.prototype._incrementSeqId=function(){return this._currentSeqId>=9007199254740991?this._currentSeqId=0:this._currentSeqId+=1,this._currentSeqId},t.prototype._getTrackPlayer=function(){return this._trackPlayerPromise.promise},t.prototype._setListIndex=function(e,t){var r=t.index&&-1!==t.index?t.index:0;return Promise.all([e,t,e.startAt(r)])},t.prototype._setListOptions=function(e){var t=e[0],r=e[1];e[2];return Promise.all([t.setShuffle(!!this._shuffled),t.setRepeatMode(this._repeatMode)]).then((function(){return[t,r]}))},t.prototype._replaceCurrentList=function(e){var t=e[0],r=e[1];return this.emitSync(d.Event.LIST_PLAYER_BEFORE_LIST_CHANGE,{newList:t,newOptions:r,oldList:this._loadedList,oldOptions:this._loadedOptions}),this._loadedList=t,this._loadedOptions=r,this._listPlayCount=0,this._listErrorCount=0,this.emit(d.Event.LIST_PLAYER_LIST_CHANGED,{list:t,options:r}),s.OperationResult.SUCCESS},t.prototype._preloadTrack=function(e){return this._getTrackPlayer().then((function(t){return t.preload(e).catch((function(){})),s.OperationResult.SUCCESS}))},t.prototype._changeTrack=function(e,t,r){var n=this;if(this._currentSeqId!==r)return Promise.resolve(s.OperationResult.CANCELLED);this.emitSync(d.Event.LIST_PLAYER_BEFORE_TRACK_LOAD,{list:this._loadedList,newTrack:e,oldTrack:this._currentTrack}),this._uid++;var i=++this._listPlayCount,o=this._loadedOptions,a=!0,u=0,l=3e4;o&&(1===i?(a=!o.paused,u=o.initialPosition||o.position||0):u=o.position||0);var _=t===c.Reason.TRACK_DONE;if(e.options){var p=e.options;void 0!==p.paused&&(a=!p.paused),void 0!==p.position&&(u=p.position),void 0!==p.playedThreshold&&(l=p.playedThreshold)}this._currentTrack=e,this._currentTrackOptions={reason:t,paused:!a,position:u,playedThreshold:l};var f=this._handleTrackLoaded.bind(this,{uid:this._uid,track:this._currentTrack,options:this._currentTrackOptions,list:this._loadedList});return this._getTrackPlayer().then((function(t){return n._currentSeqId!==r?s.OperationResult.CANCELLED:(Promise.resolve(t.load(e,{uriProperty:"playableURI",autoplay:a,position:u,playedThreshold:l,continuePrevious:_},f)).catch((function(){})),s.OperationResult.SUCCESS)}))},t.prototype._preloadUpcomingTrack=function(){var e=this,t=this._loadedList;if(!t)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."));var r={reason:c.Reason.TRACK_DONE,listConstants:l.ListConstants};return t.peekNext(r).then((function(t){return t===l.ListConstants.FORBIDDEN?s.OperationResult.FORBIDDEN:t===l.ListConstants.NULL_VALUE?e._preloadUpcomingTrack():t===l.ListConstants.LIST_END?s.OperationResult.LIST_END:p(t)&&t.playable?e._preloadTrack(t):s.OperationResult.INVALID}))},t.prototype.activateElement=function(){return this._getTrackPlayer().then((function(e){return e.activateElement(),s.OperationResult.SUCCESS}))},t.prototype.load=function(e,t){var r=function(e){void 0===e&&(e={});var t={index:-1,position:0,initialPosition:0,duration:-1,paused:!1,reason:c.Reason.UNKNOWN};return void 0!==e.index&&(t.index=e.index),void 0!==e.position&&(t.position=e.position),void 0!==e.initialPosition&&(t.initialPosition=e.initialPosition),void 0!==e.duration&&(t.duration=e.duration),void 0!==e.paused&&(t.paused=e.paused),void 0!==e.reason&&(t.reason=e.reason),t}(t||this._loadedOptions||{});return this._setListIndex(e,r).then(this._setListOptions).then(this._replaceCurrentList)},t.prototype.play=function(e,t){var r=this;return this.load(e,t).then((function(){if(r._loadedList!==e)return s.OperationResult.CANCELLED;var t=r._loadedOptions?r._loadedOptions.reason:c.Reason.UNKNOWN;return r.next(t)}))},t.prototype.canChangeTrack=function(){return this._loadedList?this._loadedList.peekNext({reason:c.Reason.FORWARD_BUTTON,listConstants:l.ListConstants}).then((function(e){return e!==l.ListConstants.FORBIDDEN})):Promise.resolve(!0)},t.prototype.next=function(e){var t=this;if(!e)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_INVALID_ARGUMENT,"The argument `reason` is required."));var r=this._loadedList;if(!r)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."));this.emitSync(d.Event.LIST_PLAYER_BEFORE_NEXT,{list:r,reason:e});var n=this._incrementSeqId(),i={reason:e,listConstants:l.ListConstants};return r.next(i).then((function(i){return t._currentSeqId!==n?s.OperationResult.CANCELLED:i===l.ListConstants.FORBIDDEN?s.OperationResult.FORBIDDEN:i===l.ListConstants.NULL_VALUE?t.next(e):i===l.ListConstants.LIST_END?(t.emit(d.Event.LIST_PLAYER_LIST_ENDED,{list:r,reason:c.Reason.END_PLAY}),t.clear(e),s.OperationResult.LIST_END):p(i)?i.playable?t._changeTrack(i,e,n):(t.emit(d.Event.LIST_PLAYER_TRACK_UNPLAYABLE,{track:i,list:r}),t.next(e)):s.OperationResult.INVALID}))},t.prototype.previous=function(e){var t=this;if(!e)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_INVALID_ARGUMENT,"The argument `reason` is required."));var r=this._loadedList;if(!r)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."));this.emitSync(d.Event.LIST_PLAYER_BEFORE_PREVIOUS,{list:r,reason:e});var n=this._incrementSeqId(),i={reason:e,listConstants:l.ListConstants};return r.previous(i).then((function(i){return t._currentSeqId!==n?s.OperationResult.CANCELLED:i===l.ListConstants.FORBIDDEN?s.OperationResult.FORBIDDEN:i===l.ListConstants.NULL_VALUE?t.previous(e):i===l.ListConstants.LIST_START?(t.emit(d.Event.LIST_PLAYER_LIST_ENDED,{list:r,reason:c.Reason.END_PLAY}),t.clear(e),s.OperationResult.LIST_END):p(i)?i.playable?t._changeTrack(i,e,n):(t.emit(d.Event.LIST_PLAYER_TRACK_UNPLAYABLE,{track:i,list:r}),t.previous(e)):s.OperationResult.INVALID}))},t.prototype.pause=function(){return this._loadedList?this._currentTrack?this._getTrackPlayer().then((function(e){return e.pause().then((function(){return s.OperationResult.SUCCESS})).catch((function(e){return"AbortError"===(null==e?void 0:e.name)?s.OperationResult.CANCELLED:s.OperationResult.FORBIDDEN}))})):Promise.resolve(s.OperationResult.SUCCESS):Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."))},t.prototype.resume=function(){return this._loadedList?this._currentTrack?this._getTrackPlayer().then((function(e){return e.resume().then((function(){return s.OperationResult.SUCCESS})).catch((function(e){return"AbortError"===(null==e?void 0:e.name)?s.OperationResult.CANCELLED:s.OperationResult.FORBIDDEN}))})):Promise.resolve(s.OperationResult.SUCCESS):Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."))},t.prototype.togglePlay=function(){return this._loadedList?this._currentTrack?this._getTrackPlayer().then((function(e){return e.togglePlay().then((function(){return s.OperationResult.SUCCESS})).catch((function(e){return"AbortError"===(null==e?void 0:e.name)?s.OperationResult.CANCELLED:s.OperationResult.FORBIDDEN}))})):Promise.resolve(s.OperationResult.SUCCESS):Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."))},t.prototype.stop=function(e){var t=this,r={reason:e||c.Reason.UNKNOWN},n=this._currentTrack;return n&&n.logData&&(r.source=n.logData.source),this._incrementSeqId(),this._getTrackPlayer().then((function(e){return e.stop(r),t.emit(d.Event.LIST_PLAYER_STOPPED,{uid:t._uid,options:t._currentTrackOptions,list:t._loadedList}),s.OperationResult.SUCCESS}))},t.prototype.clear=function(e){var t=this;return this.stop(e).then((function(){return t._loadedList=null,t._loadedOptions=null,t._currentTrack=null,t._currentTrackOptions=null,t.emit(d.Event.LIST_PLAYER_CLEARED,null),s.OperationResult.SUCCESS}))},t.prototype.setShuffle=function(e){var t=!!e;if(this._shuffled!==t){this._shuffled=t,this.emit(d.Event.LIST_PLAYER_SHUFFLE_CHANGED,{player:this,shuffled:t});var r=this._loadedList;r&&r.setShuffle(this._shuffled)}return Promise.resolve(s.OperationResult.SUCCESS)},t.prototype.setRepeatMode=function(e){if(!(e in u.RepeatMode))return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_INVALID_ARGUMENT,"The value of repeat mode is not a correct RepeatMode enum value"));if(this._repeatMode!==e){this._repeatMode=e,this.emit(d.Event.LIST_PLAYER_REPEAT_MODE_CHANGED,{player:this,repeatMode:e});var t=this._loadedList;t&&t.setRepeatMode(this._repeatMode)}return Promise.resolve(s.OperationResult.SUCCESS)},t.prototype.getVolume=function(){return this._getTrackPlayer().then((function(e){return e.getVolume()}))},t.prototype.setVolume=function(e,t){var r=this;return void 0===t&&(t=null),this._getTrackPlayer().then((function(n){return n.setVolume(e,{commandId:null!=t?t:void 0}),r.emit(d.Event.LIST_PLAYER_VOLUME_CHANGED,{volume:e,commandId:t}),s.OperationResult.SUCCESS}))},t.prototype.seek=function(e,t){var r,n,i=this;void 0===t&&(t=c.Reason.SEEK);var o=this._loadedList;if(!o)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."));if("function"==typeof o.allowSeeking&&!o.allowSeeking())return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_FORBIDDEN,"The operation is not allowed."));var u=null!==(n=null===(r=o.handleSeek)||void 0===r?void 0:r.call(o,e,{reason:t,listConstants:l.ListConstants}))&&void 0!==n?n:e;return u===l.ListConstants.PAUSE?this.pause().then((function(t){return i.emit(d.Event.LIST_PLAYER_SEEK_HANDLED,{position:e,reason:u}),t})):u===l.ListConstants.IGNORE?(this.emit(d.Event.LIST_PLAYER_SEEK_HANDLED,{position:e,reason:u}),Promise.resolve(s.OperationResult.SUCCESS)):this._currentTrack?this._getTrackPlayer().then((function(e){return e.seek(u),s.OperationResult.SUCCESS})):Promise.resolve(s.OperationResult.SUCCESS)},t.prototype.getListConstants=function(){return l.ListConstants},t.prototype.getLoadedList=function(){return this._loadedList},t.prototype.getLoadedOptions=function(){return this._loadedOptions},t.prototype.getPlayerState=function(){var e=this;return this._getTrackPlayer().then((function(t){var r=t.getPlayerState();return n.__assign(n.__assign({},r),{position:e._translatePosition(r.position),duration:e._translateDuration(r.duration)})}))},t.prototype.getState=function(){var e=this;return this.getPlayerState().then((function(t){return{playbackState:t,track:e._currentTrack,list:e._loadedList,options:e._loadedOptions}}))},t.prototype.getMediaConfig=function(){return this._getTrackPlayer().then((function(e){return e.getMediaConfig()}))},t.prototype.hideSubtitles=function(){return this._getTrackPlayer().then((function(e){return e.hideSubtitles()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.showSubtitles=function(){return this._getTrackPlayer().then((function(e){return e.showSubtitles()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.areSubtitlesShown=function(){return this._getTrackPlayer().then((function(e){return e.areSubtitlesShown()}))},t.prototype.getSubtitleLanguages=function(){return this._getTrackPlayer().then((function(e){return e.getSubtitleLanguages()}))},t.prototype.getActiveSubtitleLanguage=function(){return this._getTrackPlayer().then((function(e){var t;return null!==(t=e.getActiveSubtitleLanguage())&&void 0!==t?t:null}))},t.prototype.deactivateCueEvents=function(){return this._getTrackPlayer().then((function(e){return e.deactivateCueEvents()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.activateCueEvents=function(){return this._getTrackPlayer().then((function(e){return e.activateCueEvents()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.getCurrentBandwidth=function(){return this._getTrackPlayer().then((function(e){return e.getCurrentBandwidth()}))},t.prototype.setSubtitleLanguage=function(e){return this._getTrackPlayer().then((function(t){return t.setSubtitleLanguage(e)})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.setPlaybackSpeed=function(e){return this._getTrackPlayer().then((function(t){return t.setPlaybackSpeed(e)})).then((function(e){return e?s.OperationResult.SUCCESS:s.OperationResult.FORBIDDEN}))},t.prototype.getStatistics=function(){return this._getTrackPlayer().then((function(e){return e.getStatistics()}))},t}(i.EventEmitter);r.ListPlayer=f},{"./enums/errors":58,"./enums/event":59,"./enums/list_constants":61,"./enums/operation_result":64,"./enums/reason":66,"./enums/repeat_mode":67,"./error/playback":76,"@js-sdk/common/es5/promise_resolver":91,"@spotify-internal/emitter/es5":98,tslib:201}],82:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={tagged:"7.18.1-5339452",version:"7.18.1",revision:"5339452"}},{}],83:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("tslib");n.__exportStar(e("./logger"),r),n.__exportStar(e("./promise_resolver"),r),n.__exportStar(e("./user_agent"),r)},{"./logger":89,"./promise_resolver":91,"./user_agent":92,tslib:201}],84:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.groupBy=void 0,r.groupBy=function(e,t){return e.reduce((function(e,r){var n,i=r[t];return void 0===i||(e[i]=null!==(n=e[i])&&void 0!==n?n:[],e[i].push(r)),e}),{})}},{}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoggingError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n){var i=e.call(this,r)||this;return i.name="LoggingError",i.code=t,i.status=n||0,i}return n.__extends(t,e),t}(Error);r.LoggingError=i},{tslib:201}],86:[function(e,t,r){"use strict";function n(e,t){var r=e.indexOf(t);return-1===r?[e,""]:[e.slice(0,r),e.slice(r+t.length)]}Object.defineProperty(r,"__esModule",{value:!0}),r.urlWithQueryParam=r.splitOnce=void 0,r.splitOnce=n,r.urlWithQueryParam=function(e,t,r){for(var i=n(e,"#"),o=i[0],a=i[1],s=n(o,"?"),u=s[0],l=s[1],c=a?"#"+a:"",d=t+"="+encodeURIComponent(r),_=0,p=l.split("&");_<p.length;_++){var f=p[_];f.length>0&&n(f,"=")[0]!==t&&(d+="&"+f)}return u+"?"+d+c}},{}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoggingErrors=void 0,function(e){e.INVALID_IDENT_DATA="INVALID_IDENT_DATA",e.LOGGING_REQUEST_FAILED="LOGGING_REQUEST_FAILED"}(r.LoggingErrors||(r.LoggingErrors={}))},{}],88:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LogValues=void 0,r.LogValues={UNKNOWN:"unknown",EMPTY:"",ZERO:0,EMPTY_VERSION:"0.0.0"}},{}],89:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("tslib");n.__exportStar(e("./logger"),r),n.__exportStar(e("./enums/errors"),r),n.__exportStar(e("./enums/log_values"),r)},{"./enums/errors":87,"./enums/log_values":88,"./logger":90,tslib:201}],90:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MelodyLogger=void 0;var n=e("tslib"),i=e("./enums/errors"),o=e("./enums/log_values"),a=e("./_internal/group_by"),s=e("./_internal/logging_error"),u=e("./_internal/url_utils"),l=function(){function e(e){this._transport=e.transport,this._endpoint=e.endpoint||"@webgate/melody",this._batchQueue=[],this._identData=Promise.all([e.sdkId,e.platform,e.clientVersion]).then((function(e){var t=e[0],r=e[1],n=e[2];return{sdk_id:t||o.LogValues.EMPTY,platform:r||o.LogValues.EMPTY,client_version:n||o.LogValues.EMPTY_VERSION}}))}return e.prototype._assertValidIdentData=function(e){if(!e.sdk_id)throw new s.LoggingError(i.LoggingErrors.INVALID_IDENT_DATA,"sdkId must be a non-empty string.",0)},e.prototype._sendBatchedLogs=function(){var e=this;return this._identData.then((function(t){e._assertValidIdentData(t);var r=e._batchQueue.splice(0,e._batchQueue.length);if(r.length){var o=a.groupBy(r,"endpoint"),u=Object.keys(o).map((function(r){var a,u=null===(a=o[r])||void 0===a?void 0:a.map((function(e){return e.payload}));return(null==u?void 0:u.length)?e._transport.request(""+e._endpoint+r,{method:"POST",payload:JSON.stringify(n.__assign({messages:u},t)),retry:{maxRetries:5,condition:function(e){return 202!==e.status}}}).then((function(e){var t=e.status;return 202===t||Promise.reject(new s.LoggingError(i.LoggingErrors.LOGGING_REQUEST_FAILED,"Logging service responded with status "+t,t))})):Promise.resolve(!0)}));return Promise.all(u).then((function(){return!0}))}return Promise.resolve(!0)}))},e.prototype._sendLog=function(e,t){return this.sendLog(e,t)},e.prototype.sendLog=function(e,t,r){var o=this,a=null==r?void 0:r.forget;if(null==r?void 0:r.batch){if(a)throw new Error("'forget' cannot be used together with 'batch'.");return new Promise((function(r){o._batchQueue.push({endpoint:e,payload:t}),queueMicrotask((function(){o._sendBatchedLogs().then(r)}))}))}return this._identData.then((function(r){o._assertValidIdentData(r);var i=o._endpoint+e,s=a?o._transport.getLastToken():null;return s&&(i=u.urlWithQueryParam(i,"access_token",s)),o._transport.request(i,{method:"POST",payload:JSON.stringify(n.__assign(n.__assign({},t),r)),forget:a,retry:{maxRetries:5,condition:function(e){return 202!==e.status}}})})).then((function(e){var t=e.status;return!(!a&&202!==t)||Promise.reject(new s.LoggingError(i.LoggingErrors.LOGGING_REQUEST_FAILED,"Logging service responded with status "+t,t))}))},e}();r.MelodyLogger=l},{"./_internal/group_by":84,"./_internal/logging_error":85,"./_internal/url_utils":86,"./enums/errors":87,"./enums/log_values":88,tslib:201}],91:[function(e,t,r){arguments[4][7][0].apply(r,arguments)},{dup:7}],92:[function(e,t,r){arguments[4][8][0].apply(r,arguments)},{"./interpolate_ua":93,"./parse_ua":94,dup:8,tslib:201}],93:[function(e,t,r){arguments[4][9][0].apply(r,arguments)},{"./parse_ua":94,dup:9}],94:[function(e,t,r){arguments[4][10][0].apply(r,arguments)},{dup:10}],95:[function(e,t,r){(function(e){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defer=void 0;var t,n="undefined"!=typeof window,i=[];function o(){var e,t=i.splice(0);if(t.length)for(var r=0,n=t.length;r<n;r++)try{null===(e=t[r])||void 0===e||e.call(t)}finally{}}n&&"function"==typeof window.postMessage?function(){var e=window.location.origin||window.location.protocol+"//"+window.location.hostname;if(t=window.postMessage.bind(window,"@execute_deferreds",e),!window.__hasDeferredHandler){"function"==typeof Object.defineProperty?Object.defineProperty(window,"__hasDeferredHandler",{value:!0}):window.__hasDeferredHandler=!0;var r=function(t){t.origin!==e&&"@execute_deferreds"!==t.data||o()};window.addEventListener?window.addEventListener("message",r):window.attachEvent&&window.attachEvent("onmessage",r)}}():t="function"==typeof queueMicrotask?queueMicrotask.bind(null,o):"function"==typeof e?e.bind(null,o):setTimeout.bind(null,o,10);var a=function(e){var r=!i.length;i.push(e),r&&t()};r.defer=a,n&&("function"==typeof window.__modDefFn?r.defer=a=window.__modDefFn:"function"==typeof Object.defineProperty?Object.defineProperty(window,"__modDefFn",{value:a}):window.__modDefFn=a)}).call(this)}).call(this,e("timers").setImmediate)},{timers:200}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EmittedEvent=void 0;var n=function(){function e(e,t){this.defaultPrevented=!1,this.immediateStopped=!1,this.stopped=!1,this.type=e,this.data=t}return e.prototype.preventDefault=function(){this.defaultPrevented=!0},e.prototype.stopPropagation=function(){this.stopped=!0},e.prototype.stopImmediatePropagation=function(){this.immediateStopped=!0},e}();r.EmittedEvent=n},{}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EventEmitter=void 0;var n=e("./emitted_event"),i=e("./_internal/deferred");function o(e,t,r){for(var n=0,i=e.length;n<i;n++){var o=e[n];if((null==o?void 0:o.listener)===t&&o.options.once===r.once)return n}return-1}function a(e,t,r,n){if(void 0===n&&(n={}),!r)return!1;var i=e[t];return!i||!i.length||-1===o(i,r,n)}function s(e,t,r,n){if(void 0===n&&(n={}),t&&r){var i=e[t],o={listener:r,options:n};i?i.push(o):e[t]=[o]}}var u=function(){function e(){this._listeners={},this._metaListeners={add:{},remove:{}}}return e.prototype._dispatchFromStore=function(e,t){var r=t.type,n=e[r];if(n)for(var i=0,o=n=n.slice(0);i<o.length;i++){var a=o[i];if(a.listener.call(this,t),a.options.once&&this.removeListener(r,a.listener,a.options),t.immediateStopped)break}},e.prototype.createEvent=function(e,t){return new n.EmittedEvent(e,t)},e.prototype.on=function(e,t,r){if(void 0===r&&(r={}),!e)throw new TypeError("Argument `eventType` is required.");if(!t)return this;var i=this._listeners;if(a(i,e,t,r)){var o=this._metaListeners.add,u=o[e];if(u&&u.length){var l=new n.EmittedEvent(e,{listener:t,options:r});if(this._dispatchFromStore(o,l),l.defaultPrevented)return this}s(i,e,t,r)}return this},e.prototype.addListener=function(e,t,r){return void 0===r&&(r={}),this.on(e,t,r)},e.prototype.addListeners=function(e){for(var t in e)e.hasOwnProperty(t)&&this.on(t,e[t]);return this},e.prototype.once=function(e,t){return this.on(e,t,{once:!0})},e.prototype.removeListener=function(e,t,r){if(void 0===r&&(r={}),!e)throw new TypeError("Argument `eventType` is required.");if(!t)return this;var i=this._listeners[e];if(!i)return this;var a=o(i,t,r);if(-1===a)return this;var s=this._metaListeners.remove[e];if(s&&s.length){var u=new n.EmittedEvent(e,{listener:t,options:r});if(this._dispatchFromStore(this._metaListeners.remove,u),u.defaultPrevented)return this}return i.splice(a,1),this},e.prototype.removeListeners=function(e){for(var t in e)e.hasOwnProperty(t)&&this.removeListener(t,e[t]);return this},e.prototype.removeAllListeners=function(e){return e?this._listeners[e]=[]:this._listeners={},this},e.prototype.emit=function(e,t){var r=this;if(!e)throw new TypeError("Argument `eventType` is required.");var n=this.createEvent(e,t);return i.defer((function(){return r._dispatchFromStore(r._listeners,n)})),n},e.prototype.emitSync=function(e,t){if(!e)throw new TypeError("Argument `eventType` is required.");var r=this.createEvent(e,t);return this._dispatchFromStore(this._listeners,r),r},e.prototype.emitEvent=function(e){var t=this;return i.defer((function(){return t._dispatchFromStore(t._listeners,e)})),e},e.prototype.emitEventSync=function(e){return this._dispatchFromStore(this._listeners,e),e},e.prototype.emitAndWait=function(e,t,r){var n=this;if(!e)throw new TypeError("Argument `eventType` is required.");var o=this.createEvent(e,t);return i.defer((function(){n._dispatchFromStore(n._listeners,o),r.call(n,o)})),o},e.prototype.emitEventAndWait=function(e,t){var r=this;return i.defer((function(){r._dispatchFromStore(r._listeners,e),t.call(r,e)})),e},e.prototype.proxyEmit=function(e,t,r){var n=this;if(!e||"function"!=typeof e.on)throw new TypeError("Proxy source must be an EventEmitter");if(e===this)throw new ReferenceError("Cannot create recursive proxy.");if(!t||!r)throw new TypeError("Parameter sourceType and targetType are required.");var i=function(e){e.stopped||n.emitAndWait(r,e.data,(function(t){t.defaultPrevented&&e.preventDefault()}))};return e.on(t,i),i},e.prototype.proxyEmitSync=function(e,t,r){var n=this;if(!e||"function"!=typeof e.on)throw new TypeError("Proxy source must be an EventEmitter");if(e===this)throw new ReferenceError("Cannot create recursive proxy.");if(!t||!r)throw new TypeError("Parameter sourceType and targetType are required.");var i=function(e){if(!e.stopped){var t=n.createEvent(r,e.data);n.emitEventSync(t),t.defaultPrevented&&e.preventDefault()}};return e.on(t,i),i},e.prototype.proxyEmitAll=function(e,t){for(var r in t)t.hasOwnProperty(r)&&this.proxyEmit(e,r,t[r])},e.prototype.proxyEmitAllSync=function(e,t){for(var r in t)t.hasOwnProperty(r)&&this.proxyEmitSync(e,r,t[r])},e.prototype.onAddListener=function(e,t,r){void 0===r&&(r={});var n=this._metaListeners.add;return a(n,e,t,r)&&s(n,e,t,r),this},e.prototype.onRemoveListener=function(e,t,r){void 0===r&&(r={});var n=this._metaListeners.remove;return a(n,e,t,r)&&s(n,e,t,r),this},e}();r.EventEmitter=u},{"./_internal/deferred":95,"./emitted_event":96}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Event=r.EmittedEvent=void 0;var n=e("tslib"),i=e("./emitted_event");Object.defineProperty(r,"EmittedEvent",{enumerable:!0,get:function(){return i.EmittedEvent}}),Object.defineProperty(r,"Event",{enumerable:!0,get:function(){return i.EmittedEvent}}),n.__exportStar(e("./eventemitter"),r)},{"./emitted_event":96,"./eventemitter":97,tslib:201}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyClient=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/debug-tools/es5"),a=e("@spotify-internal/transport/es5/product_state_observer"),s=e("@spotify-internal/transport/es5"),u=e("@js-sdk/common/es5"),l=e("@js-sdk/common/es5/promise_resolver"),c=e("../typedefs"),d=e("../enums/errors"),_=e("../enums/error_source"),p=e("../enums/manifest_format"),f=e("../error/harmony_error"),h=e("./device_descriptor"),y=e("../version"),v=e("./logging/transport_logger"),E=o.logging.forTag("harmonyclient"),m=/^[a-zA-Z0-9_%:-]{1,40}$/,g=function(e){function t(t){var r=e.call(this)||this;if(r._platformIdentifier=l.createPromiseResolver(),r._platformVersion=l.createPromiseResolver(),!t)throw new TypeError("Argument `options` is not defined.");if(!t.transport)throw new TypeError("No Transport instance provided");if(!t.transport.hasPlugin("dealer"))throw new TypeError("Transport has no Dealer plugin.");return r._transport=t.transport,r._deviceDescriptor=r._initDeviceDescriptor(t),r._logger=new v.Logger({transport:r._transport.toPublic(),sdkId:r.getSDKId(),platform:r._platformIdentifier.promise,clientVersion:r._platformVersion.promise}),r._productStateObserver=a.ProductStateObserver.create({transport:r._transport}),r._onConnected=r._onConnected.bind(r),r._onAuthenticated=r._onAuthenticated.bind(r),r._onConnectionError=r._onConnectionError.bind(r),r._onAuthenticationError=r._onAuthenticationError.bind(r),r._onShortSessionDisconnect=r._onShortSessionDisconnect.bind(r),r._attachListeners(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.of=function(e){return e._client},t.prototype._createDeviceDescriptor=function(e,t){var r,i;if(void 0===t&&(t={}),(null==t?void 0:t.id)&&!m.test(t.id))throw f.HarmonyError.fatal(d.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Invalid device id.");var o=t.capabilities||{},a={change_volume:null===(r=o.change_volume)||void 0===r||r,endsong_snooping:o.endsong_snooping,enable_play_token:!0,supports_file_media_type:!0,play_token_lost_behavior:e.playTokenLostBehavior||"pause",disable_connect:!!e.hidden,audio_podcasts:null===(i=o.audio_podcasts)||void 0===i||i,video_playback:o.video_playback,lossless_playback:o.lossless_playback,volume_steps:void 0!==o.volume_steps&&o.volume_steps>=0&&o.volume_steps<c.GAIA_VOLUME?o.volume_steps:void 0,manifest_formats:[p.ManifestFormat.FILE_IDS_MP3,p.ManifestFormat.FILE_URLS_MP3]},s=h.DeviceDescriptor.create(n.__assign(n.__assign({},t),{capabilities:a}));return this._platformIdentifier.resolve(s.getPlatformIdentifier()),this._platformVersion.resolve(s.getPlatformVersion()),this.proxyEmit(s,"descriptor_changed","descriptor_changed"),s},t.prototype._initDeviceDescriptor=function(e){var t=this;return Promise.resolve(e.descriptor).then(this._createDeviceDescriptor.bind(this,e)).catch((function(e){return t._onError(_.HarmonyErrorSource.HARMONY,{error:e}),Promise.reject(e)}))},t.prototype._attachListeners=function(){var e=this,t=this._transport;t.on(s.TransportEvent.CONNECTED,this._onConnected),t.on(s.TransportEvent.AUTHENTICATED,this._onAuthenticated),t.on(s.TransportEvent.CONNECTION_FAILED,this._onConnectionError),t.on(s.TransportEvent.AUTHENTICATION_FAILED,this._onAuthenticationError),this.proxyEmit(t,s.TransportEvent.RECONNECTING,"reconnecting"),this.proxyEmit(t,s.TransportEvent.RECONNECTED,"reconnected"),this.proxyEmit(t,s.TransportEvent.LOGGED_OUT,"logged_out"),this.proxyEmitSync(t,s.TransportEvent.BEFORE_OFFLINE_DISCONNECT,"before_offline_disconnect"),this.proxyEmitSync(t,s.TransportEvent.BEFORE_ONLINE_DISCONNECT,"before_disconnect"),t.on(s.TransportEvent.SHORT_SESSION_DISCONNECTED,this._onShortSessionDisconnect.bind(this)),this.proxyEmit(this._productStateObserver,s.TransportEvent.PRODUCT_STATE_CHANGED,"product_state_changed"),this.on("before_disconnect",(function(t){var r=e._productStateObserver.deregister().catch((function(){}));t.data.awaitPromise(r)}))},t.prototype._onError=function(e,t){this.emit("error",{source:e,error:t.error}),t.error&&t.error.unrecoverable&&this.emit("unrecoverable_failure",{source:e,error:t.error})},t.prototype._onConnected=function(){this.emit("connected",null)},t.prototype._onAuthenticated=function(){this.emit("authenticated",null)},t.prototype._onConnectionError=function(e){this._onError(_.HarmonyErrorSource.TRANSPORT,{error:e.data.error}),this.emit("connection_error",e.data)},t.prototype._onAuthenticationError=function(e){this._onError(_.HarmonyErrorSource.TRANSPORT,{error:e.data.error}),this.emit("authentication_error",e.data)},t.prototype._onShortSessionDisconnect=function(e){this._logger.logClientEvent({source:"transport",source_version:y.default.tagged,source_vendor:"spotify",event:e.type,event_version:"1.0.0",json_data:{disconnectCount:e.data.disconnectCount,sessionLength:e.data.sessionLength}},"object").catch((function(t){return E.warn(e.type+" Logging Error:",t)}))},t.prototype.getVersionDescriptor=function(){return n.__assign({},y.default)},t.prototype.getSDKId=function(){return"harmony:"+y.default.tagged},t.prototype.getUntaggedSDKId=function(){return"harmony:"+y.default.version},t.prototype.getPlatformIdentifier=function(){return this._platformIdentifier.promise},t.prototype.getPlatformVersion=function(){return this._platformVersion.promise},t.prototype.getLogger=function(){return this._logger},t.prototype.logAppMetrics=function(e,t){if(!this._logger)throw new TypeError("Invalid logger instance");return this._logger.logMetrics(e,t)},t.prototype.request=function(e,t){return this._transport.request(e,t)},t.prototype.getPublicTransport=function(){return this._transport.toPublic()},t.prototype.getClientDescriptor=function(){return this._deviceDescriptor.then((function(e){return e.toJSON()}))},t.prototype.getDeviceDescriptor=function(){return this._deviceDescriptor},t.prototype.getUserInfo=function(){return this._transport.request("@webapi/v1/me",{responseType:"json"}).then((function(e){var t=e.body;if(200!==e.status){var r=new f.HarmonyError(d.HarmonyErrors.USER_INFO_REQUEST_FAILED_WITH_STATUS,"User info request failed with status "+e.status);return r.status=e.status,Promise.reject(r)}return t?{display_name:t.display_name,followers:t.followers,id:t.id,images:t.images,uri:t.uri}:Promise.reject(new f.HarmonyError(d.HarmonyErrors.USER_INFO_REQUEST_EMPTY_RESPONSE,"Unexpected empty response."))}))},t.prototype.getProductState=function(){return this._productStateObserver.getCurrentState()},t.prototype.setName=function(e){return this._deviceDescriptor.then((function(t){return t.setName(e)}))},t.prototype.setNameTemplate=function(e){return this.setName(u.interpolateUA(e))},t.prototype.setCapability=function(e,t){return this._deviceDescriptor.then((function(r){return r.setCapability(e,t)}))},t.prototype.notifyError=function(e,t){this._onError(e,{error:t})},t}(i.EventEmitter);r.HarmonyClient=g},{"../enums/error_source":124,"../enums/errors":125,"../enums/manifest_format":128,"../error/harmony_error":132,"../typedefs":138,"../version":142,"./device_descriptor":106,"./logging/transport_logger":110,"@js-sdk/common/es5":143,"@js-sdk/common/es5/promise_resolver":151,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,"@spotify-internal/transport/es5":181,"@spotify-internal/transport/es5/product_state_observer":187,tslib:201}],100:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.CloudPlaybackClient=void 0;var i=e("tslib"),o=e("@spotify-internal/transport/es5"),a=e("@js-sdk/debug-tools/es5"),s=e("@spotify-internal/emitter/es5"),u=e("@js-sdk/playback/es5"),l=e("@js-sdk/common/es5/promise_resolver"),c=e("../../enums/errors"),d=e("../../enums/manifest_format"),_=e("../../enums/error_source"),p=e("../../enums/hifi_status"),f=e("../../error/cloud_playback/client"),h=e("./common"),y=e("./list"),v=a.logging.forTag("cpclient");function E(){throw new Error("Not implemented")}var m={condition:function(e){var t=e.status;return 429===t||503===t},maxRetries:2},g={"/play":!0,"/skip_next":!0,"/skip_previous":!0,"/repeat":!0,"/shuffle":!0,"/event/play_progress":!0},T=((n={})[d.ManifestFormat.FILE_URLS_MP3]={mime_type:"audio/mp3"},n[d.ManifestFormat.FILE_URLS_EXTERNAL]={mime_type:"audio/mp3"},n[d.ManifestFormat.FILE_IDS_MP3]={mime_type:"audio/mp3"},n[d.ManifestFormat.FILE_IDS_MP4]={mime_type:'audio/mp4+file_id; codecs="mp4a.40.2"',key_system:u.KeySystem.WIDEVINE},n[d.ManifestFormat.FILE_IDS_MP4_DUAL]={mime_type:'audio/mp4+file_id; codecs="mp4a.40.2"',key_system:u.KeySystem.PLAYREADY},n[d.ManifestFormat.FILE_IDS_CBCS]={mime_type:'audio/mp4+file_id; codecs="mp4a.40.2"',key_system:u.KeySystem.FAIRPLAY},n[d.ManifestFormat.FILE_IDS_MP4FLAC]={mime_type:'audio/mp4+file_id; codecs="flac"',key_system:u.KeySystem.WIDEVINE},n[d.ManifestFormat.MANIFEST_IDS_VIDEO]={mime_type:"video/mp4+manifest_id"},n),S=function(e){function t(t){var r,n=e.call(this)||this;return n._currentList=null,n._deviceId=null,n._isDeregistering=!1,n._loading=!1,n._lastReportedPlayedAmount=0,n._trackingDataSenderPromises=[],n._registered=!1,n._lastCommandTimestamp=0,n._currentPlayerState={playback_id:"",duration:0,current_position:0,paused:!0,playbackQuality:{audio_quality:u.PlaybackQuality.UNKNOWN,hifi_status:p.HiFiStatus.NONE}},n._commandIds=((r={})[h.CommandType.LOGOUT]=null,r[h.CommandType.PAUSE]=null,r[h.CommandType.PLAY_STATE]=null,r[h.CommandType.PLAY_STATE_CONTEXT]=null,r[h.CommandType.RESUME]=null,r[h.CommandType.SEEK]=null,r[h.CommandType.STOP]=null,r[h.CommandType.VOLUME]=null,r),n._connectionId=null,n._transport=t.transport,n._logger=t.logger,n._descriptorPromise=Promise.resolve(t.descriptor),n._endpoint=t.endpoint||"https://cpapi.spotify.com/v1",n._listPlayer=t.listPlayer,n._handleConfigurationResponse=n._handleConfigurationResponse.bind(n),n._handleReportEventResponse=n._handleReportEventResponse.bind(n),n.register=n.register.bind(n),n._init(),n}return i.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e,t=this;this._descriptorPromise.then((function(e){t._parseDescriptor(e),e.on("descriptor_changed",(function(){t._parseDescriptor(e)}))})),this._transport.on(this._transport.EVENT_CONNECTION_ID,this._onConnectionId.bind(this)),this._transport.matchMessages("hm://cloud-playback/v1/push",this._onMessage.bind(this)),this._listPlayer.addListeners(((e={})[u.PlaybackEvent.LIST_PLAYER_PLAYER_LOAD]=this._onPlayerLoad.bind(this),e[u.PlaybackEvent.LIST_PLAYER_VOLUME_CHANGED]=this._onVolumeChanged.bind(this),e[u.PlaybackEvent.LIST_PLAYER_PAUSED]=this._onPaused.bind(this),e[u.PlaybackEvent.LIST_PLAYER_ERROR]=this._onError.bind(this),e[u.PlaybackEvent.LIST_PLAYER_PLAYING]=this._onPlaying.bind(this),e[u.PlaybackEvent.LIST_PLAYER_PROGRESS]=this._onProgress.bind(this),e[u.PlaybackEvent.LIST_PLAYER_BEFORE_PLAYER_LOAD]=this._onBeforePlayerLoad.bind(this),e[u.PlaybackEvent.LIST_PLAYER_POSITION_CHANGED]=this._onPositionChanged.bind(this),e[u.PlaybackEvent.LIST_PLAYER_DURATION_CHANGED]=this._onDurationChanged.bind(this),e[u.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_CREATED]=this._onTrackingDataCreated.bind(this),e[u.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_FINALIZED]=this._onTrackingDataFinalized.bind(this),e))},t.prototype._onMessage=function(e){var t=e.payloads;Array.isArray(t)&&t.length&&this._performCommand(t[0])},t.prototype._handlePauseCommand=function(){this._listPlayer.pause()},t.prototype._handleResumeCommand=function(){this._listPlayer.resume()},t.prototype._handleStopCommand=function(){this._clearState()},t.prototype._onPaused=function(){if(this._currentPlayerState.paused=!0,"string"!=typeof this._descriptorId)throw new f.CloudPlaybackClientError(c.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var e={playback_descriptor_id:this._descriptorId},t=this._commandIds[h.CommandType.PAUSE];t&&(e.command_id=t.commandId,e.command_id_str=t.commandIdStr,this._commandIds[h.CommandType.PAUSE]=null),this._reportEvent(h.ReportingEvent.PAUSE,e),this._emitStateChanged()},t.prototype._onPlaying=function(){if(this._currentPlayerState.paused=!1,"string"!=typeof this._descriptorId)throw new f.CloudPlaybackClientError(c.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var e={playback_descriptor_id:this._descriptorId},t=this._commandIds[h.CommandType.RESUME];t&&(e.command_id=t.commandId,e.command_id_str=t.commandIdStr,this._commandIds[h.CommandType.RESUME]=null),this._reportEvent(h.ReportingEvent.RESUME,e),this._emitStateChanged()},t.prototype._onDurationChanged=function(e){this._currentPlayerState.duration=e.data.duration,this._emitStateChanged()},t.prototype._onPositionChanged=function(e){var t=this._currentPlayerState.current_position;if(this._currentPlayerState.current_position=e.data.position,"string"!=typeof this._descriptorId)throw new f.CloudPlaybackClientError(c.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var r={playback_descriptor_id:this._descriptorId,previous_position:t},n=this._commandIds[h.CommandType.SEEK];n&&(r.command_id=n.commandId,r.command_id_str=n.commandIdStr,this._commandIds[h.CommandType.SEEK]=null),this._reportEvent(h.ReportingEvent.POSITION_CHANGE,r),this._emitStateChanged()},t.prototype._onError=function(e){if("string"!=typeof this._descriptorId)throw new f.CloudPlaybackClientError(c.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var t=e.data.error.code,r=h.ErrorType.UNKNOWN;t===u.Errors.MEDIA_DECODING_ERROR&&(r=h.ErrorType.DECODING),(null==t?void 0:t.match(/^EME_/))&&(r=h.ErrorType.DRM);var n={playback_descriptor_id:this._descriptorId,error_type:r},i=this._commandIds[h.CommandType.PLAY_STATE];i&&(n.command_id=i.commandId,n.command_id_str=i.commandIdStr,this._commandIds[h.CommandType.PLAY_STATE]=null),this._reportEvent(h.ReportingEvent.PLAY_FAILURE,n)},t.prototype._onProgress=function(e){if(this._currentPlayerState.current_position=e.data.position,"string"!=typeof this._descriptorId)throw new f.CloudPlaybackClientError(c.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var t=this._currentList,r=null==t?void 0:t.getReportingMarkers();if(t&&r){var n=e.data.played,i=r.checkin,o=r.periodic;if(i.length){if(i[0]&&n<i[0])return;i.shift()}else if(o&&o>=n-this._lastReportedPlayedAmount)return;this._lastReportedPlayedAmount=n,this._reportEvent(h.ReportingEvent.PLAY_PROGRESS,{playback_descriptor_id:this._descriptorId})}},t.prototype._onBeforePlayerLoad=function(e){var t,r;this._loading=!0;var n=e.data,i=n.track,o=n.options,a=n.logData,s=i.metadata;this._descriptorId=s.descriptorId,this._lastReportedPlayedAmount=0,this._currentPlayerState={playback_id:null!==(t=null==a?void 0:a.playbackId)&&void 0!==t?t:"",duration:null!==(r=s.duration)&&void 0!==r?r:0,current_position:o.position,paused:!o.autoplay,playbackQuality:s.playbackQuality}},t.prototype._onPlayerLoad=function(e){if("string"!=typeof this._descriptorId)throw new f.CloudPlaybackClientError(c.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");this._loading=!1,this._currentPlayerState.current_position=e.data.position;var t={playback_descriptor_id:this._descriptorId,initial_loading_stats:{}},r=this._commandIds[h.CommandType.PLAY_STATE];r&&(t.command_id=r.commandId,t.command_id_str=r.commandIdStr,this._commandIds[h.CommandType.PLAY_STATE]=null),this._reportEvent(h.ReportingEvent.ITEM_READY,t),this._emitStateChanged()},t.prototype._onTrackingDataCreated=function(){this._trackingDataSenderPromises.push(l.createPromiseResolver())},t.prototype._onTrackingDataFinalized=function(e){var t,r=e.data.trackingData,n=this._trackingDataSenderPromises[this._trackingDataSenderPromises.length-1],i={playback_descriptor_id:null===(t=r.contentMetadata)||void 0===t?void 0:t.descriptorId,playback_stats:{num_stalls:r.nStalls,file_id:r.fileId,urls:r.getURLsJSON()}},o=this._commandIds[h.CommandType.LOGOUT]||this._commandIds[h.CommandType.PLAY_STATE];o&&(i.command_id=o.commandId,i.command_id_str=o.commandIdStr),this._reportEvent(h.ReportingEvent.ITEM_END,i,{playback_id:r.playbackId,current_position:r.position,paused:!0,duration:r.msActualDuration,playbackQuality:this._currentPlayerState.playbackQuality}).then((function(){n&&n.resolve(!0)})).catch((function(){n&&n.resolve(!1)})),this._emitStateChanged()},t.prototype._logContentRequest=function(e,t,r){var n;return this._logger.logJSSDKContentRequest({http_status:r.status,ms_request_duration:Date.now()-t,n_retries:r.retries.count,playback_id:null===(n=r.body)||void 0===n?void 0:n.play_state.playable_item.playback.id,source:"cloud-playback-client",type:e}).catch((function(e){v.error("Cloud Playback logJSSDKContentRequest error",e)}))},t.prototype._cloudPlaybackRequest=function(e,t,r){void 0===e&&(e="");var n=this._endpoint+"/client/"+this._deviceId+e,i={method:o.Method[t],headers:{"Content-Type":"application/json"},authorize:!0,responseType:"json",retry:g[e]?void 0:m,payload:JSON.stringify(r)};return this._transport.request(n,i).then((function(e){if(!e.ok)throw new Error("Cloud playback request failed with status "+e.status);return e}))},t.prototype._reportEvent=function(e,t,r){if(!this._registered){var n=new f.CloudPlaybackClientError(c.HarmonyErrors.CP_INVALID_STATE,"Cannot send report "+e+" when the device is not registered");return this.emit("error",{error:n,source:_.HarmonyErrorSource.CLOUD_PLAYBACK}),Promise.reject(n)}if(!this._deviceId){n=new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured");return this.emit("error",{error:n,source:_.HarmonyErrorSource.CLOUD_PLAYBACK}),Promise.reject(n)}var o=i.__assign({timestamp:Date.now(),player_state:r||this._currentPlayerState},t);return this._cloudPlaybackRequest("/event/"+e,"POST",o).then(this._handleReportEventResponse)},t.prototype._handleReportEventResponse=function(e){var t,r,n,i;if(200!==e.status){var o=new f.CloudPlaybackClientError(c.HarmonyErrors.CP_REQUEST_FAILED_WITH_STATUS,"PlayLoad event failed with status "+e.status);return o.status=e.status,Promise.reject(o)}return(null===(t=e.body)||void 0===t?void 0:t.must_stop)&&this._listPlayer.stop(),(null===(r=e.body)||void 0===r?void 0:r.must_pause)&&this._listPlayer.pause(),(null===(n=e.body)||void 0===n?void 0:n.clear_preloaded)&&(null===(i=this._currentList)||void 0===i||i.clearPreload()),Promise.resolve()},t.prototype._performCommand=function(e){if(e.server_timestamp<this._lastCommandTimestamp)v.warn(e.type+" command ignored due to more recent command in execution.");else switch(this._lastCommandTimestamp=e.server_timestamp,this._commandIds[e.type]={commandId:e.command_id,commandIdStr:e.command_id_str},e.type){case h.CommandType.PAUSE:this._handlePauseCommand();break;case h.CommandType.RESUME:this._handleResumeCommand();break;case h.CommandType.PLAY_STATE:this._handlePlayCommand(e);break;case h.CommandType.STOP:this._handleStopCommand();break;case h.CommandType.SEEK:this._handleSeekCommand(e);break;case h.CommandType.VOLUME:this._handleVolumeCommand(e);break;case h.CommandType.PLAY_STATE_CONTEXT:this._handlePlayStateContextCommand(e);break;case h.CommandType.LOGOUT:this._handleLogoutCommand();break;default:E()}},t.prototype._handleSeekCommand=function(e){var t=e.payload;this._listPlayer.seek(t.seekTo)},t.prototype._handleVolumeCommand=function(e){var t=e.payload;this._listPlayer.setVolume(t.volume)},t.prototype._onVolumeChanged=function(e){var t,r;if(this._registered)if(this._registrationInfo&&this._deviceId){this._registrationInfo.clientInstanceInfo.volume=e.data.volume;var n={timestamp:Date.now(),volume:e.data.volume,command_id:null===(t=this._commandIds[h.CommandType.VOLUME])||void 0===t?void 0:t.commandId,command_id_str:null===(r=this._commandIds[h.CommandType.VOLUME])||void 0===r?void 0:r.commandIdStr};this._cloudPlaybackRequest("/volume","POST",n),this._commandIds[h.CommandType.VOLUME]=null}else this.emit("error",{error:new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_DEVICE_DESCRIPTOR,"No device descriptor"),source:_.HarmonyErrorSource.CLOUD_PLAYBACK});else this.emit("error",{error:new f.CloudPlaybackClientError(c.HarmonyErrors.CP_INVALID_STATE,"Cannot update volume when the device is not registered"),source:_.HarmonyErrorSource.CLOUD_PLAYBACK})},t.prototype._handlePlayCommand=function(e){var t=e.payload;this._loading=!0;var r=y.CloudPlaybackList.create({client:this,initialPlayState:t});this._currentList=r,this._listPlayer.play(r,{reason:u.Reason.REMOTE})},t.prototype._handlePlayStateContextCommand=function(e){var t=e.payload,r=this._currentList;r&&(r.updatePlayStateContext(t.context),t.clear_preloaded&&r.clearPreload(),this._emitStateChanged())},t.prototype._handleLogoutCommand=function(){var e=this;this._clearState(),this.deregister().then((function(t){t&&e.emit("logout",null)}))},t.prototype._clearState=function(){var e=this._listPlayer;e.pause().catch((function(){})),e.clear(u.Reason.REMOTE),this._currentList=null,this._currentPlayerState={playback_id:"",duration:0,current_position:0,paused:!0,playbackQuality:{audio_quality:u.PlaybackQuality.UNKNOWN,hifi_status:p.HiFiStatus.NONE}},this.emit("state_cleared",null)},t.prototype._emitStateChanged=function(){var e,t,r=this._currentPlayerState;this.emit("state_changed",{playState:null!==(t=null===(e=this._currentList)||void 0===e?void 0:e.getCurrentPlayState())&&void 0!==t?t:null,position:r.current_position,paused:r.paused,duration:r.duration,loading:this._loading,playbackId:r.playback_id,playbackQuality:r.playbackQuality})},t.prototype._onConnectionId=function(e){this._connectionId=e.data.id,this._isDeregistering||this.register().catch((function(){}))},t.prototype._handleConfigurationResponse=function(e){E()},t.prototype._parseDescriptor=function(e){var t;if(this._registrationInfo)return!1;this._deviceId=e.getId();var r=e.toJSON(),n={type:r.type.toUpperCase(),brand:r.brand,model:r.model,name:r.name,platform_identifier:r.platform_identifier,version:null!==(t=r.platform_version)&&void 0!==t?t:"",volume:1,volume_steps:62},i=["audio/track"];e.getCapability("audio_podcasts")&&i.push("audio/episode"),e.getCapability("video_playback")&&i.push("video/episode");for(var o=[{mime_type:"audio/mp3"}],a=0,s=e.getManifestFormats();a<s.length;a++){var u=s[a],l=T[u];l&&"audio/mp3"!==l.mime_type&&o.push(l)}return this._registrationInfo={clientInstanceInfo:n,supportedMediaContentTypes:i,supportedFileFormats:o},!0},t.prototype._sendConfigurationRequest=function(){if(this._registered)return Promise.resolve(!0);var e=this._registrationInfo;if(!e||!this._deviceId)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_DEVICE_DESCRIPTOR,"No device descriptor"));if(!this._connectionId)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_CONNECTION_ID,"No connection id"));var t={client_instance_info:e.clientInstanceInfo,supported_media_content_types:e.supportedMediaContentTypes,supported_file_formats:e.supportedFileFormats,timestamp:Date.now(),push_channel:{type:"CONNECTION_ID",target:this._connectionId},display_item_window:{previous_items_size:2,next_items_size:2}};return this._cloudPlaybackRequest("","PUT",t).then((function(e){if(200!==e.status){var t=new f.CloudPlaybackClientError(c.HarmonyErrors.CP_REGISTRATION_FAILED_WITH_STATUS,"Registration request failed with status "+e.status);return t.status=e.status,Promise.reject(t)}return!0}))},t.prototype._handlePlayResponse=function(e){var t;return 200!==e.status?((t=new f.CloudPlaybackClientError(c.HarmonyErrors.CP_REQUEST_FAILED_WITH_STATUS,"PlayableItem request failed with status "+e.status)).status=e.status,Promise.reject(t)):e.body?Promise.resolve(e.body):((t=new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_RESPONSE_BODY,"PlayableItem request returns empty body with status "+e.status)).status=e.status,Promise.reject(t))},t.prototype._deregisterFromService=function(){var e=this;return this._deviceId?(this._isDeregistering=!0,this._registered=!1,this._cloudPlaybackRequest("","DELETE").then((function(t){e._isDeregistering=!1;var r=2===t.getStatusFamily();return e._registered=!r,r}),(function(){return e._isDeregistering=!1,e._registered=!0,!1}))):Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"))},t.prototype.register=function(){var e=this;return this._registered?Promise.resolve(!1):(this._registrationInfo?Promise.resolve(!0):this._descriptorPromise.then((function(t){return e._parseDescriptor(t)}))).then((function(){return e._sendConfigurationRequest()})).then((function(t){return t&&null!==e._deviceId&&(e._registered=t,e.emit("registered",{deviceId:e._deviceId})),e._registered}))},t.prototype.skipNextPlayState=function(){var e=this;if(!this._registered)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_INVALID_STATE,"Cannot skip next when the device is not registered"));if(!this._deviceId)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"));var t=Date.now(),r={timestamp:Date.now(),reason:h.SkipReason.NEXTBUTTON};return this._cloudPlaybackRequest("/skip_next","POST",r).then((function(r){return e._logContentRequest("skip_next",t,r),e._handlePlayResponse(r)}))},t.prototype.skipPreviousPlayState=function(){var e=this;if(!this._registered)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_INVALID_STATE,"Cannot skip previous when the device is not registered"));if(!this._deviceId)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"));var t=Date.now(),r={timestamp:Date.now(),reason:h.SkipReason.PREVBUTTON};return this._cloudPlaybackRequest("/skip_previous","POST",r).then((function(r){return e._logContentRequest("skip_previous",t,r),e._handlePlayResponse(r)}))},t.prototype.getNextPlayState=function(){var e=this;if(!this._registered)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_INVALID_STATE,"Cannot get next when the device is not registered"));if(!this._deviceId)return Promise.reject(new f.CloudPlaybackClientError(c.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"));var t=Date.now();return this._cloudPlaybackRequest("/get_next?timestamp="+Date.now(),"GET").then((function(r){return e._logContentRequest("get_next",t,r),e._handlePlayResponse(r)}))},t.prototype.stop=function(){E()},t.prototype.deregister=function(){var e=this;if(!this._registered)return Promise.resolve(!1);var t=Promise.all(this._trackingDataSenderPromises.map((function(e){return e.promise}))).then((function(e){return e.every((function(e){return!0===e}))})).catch((function(){return!1}));return this._listPlayer.stop().catch((function(){})).then((function(){return Promise.race([t,(e=1e3,r=!1,new Promise((function(t){setTimeout((function(){return t(r)}),e)})))]);var e,r})).then((function(t){return t||v.warn("Some tracking data might not being sent."),e._deregisterFromService()}))},t}(s.EventEmitter);r.CloudPlaybackClient=S},{"../../enums/error_source":124,"../../enums/errors":125,"../../enums/hifi_status":127,"../../enums/manifest_format":128,"../../error/cloud_playback/client":130,"./common":101,"./list":102,"@js-sdk/common/es5/promise_resolver":151,"@js-sdk/debug-tools/es5":17,"@js-sdk/playback/es5":80,"@spotify-internal/emitter/es5":98,"@spotify-internal/transport/es5":181,tslib:201}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorType=r.SkipReason=r.ReportingEvent=r.CommandType=r.RepeatMode=r.ImageMetadataSize=r.ItemMetadataContentType=void 0,function(e){e.TRACK="TRACK",e.EPISODE="EPISODE",e.MIXED="MIXED",e.AD="AD"}(r.ItemMetadataContentType||(r.ItemMetadataContentType={})),function(e){e.UNKNOWN="UNKNOWN",e.SMALL="SMALL",e.LARGE="LARGE",e.XLARGE="XLARGE"}(r.ImageMetadataSize||(r.ImageMetadataSize={})),function(e){e.OFF="OFF",e.TRACK="TRACK",e.CONTEXT="CONTEXT"}(r.RepeatMode||(r.RepeatMode={})),function(e){e.PLAY_STATE="PLAY_STATE",e.SEEK="SEEK",e.VOLUME="VOLUME",e.PAUSE="PAUSE",e.RESUME="RESUME",e.STOP="STOP",e.PLAY_STATE_CONTEXT="PLAY_STATE_CONTEXT",e.LOGOUT="LOGOUT"}(r.CommandType||(r.CommandType={})),function(e){e.PAUSE="pause",e.RESUME="resume",e.POSITION_CHANGE="position_change",e.ITEM_READY="item_ready",e.PLAY_PROGRESS="play_progress",e.PLAY_FAILURE="play_failure",e.ITEM_END="item_end"}(r.ReportingEvent||(r.ReportingEvent={})),function(e){e.VOICE="VOICE",e.NEXTBUTTON="NEXTBUTTON",e.PREVBUTTON="PREVBUTTON"}(r.SkipReason||(r.SkipReason={})),function(e){e.UNKNOWN="UNKNOWN",e.DRM="DRM",e.MEDIA_CONTENT_TYPE="MEDIA_CONTENT_TYPE",e.DECODING="DECODING",e.PARSING="PARSING"}(r.ErrorType||(r.ErrorType={}))},{}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CloudPlaybackList=r.parsePlayState=void 0;var n=e("@js-sdk/playback/es5"),i=e("../../enums/errors"),o=e("./common"),a=/^https:\/\//;function s(e,t){for(var r,i,s,u=e.playable_item,l=u.playback,c=0,d=l.descriptors;c<d.length;c++){var _=d[c];"file_id"in _?r=_.file_id:(i=_.url,s=u.reporting.impression_urls);var p=e.context.current_item,f=p.content_type===o.ItemMetadataContentType.AD;if(i&&!a.test(i)&&(i=void 0),r||i){var h=void 0,y=void 0;if("audio/mp3"===_.file_format.mime_type)h=n.MediaFormat.MP3;else if("video/mp4+manifest_id"===_.file_format.mime_type)h=n.MediaFormat.MANIFEST_ID;else if('audio/mp4+file_id; codecs="flac"'===_.file_format.mime_type)h=n.MediaFormat.MP4_FLAC,y=n.AudioFileFormat.MP4_FLAC;else{if('audio/mp4+file_id; codecs="mp4a.40.2"'!==_.file_format.mime_type)continue;switch(_.file_format.key_system){case n.KeySystem.WIDEVINE:h=n.MediaFormat.MP4;break;case n.KeySystem.PLAYREADY:case n.KeySystem.PLAYREADY_HARDWARE:h=n.MediaFormat.MP4_DUAL;break;case n.KeySystem.FAIRPLAY:h=n.MediaFormat.MP4_CBCS;break;default:continue}}var v=!r&&void 0!==i;return{uri:p.uri,fileId:r,resolvedURL:i,isAd:f,playable:!0,format:h,fileFormat:y,mediaType:"VIDEO"===_.media_type?"video":"audio",metadata:{duration:p.estimated_duration,descriptorId:_.id,playbackQuality:_.playback_quality},options:{position:l.start_position,paused:l.paused},noManifest:v,logData:{noLog:f,noTSV:f,noStats:f,playbackId:l.id,displayTrack:p.uri,playContext:e.context.uri,impressionURLs:s,reason:t.reason,deviceId:t.deviceId}}}}return n.ListConstants.NULL_VALUE}r.parsePlayState=s;var u=function(){function e(e){var t;this._currentPlayState=null,this._nextPlayState=null,this._currentStateIndex=null,this._pausedState=!1,this._initialPlaybackPosition=null,this._client=e.client,this._nextPlayState=null!==(t=e.initialPlayState)&&void 0!==t?t:null}return e._handleCloudPlaybackError=function(e){return e&&e.code===i.HarmonyErrors.CP_INVALID_STATE?Promise.resolve(n.ListConstants.FORBIDDEN):Promise.reject(e)},e.create=function(t){return new e(t)},e.prototype.startAt=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setShuffle=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setRepeatMode=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.next=function(t){var r=this;if(t.reason===n.Reason.FORWARD_BUTTON)return this._client.skipNextPlayState().then((function(e){return r._currentPlayState=e.play_state,r._nextPlayState=null,s(e.play_state,{reason:t.reason,deviceId:r._deviceId})})).catch(e._handleCloudPlaybackError);if(this._nextPlayState){var i=this._nextPlayState;return this._currentPlayState=i,this._nextPlayState=null,Promise.resolve(s(i,{reason:t.reason,deviceId:this._deviceId}))}return this._client.getNextPlayState().then((function(e){return r._currentPlayState=e.play_state,r._nextPlayState=null,s(e.play_state,{reason:t.reason,deviceId:r._deviceId})})).catch(e._handleCloudPlaybackError)},e.prototype.peekNext=function(t){var r=this;return this._nextPlayState?Promise.resolve(s(this._nextPlayState,{reason:t.reason,deviceId:this._deviceId})):this._client.getNextPlayState().then((function(e){return r._nextPlayState=e.play_state,s(e.play_state,{reason:t.reason,deviceId:r._deviceId})})).catch(e._handleCloudPlaybackError)},e.prototype.previous=function(t){var r=this;return this._client.skipPreviousPlayState().then((function(e){return r._currentPlayState=e.play_state,r._nextPlayState=null,s(r._currentPlayState,{reason:t.reason,deviceId:r._deviceId})})).catch(e._handleCloudPlaybackError)},e.prototype.allowSeeking=function(){var e,t,r;return!(null===(r=null===(t=null===(e=this._currentPlayState)||void 0===e?void 0:e.context)||void 0===t?void 0:t.restrictions.seek)||void 0===r?void 0:r.length)},e.prototype.getCurrentTrack=function(){return this._currentPlayState?s(this._currentPlayState,{reason:n.Reason.UNKNOWN,deviceId:this._deviceId}):n.ListConstants.NULL_VALUE},e.prototype.getCurrentPlayState=function(){return this._currentPlayState},e.prototype.getReportingMarkers=function(){var e,t,r=null===(e=this._currentPlayState)||void 0===e?void 0:e.playable_item.reporting;return r?{checkin:r.checkin_markers,periodic:null!==(t=r.periodic_checking_interval)&&void 0!==t?t:0}:null},e.prototype.clearPreload=function(){return!!this._nextPlayState&&(this._nextPlayState=null,!0)},e.prototype.updatePlayStateContext=function(e){this._currentPlayState&&(this._currentPlayState.context=e)},e}();r.CloudPlaybackList=u},{"../../enums/errors":125,"./common":101,"@js-sdk/playback/es5":80}],103:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CPPlaybackStateObserver=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("spotify-liburi"),a=e("../../enums/repeat_mode"),s=e("../playback_state_observer"),u={timestamp:Date.now(),context:{uri:null,metadata:{}},duration:0,restrictions:{},disallows:{},track_window:{current_track:null,next_tracks:[],previous_tracks:[]},paused:!0,position:0,repeat_mode:a.RepeatMode.OFF,shuffle:!1,loading:!1,playback_id:null},l={pause:"disallow_pausing_reasons",resume:"disallow_resuming_reasons",seek:"disallow_seeking_reasons",skip_next:"disallow_skipping_next_reasons",skip_prev:"disallow_skipping_prev_reasons",toggle_repeat_context:"disallow_toggling_repeat_context_reasons",toggle_repeat_track:"disallow_toggling_repeat_track_reasons",toggle_shuffle:"disallow_toggling_shuffle_reasons",peek_next:"disallow_peeking_next_reasons",peek_prev:"disallow_peeking_prev_reasons"};var c=function(e){function t(t){var r=e.call(this)||this;return r._state=null,r._client=t,r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){this._client.on("state_changed",this._onStateChanged.bind(this)),this._client.on("state_cleared",this._onStateCleared.bind(this))},t.prototype._onStateChanged=function(e){var t,r;if(null===e.data)return this._state=null,void this.emit("state_changed",{state:null});var i=null!==(t=this._state)&&void 0!==t?t:u,o={},c=i.shuffle,d=i.repeat_mode,_=i.restrictions,p=i.context,f=i.track_window,h=Date.now(),y=e.data,v=y.playState,E=y.position,m=y.paused,g=y.duration,T=y.loading,S=y.playbackQuality,P=y.playbackId;if(v){d=a.RepeatMode[v.context.options.repeat_mode],o=v.context.restrictions,c=v.context.options.shuffled,p={uri:v.context.uri,metadata:v.context};var b=this._parseTrack(v.context.current_item,g,null===(r=v.playable_item.playback.descriptors[0])||void 0===r?void 0:r.media_type);f=n.__assign(n.__assign({},f),{current_track:b,next_tracks:this._getTracks(v.context.next_items),previous_tracks:this._getTracks(v.context.previous_items)})}_=s.parseRestrictions(function(e){var t={};for(var r in e)r&&(t[l[r]]=e[r]);return t}(o),m),this._state={timestamp:h,context:p,duration:g,paused:m,shuffle:c,position:E,loading:T,repeat_mode:d,track_window:f,restrictions:_,disallows:s.parseDisallows(_),playback_id:P,playback_quality:S.audio_quality,playback_features:{hifi_status:S.hifi_status}},this.emit("state_changed",{state:this._state})},t.prototype._onStateCleared=function(){this._state=null,this.emit("state_changed",{state:null})},t.prototype._parseTrack=function(e,t,r){var n,i,a=o.from(e.uri),s="AUDIO"===r?"audio":"video";return{id:a?o.hexToId(a.id):null,uri:e.uri,type:a&&a.type?a.type:"unknown",uid:e.uid,linked_from:{uri:null,id:null},media_type:s,track_type:s,name:e.name,duration_ms:t||e.estimated_duration,artists:e.artists,album:{name:null===(n=e.group)||void 0===n?void 0:n.name,uri:null===(i=e.group)||void 0===i?void 0:i.uri,images:e.images},is_playable:!0}},t.prototype._getTracks=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];this._parseTrack(i)&&t.push(this._parseTrack(i))}return t},t.prototype.getCurrentState=function(){var e=this._state;if(e&&!e.paused){var t=Date.now(),r=e.position+(t-e.timestamp);e.position=r,e.timestamp=t}return Promise.resolve(this._state?n.__assign({},this._state):null)},t}(i.EventEmitter);r.CPPlaybackStateObserver=c},{"../../enums/repeat_mode":129,"../playback_state_observer":113,"@spotify-internal/emitter/es5":98,"spotify-liburi":199,tslib:201}],104:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerAPIClient=r.targetDeviceToId=r.idToTargetDevice=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@spotify-internal/transport/es5/enums/method"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../../typedefs"),u=e("../../enums/device_type"),l=e("../../enums/errors"),c=e("../../error/connect_state/client"),d=e("../helpers/device"),_=/connect-state\/v1\/cluster$/,p=/^([a-zA-Z0-9_%:-]{1,40}).*$/;function f(e){var t,r,n;return!!e.track&&0===(null!==(n=null===(r=null===(t=e.restrictions)||void 0===t?void 0:t.disallow_transferring_playback_reasons)||void 0===r?void 0:r.length)&&void 0!==n?n:0)}function h(e){if(!e)return{deviceId:null};var t=e.split("::a_"),r=t[0],n=t[1];return{deviceId:r,aliasId:n?parseInt(n,10):void 0}}r.idToTargetDevice=h,r.targetDeviceToId=function(e){return e.deviceId?e.aliasId?e.deviceId+"::a_"+e.aliasId:e.deviceId:null};var y=function(e){function t(t){var r=e.call(this)||this;return r._autoregister=!0,r._connectionId="",r._localDeviceId="",r._localObserverDeviceId=null,r._lastActiveDevice=null,r._lastKnownPlayerState=null,r._lastKnownDevices=[],r._localDevice=null,r._fetchedInitialState=!1,r._awaitingAcknowledgment={},r._acknowledgementMaps=[],r._lastProcessedTimestamp=0,r._descriptor=t.descriptor,r._transport=t.transport,r._endpoint=t.endpoint||"@webgate/connect-state",r._autoregister=!("autoregister"in t)||!!t.autoregister,r._onConnectionId=r._onConnectionId.bind(r),r._onClusterMessage=r._onClusterMessage.bind(r),r._awaitResponseWithAck=r._awaitResponseWithAck.bind(r),r._transport.on(r._transport.EVENT_CONNECTION_ID,(function(e){r._onConnectionId(e.data.id)})),r._transport.matchMessages(_,r._onClusterMessage),r._descriptorPromise=Promise.resolve(r._descriptor).then((function(e){return r._localDeviceId=e.id||"",r._localObserverDeviceId=("hobs_"+r._localDeviceId).replace(p,"$1"),!0})),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._onConnectionId=function(e){this._connectionId=e,this._autoregister&&this.register()},t.prototype._onClusterMessage=function(e){var t=e.payloads&&e.payloads[0];if(t){if(t.ack_id){var r=t.ack_id,n=this._awaitingAcknowledgment[r];if(n)n.resolve(!0);else for(var i=0,o=this._acknowledgementMaps;i<o.length;i++){o[i][r]=a.createPromiseResolver()}}this._parseCluster(t.cluster)}},t.prototype._resolveTargetDevice=function(e){var t=this;return this._descriptorPromise.then((function(){var r=t._localDeviceId,n=e;return n?n===s.LOCAL_DEVICE_ID?h(r):h(n):h(t._lastActiveDevice?t._lastActiveDevice.id:r)}))},t.prototype._makeEndpoint=function(e,t,r){var n=this;return this._descriptorPromise.then((function(){var i=n._localDeviceId;return n._endpoint+"/"+e+"/"+t+"/from/"+i+"/to/"+r}))},t.prototype._sendPlayerCommand=function(e,t,r){var n=this;void 0===t&&(t=null),void 0===r&&(r={}),r.endpoint=e;var i={command:r};return this._resolveTargetDevice(t).then((function(e){if(!e.deviceId)throw new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_MISSING_DEVICE_ID,"Operation resulted in a null device id");return!i.target_alias_id&&e.aliasId&&(i.target_alias_id=e.aliasId),n._makeEndpoint("v1","player/command",e.deviceId)})).then((function(e){return n._sendRequest(o.Method.POST,e,i)})).then(this._awaitResponseWithAck)},t.prototype._sendConnectCommand=function(e,t,r){var n=this;void 0===t&&(t=null),void 0===r&&(r={});var i="volume"===e?o.Method.PUT:o.Method.POST,a="volume"===e||"logout"===e;return this._resolveTargetDevice(t).then((function(t){if(!t.deviceId)throw new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_MISSING_DEVICE_ID,"Operation resulted in a null device id");return t.aliasId&&(a?r.command_options={target_alias_id:t.aliasId}:r.target_alias_id||(r.target_alias_id=t.aliasId)),n._makeEndpoint("v1","connect/"+e,t.deviceId)})).then((function(e){return n._sendRequest(i,e,r)})).then(this._awaitResponseWithAck)},t.prototype._sendRequest=function(e,t,r){var n=this._acknowledgementMaps,i={};n.push(i);var o=function(){var e=n.indexOf(i);-1!==e&&n.splice(e,1)};return this._transport.request(t,{method:e,payload:r?JSON.stringify(r):void 0,responseType:"json",retry:{condition:function(e,t){var r=e.getStatusFamily();return r===t.SERVER_ERROR||r===t.CONNECTION_ERROR}}}).then((function(e){return o(),{response:e,map:i}}),(function(e){return o(),Promise.reject(e)}))},t.prototype._awaitResponseWithAck=function(e){var t,r;if(404===e.response.status)return Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_DEVICE,"No such device."));var n=null===(t=e.response.body)||void 0===t?void 0:t.ack_id;if(200===e.response.status&&n){if(null===(r=e.map)||void 0===r?void 0:r[n])return Promise.resolve(!0);var i=a.createPromiseResolver();return this._awaitingAcknowledgment[n]=i,i.promise}return Promise.resolve(202===e.response.status&&!n)},t.prototype._parseCluster=function(e){if(e){var t=parseInt(e.timestamp,10);this._lastProcessedTimestamp>t||(this._lastProcessedTimestamp=t,this._parseClusterDevices(e),this._parseClusterPlayerState(e))}},t.prototype._parseClusterDevices=function(e){var t,r=this._lastActiveDevice;this._lastActiveDevice=null,this._lastKnownDevices=[],this._localDevice=null;var n=[];for(var i in e.devices)e.devices.hasOwnProperty(i)&&n.push(i);if(n.sort(),n.length)for(var o=e.active_device_id,a=0,s=n;a<s.length;a++){i=s[a];var u=e.devices[i],l=this._formatClusterDevice(u,o);(t=this._lastKnownDevices).push.apply(t,l);for(var c=0,_=l;c<_.length;c++){var p=_[c];p.is_active&&(this._lastActiveDevice=p),p.local&&(this._localDevice=p)}}if(!this._fetchedInitialState||!d.areDevicesEqual(this._lastActiveDevice,r)){var h=e.player_state,y=h&&f(h);this.emit("device_state_changed",{deviceState:this._lastActiveDevice,hasOrphanedState:!this._lastActiveDevice&&!!y,disappeared:!!r&&!this._lastActiveDevice})}this.emit("devices_changed",{devices:this._lastKnownDevices,localDevice:this._localDevice})},t.prototype._formatClusterDevice=function(e,t){var r={};if(e&&Array.isArray(e.metadata))for(var i=0,o=e.metadata.length;i<o;i++){var a=e.metadata[i];r[a.type]=a.metadata}var l=e.capabilities||{},c={};"supports_hifi"in l&&(c.hifi_status=l.supports_hifi);var d={hidden:!1,id:e.device_id,is_active:e.device_id===t,is_controllable:!!l.is_controllable,is_observable:!!l.is_observable,local:e.device_id===this._localDeviceId,metadata:r,name:e.name,type:(e.device_type||u.DeviceType.UNKNOWN).toLowerCase(),version:e.device_software_version,volume:l.disable_volume?-1:e.volume/s.GAIA_VOLUME,capabilities:{supports_lossless_audio:!!l.supports_lossless_audio},is_alias:!1,is_alias_group:!1,playback_features:c,is_group:!!e.is_group,is_being_activated:!1};if(!e.device_aliases)return[d];var _=[];for(var p in e.device_aliases)if(e.device_aliases.hasOwnProperty(p)){var f=e.device_aliases[p];if(f){var h=n.__assign(n.__assign({},d),{id:d.id+"::a_"+f.id,name:f.display_name,is_alias:!0,is_alias_group:e.is_group||f.is_group,is_active:d.is_active&&e.selected_alias_id===f.id,is_group:!!f.is_group});_.push(h)}}return _},t.prototype._parseClusterPlayerState=function(e){this._lastKnownPlayerState=null;var t=e.active_device_id,r=t&&e.devices[t],n=e.player_state;n&&n.track&&(r&&r.capabilities&&!r.capabilities.is_observable?n=null:(r||(n.is_paused=!0,n.restrictions&&(delete n.restrictions.disallow_resuming_reasons,n.restrictions.disallow_pausing_reasons=["already_paused"])),n.duration=parseInt(n.duration,10),n.position=parseInt(n.position,10),n.position_as_of_timestamp=parseInt(n.position_as_of_timestamp,10),n.timestamp=parseInt(n.timestamp,10),n.next_tracks=n.next_tracks||[],n.prev_tracks=n.prev_tracks||[]),this._lastKnownPlayerState=n);var i=!r&&!!this._lastKnownPlayerState;i&&n&&!f(n)&&(this._lastKnownPlayerState=null,i=!1),this.emit("player_state_changed",{playerState:this._lastKnownPlayerState,orphaned:i,isLocal:!!t&&t===this._localDeviceId})},t.prototype._register=function(){var e=this;this._fetchedInitialState=!1;var t=this._endpoint+"/v1/devices/"+this._localObserverDeviceId;return this._connectionId||Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_CONNECTION_ID,"Cannot register: no connection id.")),this._transport.request(t,{method:"PUT",headers:{"X-Spotify-Connection-Id":this._connectionId,Accept:"application/json"},payload:JSON.stringify({member_type:"CONNECT_STATE",device:{device_info:{capabilities:{can_be_player:!1,hidden:!0,needs_full_player_state:!0}}}}),responseType:"json"}).then((function(t){429===t.status?e.emit("max_subscriptions_reached",{error:new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_MAX_SUBSCRIPTIONS_REACHED,"Max connections reached")}):200===t.status&&(e.emit("registered",null),t.body&&(e._parseCluster(t.body),e._fetchedInitialState=!0)),429!==t.status&&408!==t.status||(e._lastKnownDevices=e._lastKnownDevices.map((function(e){return e.is_being_activated=!1,e})),e._localDevice&&(e._localDevice.is_being_activated=!1),e.emit("devices_changed",{devices:e._lastKnownDevices,localDevice:e._localDevice}))}))},t.prototype.register=function(){return this._connectionId?this._descriptorPromise.then(this._register.bind(this)):Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_CONNECTION_ID,"Cannot register: no connection id."))},t.prototype.deregister=function(){var e=this,t=this._endpoint+"/v1/devices/"+this._localObserverDeviceId;return this._transport.request(t,{method:"DELETE",responseType:"json"}).then((function(t){200===t.status&&e.emit("deregistered",null)}))},t.prototype.getDevices=function(){var e=this;return this._fetchedInitialState?Promise.resolve({devices:this._lastKnownDevices,localDevice:this._localDevice}):new Promise((function(t){e.once("device_state_changed",(function(){t({devices:e._lastKnownDevices,localDevice:e._localDevice})}))}))},t.prototype.getActiveDevice=function(){var e=this;return this._fetchedInitialState?Promise.resolve(this._lastActiveDevice):new Promise((function(t){e.once("device_state_changed",(function(e){t(e.data.deviceState)}))}))},t.prototype.getContextPlayerState=function(){var e=this;return this._fetchedInitialState?Promise.resolve(this._lastKnownPlayerState):new Promise((function(t){e.once("player_state_changed",(function(e){t(e.data.playerState)}))}))},t.prototype.play=function(e,t){return void 0===t&&(t=null),e?this._sendPlayerCommand("play",t,e):Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_INVALID_ARGUMENTS,"Descriptor is required for play commands"))},t.prototype.updateCurrentContext=function(e,t){var r=this;return void 0===e&&(e=null),void 0===t&&(t={}),this.getContextPlayerState().then((function(n){return n?n.session_id?n.context_url||t.forceNonUpdateable?r._sendPlayerCommand("update_context",e,{context:{url:n.context_url||"context://"+n.context_uri},session_id:n.session_id}):Promise.resolve(!1):Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_SESSION_ID,"The current state does not have a session id")):Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"))}))},t.prototype.setQueue=function(e,t){return this._sendPlayerCommand("set_queue",t,e)},t.prototype.addToQueue=function(e,t){return this._sendPlayerCommand("add_to_queue",t,{track:e})},t.prototype.togglePlay=function(e){var t=this;return this.getContextPlayerState().then((function(r){return r?r.is_paused?t.resume(e):t.pause(e):Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"))}))},t.prototype.transfer=function(e,t){var r,n;void 0===t&&(t={}),this._lastKnownDevices=this._lastKnownDevices.map((function(t){return t.is_being_activated=t.id===e,t})),this._localDevice&&(this._localDevice.is_being_activated=e===s.LOCAL_DEVICE_ID),this.emit("devices_changed",{devices:this._lastKnownDevices,localDevice:this._localDevice});var i={restore_paused:"restore"};return"paused"in t&&(i.restore_paused=t.paused?"pause":"resume"),this._sendConnectCommand("transfer",e||s.LOCAL_DEVICE_ID,{transfer_options:i,page_instance_id:null===(r=t.loggingParams)||void 0===r?void 0:r.pageInstanceId,interaction_id:null===(n=t.loggingParams)||void 0===n?void 0:n.interactionId})},t.prototype.pause=function(e){return this._sendPlayerCommand("pause",e)},t.prototype.resume=function(e){return this._sendPlayerCommand("resume",e)},t.prototype.nextTrack=function(e,t){return this._sendPlayerCommand("skip_next",e,t)},t.prototype.previousTrack=function(e,t){return this._sendPlayerCommand("skip_prev",e,t)},t.prototype.seek=function(e,t){return isNaN(e)||e<0?Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_INVALID_POSITION,"Invalid position.")):this._sendPlayerCommand("seek_to",t,{value:e})},t.prototype.setShuffle=function(e,t){return this._sendPlayerCommand("set_shuffling_context",t,{value:!!e})},t.prototype.toggleShuffle=function(e){var t=this;return this.getContextPlayerState().then((function(r){if(!r)return Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"));var n=r.options&&r.options.shuffling_context;return t.setShuffle(!n,e)}))},t.prototype.setRepeatingContext=function(e,t){return this._sendPlayerCommand("set_repeating_context",t,{value:e})},t.prototype.setRepeatingTrack=function(e,t){return this._sendPlayerCommand("set_repeating_track",t,{value:!!e})},t.prototype.setOptions=function(e,t){return this._sendPlayerCommand("set_options",t,n.__assign({},e))},t.prototype.setVolume=function(e,t){if(isNaN(e)||e<0)return Promise.reject(new c.PlayerAPIClientError(l.HarmonyErrors.CONNECTAPI_CLIENT_INVALID_VOLUME,"Invalid volume."));var r=Math.round(e*s.GAIA_VOLUME);return this._sendConnectCommand("volume",t,{volume:r})},t.prototype.logout=function(e){return this._sendConnectCommand("logout",e)},t}(i.EventEmitter);r.PlayerAPIClient=y},{"../../enums/device_type":123,"../../enums/errors":125,"../../error/connect_state/client":131,"../../typedefs":138,"../helpers/device":109,"@js-sdk/common/es5/promise_resolver":151,"@spotify-internal/emitter/es5":98,"@spotify-internal/transport/es5/enums/method":166,tslib:201}],105:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyController=void 0;var n=e("tslib"),i=e("spotify-liburi"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/debug-tools/es5"),s=e("@js-sdk/playback/es5"),u=e("../enums/hifi_status"),l=e("../enums/repeat_mode"),c=e("../enums/errors"),d=e("../enums/device_deactivated_reason"),_=e("../error/connect_state/client"),p=e("./metadata_decorator"),f=e("./player_queue"),h=a.logging.forTag("harmony.controller"),y=/^disallow_([^]+)_reasons$/,v={disallow_pausing_reasons:!0,disallow_peeking_next_reasons:!0,disallow_peeking_prev_reasons:!0,disallow_resuming_reasons:!0,disallow_seeking_reasons:!0,disallow_skipping_next_reasons:!0,disallow_skipping_prev_reasons:!0,disallow_toggling_repeat_context_reasons:!0,disallow_toggling_repeat_track_reasons:!0,disallow_toggling_shuffle_reasons:!0,disallow_transferring_playback_reasons:!0},E="premium",m="on-demand",g={unknown:s.PlaybackQuality.UNKNOWN,default:s.PlaybackQuality.DEFAULT,low:s.PlaybackQuality.LOW,normal:s.PlaybackQuality.NORMAL,normalized:s.PlaybackQuality.NORMAL,high:s.PlaybackQuality.HIGH,veryhigh:s.PlaybackQuality.VERY_HIGH,hifi:s.PlaybackQuality.HIFI},T={on:u.HiFiStatus.ON,off:u.HiFiStatus.OFF,none:u.HiFiStatus.NONE};function S(e,t){if(!e)return[];for(var r=[],n=[i.Type.TRACK,i.Type.EPISODE],o=0,a=e.length;o<a;o++){var s=e[o];if(!s)throw new TypeError("Null value inside track array.");var u=void 0;if("string"==typeof s?(u=i.from(s),s={uri:s}):u=i.from(s.uri),!/^spotify:(meta:|delimiter)/.test(s.uri)){if(!u)throw new TypeError("Invalid uri string: "+u);if(-1===n.indexOf(u.type))throw new TypeError("Invalid track uri: "+s.uri)}s.metadata||(s.metadata={}),t&&t.queued&&(s.metadata.is_queued="true"),r.push(s)}return r}function P(e){if(e){if(/^.+:\/\//.test(e))return e;throw new TypeError("Invalid page url: "+e)}}var b=function(e){function t(t){var r=e.call(this)||this;return r._suppressed=!1,r._lastDeviceInfoData=null,r._state=null,r._lastPlayerState=null,r._isOrphanedState=!1,r._progressPosition=0,r._lastProgressTs=0,r._trackingIntervalId=0,r._queue=null,r._client=t.client,r._serverTime=t.serverTime,r._version=t.version,r._playerClient=t.playerClient,r._disableProgress=!!t.disableProgress,r._transport=r._client.getPublicTransport(),r._decorate=!!t.decorateTrackWindow,r._metadataDecorator=new p.MetadataDecorator({transport:r._transport}),r._onClientBeforeDisconnect=r._onClientBeforeDisconnect.bind(r),r._onDeviceStateChanged=r._onDeviceStateChanged.bind(r),r._onPlayerStateChanged=r._onPlayerStateChanged.bind(r),r._onProgressTracking=r._onProgressTracking.bind(r),r._client.on("before_disconnect",r._onClientBeforeDisconnect),r.proxyEmit(r._playerClient,"max_subscriptions_reached","max_subscriptions_reached"),r.proxyEmit(r._playerClient,"devices_changed","devices_changed"),r.proxyEmit(r._playerClient,"registered","registered"),r.proxyEmit(r._playerClient,"deregistered","deregistered"),r._playerClient.on("device_state_changed",r._onDeviceStateChanged),r._playerClient.on("player_state_changed",r._onPlayerStateChanged),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._onClientBeforeDisconnect=function(e){e&&e.data.awaitPromise(this._playerClient.deregister().catch((function(){})))},t.prototype._onDeviceStateChanged=function(e){var t,r,n=this,i=e.data,o=i.deviceState,a=i.hasOrphanedState,s=!!(null===(r=null===(t=this._lastDeviceInfoData)||void 0===t?void 0:t.deviceInfo)||void 0===r?void 0:r.local);this._lastDeviceInfoData={deviceInfo:o,hasOrphanedState:a},s&&!(null==o?void 0:o.local)&&this._playerClient.getDevices().then((function(e){var t=e.localDevice,r=d.DeviceDeactivatedReason.STOPPED;a?t||(r=d.DeviceDeactivatedReason.LOCAL_PLAYER_DISABLED):r=d.DeviceDeactivatedReason.REMOTE_ACTIVATED,n.emit("device_deactivated",{reason:r})})).catch((function(e){h.warn("Device deactivation checking failed.",e)})),this._suppressed||this.emit("device_info_changed",this._lastDeviceInfoData)},t.prototype._startProgressTracking=function(){this._stopProgressTracking(),this._lastProgressTs=Date.now(),this._onProgressTracking(),this._trackingIntervalId=setInterval(this._onProgressTracking,500)},t.prototype._stopProgressTracking=function(){this._trackingIntervalId&&(clearInterval(this._trackingIntervalId),this._trackingIntervalId=0)},t.prototype._onProgressTracking=function(){var e,t=Date.now(),r=(null===(e=this._lastPlayerState)||void 0===e?void 0:e.playback_speed)||1;this._progressPosition+=r*(t-this._lastProgressTs),this.emit("progress",{position:this._progressPosition,timestamp:Date.now()}),this._lastProgressTs=t},t.prototype._getLicense=function(){return this._client.getProductState().then((function(e){return"premium"===e.product?E:m})).catch((function(){return m}))},t.prototype._generatePlayOptions=function(e,t){return this._getLicense().then((function(r){var n={license:r};if(!e)return n;if(("index"in e||"trackUID"in e||"trackURI"in e||"pageIndex"in e)&&(n.skip_to={track_uid:e.trackUID,track_index:e.index,track_uri:e.trackURI,page_index:e.pageIndex}),"initialOffset"in e&&(n.seek_to=e.initialOffset),"paused"in e&&(n.initially_paused=e.paused),"alwaysPlaySomething"in e&&(n.always_play_something=e.alwaysPlaySomething),t)return n;n.player_options_override={};var i=n.player_options_override;if("shuffle"in e&&(i.shuffling_context=e.shuffle),"repeatMode"in e)switch(e.repeatMode){case l.RepeatMode.CONTEXT:i.repeating_context=!0,i.repeating_track=!1;break;case l.RepeatMode.TRACK:i.repeating_track=!0,i.repeating_context=!1;break;case l.RepeatMode.OFF:i.repeating_track=!1,i.repeating_context=!1}return n}))},t.prototype._setFilterAndSort=function(e,t){t&&t.filter&&e.metadata&&(e.metadata["filtering.predicate"]=t.filter),t&&t.sort&&e.metadata&&(e.metadata["sorting.criteria"]=t.sort)},t.prototype._setMetadataOptions=function(e,t){if(t){var r=e.metadata||{};"autoplayCandidate"in t&&(r.autoplay_candidate=t.autoplayCandidate?"true":"false"),e.metadata=r}},t.prototype._generatePlayOrigin=function(e){if(e&&e.featureClasses&&!Array.isArray(e.featureClasses))throw new TypeError("PlayOptions playOrigin.featureClasses must be an array of strings.");return{feature_identifier:e&&e.featureIdentifier||"harmony",feature_version:e&&e.featureVersion||this._version,feature_classes:e&&e.featureClasses,view_uri:e&&e.viewURI,external_referrer:e&&e.externalReferrer,referrer_identifier:e&&e.referrerIdentifier}},t.prototype._generateLoggingParams=function(e){var t=e.pageInstanceId,r=e.interactionId;return{page_instance_ids:t?[t]:[],interaction_ids:r?[r]:[]}},t.prototype._parseRestrictions=function(e){var t={};for(var r in e.restrictions)e.restrictions.hasOwnProperty(r)&&v[r]?t[r]=e.restrictions[r]:v[r]&&(t[r]=[]);return t},t.prototype._parseDisallows=function(e){var t={},r=e.restrictions;for(var n in r)if(r.hasOwnProperty(n)&&v[n]){var i=r[n],o=!(!i||!i.length);t[n.replace(y,"$1")]=o}return t},t.prototype._onPlayerStateChanged=function(e){var t=this;this._isOrphanedState=e.data.orphaned,this._parsePlayerState(e.data.playerState).then((function(r){t._state=r,t._suppressed||t.emit("state_changed",{state:r?n.__assign({},r):null,orphaned:e.data.orphaned}),!t._disableProgress&&r&&(t._progressPosition=r.position,r.paused?t._stopProgressTracking():t._startProgressTracking())}))},t.prototype._parsePlayerState=function(e){var t=this;return this._lastPlayerState=e,e?this._getTrackWindow(e).then((function(r){var n,i,o,a,u,l,c,d;return{context:{uri:e.context_uri||null,metadata:e.context_metadata||{}},timestamp:e.timestamp,duration:e.duration||r.current_track&&"uri"in r.current_track&&r.current_track.duration_ms||0,position:e.is_paused?e.position_as_of_timestamp:t._offsetPosition(e.timestamp,e.position_as_of_timestamp,null===(n=t._lastPlayerState)||void 0===n?void 0:n.playback_speed),playback_id:null,playback_quality:null!==(a=g[null!==(o=null===(i=e.playback_quality)||void 0===i?void 0:i.bitrate_level)&&void 0!==o?o:"unknown"])&&void 0!==a?a:s.PlaybackQuality.UNKNOWN,playback_features:{hifi_status:T[null!==(l=null===(u=e.playback_quality)||void 0===u?void 0:u.hifi_status)&&void 0!==l?l:"none"]},paused:!!e.is_paused,shuffle:!(!e.options||!e.options.shuffling_context),repeat_mode:t._getStateRepeatMode(e),restrictions:t._parseRestrictions(e),disallows:t._parseDisallows(e),track_window:r,bitrate:null,loading:null!==(d=null===(c=t._state)||void 0===c?void 0:c.loading)&&void 0!==d&&d}})):Promise.resolve(null)},t.prototype._offsetPosition=function(e,t,r,n){void 0===r&&(r=1);var i=t+((n||this._serverTime.getApproximate())-e)*r;return i<0?0:i},t.prototype._isRestricted=function(e,t){if(!e||!e.restrictions)return!1;var r="disallow_"+t+"_reasons";return!!(e.restrictions[r]||[]).length},t.prototype._getTrackWindow=function(e){var t={current_track:null,next_tracks:[],previous_tracks:[]},r={},n=[];if(!e.track)return Promise.resolve(t);var o=e.track.uri;if(!o)return Promise.resolve(t);var a=this._metadataDecorator,s=i.from(o),u=a.formatLocalTrack(s,e.track.uid),l=a.formatAd(s,e.track);return t.current_track=u||l||{uri:o,uid:e.track.uid,type:s&&s.type?s.type:"unknown"},u||l||(r[o]=1,n.push(o)),this._isRestricted(e,"peeking_next")||this._fillWindow(n,t.next_tracks,r,e.next_tracks?e.next_tracks.slice(0,5):[]),this._isRestricted(e,"peeking_prev")||this._fillWindow(n,t.previous_tracks,r,e.prev_tracks?e.prev_tracks.slice(-5):[],!0),this._decorate?this._metadataDecorator.decorateTrackWindow(t,n):Promise.resolve(t)},t.prototype._fillWindow=function(e,t,r,n,o){o&&n.reverse();for(var a=0,s=n;a<s.length;a++){var u=s[a],l=u.uri,c=i.from(l);if(l&&"spotify:delimiter"!==l&&(!c||c.type!==i.Type.AD&&c.type!==i.Type.INTERRUPTION)){var d=this._metadataDecorator.formatLocalTrack(c,u.uid),_=d||{uri:l,uid:u.uid,type:"unknown"};if(d||l in r||(r[l]=1,e.push(l)),o?t.unshift(_):t.push(_),2===t.length)break}}},t.prototype._getStateRepeatMode=function(e){var t=e.options;return t&&t.repeating_track?l.RepeatMode.TRACK:t&&t.repeating_context?l.RepeatMode.CONTEXT:l.RepeatMode.OFF},t.prototype._play=function(e,t,r){var n=this;return this._setFilterAndSort(e,r),this._setMetadataOptions(e,r),this._generatePlayOptions(r).then((function(i){var o={context:e,play_origin:n._generatePlayOrigin(r&&r.playOrigin),options:i};return(null==r?void 0:r.loggingParams)&&(o.logging_params=n._generateLoggingParams(r.loggingParams)),n._playerClient.play(o,t)}))},t.prototype.getActiveDevice=function(){return this._playerClient.getActiveDevice()},t.prototype.getCurrentState=function(e){var t;if(e&&this._isOrphanedState)return Promise.resolve(null);var r=this._state;if(r&&!r.paused){var i=this._serverTime.getApproximate();r.position=this._offsetPosition(r.timestamp,r.position,null===(t=this._lastPlayerState)||void 0===t?void 0:t.playback_speed,i),r.timestamp=i}return Promise.resolve(r?n.__assign({},r):null)},t.prototype.getContextPlayerState=function(){return h.warn("The `getContextPlayerState()` method is not well supported. Please avoid using it directly."),this._playerClient.getContextPlayerState()},t.prototype.getDevices=function(){return this._playerClient.getDevices()},t.prototype.playURI=function(e,t,r){if(!i.from(e))return Promise.reject(new TypeError("Invalid Spotify URI"));var n={uri:e,url:"context://"+e,metadata:r&&r.contextMetadata||{}};return this._play(n,t,r)},t.prototype.playPages=function(e,t,r){var n,i;if(!Array.isArray(e))return Promise.reject(new TypeError("Invalid pages array."));try{i=function(e){for(var t,r,n,i=[],o=0,a=e;o<a.length;o++){var s=a[o];i.push({tracks:Array.isArray(s.tracks)?S(s.tracks):void 0,page_url:null!==(t=P(s.pageURL))&&void 0!==t?t:void 0,next_page_url:null!==(r=P(s.nextPageURL))&&void 0!==r?r:void 0,metadata:null!==(n=s.metadata)&&void 0!==n?n:void 0})}return i}(e)}catch(e){return Promise.reject(e)}var o={uri:null!==(n=null==r?void 0:r.contextURI)&&void 0!==n?n:"spotify:internal:harmony-play-pages",metadata:(null==r?void 0:r.contextMetadata)||{},pages:i};return this._play(o,t,r)},t.prototype.playTracks=function(e,t,r){var n,i;if(!Array.isArray(e))return Promise.reject(new TypeError("Invalid tracks array."));try{i=S(e)}catch(e){return Promise.reject(e)}var o={uri:null!==(n=null==r?void 0:r.contextURI)&&void 0!==n?n:"spotify:internal:harmony-play-tracks",metadata:(null==r?void 0:r.contextMetadata)||{},pages:[{tracks:i}]};return this._play(o,t,r)},t.prototype.updateCurrentContext=function(e,t){return void 0===t&&(t={}),this._playerClient.updateCurrentContext(e,t)},t.prototype.setQueue=function(e,t,r){if(!Array.isArray(e))return Promise.reject(new TypeError("Invalid nextTracks array."));if(!Array.isArray(t))return Promise.reject(new TypeError("Invalid previousTracks array."));var n,i;try{n=S(e),i=S(t)}catch(e){return Promise.reject(e)}var o={next_tracks:n.length?n:void 0,prev_tracks:i.length?i:void 0};return this._playerClient.setQueue(o,r)},t.prototype.togglePlay=function(e){return this._playerClient.togglePlay(e)},t.prototype.transfer=function(e,t){return void 0===t&&(t={}),this._playerClient.transfer(e,t)},t.prototype.pause=function(e){return this._playerClient.pause(e)},t.prototype.resume=function(e){return this._playerClient.resume(e)},t.prototype.nextTrack=function(e,t){var r={};return(null==t?void 0:t.track)&&(r.track=f.createContextTracks([t.track])[0]),this._playerClient.nextTrack(e,r)},t.prototype.previousTrack=function(e,t){var r={};return(null==t?void 0:t.track)&&(r.track=f.createContextTracks([t.track])[0]),this._playerClient.previousTrack(e,r)},t.prototype.seek=function(e,t){return this._playerClient.seek(e,t)},t.prototype.setShuffle=function(e,t){return this._playerClient.setShuffle(e,t)},t.prototype.toggleShuffle=function(e){return this._playerClient.toggleShuffle(e)},t.prototype.setVolume=function(e,t){return this._playerClient.setVolume(e,t)},t.prototype.logout=function(e){return this._playerClient.logout(e)},t.prototype.setRepeatMode=function(e,t){var r=this;return this.getCurrentState().then((function(n){if(!n)return Promise.reject(new _.PlayerAPIClientError(c.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"));var i=r._playerClient,o=n.disallows;switch(e){case l.RepeatMode.OFF:return(!o.toggling_repeat_context||!o.toggling_repeat_track)&&i.setOptions({repeating_context:!!o.toggling_repeat_context&&void 0,repeating_track:!!o.toggling_repeat_track&&void 0},t);case l.RepeatMode.CONTEXT:return!o.toggling_repeat_context&&i.setOptions({repeating_context:!0,repeating_track:!!o.toggling_repeat_track&&void 0},t);case l.RepeatMode.TRACK:return!o.toggling_repeat_track&&i.setOptions({repeating_context:!o.toggling_repeat_context||void 0,repeating_track:!0},t);default:return Promise.reject(new TypeError("Unknown repeat mode."))}}))},t.prototype.register=function(){return this._playerClient.register()},t.prototype.suppressEvents=function(){this._suppressed=!0},t.prototype.unsuppressEvents=function(){this._suppressed=!1,this._lastDeviceInfoData&&this.emit("device_info_changed",this._lastDeviceInfoData),this._state&&this.emit("state_changed",{state:this._state})},t.prototype.getQueueManager=function(e,t){if(void 0===t&&(t={}),!this._queue){var r=t.reportInitial?this._lastPlayerState:null;this._queue=new f.QueueManager(n.__assign({connectClient:this._playerClient,initialContextPlayerState:r,runner:e},t))}return this._queue},t}(o.EventEmitter);r.HarmonyController=b},{"../enums/device_deactivated_reason":122,"../enums/errors":125,"../enums/hifi_status":127,"../enums/repeat_mode":129,"../error/connect_state/client":131,"./metadata_decorator":112,"./player_queue":114,"@js-sdk/debug-tools/es5":17,"@js-sdk/playback/es5":80,"@spotify-internal/emitter/es5":98,"spotify-liburi":199,tslib:201}],106:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceDescriptor=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5"),o=e("@spotify-internal/emitter/es5"),a=e("../enums/device_type"),s=e("../utils/device_id"),u=e("./helpers/capitalize"),l=function(e){function t(t){var r,n=e.call(this)||this;if(n._platformVersion="",n._metadata={},n._manifestPrependOffset=0,!t)throw new TypeError("Invalid argument `options`.");if(!t.id)throw new TypeError("Argument `options.id` is required.");if(!t.name||!t.model||!t.type)throw new TypeError("Incomplete `options` value.");return n._id=t.id,n._type=t.type,n._brand=t.brand,n._model=t.model,n._isGroup=!!t.is_group,n._name=t.name,n._platformName=t.platform_name,n._platformIdentifier=t.platform_identifier,n._platformVersion=t.platform_version||"",n._metadata=t.metadata||{},n._capabilities=t.capabilities||{manifest_formats:[]},n._manifestPrependOffset=(null===(r=n._capabilities.manifest_formats)||void 0===r?void 0:r.length)||0,n}return n.__extends(t,e),t.create=function(e){return new t({id:s.DeviceId.get(e.id,e.randomizeId),model:e.model||i.interpolateUA("harmony-{{name}}.{{version}}-{{platform}}").toLowerCase(),name:e.nameTemplate?i.interpolateUA(e.nameTemplate):e.name||u.capitalize(i.interpolateUA("Spotify ({{name}}/{{platform}})")),type:e.type||a.DeviceType.COMPUTER,brand:e.brand||"SpotifyHarmonyGeneric",platform_name:e.platform_name,platform_identifier:e.platform_identifier,platform_version:e.platform_version,metadata:e.metadata||{},capabilities:e.capabilities||{},is_group:!!e.is_group})},t.prototype.getId=function(){return this._id},t.prototype.setCapability=function(e,t){switch(e){case"manifest_formats":throw new TypeError('Cannot change capability "manifest_formats"');default:return this._capabilities[e]=t,this.emit("descriptor_changed",{descriptor:this.toJSON()}),!0}},t.prototype.getCapability=function(e){switch(e){case"manifest_formats":throw new TypeError("Use `descriptor.getManifestFormats()`.");default:return this._capabilities[e]}},t.prototype.setName=function(e){return this._name=e,this.emit("descriptor_changed",{descriptor:this.toJSON()}),!0},t.prototype.getName=function(){return this._name},t.prototype.getType=function(){return this._type},t.prototype.getBrand=function(){return this._brand},t.prototype.getModel=function(){return this._model},t.prototype.getPlatformIdentifier=function(){return this._platformIdentifier||"Partner "+this._brand+" "+this._model},t.prototype.getPlatformName=function(){return this._platformName||this.getPlatformIdentifier()},t.prototype.getPlatformVersion=function(){return this._platformVersion},t.prototype.getManifestFormats=function(){return this._capabilities.manifest_formats||[]},t.prototype.appendManifestFormat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._capabilities.manifest_formats;Array.isArray(r)&&r.push.apply(r,e)},t.prototype.prependManifestFormat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._capabilities.manifest_formats;Array.isArray(r)&&r.splice.apply(r,n.__spreadArray([this._manifestPrependOffset,0],e))},t.prototype.toJSON=function(){return{brand:this._brand,capabilities:n.__assign({},this._capabilities),id:this._id,metadata:n.__assign({},this._metadata),model:this._model,name:this._name,platform_name:this._platformName,platform_identifier:this._platformIdentifier,platform_version:this._platformVersion,type:this._type}},t.prototype.toTrackPlaybackDeviceInfo=function(){return{brand:this._brand,capabilities:n.__assign({},this._capabilities),device_id:this._id,device_type:this._type,metadata:n.__assign({},this._metadata),model:this._model,name:this._name,platform_name:this._platformName,platform_identifier:this._platformIdentifier,is_group:this._isGroup}},t}(o.EventEmitter);r.DeviceDescriptor=l},{"../enums/device_type":123,"../utils/device_id":141,"./helpers/capitalize":108,"@js-sdk/common/es5":143,"@spotify-internal/emitter/es5":98,tslib:201}],107:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Harmony=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/playback/es5/enums/reason"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../typedefs"),u=e("../enums/harmony_event"),l=e("../enums/errors"),c=e("../enums/error_source"),d=e("../enums/repeat_mode"),_=e("../error/harmony_error"),p=e("./helpers/device"),f=e("./player_queue"),h=function(e){function t(t){var r=e.call(this)||this;return r._hasFakeState=!1,r._localPlayerEnabled=!1,r._localPlayback=!1,r._lastDeviceList=[],r._deferredStreamer=a.createPromiseResolver(),r._client=t.client,r._streamer=t.streamer,r._controller=t.controller,r._hidden=!!t.hidden,r._onlyLocalState=!!t.onlyLocalState,r._preferController=!r._onlyLocalState&&!!t.preferControllerState,r._claimInactivePlayerStates=!!t.claimInactivePlayerStates,r._enableControllerWithoutStreamer=!!t.enableControllerWithoutStreamer,r._autoActivateElement=!!t.autoActivateElement,r._deactivateOnStop=!!t.experimentalDeactivateOnStop,r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e,t=this;this._createStreamerDeferred();var r=this._client;r.on("error",this._onError.bind(this)),this.proxyEmit(r,"authenticated",u.HarmonyEvent.AUTHENTICATED),this.proxyEmit(r,"authentication_error",u.HarmonyEvent.AUTHENTICATION_ERROR),this.proxyEmit(r,"before_disconnect",u.HarmonyEvent.BEFORE_DISCONNECT),this.proxyEmit(r,"connected",u.HarmonyEvent.CONNECTED),this.proxyEmit(r,"connection_error",u.HarmonyEvent.CONNECTION_ERROR),this.proxyEmit(r,"descriptor_changed",u.HarmonyEvent.DEVICE_DESCRIPTOR_CHANGED),this.proxyEmit(r,"product_state_changed",u.HarmonyEvent.PRODUCT_STATE_CHANGED),this.proxyEmit(r,"reconnected",u.HarmonyEvent.RECONNECTED),this.proxyEmit(r,"reconnecting",u.HarmonyEvent.RECONNECTING),this.proxyEmit(r,"unrecoverable_failure",u.HarmonyEvent.UNRECOVERABLE_FAILURE),this.proxyEmit(r,"logged_out",u.HarmonyEvent.LOGGED_OUT);var n=this._controller;n.on("device_info_changed",(function(e){t._onDeviceStateChanged(e.data)})),n.on("devices_changed",this._onDevicesChanged.bind(this)),n.on("state_changed",this._onPlayerStateChanged.bind(this)),n.on("progress",this._onControllerProgress.bind(this)),this.proxyEmitAll(n,((e={}).max_subscriptions_reached=u.HarmonyEvent.MAX_SUBSCRIPTIONS_REACHED,e.device_deactivated=u.HarmonyEvent.DEVICE_DEACTIVATED,e)),n.on("registered",this.emit.bind(this,u.HarmonyEvent.REMOTE_OBSERVER_ENABLED,null)),n.on("deregistered",this.emit.bind(this,u.HarmonyEvent.REMOTE_OBSERVER_DISABLED,null));var i=this._streamer;i?(i.on("deregistered",this._onStreamerDeregistered.bind(this)),i.on("registered",this._onStreamerRegistered.bind(this)),i.on("registration_aborted",this._onStreamerRegistrationAborted.bind(this)),i.on("state_changed",this._onStreamerStateChanged.bind(this)),i.on("stopped_on_background",this._onStreamerStoppedOnBackground.bind(this)),i.on("streamer_seek_handled",this._onSeekHandled.bind(this)),this.proxyEmitSync(i,"before_volume_change",u.HarmonyEvent.BEFORE_VOLUME_CHANGE),this.proxyEmit(i,"autoplay_failed",u.HarmonyEvent.AUTOPLAY_FAILED),this.proxyEmit(i,"stalled",u.HarmonyEvent.BUFFER_STALLED),this.proxyEmit(i,"buffering_end",u.HarmonyEvent.BUFFERING_END),this.proxyEmit(i,"buffering_start",u.HarmonyEvent.BUFFERING_START),this.proxyEmit(i,"duration_changed",u.HarmonyEvent.DURATION_CHANGED),this.proxyEmit(i,"max_list_errors_reached",u.HarmonyEvent.MAX_LIST_ERRORS_REACHED),this.proxyEmit(i,"max_subscriptions_reached",u.HarmonyEvent.MAX_SUBSCRIPTIONS_REACHED),this.proxyEmit(i,"playback_capped",u.HarmonyEvent.PLAYBACK_CAPPED),this.proxyEmit(i,"player_initialization_done",u.HarmonyEvent.PLAYER_INITIALIZATION_DONE),this.proxyEmit(i,"player_initialization_failed",u.HarmonyEvent.PLAYER_INITIALIZATION_FAILED),this.proxyEmit(i,"progress",u.HarmonyEvent.PROGRESS),this.proxyEmit(i,"registration_error",u.HarmonyEvent.SERVICE_REGISTRATION_ERROR),this.proxyEmit(i,"track_ended",u.HarmonyEvent.TRACK_ENDED),this.proxyEmit(i,"video_element_appended",u.HarmonyEvent.VIDEO_ELEMENT_APPENDED),this.proxyEmit(i,"video_element_removed",u.HarmonyEvent.VIDEO_ELEMENT_REMOVED),this.proxyEmit(i,"volume_changed",u.HarmonyEvent.VOLUME_CHANGED),this.proxyEmit(i,"displayed_cues_changed",u.HarmonyEvent.DISPLAYED_CUES_CHANGED),this.proxyEmit(i,"subtitle_languages_loaded",u.HarmonyEvent.SUBTITLE_LANGUAGES_LOADED),this.proxyEmitSync(i,"internal_endcontent","internal_endcontent"),i.on("context_ended",this.emit.bind(this,u.HarmonyEvent.LOCAL_CONTEXT_ENDED,null)),i.on("logged_out",this.emit.bind(this,u.HarmonyEvent.LOCAL_PLAYER_LOGGED_OUT,null))):(this._disableLocalTarget(),this.on(u.HarmonyEvent.AUTHENTICATED,(function(){t.emit(u.HarmonyEvent.LOCAL_PLAYER_DISABLED,null)})))},t.prototype._createStreamerDeferred=function(){this._deferredStreamer=a.createPromiseResolver(),this._deferredStreamer.promise.catch((function(){}))},t.prototype._isTargetIdLocal=function(e){return e?e===s.LOCAL_DEVICE_ID?Promise.resolve(!0):this._client.getDeviceDescriptor().then((function(t){return e===t.getId()})):Promise.resolve(!!this._localPlayback)},t.prototype._onStreamerRegistered=function(e){this._deferredStreamer.resolve(e.data),this._createStreamerDeferred(),this._deferredStreamer.resolve(e.data),this._localPlayerEnabled=!0,this._controller.register(),this.emit(u.HarmonyEvent.LOCAL_PLAYER_ENABLED,null)},t.prototype._onStreamerDeregistered=function(){this._disableLocalTarget(),this.emit(u.HarmonyEvent.LOCAL_PLAYER_DISABLED,null)},t.prototype._onStreamerRegistrationAborted=function(){this._disableLocalTarget(),this._enableControllerWithoutStreamer&&this._controller.register(),this.emit(u.HarmonyEvent.LOCAL_PLAYER_DISABLED,null)},t.prototype._disableLocalTarget=function(){this._localPlayerEnabled=!1;var e=new _.HarmonyError(l.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"Cannot perform command; local player is disabled.");this._deferredStreamer.reject(e),this._createStreamerDeferred(),this._deferredStreamer.reject(e)},t.prototype._onStreamerConnect=function(){return this._deferredStreamer.promise},t.prototype._onDeviceStateChanged=function(e){var t=this,r=!!this._localPlayback,n=function(e){void 0===e&&(e=!1),t._generateLocalDeviceInfo(e).then((function(e){t.emit(u.HarmonyEvent.LAST_ACTIVE_DEVICE_INFO_CHANGED,{deviceInfo:e,hasOrphanedState:!1})}))};if(this._localPlayerEnabled&&e.hasOrphanedState&&this._claimInactivePlayerStates)return this._hasFakeState=!0,void n(!0);if(this._hasFakeState=!1,this._localPlayback=!(!e.deviceInfo||!e.deviceInfo.local),this._localPlayback){if(!this._streamer)throw new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.");this._streamer.getVolume().then((function(r){e.deviceInfo&&(e.deviceInfo.volume=r),t.emit(u.HarmonyEvent.LAST_ACTIVE_DEVICE_INFO_CHANGED,e)})).catch((function(){}))}else this._onlyLocalState?(this._localPlayback||r)&&n():this.emit(u.HarmonyEvent.LAST_ACTIVE_DEVICE_INFO_CHANGED,e)},t.prototype._onDevicesChanged=function(e){var t=this,r=this._lastDeviceList;this._parseDeviceList(e.data).then((function(e){p.areDeviceListsEqual(r,e)||t.emit(u.HarmonyEvent.DEVICES_CHANGED,{devices:e,localDevice:null})}))},t.prototype._onError=function(e){var t=e.data.error;e.data.source===c.HarmonyErrorSource.PLAYBACK&&t&&t.unrecoverable&&(this._disableLocalTarget(),this._streamer&&this._streamer.deregister()),this.emit(u.HarmonyEvent.ERROR,e.data)},t.prototype._onPlayerStateChanged=function(e){if(!this._onlyLocalState&&(this._preferController||!this._localPlayback)){var t=void 0;t=this._localPlayerEnabled&&this._claimInactivePlayerStates?e.data.state:e.data.orphaned?null:e.data.state,this.emit(u.HarmonyEvent.STATE_CHANGED,{state:t})}},t.prototype._onControllerProgress=function(e){this._onlyLocalState||this._localPlayback||this.emit(u.HarmonyEvent.PROGRESS,e.data)},t.prototype._onStreamerStateChanged=function(e){this._preferController||(this._onlyLocalState?this._triggerLocalStateChanges(e.data):this._hidden?this._handleHidden(e.data):this._localPlayback&&this.emit(u.HarmonyEvent.STATE_CHANGED,e.data))},t.prototype._onStreamerStoppedOnBackground=function(){this._deactivateOnStop&&(this._localPlayback=!1),this.emit(u.HarmonyEvent.STOPPED_ON_BACKGROUND,null)},t.prototype._handleHidden=function(e){e.state?(this._controller.suppressEvents(),this._triggerLocalStateChanges(e)):this._controller.unsuppressEvents()},t.prototype._parseDeviceList=function(e){var t=this,r=e.devices.slice(0).map((function(e){return Promise.resolve(e)}));return r.length&&e.localDevice?this._hasFakeState&&e.localDevice&&(e.localDevice.is_active=!0):r.push(this._generateLocalDeviceInfo(this._hasFakeState)),Promise.all(r).then((function(e){return t._lastDeviceList=e,e}))},t.prototype._triggerLocalStateChanges=function(e){var t=this;this._generateLocalDeviceInfo().then((function(e){t._onDeviceStateChanged({deviceInfo:e,hasOrphanedState:!1})})),this.emit(u.HarmonyEvent.STATE_CHANGED,e)},t.prototype._canStartNewContext=function(e){var t=this;return this._runOnDevice(e,(function(){return t._streamer?Promise.resolve(!0):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided."))}),(function(){return Promise.resolve(!0)}),!0)},t.prototype._activateElement=function(){this._autoActivateElement=!1,this._streamer&&this._streamer.activateElement().catch((function(){}))},t.prototype._runOnDevice=function(e,t,r,n){var i=this;return void 0===e&&(e=void 0),this._hasFakeState&&!n?(this._autoActivateElement&&this._activateElement(),this._claimStateAndRun(r)):this._isTargetIdLocal(e).then((function(e){return e?i._onStreamerConnect().then(t):r()}))},t.prototype._claimStateAndRun=function(e){var t=this;return this._onStreamerConnect().then((function(){return t._hasFakeState=!1,Promise.all([t._controller.transfer(s.LOCAL_DEVICE_ID,{paused:!0}),new Promise((function(e,r){t._streamer?t._streamer.once("track_loaded",e):r(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided."))}))])})).then((function(){return e()}))},t.prototype._generateLocalDeviceInfo=function(e){var t=this;void 0===e&&(e=!1);var r=this._client,n=this._streamer,i=Promise.resolve(!1),o=Promise.resolve(-1);return this._localPlayerEnabled&&(e?i=Promise.resolve(!0):n&&(i=n.getCurrentState().then((function(e){return!!e}))),n&&(o=n.getVolume())),Promise.all([r.getClientDescriptor(),r.getSDKId(),i,o]).then((function(e){var r,n=e[0],i=e[1],o=e[2],a=e[3],s={hifi_status:{fully_supported:void 0,user_eligible:void 0,device_supported:null===(r=n.capabilities)||void 0===r?void 0:r.lossless_playback}};return{hidden:t._hidden,id:n.id,is_active:o,is_group:!1,is_being_activated:!1,is_controllable:t._localPlayerEnabled,is_observable:!!t._localPlayerEnabled&&!t._hidden,local:!0,metadata:n.metadata||{},name:n.name,type:n.type,version:i,volume:a,capabilities:{supports_lossless_audio:!1},playback_features:s,has_inactive_player_state:t._hasFakeState}}))},t.prototype._movePosition=function(e,t){var r=this;return this.getCurrentState().then((function(n){if(!n||isNaN(n.position))return Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Seeking not allowed with invalid track."));var i=e,o=Math.min(n.duration,Math.max(0,n.position+i));return r.seek(o,t)}))},t.prototype._prepareSkipTrack=function(e){return"string"==typeof e?f.queueTrackFromQid(e):e},t.prototype._cycleRepeatMode=function(e){var t=this;return this.getCurrentState().then((function(r){if(!r)return Promise.reject(new _.HarmonyError(l.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"));var n=null,i=r.disallows;switch(r.repeat_mode){case d.RepeatMode.OFF:if(i.toggling_repeat_context){if(i.toggling_repeat_track)return Promise.resolve(!1);n=d.RepeatMode.TRACK}else n=d.RepeatMode.CONTEXT;break;case d.RepeatMode.CONTEXT:n=i.toggling_repeat_track?d.RepeatMode.OFF:d.RepeatMode.TRACK;break;case d.RepeatMode.TRACK:n=d.RepeatMode.OFF;break;default:n=d.RepeatMode.OFF}return t.setRepeatMode(n,e)}))},t.prototype._onSeekHandled=function(e){this._controller.seek(e.data.position)},t.prototype.getClientDescriptor=function(){return this._client.getClientDescriptor()},t.prototype.getProductState=function(){return this._client.getProductState()},t.prototype.getPublicTransport=function(){return this._client.getPublicTransport()},t.prototype.getUserInfo=function(){return this._client.getUserInfo()},t.prototype.getVersionDescriptor=function(){return this._client.getVersionDescriptor()},t.prototype.logAppMetrics=function(e,t){return this._client.logAppMetrics(e,t)},t.prototype.setName=function(e){return this._client.setName(e)},t.prototype.setNameTemplate=function(e){return this._client.setNameTemplate(e)},t.prototype.getContextPlayerState=function(){return this._controller.getContextPlayerState()},t.prototype.updateCurrentContext=function(e,t){return this._controller.updateCurrentContext(e,t)},t.prototype.getLastActiveDevice=function(){var e=this;return this._onlyLocalState||this._hasFakeState?this._generateLocalDeviceInfo(this._hasFakeState):this._controller.getActiveDevice().then((function(t){return(null==t?void 0:t.local)&&e._streamer?(t.hidden=e._hidden,e._streamer.getVolume().then((function(e){return t.volume=e,t}))):t}))},t.prototype.getCurrentState=function(){var e=this;if(!this._onlyLocalState&&(this._preferController||!this._localPlayback)){var t=!this._localPlayerEnabled||!this._claimInactivePlayerStates;return this._controller.getCurrentState(t).then((function(t){return!e._preferController&&e._localPlayback?e.getCurrentState():t}))}return this._onStreamerConnect().then(this._streamer.getCurrentState.bind(this._streamer))},t.prototype.togglePlay=function(e){var t=this;return this._runOnDevice(e,(function(){return t._streamer.togglePlay()}),this._controller.togglePlay.bind(this._controller,e))},t.prototype.pause=function(e){var t=this;return this._runOnDevice(e,(function(){return t._streamer.pause()}),this._controller.pause.bind(this._controller,e))},t.prototype.resume=function(e){var t=this;return this._runOnDevice(e,(function(){return t._streamer.resume()}),this._controller.resume.bind(this._controller,e))},t.prototype.playURI=function(e,t,r){var n=this;return this._canStartNewContext(t).then((function(){return n._autoActivateElement&&n._activateElement(),n._controller.playURI(e,t,r)}))},t.prototype.playPages=function(e,t,r){var n=this;return this._canStartNewContext(t).then((function(){return n._autoActivateElement&&n._activateElement(),n._controller.playPages(e,t,r)}))},t.prototype.playTracks=function(e,t,r){var n=this;return this._canStartNewContext(t).then((function(){return n._autoActivateElement&&n._activateElement(),n._controller.playTracks(e,t,r)}))},t.prototype.nextTrack=function(e,t){var r=this,n={},i=function(){return r._streamer.nextTrack(o.Reason.FORWARD_BUTTON)},a=this._controller.nextTrack.bind(this._controller,e,n);return(null==t?void 0:t.track)&&(i=a,n.track=this._prepareSkipTrack(t.track)),this._runOnDevice(e,i,a)},t.prototype.smartPreviousTrack=function(e){var t=this;return this.getCurrentState().then((function(r){return r?(r.disallows||{}).seeking||r.position<3e3&&r.track_window&&r.track_window.previous_tracks&&r.track_window.previous_tracks.length>0?t.previousTrack(e):t.seek(0,e):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_NO_TRACKS_LOADED,"No current state."))}))},t.prototype.previousTrack=function(e,t){var r=this,n={},i=function(){return r._streamer.previousTrack(o.Reason.FORWARD_BUTTON)},a=this._controller.previousTrack.bind(this._controller,e,n);return(null==t?void 0:t.track)&&(i=a,n.track=this._prepareSkipTrack(t.track)),this._runOnDevice(e,i,a)},t.prototype.seek=function(e,t){var r=this;return this._runOnDevice(t,(function(){return r._streamer.seek(e)}),this._controller.seek.bind(this._controller,e,t))},t.prototype.seekForward=function(e,t){return void 0===e&&(e=15e3),this._movePosition(e,t)},t.prototype.seekBackward=function(e,t){return void 0===e&&(e=15e3),this._movePosition(-1*e,t)},t.prototype.getVolume=function(){return this._streamer?this._streamer.getVolume():Promise.resolve(-1)},t.prototype.setVolume=function(e,t){var r=this;return this._runOnDevice(t,(function(){return r._streamer.setVolume(e)}),this._controller.setVolume.bind(this._controller,e),!0)},t.prototype.getVideoProfiles=function(){if(!this._streamer)throw new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.");return this._streamer.getVideoVariants()},t.prototype.setPreferredBitrate=function(e){if(!this._streamer)throw new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.");return this._streamer.setPreferredBitrate(e)},t.prototype.getDevices=function(){return this._controller.getDevices().then(this._parseDeviceList.bind(this))},t.prototype.setQueue=function(e,t,r){console.warn("Harmony.setQueue is deprecated; migrate to new PlayerQueue API");var n=this._controller.setQueue.bind(this._controller,e,t,r);return this._runOnDevice(r,n,n)},t.prototype.addToQueue=function(e,t){var r=e.map((function(e){return"string"==typeof e?e:e.uri}));return this._controller.getQueueManager().addToQueue(r,t)},t.prototype.setShuffle=function(e,t){var r=this._controller.setShuffle.bind(this._controller,e,t);return this._runOnDevice(t,r,r)},t.prototype.toggleShuffle=function(e){var t=this._controller.toggleShuffle.bind(this._controller,e);return this._runOnDevice(e,t,t)},t.prototype.setRepeatMode=function(e,t){var r=this._controller.setRepeatMode.bind(this._controller,e,t);return this._runOnDevice(t,r,r)},t.prototype.cycleRepeatMode=function(e){var t=this._cycleRepeatMode.bind(this,e);return this._runOnDevice(e,t,t)},t.prototype.transfer=function(e,t){var r=e||s.LOCAL_DEVICE_ID,n=this._controller.transfer.bind(this._controller,r,t);return this._autoActivateElement&&this._activateElement(),this._runOnDevice(r,n,n,!0)},t.prototype.logout=function(e){return this._controller.logout(e||s.LOCAL_DEVICE_ID)},t.prototype.activateElement=function(){return this._streamer?this._streamer.activateElement():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"Cannot activate element; local player is disabled."))},t.prototype.getQueueManager=function(){var e=this;return this._controller.getQueueManager((function(t,r){return e._runOnDevice(r,t,t)}),{reportInactiveQueues:this._claimInactivePlayerStates,onlyLocalQueue:this._onlyLocalState,reportInitial:this._hasFakeState||this._localPlayback})},t.prototype.hideSubtitles=function(){return this._localPlayback?this._streamer?this._streamer.hideSubtitles():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot hide subtitles on remote player."))},t.prototype.showSubtitles=function(){return this._localPlayback?this._streamer?this._streamer.showSubtitles():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot show subtitles on remote player."))},t.prototype.areSubtitlesShown=function(){return this._localPlayback?this._streamer?this._streamer.areSubtitlesShown():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot show subtitles on remote player."))},t.prototype.getSubtitleLanguages=function(){return this._localPlayback?this._streamer?this._streamer.getSubtitleLanguages():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot get subtitle languages on remote player."))},t.prototype.getActiveSubtitleLanguage=function(){return this._localPlayback?this._streamer?this._streamer.getActiveSubtitleLanguage():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot get subtitle language on remote player."))},t.prototype.setSubtitleLanguage=function(e){return this._localPlayback?this._streamer?this._streamer.setSubtitleLanguage(e):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot set subtitle languages on remote player."))},t.prototype.deactivateSubtitleEvents=function(){return this._localPlayback?this._streamer?this._streamer.activateSubtitleEvents():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot deactivate subtitle events on remote player."))},t.prototype.activateSubtitleEvents=function(){return this._localPlayback?this._streamer?this._streamer.activateSubtitleEvents():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot activate subtitle events on remote player."))},t.prototype.setBackgrounded=function(e){return this._localPlayback?this._streamer?this._streamer.setBackgrounded(e):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot set background mode on remote player."))},t.prototype.setVideoResolution=function(e){return this._localPlayback?this._streamer?this._streamer.setVideoResolution(e):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"No streamer provided.")):Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot set preferred video resolution on remote player."))},t.prototype.getMediaConfig=function(){return this._streamer?this._streamer.getMediaConfig():Promise.reject(new _.HarmonyError(l.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"Cannot activate element; local player is disabled."))},t}(i.EventEmitter);r.Harmony=h},{"../enums/error_source":124,"../enums/errors":125,"../enums/harmony_event":126,"../enums/repeat_mode":129,"../error/harmony_error":132,"../typedefs":138,"./helpers/device":109,"./player_queue":114,"@js-sdk/common/es5/promise_resolver":151,"@js-sdk/playback/es5/enums/reason":66,"@spotify-internal/emitter/es5":98,tslib:201}],108:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.capitalize=void 0,r.capitalize=function(e){return e.replace(/\b[a-z]/g,(function(e){return e.toUpperCase()}))}},{}],109:[function(e,t,r){"use strict";function n(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&e.is_active===t.is_active&&e.is_controllable===t.is_controllable&&e.is_observable===t.is_observable&&e.local===t.local&&e.name===t.name&&e.type===t.type&&e.version===t.version&&e.volume===t.volume)}Object.defineProperty(r,"__esModule",{value:!0}),r.areDeviceListsEqual=r.areDevicesEqual=void 0,r.areDevicesEqual=n,r.areDeviceListsEqual=function(e,t){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Invalid devices list.");if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}},{}],110:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Logger=void 0;var n=e("@js-sdk/common/es5"),i=function(){function e(e){this._melodyLogger=new n.MelodyLogger(e)}return e.prototype.logClientEvent=function(e,t){return e?this._melodyLogger.sendLog("/v1/msg/batch",{type:"client_event",message:{source:e.source||n.LogValues.UNKNOWN,context:e.context||n.LogValues.UNKNOWN,event:e.event||n.LogValues.UNKNOWN,event_version:e.event_version||n.LogValues.EMPTY,test_version:e.test_version||n.LogValues.EMPTY,source_version:e.source_version||n.LogValues.UNKNOWN,source_vendor:e.source_vendor||n.LogValues.UNKNOWN,json_data:"json"===t?e.json_data||"{}":JSON.stringify(e.json_data||{})}},{batch:!0}):Promise.reject(new TypeError("Logger.logClientEvent `data` cannot be null."))},e.prototype.logMetrics=function(e,t){if(!e&&!t)return Promise.resolve(!0);var r=e||[],n=t||[];if(!r.length&&!n.length)return Promise.resolve(!0);if(!Array.isArray(r)||!Array.isArray(n))return Promise.reject(new TypeError("Logger.logMetrics `meters` and `timers` must be null or an array."));for(var i=0,o=r;i<o.length;i++){var a=o[i];if(!("what"in a)||!("result"in a)||!("reason"in a))return Promise.reject(new TypeError("Logger.logMetrics: Invalid meter format in `meters` array."))}for(var s=0,u=n;s<u.length;s++){var l=u[s];if(!("what"in l)||!("duration"in l))return Promise.reject(new TypeError("Logger.logMetrics: Invalid timer format in `timers` array."))}return this._melodyLogger.sendLog("/v1/metric",{sdk_id:void 0,platform:void 0,client_version:void 0,meters:r,timers:n})},e.prototype.logJSSDKError=function(e,t){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_error",message:{source:e.source||n.LogValues.UNKNOWN,source_version:e.source_version||n.LogValues.UNKNOWN,type:e.type||n.LogValues.UNKNOWN,message:e.message||n.LogValues.EMPTY,stack:JSON.stringify(e.stack||n.LogValues.EMPTY),json_data:"json"===t?e.json_data||"{}":JSON.stringify(e.json_data||{}),json_data_version:e.json_data_version||n.LogValues.EMPTY_VERSION}},{batch:!0})},e.prototype.logJSSDKContentRequest=function(e){var t;return this._melodyLogger.sendLog("/v1/msg/jssdk_content_request",{source:e.source||n.LogValues.UNKNOWN,type:e.type||n.LogValues.UNKNOWN,http_status:null!==(t=e.http_status)&&void 0!==t?t:void 0,ms_request_duration:e.ms_request_duration||n.LogValues.EMPTY,n_retries:e.n_retries||n.LogValues.ZERO,playback_id:e.playback_id||n.LogValues.EMPTY})},e}();r.Logger=i},{"@js-sdk/common/es5":143}],111:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.ManifestTrackResolver=r.FLAC_BITRATE=void 0;var i=e("spotify-liburi"),o=e("@js-sdk/playback/es5"),a=e("../enums/manifest_format");r.FLAC_BITRATE=1411200;var s=/^https:\/\//,u=((n={})[a.ManifestFormat.FILE_URLS_MP3]=o.MediaFormat.MP3,n[a.ManifestFormat.FILE_URLS_EXTERNAL]=o.MediaFormat.MP3,n[a.ManifestFormat.FILE_IDS_MP3]=o.MediaFormat.MP3,n[a.ManifestFormat.FILE_IDS_MP4]=o.MediaFormat.MP4,n[a.ManifestFormat.FILE_IDS_MP4_DUAL]=o.MediaFormat.MP4,n[a.ManifestFormat.FILE_IDS_CBCS]=o.MediaFormat.MP4_CBCS,n[a.ManifestFormat.FILE_IDS_MP4FLAC]=o.MediaFormat.MP4_FLAC,n[a.ManifestFormat.MANIFEST_IDS_VIDEO]=o.MediaFormat.MANIFEST_ID,n),l=function(){function e(e){this._descriptor=e.descriptor,this._listPlayer=e.listPlayer}return e.create=function(t){return new e(t)},e.prototype._resolveFromStateTrack=function(e,t,n){for(var l,c,d,_,p=e.manifest,f=e.metadata.uri,h=i.from(f),y=null,v=0,E=n;v<E.length;v++){var m=E[v],g=p[m];if(g)for(var T=0,S=g;T<S.length;T++){var P=S[T];if(P.file_id||s.test(null!==(l=P.file_url)&&void 0!==l?l:"")){var b=!(!h||h.type!==i.Type.AD&&h.type!==i.Type.INTERRUPTION);if(m!==a.ManifestFormat.FILE_IDS_MP3||b){var R=void 0;R=P.track_type?P.track_type.toLowerCase():m===a.ManifestFormat.MANIFEST_IDS_VIDEO?"video":"audio";var A=void 0;if(P.format){var I=parseInt(P.format,10);o.AudioFileFormat[I]&&(A=I)}var L=null!==(c=P.bitrate)&&void 0!==c?c:m===a.ManifestFormat.FILE_IDS_MP4FLAC?r.FLAC_BITRATE:128e3,O=null!==(d=P.bitrate)&&void 0!==d?d:m===a.ManifestFormat.FILE_IDS_MP4FLAC?7e5:128e3,C=u[m];if(y={uri:f,uriType:h&&h.type?h.type:void 0,fileId:null!==(_=P.file_id)&&void 0!==_?_:"",resolvedURL:P.file_url,mediaType:R,format:C,bitrate:O,fileFormat:null!=A?A:void 0,playbackQuality:P.audio_quality,hifi_status:P.hifi_status,impressionURL:P.impression_url,impressionURLs:P.impression_urls,isAd:b,noLog:!1,noTSV:b,noStats:b,noManifest:C===o.MediaFormat.MP3,playable:!0},m===a.ManifestFormat.MANIFEST_IDS_VIDEO||L<=t)return y}}}}return y},e.prototype.resolveFromStateTrack=function(e){var t=this;return Promise.all([Promise.resolve(this._descriptor),this._listPlayer.getCurrentBandwidth()]).then((function(r){var n=r[0],i=r[1];return t._resolveFromStateTrack(e,i,n.getManifestFormats())}))},e}();r.ManifestTrackResolver=l},{"../enums/manifest_format":128,"@js-sdk/playback/es5":80,"spotify-liburi":199}],112:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MetadataDecorator=void 0;var n=e("tslib"),i=e("spotify-liburi"),o=e("@spotify-internal/linkedlist/es5"),a=function(){function e(e){this._transport=e.transport,this._metadataCache=new o.LRUCache(e.cacheSize||20)}return e.create=function(t){return new e(t)},e.prototype._decorateTrackWindow=function(e){var t,r,i,o=this._metadataCache,a={current_track:null,next_tracks:[],previous_tracks:[]};e.current_track&&(r=o&&e.current_track&&"uri"in e.current_track&&o.get(e.current_track.uri),a.current_track=n.__assign({uid:e.current_track.uid},r||e.current_track)),t=e.next_tracks.length;for(;t--;)i=e.next_tracks[t],r=o&&i&&"uri"in i&&o.get(i.uri),a.next_tracks[t]=n.__assign({uid:i.uid},r||i);for(t=e.previous_tracks.length;t--;)i=e.previous_tracks[t],r=o&&i&&"uri"in i&&o.get(i.uri),a.previous_tracks[t]=n.__assign({uid:i.uid},r||i);return a},e.prototype._buildTrackList=function(e){for(var t=[],r={},i=0,o=n.__spreadArray(n.__spreadArray([e.current_track],e.next_tracks),e.previous_tracks);i<o.length;i++){var a=o[i];a&&!r[a.uri]&&t.push(a.uri)}return t},e.prototype._cacheMetadata=function(e){for(var t=[],r=[],n=this._metadataCache,o=0,a=e;o<a.length;o++){var s=a[o];if(!n.get(s)){var u=i.from(s);if(u){var l=i.hexToId(u.id);u.type===i.Type.TRACK?r.push(l):u.type===i.Type.EPISODE&&t.push(l)}}}return t.length||r.length?Promise.all([this._requestMultiData("episodes",t),this._requestMultiData("tracks",r)]).then((function(e){var t=e[0],r=e[1];return!!t||!!r})):Promise.resolve(!0)},e.prototype._requestMultiData=function(e,t){var r=this;if(!t.length)return Promise.resolve(!1);var n=this._metadataCache,i=["https://@webapi/v1/",e,"?ids=",t.join(","),"&market=from_token"].join("");return this._transport.request(i,{responseType:"json"}).then((function(t){var i;if(200!==t.status)return!1;var o=null===(i=t.body)||void 0===i?void 0:i[e];if(!o)return!1;for(var a=o.length;a--;){var s=o[a];s&&("episodes"===e?s=r._formatEpisodeData(s):(s.track_type="audio",s.media_type="audio"),n&&n.set(s.uri,s),n&&s.linked_from&&s.linked_from.uri&&n.set(s.linked_from.uri,s))}return!0}))},e.prototype._formatEpisodeData=function(e){var t="audio"===e.show.media_type?"audio":"video";return{id:e.id,uri:e.uri,type:"episode",media_type:t,track_type:e.show.media_type,name:e.name,artists:[{uri:e.show.uri,name:e.show.publisher}],album:{uri:e.show.uri,name:e.show.name,images:e.images},duration_ms:e.duration_ms||0,is_playable:!0}},e.prototype.formatLocalTrack=function(e,t){return e&&e.type===i.Type.LOCAL?{uri:e.toURI(),type:"local",uid:t,media_type:"audio",track_type:"audio",name:e.track,artists:[{uri:i.localArtistURI(e.artist).toURI(),name:e.artist}],album:{uri:i.localAlbumURI(e.artist,e.album).toURI(),name:e.album,images:[{url:""}]},duration_ms:e.duration?1e3*e.duration:0,is_playable:!1}:null},e.prototype.formatAd=function(e,t){if(!e||e.type!==i.Type.AD&&e.type!==i.Type.INTERRUPTION)return null;if(!t||!t.metadata)return null;var r=t.metadata;return{id:e.id,uri:e.toURI(),type:e.type,uid:t.uid,media_type:"audio",track_type:"audio",name:r.advertiser,artists:[{uri:r.click_url,name:r.buttonMessage||r.advertiser}],album:{uri:r.click_url,name:r.advertiser,images:[{url:r.image_url}]},duration_ms:parseInt(r.duration,10),is_playable:!1}},e.prototype.decorateTrackWindow=function(e,t){var r=this,n=null!=t?t:this._buildTrackList(e);return this._cacheMetadata(n).then((function(t){return t?r._decorateTrackWindow(e):e}))},e}();r.MetadataDecorator=a},{"@spotify-internal/linkedlist/es5":155,"spotify-liburi":199,tslib:201}],113:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parseDisallows=r.parseRestrictions=void 0;var n=/^disallow_([^]+)_reasons$/;r.parseRestrictions=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&"disallow_resuming_reasons"!==n&&"disallow_pausing_reasons"!==n&&(r[n]=e[n]);return t?r.disallow_pausing_reasons=["already_paused"]:r.disallow_resuming_reasons=["not_paused"],r},r.parseDisallows=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],o=!(!i||!i.length);t[r.replace(n,"$1")]=o}return t}},{}],114:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.QueueManager=r.queueTrackFromQid=r.createContextTracks=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/harmony_event"),a=e("../enums/errors"),s=e("../error/player_queue");function u(e,t){var r,n,i,o;void 0===t&&(t={ignoreMetaForTrack:!1});var a=[],s=[],u=!1,l=!1;if(!(null==e?void 0:e.length))return{items:a,tracks:s,hasQueuedTracks:u};for(var c=0,d=e;c<d.length;c++){var _=d[c],p="spotify:delimiter"===_.uri||/^spotify:meta:/.test(_.uri)?"meta":"track",f=_.uid+":::"+(null===(r=_.metadata)||void 0===r?void 0:r.iteration),h={type:p,uri:_.uri,uid:_.uid,qid:f,metadata:_.metadata||{},hidden:"true"===(null===(n=_.metadata)||void 0===n?void 0:n.hidden),queued:"true"===(null===(i=_.metadata)||void 0===i?void 0:i.is_queued),provider:_.provider,removed_reasons:_.removed,$blck_rs:_.blocked};h.queued&&(u=!0),a.push(h),"meta"===h.type?l=!0:!t.ignoreMetaForTrack&&l||"track"!==h.type||h.hidden||(null===(o=h.removed_reasons)||void 0===o?void 0:o.length)||s.push(h)}return{items:a,tracks:s,hasQueuedTracks:u}}function l(e,t){if(void 0===t&&(t={}),!Array.isArray(e))throw new TypeError("Items is not an array.");if(!e.length)return[];for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];if(o){"string"==typeof o&&(o={type:"track",uri:o});var a={uri:o.uri,uid:o.uid,metadata:o.metadata||{},removed:o.removed_reasons,blocked:o.$blck_rs,provider:o.provider};(o.queued||t.queued)&&(a.metadata.is_queued="true",a.provider="queue"),(o.hidden||"meta"===o.type)&&(a.metadata.hidden="true"),r.push(a)}}return r}function c(e){var t=e.split(":::"),r=t[0],n=t[1],i={type:"track",uid:r};return n&&(i.metadata={iteration:n}),i}r.createContextTracks=l,r.queueTrackFromQid=c;var d=function(e){function t(t){var r=e.call(this)||this;return r._hasInitialState=!1,r._reportInactiveQueues=!1,r._onlyLocalQueue=!1,r._currentPlayerState=null,r._currentInternalQueue=null,r._currentQueue=null,r._hasQueuedTracks=!1,r._connectClient=t.connectClient,r._runner=t.runner||function(e){return e()},r._parsePlayerState=r._parsePlayerState.bind(r),r._onlyLocalQueue=!!t.onlyLocalQueue,r._reportInactiveQueues=!!t.reportInactiveQueues,r._connectClient.on("player_state_changed",r._onPlayerStateChanged.bind(r)),t.initialContextPlayerState&&r._parsePlayerState(t.initialContextPlayerState),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._onPlayerStateChanged=function(e){var t=e.data,r=t.playerState,n=t.orphaned,i=t.isLocal;this._parsePlayerState(r,n,i)},t.prototype._parsePlayerState=function(e,t,r){var n,i,a;if(this._hasInitialState=!0,this._onlyLocalQueue&&!r||!this._reportInactiveQueues&&t)this._currentPlayerState=null,this._currentInternalQueue=null,this._currentQueue=null;else if(this._currentPlayerState=null!=e?e:null,e){if(e.queue_revision===(null===(n=this._currentInternalQueue)||void 0===n?void 0:n.revision))return null;this._hasQueuedTracks=!1;var s={ignoreMetaForTrack:null===(i=e.options)||void 0===i?void 0:i.repeating_context},l=e.queue_revision,c=u([e.track]).items[0],d=u(e.next_tracks,s),_=u(e.prev_tracks,s);this._hasQueuedTracks=d.hasQueuedTracks;var p={uri:e.context_uri,metadata:null!==(a=e.context_metadata)&&void 0!==a?a:void 0};this._currentInternalQueue={revision:l,context:p,current_track:c,next_items:d.items,previous_items:_.items},this._currentQueue={revision:l,context:p,current_track:c,next_tracks:d.tracks,previous_tracks:_.tracks}}else this._hasQueuedTracks=!1,this._currentInternalQueue=null,this._currentQueue=null;return this.emit(o.HarmonyEvent.PLAYER_QUEUE_CHANGED,{internalPlayerQueue:this._currentInternalQueue,playerQueue:this._currentQueue}),this._currentInternalQueue},t.prototype._setQueueNext=function(e,t){var r=this,n=this._currentPlayerState;if(!n)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));var i={next_tracks:e,prev_tracks:n.prev_tracks,queue_revision:n.queue_revision};return this._runner((function(){return r._connectClient.setQueue(i,t)}),t)},t.prototype._appendQueued=function(e,t){var r,i,o=this._currentPlayerState;if(!o)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));var u=Array.from(null!==(r=o.next_tracks)&&void 0!==r?r:[]);if(this._hasQueuedTracks){for(var l=!1,c=0,d=u.length;c<d;c++){var _=u[c];if("true"!==(null===(i=null==_?void 0:_.metadata)||void 0===i?void 0:i.is_queued)){u.splice.apply(u,n.__spreadArray([c,0],e)),l=!0;break}}l||u.push.apply(u,e)}else u.unshift.apply(u,e);return this._setQueueNext(u,t)},t.prototype.getInternalPlayerQueue=function(){var e=this;return this._hasInitialState?Promise.resolve(this._currentInternalQueue):new Promise((function(t){e.on(o.HarmonyEvent.PLAYER_QUEUE_CHANGED,(function(e){t(e.data.internalPlayerQueue)}))}))},t.prototype.getPlayerQueue=function(){var e=this;return this._hasInitialState?Promise.resolve(this._currentQueue):new Promise((function(t){e.on(o.HarmonyEvent.PLAYER_QUEUE_CHANGED,(function(e){t(e.data.playerQueue)}))}))},t.prototype.setInternalPlayerQueue=function(e,t,r){var n=this;if(void 0===r&&(r={ignoreRevision:!1}),!this._currentPlayerState)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));if(e.revision!==this._currentPlayerState.queue_revision&&!r.ignoreRevision)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_OPERATION_STALE_REVISION,"Cannot perform operation; revision is stale."));var i={next_tracks:l(e.next_items),prev_tracks:l(e.previous_items),queue_revision:r.ignoreRevision?void 0:this._currentPlayerState.queue_revision};return this._runner((function(){return n._connectClient.setQueue(i,t)}),t)},t.prototype.addToQueue=function(e,t){var r=this;if(!Array.isArray(e))return Promise.reject(new TypeError("Argument `items` must be an array."));var n=l(e,{queued:!0});return n.length?1===n.length?this._runner((function(){return r._connectClient.addToQueue(n[0],t)}),t):this._appendQueued(n,t):Promise.resolve(!1)},t.prototype.removeNext=function(e,t){var r,n,i,o,u=this._currentPlayerState;if(!u)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));o="string"==typeof e?c(e):e;for(var l=Array.from(null!==(r=u.next_tracks)&&void 0!==r?r:[]),d=l.length,_=0;_<d;_++){var p=l[_];if((null==p?void 0:p.uid)===o.uid&&(null===(n=null==p?void 0:p.metadata)||void 0===n?void 0:n.iteration)===(null===(i=o.metadata)||void 0===i?void 0:i.iteration)){l.splice(_,1);break}}return l.length===d?Promise.resolve(!1):this._setQueueNext(l,t)},t}(i.EventEmitter);r.QueueManager=d},{"../enums/errors":125,"../enums/harmony_event":126,"../error/player_queue":133,"@spotify-internal/emitter/es5":98,tslib:201}],115:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyStreamer=void 0;var n=e("tslib"),i=e("@js-sdk/playback/es5"),o=e("@spotify-internal/emitter/es5"),a=e("../enums/error_source"),s=function(e){function t(t){var r=e.call(this)||this;return r._client=t.client,r._initialVolume=t.initialVolume,r._listPlayer=t.listPlayer,r._playerPromise=t.playerPromise,r._playbackServiceClient=t.playbackServiceClient,r._playbackStateObserver=t.playbackStateObserver,r._stopOnBackground=t.stopOnBackground,r._init(),r}return n.__extends(t,e),t.prototype._init=function(){var e,t,r,n,o,s=this;this._client.addListeners(((e={}).before_disconnect=this._onClientBeforeDisconnect.bind(this),e.before_offline_disconnect=this._onClientBeforeOfflineDisconnect.bind(this),e));var u=this._listPlayer;u.addListeners(((t={})[i.PlaybackEvent.LIST_PLAYER_CAPPED]=this._onCapped.bind(this),t[i.PlaybackEvent.LIST_PLAYER_TRACK_ENDED]=this._onTrackEnded.bind(this),t[i.PlaybackEvent.LIST_PLAYER_BEFORE_VOLUME_CHANGE]=this._onBeforeVolumeChange.bind(this),t[i.PlaybackEvent.LIST_PLAYER_VOLUME_CHANGED]=this._onVolumeChanged.bind(this),t[i.PlaybackEvent.LIST_PLAYER_ERROR]=function(e){s._onError(e,a.HarmonyErrorSource.PLAYBACK)},t)),this.proxyEmitAll(u,((r={})[i.PlaybackEvent.LIST_PLAYER_AUTOPLAY_FAILED]="autoplay_failed",r[i.PlaybackEvent.LIST_PLAYER_TRACK_LOADED]="track_loaded",r[i.PlaybackEvent.LIST_PLAYER_DURATION_CHANGED]="duration_changed",r[i.PlaybackEvent.LIST_PLAYER_POSITION_CHANGED]="position_changed",r[i.PlaybackEvent.LIST_PLAYER_PROGRESS]="progress",r[i.PlaybackEvent.LIST_PLAYER_BUFFER_STALLED]="stalled",r[i.PlaybackEvent.LIST_PLAYER_BUFFERING_END]="buffering_end",r[i.PlaybackEvent.LIST_PLAYER_BUFFERING_START]="buffering_start",r[i.PlaybackEvent.LIST_PLAYER_MAX_LIST_ERRORS_REACHED]="max_list_errors_reached",r[i.PlaybackEvent.LIST_PLAYER_VIDEO_ELEMENT_APPENDED]="video_element_appended",r[i.PlaybackEvent.LIST_PLAYER_VIDEO_ELEMENT_REMOVED]="video_element_removed",r[i.PlaybackEvent.LIST_PLAYER_LIST_ENDED]="context_ended",r[i.PlaybackEvent.LIST_PLAYER_SEEK_HANDLED]="streamer_seek_handled",r[i.PlaybackEvent.LIST_PLAYER_DISPLAYED_CUES_CHANGED]="displayed_cues_changed",r[i.PlaybackEvent.LIST_PLAYER_SUBTITLE_LANGUAGES_LOADED]="subtitle_languages_loaded",r[i.PlaybackEvent.LIST_PLAYER_PLAYBACK_SPEED_CHANGED]="speed_changed",r));var l=this._playbackServiceClient;l.addListeners(((n={}).logout=this._onPlaybackClientLogout.bind(this),n.error=function(e){s._onError(e,e.data.source)},n)),this.proxyEmitAll(l,((o={}).max_subscriptions_reached="max_subscriptions_reached",o.deregistered="deregistered",o.registered="registered",o.registration_aborted="registration_aborted",o.internal_endcontent="internal_endcontent",o)),this.proxyEmit(this._playbackStateObserver,"state_changed","state_changed"),this._stopOnBackground&&document.addEventListener&&document.addEventListener("visibilitychange",(function(){document.hidden&&s.stop()&&s.emitSync("stopped_on_background",null)})),this._playerPromise.then((function(e){e.setVolume(s._initialVolume),s.emit("player_initialization_done",null)}),(function(e){s.emit("player_initialization_failed",{reason:e.message,error:e})}))},t.prototype._assertOperationSuccess=function(e){return e===i.OperationResult.SUCCESS},t.prototype._onTrackEnded=function(){this.emit("track_ended",null)},t.prototype._onClientBeforeDisconnect=function(e){e.data.awaitPromise(this.deregister().catch((function(){})))},t.prototype._onClientBeforeOfflineDisconnect=function(e){e.data.awaitPromise(this.pause().catch((function(){})))},t.prototype._onBeforeVolumeChange=function(e){var t;this.emitSync("before_volume_change",{volume:e.data.volume,remote:!!(null===(t=e.data.options)||void 0===t?void 0:t.commandId)}).defaultPrevented&&e.preventDefault()},t.prototype._onVolumeChanged=function(e){this.emit("volume_changed",{volume:e.data.volume,remote:!!e.data.commandId})},t.prototype._onCapped=function(){this.emit("playback_capped",null)},t.prototype._onError=function(e,t){var r=e.data.error;r&&(r&&"registration"in r&&r.registration&&t===a.HarmonyErrorSource.TRACK_PLAYBACK&&this.emit("registration_error",{error:r}),this.emit("error",{source:t,error:r}),this._client.notifyError(t,r))},t.prototype._onPlaybackClientLogout=function(){this.emit("logged_out",null)},t.prototype.stop=function(){return this._playbackServiceClient.stop()},t.prototype.register=function(){return this._playbackServiceClient.register()},t.prototype.deregister=function(){return this._playbackServiceClient.deregister()},t.prototype.resume=function(){return this._listPlayer.resume().then(this._assertOperationSuccess)},t.prototype.pause=function(){return this._listPlayer.pause().then(this._assertOperationSuccess)},t.prototype.nextTrack=function(e){return void 0===e&&(e=i.Reason.FORWARD_BUTTON),this._listPlayer.next(e).then(this._assertOperationSuccess)},t.prototype.canChangeTrack=function(){return this._listPlayer.canChangeTrack()},t.prototype.previousTrack=function(e){return void 0===e&&(e=i.Reason.BACK_BUTTON),this._listPlayer.previous(e).then(this._assertOperationSuccess)},t.prototype.togglePlay=function(){return this._listPlayer.togglePlay().then(this._assertOperationSuccess)},t.prototype.setVolume=function(e){return this._listPlayer.setVolume(e).then(this._assertOperationSuccess)},t.prototype.getVolume=function(){return this._listPlayer.getVolume()},t.prototype.seek=function(e){return this._listPlayer.seek(e).then(this._assertOperationSuccess)},t.prototype.getCurrentState=function(){return this._playbackStateObserver.getCurrentState()},t.prototype.getVideoVariants=function(){return this._playerPromise.then((function(e){return e.getVideoVariants()}))},t.prototype.setPreferredBitrate=function(e){var t=this;return this._playerPromise.then((function(r){return r.setPreferredBitrate(e).then(t._assertOperationSuccess)}))},t.prototype.setVideoResolution=function(e){return this._playerPromise.then((function(t){return t.setVideoResolution(e)}))},t.prototype.setBackgrounded=function(e){return this._playerPromise.then((function(t){return t.setBackgrounded(e)}))},t.prototype.activateElement=function(){return this._playerPromise.then((function(e){return e.activateElement()}))},t.prototype.hideSubtitles=function(){return this._listPlayer.hideSubtitles().then(this._assertOperationSuccess)},t.prototype.showSubtitles=function(){return this._listPlayer.showSubtitles().then(this._assertOperationSuccess)},t.prototype.areSubtitlesShown=function(){return this._listPlayer.areSubtitlesShown()},t.prototype.getSubtitleLanguages=function(){return this._listPlayer.getSubtitleLanguages()},t.prototype.getActiveSubtitleLanguage=function(){return this._listPlayer.getActiveSubtitleLanguage()},t.prototype.setSubtitleLanguage=function(e){return this._listPlayer.setSubtitleLanguage(e).then(this._assertOperationSuccess)},t.prototype.getMediaConfig=function(){return this._listPlayer.getMediaConfig()},t.prototype.setPlaybackSpeed=function(e){return this._listPlayer.setPlaybackSpeed(e).then(this._assertOperationSuccess)},t.prototype.deactivateSubtitleEvents=function(){return this._listPlayer.deactivateCueEvents().then(this._assertOperationSuccess)},t.prototype.activateSubtitleEvents=function(){return this._listPlayer.activateCueEvents().then(this._assertOperationSuccess)},t}(o.EventEmitter);r.HarmonyStreamer=s},{"../enums/error_source":124,"@js-sdk/playback/es5":80,"@spotify-internal/emitter/es5":98,tslib:201}],116:[function(e,t,r){(function(t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackPlaybackServiceClient=void 0;var n=e("tslib"),i=e("@js-sdk/debouncer/es5"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/debug-tools/es5"),s=e("@js-sdk/playback/es5"),u=e("@js-sdk/common/es5/promise_resolver"),l=e("../../typedefs"),c=e("../../enums/errors"),d=e("../../enums/debug_source"),_=e("../../enums/error_source"),p=e("../../error/track_playback/client"),f=e("../../version"),h=e("../../utils/assert"),y=a.logging.forTag("tpapiclient"),v=a.logging.forTag("tpapiclient.endsong"),E=a.logging.forTag("tpapiclient.endsongs"),m=/^hm:\/\/track-playback\/v1/,g=/^hm:\/\/play-token\/lost/,T=function(e,t){var r=e.getStatusFamily();return r===t.SERVER_ERROR||r===t.CONNECTION_ERROR},S={condition:T,maxRetries:8},P={condition:T,maxRetries:2},b=function(e){function r(t){var r=e.call(this)||this;return r._deviceId=null,r._sequenceNumber=0,r._currentContext=null,r._loading=!1,r._lastSentStateUpdatePayload=null,r._isSendingConflict=!1,r._queuedRejectedStates=[],r._isSendingUpdate=!1,r._queueSendUpdate=[],r._currentTrackInfo={},r._registered=!1,r._isDeregistering=!1,r._waitingForTrackingData=u.createPromiseResolver(),r._lastProcessedStateId=null,r._limitStateUpdates=!1,r._lastUpdateStateTime=0,r._initialUpdateSent=!1,r._startedPlayingUpdateSent=!1,r._nextFinalizedDataPayload=null,r._switchingContext=!1,r._connectionId=null,r._transport=t.transport,r._logger=t.logger,r._endpoint=t.endpoint||"http://@webgate/track-playback",r._listPlayer=t.listPlayer,r._ListClass=t.ListClass,r._currentGaiaVolume=t.initialVolume*l.GAIA_VOLUME,r._clientVersion=t.clientVersion,r._manifestTrackResolver=t.manifestTrackResolver,r._descriptorPromise=Promise.resolve(t.descriptor),r._init(),r._performCommand=r._performCommand.bind(r),r._handleRegisterResponse=r._handleRegisterResponse.bind(r),r._handleStateConflictResponse=r._handleStateConflictResponse.bind(r),r.register=r.register.bind(r),r._parseDescriptor=r._parseDescriptor.bind(r),r._volumeDebouncer=new i.Debouncer(r._sendVolume.bind(r),{blockInitial:!0}),r}return n.__extends(r,e),r.create=function(e){return new r(e)},r.prototype._init=function(){var e,t=this;this._waitingForTrackingData=u.createPromiseResolver(),this._waitingForTrackingData.resolve(!0),this._transport.on(this._transport.EVENT_CONNECTION_ID,this._onConnectionId.bind(this)),this._transport.matchMessages(g,this._onPlayTokenLost.bind(this)),this._transport.matchMessages(m,this._onTrackPlaybackMessage.bind(this)),this._listPlayer.addListeners(((e={})[s.PlaybackEvent.LIST_PLAYER_CAPPED]=this._onCapped.bind(this),e[s.PlaybackEvent.LIST_PLAYER_ERROR_SYNC]=this._onError.bind(this),e[s.PlaybackEvent.LIST_PLAYER_BEFORE_NEXT]=this._onBeforeTrackChange.bind(this),e[s.PlaybackEvent.LIST_PLAYER_BEFORE_PREVIOUS]=this._onBeforeTrackChange.bind(this),e[s.PlaybackEvent.LIST_PLAYER_BEFORE_PLAYER_LOAD]=this._onBeforePlayerLoad.bind(this),e[s.PlaybackEvent.LIST_PLAYER_PLAYER_LOAD]=this._onListPlayerLoad.bind(this),e[s.PlaybackEvent.LIST_PLAYER_BEFORE_TRACK_LOAD]=this._onBeforeTrackLoad.bind(this),e[s.PlaybackEvent.LIST_PLAYER_POSITION_CHANGED]=this._onPositionChanged.bind(this),e[s.PlaybackEvent.LIST_PLAYER_DURATION_CHANGED]=this._onDurationChanged.bind(this),e[s.PlaybackEvent.LIST_PLAYER_VOLUME_CHANGED]=this._onVolumeChanged.bind(this),e[s.PlaybackEvent.LIST_PLAYER_PLAYBACK_SPEED_CHANGED]=this._onSpeedChanged.bind(this),e[s.PlaybackEvent.LIST_PLAYER_PAUSED]=this._onPlayPause.bind(this,!0),e[s.PlaybackEvent.LIST_PLAYER_PLAYING]=this._onPlayPause.bind(this,!1),e[s.PlaybackEvent.LIST_PLAYER_PLAYED_THRESHOLD_REACHED]=this._onPlayThresholdReached.bind(this),e[s.PlaybackEvent.LIST_PLAYER_PROGRESS]=this._onProgress.bind(this),e[s.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_CREATED]=this._onTrackDataCreatedEvent.bind(this),e[s.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_FINALIZED]=this._onTrackDataFinalizedEvent.bind(this),e)),this._descriptorPromise.then((function(e){e.on("descriptor_changed",(function(){t._parseDescriptor(e),t._updateDeviceInfo()}))}))},r.prototype._onBeforeTrackChange=function(){var e,t;if(!this._nextFinalizedDataPayload&&!this._switchingContext){var r=null!==(t=null===(e=this._currentContext)||void 0===e?void 0:e.getStateRef())&&void 0!==t?t:null,n=this._generateStatePayload(r,d.DebugSource.TRACK_DATA_FINALIZED);this._setSequenceNumber(n),this._nextFinalizedDataPayload=n}},r.prototype._onBeforeTrackLoad=function(e){var t;this._loading=!0,this._switchingContext=!1,this._currentTrackInfo.duration=void 0,this._stateEventPositionOverride=null===(t=e.data.newTrack.options)||void 0===t?void 0:t.position},r.prototype._onBeforePlayerLoad=function(e){var t,r,n,i,o,a,s,u,l=this._currentContext;if(l){var c=l.getCurrentTrack(),_=null===(t=l.getCurrentState)||void 0===t?void 0:t.call(l),p=null!==(n=null!==(r=null==_?void 0:_.duration_override)&&void 0!==r?r:null==c?void 0:c.metadata.duration)&&void 0!==n?n:0,f=e.data,h=f.track.metadata||{},y=this._currentTrackInfo.playbackSpeed||1;this._currentTrackInfo={duration:p,mediaType:f.track.mediaType.toUpperCase(),fileFormat:f.track.fileFormat,bitrate:null===(o=null===(i=f.logData)||void 0===i?void 0:i.format)||void 0===o?void 0:o.bitrate,playbackQuality:h.playbackQuality,hifiStatus:h.hifiStatus,changePlaybackSpeed:null!==(s=!(null===(a=f.track.options)||void 0===a?void 0:a.useDefaultPlaybackSpeed))&&void 0!==s&&s,playbackSpeed:(null===(u=e.data.track.options)||void 0===u?void 0:u.useDefaultPlaybackSpeed)?1:y};var v=f.options;l.setPaused(!v.autoplay),this._setCurrentTrackPosition(v&&v.position||0),this._updateState(d.DebugSource.BEFORE_TRACK_LOAD),this._startedPlayingUpdateSent=!1,this._initialUpdateSent=!1}},r.prototype._onCapped=function(){this._listPlayer.clear(s.Reason.CAPPED),this._currentContext=null,this._updateState(d.DebugSource.CAPPED),this._setCurrentTrackPosition(void 0),this._lastProcessedStateId=null,this.emit("state_cleared",null)},r.prototype._onConnectionId=function(e){var t=this;this._connectionId=e.data.id,this._isDeregistering||(this._registered=!1,Promise.all([this._listPlayer.getVolume(),this._descriptorPromise.then(this._parseDescriptor)]).then(this.register,(function(e){y.info("Skipping registration due to error",e),t.emit("registration_aborted",{reason_error:e,source:_.HarmonyErrorSource.TRACK_PLAYBACK})})).catch((function(){})))},r.prototype._onDurationChanged=function(e){var t,r=null===(t=this._currentContext)||void 0===t?void 0:t.getCurrentTrack();(null==r?void 0:r.metadata.uri)===e.data.track.uri&&(this._currentTrackInfo.duration=e.data.duration,this._emitStateChanged())},r.prototype._onError=function(e){"position"in e.data&&(this._setCurrentTrackPosition(e.data.position),this._updateState(d.DebugSource.ERROR))},r.prototype._onSpeedChanged=function(e){this._currentTrackInfo.playbackSpeed=e.data.playback_speed,this._updateState(d.DebugSource.SPEED_CHANGED)},r.prototype._onPlayPause=function(e,t){var r=this._currentContext;r&&(r.setPaused(e),"position"in t.data&&this._setAllTrackPositions(t.data.position),t.data.track.stateId&&this._shouldSendUpdateForEvent(t.data.track.stateId)?this._updateState(e?d.DebugSource.PAUSE:d.DebugSource.RESUME):(this._lastProcessedStateId=null,this._emitStateChanged()))},r.prototype._onPlayThresholdReached=function(e){this._initialUpdateSent=!0,this._setAllTrackPositions(e.data.position),this._updateState(d.DebugSource.PLAYED_THRESHOLD_REACHED)},r.prototype._onPlayTokenLost=function(){this._listPlayer.pause().catch((function(){}))},r.prototype._onPositionChanged=function(e){this._loading||(this._setCurrentTrackPosition(e.data.position),e.data.track&&this._shouldSendUpdateForEvent(e.data.track.stateId)?this._updateState(d.DebugSource.POSITION_CHANGED):(this._lastProcessedStateId=null,this._emitStateChanged()))},r.prototype._onProgress=function(e){if(!this._loading&&this._currentContext&&(this._setAllTrackPositions(e.data.position),!this._startedPlayingUpdateSent&&e.data.played>1e3&&(this._startedPlayingUpdateSent=!0,this._updateState(d.DebugSource.STARTED_PLAYING)),e.data.logData)){var t=this._currentContext.getCurrentTrack(),r=t&&"number"==typeof t.ms_playing_update_interval?t.ms_playing_update_interval:null;this._initialUpdateSent&&null!==r&&r>0&&Date.now()-this._lastUpdateStateTime>r&&this._updateState(d.DebugSource.PROGRESS)}},r.prototype._onTrackDataCreatedEvent=function(){this._waitingForTrackingData=u.createPromiseResolver()},r.prototype._onTrackDataFinalizedEvent=function(e){var t=this._nextFinalizedDataPayload;t&&(t.playback_stats=e.data.playbackStats,this._updateState(d.DebugSource.TRACK_DATA_FINALIZED,t)),this._nextFinalizedDataPayload=null,this._waitingForTrackingData&&this._waitingForTrackingData.resolve(!0)},r.prototype._onListPlayerLoad=function(e){this._loading=!1;var t=this._currentContext;t&&(t.setPaused(!e.data.autoplay),this._setCurrentTrackPosition(e.data.position||0))},r.prototype._onTrackPlaybackMessage=function(e){var t=e.payloads;Array.isArray(t)&&t.length&&this._performCommand(t[0])},r.prototype._onVolumeChanged=function(e){var t;if(this._currentGaiaVolume=e.data.volume*l.GAIA_VOLUME,this._registered){var r=null!==(t=e.data.commandId)&&void 0!==t?t:"",n={seq_num:void 0,volume:this._currentGaiaVolume,command_id:r};this._volumeDebouncer.async(n)}},r.prototype._clearSessionData=function(){this._connectionId=null,this._sequenceNumber=0,this._currentContext=null,this._lastSentStateUpdatePayload=null,this._isSendingConflict=!1,this._isSendingUpdate=!1,this._queueSendUpdate=[],this._previousTrackPosition=void 0,this._currentTrackPosition=void 0,this._currentTrackInfo={},this._lastProcessedStateId=null,this.emit("state_cleared",null)},r.prototype._createStateRef=function(e,t){if(!t)return null;var r=e.states[t.state_index];if(!r)throw new p.TrackPlayerAPIClientError(c.HarmonyErrors.TP_CANNOT_CREATE_STATE_REF,"Invalid state reference.");return{state_machine_id:e.state_machine_id,state_id:r.state_id,paused:t.paused}},r.prototype._deregisterFromService=function(e){var t=this,r=null,n=this._currentContext;n&&(e&&(n.setPaused(!e.playing),this._setAllTrackPositions(e.position)),r=n.getStateRef());var i=this._generateStatePayload(r,d.DebugSource.DEREGISTER);this._setSequenceNumber(i);var o=this._endpoint+"/v1/devices/"+this._deviceId;return this._transport.request(o,{authorize:!0,method:"DELETE",payload:JSON.stringify(i),responseType:"json",retry:P}).then((function(e){if(200!==e.status&&204!==e.status)return t._registered=!0,!1;var r=e.body;return r&&(r.endsong&&v.log(r.endsong),r.endsongs&&(E.log(r.endsongs),t.emit("internal_endcontent",{endcontents:r.endsongs}))),t._clearSessionData(),t.emit("deregistered",null),!0}))},r.prototype._emitError=function(e,t){void 0===t&&(t={}),this._logger.logJSSDKError({source:"tpapi-client",source_version:f.default.tagged,type:e.code,message:e&&e.message,stack:e&&e.stack,json_data:t,json_data_version:"1.0.0"},"object").catch((function(e){y.error("Track-Playback Logging Error",e)})),this.emit("error",{error:e,source:_.HarmonyErrorSource.TRACK_PLAYBACK})},r.prototype._emitStateChanged=function(){var e=this._currentContext;if(e){var t=this._currentTrackPosition||0;void 0!==this._stateEventPositionOverride&&(t=this._stateEventPositionOverride,this._stateEventPositionOverride=void 0),this.emit("state_changed",{position:t,currentTrackInfo:this._currentTrackInfo,stateMachine:e.getStateMachine(),stateRef:e.getInternalStateRef(),paused:e.isPaused(),loading:this._loading})}},r.prototype._generateStatePayload=function(e,t){var r=this._currentTrackInfo;return{seq_num:void 0,seq_nums:void 0,state_ref:e,sub_state:{playback_speed:(null==e?void 0:e.paused)?0:this._currentTrackInfo.playbackSpeed||1,position:this._currentTrackPosition,duration:r.duration||void 0,media_type:r.mediaType,bitrate:r.bitrate,audio_quality:r.playbackQuality,format:r.fileFormat},previous_position:this._previousTrackPosition,playback_stats:void 0,rejected_state_refs:void 0,debug_source:t}},r.prototype._handleRegisterResponse=function(e){var t;if(429===e.status)return(t=p.TrackPlayerAPIClientError.fatal(c.HarmonyErrors.TP_MAX_SUBSCRIPTIONS_REACHED,"Max connections reached")).maxedSubscriptions=!0,t.status=e.status,this.emit("max_subscriptions_reached",{error:t}),Promise.reject(t);if(403===e.status&&e.body&&"PREMIUM_REQUIRED"===e.body.error_type?t=p.TrackPlayerAPIClientError.fatal(c.HarmonyErrors.TP_REGISTRATION_FAILED_NON_PREMIUM,"Cannot register to Track Playback with non-premium user."):200!==e.status?t=p.TrackPlayerAPIClientError.fatal(c.HarmonyErrors.TP_REGISTRATION_FAILED_WITH_STATUS,"track-playback service responded with status "+e.status+" when registering device"):e.body||(t=p.TrackPlayerAPIClientError.fatal(c.HarmonyErrors.TP_NO_RESPONSE_BODY,"Unexpected empty response body from registration request.")),t)return t.status=e.status,Promise.reject(t);var r=e.body;return r.endsong&&v.log(r.endsong),r.endsongs&&(E.log(r.endsongs),this.emit("internal_endcontent",{endcontents:r.endsongs})),this._sequenceNumber=r.initial_seq_num,this._registered=!0,this.emit("registered",{deviceId:this._deviceId}),Promise.resolve(!0)},r.prototype._handleStateConflictResponse=function(e){var t;if(e.status>=200&&e.status<300){var r=null===(t=e.body)||void 0===t?void 0:t.commands;if(!r||!r.length)return;for(var n=0,i=r.length;n<i;n++)this._performCommand(r[n])}else{var o=new p.TrackPlayerAPIClientError(c.HarmonyErrors.TP_CONFLICT_REQUEST_FAILED_WITH_STATUS,"Track-Playback service responded with "+e.status);o.status=e.status,this._emitError(o)}},r.prototype._handleStateUpdateResponse=function(e,t){var r;if(200!==t.status)return(r=new p.TrackPlayerAPIClientError(c.HarmonyErrors.TP_PARSE_STATE_UPDATE_FAILED_WITH_STATUS,"Service responded with status "+t.status)).status=t.status,Promise.reject(r);if(!t.body)return(r=new p.TrackPlayerAPIClientError(c.HarmonyErrors.TP_UPDATE_REQUEST_EMPTY_RESPONSE,"Unexpected empty response body from state update request.")).status=t.status,Promise.reject(r);var n=t.body;n.endsong&&v.log(n.endsong),n.endsongs&&(E.log(n.endsongs),this.emit("internal_endcontent",{endcontents:n.endsongs}));var i=this._currentContext;if(!i)return Promise.resolve();var o=n.state_machine,a=n.updated_state_ref;return this._isCurrentStateRef(e)?(i.setStateMachine(o),i.setCurrentState(a),this._emitStateChanged(),Promise.resolve()):Promise.resolve()},r.prototype._isCurrentStateRef=function(e){var t=this._currentContext?this._currentContext.getStateRef():null;return!t&&!e||!(!t||!e)&&(t.state_machine_id===e.state_machine_id&&t.state_id===e.state_id&&t.paused===e.paused)},r.prototype._logUnsentStateUpdate=function(e){y.info("Unsent state update.",e),this._logger.logClientEvent({source:"tpapi-client",source_version:f.default.tagged,source_vendor:"spotify",event:"unsent-state-update",event_version:"1.0.0",json_data:e},"object").catch((function(e){y.error("Track-Playback Logging Error",e)}))},r.prototype._logout=function(){var e=this;this._listPlayer.pause().catch((function(){})),this.emit("state_cleared",null),this.deregister().then((function(t){e._currentContext=null,e._setCurrentTrackPosition(void 0),t&&e.emit("logout",null)}))},r.prototype._parseDescriptor=function(e){return this._deviceId=e.getId(),this._deviceInfo=e.toTrackPlaybackDeviceInfo(),!0},r.prototype._performCommand=function(e){switch(e.type){case"set_volume":this._setVolume(e);break;case"log_out":this._logout();break;case"replace_state":this._replaceState(e);break;case"ping":this._updateState(d.DebugSource.PING);break;default:this._emitError(new p.TrackPlayerAPIClientError(c.HarmonyErrors.TP_UNKNOWN_COMMAND,"Received unknown command."),{command:e})}},r.prototype._rejectState=function(e){var t=this,r=this._queuedRejectedStates;if(void 0!==e&&r.push(e),this._registered&&!this._isSendingConflict&&r.length){this._isSendingConflict=!0;var n=r.splice(0,5),i=this._currentContext?this._currentContext.getStateRef():null,o=this._generateStatePayload(i);o.rejected_state_refs=n,this._setSequenceNumbers(o,n.length);var a=function(){t._isSendingConflict=!1,t._rejectState()},s=this._endpoint+"/v1/devices/"+this._deviceId+"/state_conflict";this._transport.request(s,{authorize:!0,method:"POST",headers:{"Content-Type":"application/json"},responseType:"json",payload:JSON.stringify(o),retry:P}).then(this._handleStateConflictResponse).then(a,a)}},r.prototype._replaceState=function(e){var t,r,n,i=this._listPlayer,o=e.state_machine,a=e.state_ref,u=this._createStateRef(o,a);if(this._isCurrentStateRef(e.prev_state_ref))if(a){var l=null!==(r=null===(t=this._currentContext)||void 0===t?void 0:t.getStateRef())&&void 0!==r?r:null;if(h.assert(null!==u,"New state reference is null"),this._currentContext&&(null==l?void 0:l.state_id)===u.state_id){var c=this._currentContext;c.setStateMachine(o),c.setCurrentState(a);var _=!1;c.isPaused()!==a.paused&&(_=!0),a.paused?(c.setPaused(!0),i.pause()):(c.setPaused(!1),i.resume());var p=parseInt(e.seek_to,10);c.allowSeeking()&&!isNaN(p)&&(i.seek(p,s.Reason.REMOTE),this._setCurrentTrackPosition(p),_=!0),_?this._emitStateChanged():(this._lastProcessedStateId=null,this._updateState(d.DebugSource.MODIFY_CURRENT_STATE))}else{this._lastProcessedStateId=null!==(n=u.state_id)&&void 0!==n?n:null,this._currentContext&&this._onBeforeTrackChange();var f=this._ListClass.create("spotify:app:jsspeaker",this._manifestTrackResolver);f.setStateMachine(o),f.startAtState(a),this._deviceId&&f.setDeviceId(this._deviceId),this._currentContext=f;var y=e.seek_to||0;f.setInitialPosition(y),this._loading=!0,this._switchingContext=!0,i.play(f,{reason:s.Reason.REMOTE})}}else this._clearContextAndState();else this._rejectState(u)},r.prototype._clearContextAndState=function(){var e=this._listPlayer;e.pause().catch((function(){})),e.clear(s.Reason.REMOTE),this._currentContext=null,this._updateState(d.DebugSource.STATE_CLEAR),this._setAllTrackPositions(void 0),this._lastProcessedStateId=null,this.emit("state_cleared",null),this._loading=!0},r.prototype._sendDevicesRequest=function(e,t){var r=this._endpoint+"/v1/devices";return"PUT"===e&&(r=r+"/"+this._deviceId),this._transport.request(r,{authorize:!0,method:e||"POST",headers:{"Content-Type":"application/json"},responseType:"json",payload:JSON.stringify(t),retry:S})},r.prototype._sendVolume=function(e){var t=this._endpoint+"/v1/devices/"+this._deviceId+"/volume";return this._setSequenceNumber(e),this._transport.request(t,{authorize:!0,method:"PUT",headers:{"Content-Type":"application/json"},payload:JSON.stringify(e)})},r.prototype._setAllTrackPositions=function(e){this._previousTrackPosition=e,this._currentTrackPosition=e},r.prototype._setCurrentTrackPosition=function(e){this._previousTrackPosition=this._currentTrackPosition,this._currentTrackPosition=e},r.prototype._setSequenceNumber=function(e){return void 0===e.seq_num&&(e.seq_num=++this._sequenceNumber),e},r.prototype._setSequenceNumbers=function(e,t){e.seq_nums=[];for(var r=0;r<t;r++)e.seq_nums.push(++this._sequenceNumber);return e},r.prototype._setVolume=function(e){var t,r=e.volume/l.GAIA_VOLUME;this._listPlayer.setVolume(r,null!==(t=e.command_id)&&void 0!==t?t:"tpcommand-"+Date.now())},r.prototype._shouldSendUpdateForEvent=function(e){return!(!e||e===this._lastProcessedStateId)},r.prototype._updateDeviceInfo=function(){var e=this;this._registered&&this._deviceInfo&&this._sendDevicesRequest("PUT",this._deviceInfo).then((function(t){204===t.status&&e.emit("registration_updated",null)}))},r.prototype._updateState=function(e,t){var r,n,i,o,a=this;if(this._registered)if(t?(i=t.state_ref,o=t):(i=null!==(n=null===(r=this._currentContext)||void 0===r?void 0:r.getStateRef())&&void 0!==n?n:null,o=this._generateStatePayload(i,e)),this._wasStatePayloadSentRecently(o)){if(this._emitStateChanged(),this._isSendingUpdate&&this._limitStateUpdates)return this._logUnsentStateUpdate(o),void this._queueSendUpdate.push(e);this._isSendingUpdate=!0,this._queueSendUpdate=[],this._setSequenceNumber(o),this._lastSentStateUpdatePayload=o;var s=function(){a._isSendingUpdate=!1,a._queueSendUpdate.length&&a._updateState(a._queueSendUpdate[a._queueSendUpdate.length-1]),y.info("State update sent.",e,o)},u=this._endpoint+"/v1/devices/"+this._deviceId+"/state";this._lastUpdateStateTime=Date.now(),this._transport.request(u,{authorize:!0,method:"PUT",headers:{"Content-Type":"application/json"},responseType:"json",payload:JSON.stringify(o),retry:S}).then(this._handleStateUpdateResponse.bind(this,i)).then(s,(function(e){a._emitError(e),s()}))}else y.info("State update ignored (duplicate).",o)},r.prototype._wasStatePayloadSentRecently=function(e){var t=this._lastSentStateUpdatePayload;if(!t||!t.state_ref||!e.state_ref)return!0;var r=e.state_ref,n=t.state_ref;if(r.paused!==n.paused||r.state_id!==n.state_id||r.state_machine_id!==n.state_machine_id)return!0;var i=e.sub_state,o=t.sub_state;return i.playback_speed!==o.playback_speed||i.position!==o.position||i.duration!==o.duration||e.previous_position!==t.previous_position},r.prototype.stop=function(){return!(!this._registered||!this._currentContext)&&(this._clearContextAndState(),!0)},r.prototype.deregister=function(){var e=this;return this._registered?(this._isDeregistering=!0,this._registered=!1,this._listPlayer.getPlayerState().then((function(t){return Promise.all([e._deregisterFromService(t),e._waitingForTrackingData.promise,e._listPlayer.stop().catch((function(){}))]).then((function(t){var r=t[0];return e._isDeregistering=!1,r}))}),(function(){return e._isDeregistering=!1,e._registered=!0,!1}))):Promise.resolve(!1)},r.prototype.register=function(){var e,r=this;if(this._registered)return Promise.resolve(!1);if(!this._deviceInfo)return Promise.reject(new Error("Need DeviceInfo for device registration."));if(!this._connectionId)return Promise.reject(new Error("Need connection-id for device registration"));var n=this._currentContext;return n&&(e=this._generateStatePayload(n.getStateRef(),d.DebugSource.REGISTER),this._setSequenceNumber(e)),this._sendDevicesRequest("POST",{device:this._deviceInfo,outro_endcontent_snooping:"true"===t.env.OUTRO_SNOOPING,connection_id:this._connectionId,client_version:this._clientVersion,previous_session_state:e,volume:this._currentGaiaVolume}).then(this._handleRegisterResponse).catch((function(e){return e&&!e.maxedSubscriptions&&(e.registration=!0,r._emitError(e)),!1}))},r}(o.EventEmitter);r.TrackPlaybackServiceClient=b}).call(this)}).call(this,e("_process"))},{"../../enums/debug_source":121,"../../enums/error_source":124,"../../enums/errors":125,"../../error/track_playback/client":134,"../../typedefs":138,"../../utils/assert":139,"../../version":142,"@js-sdk/common/es5/promise_resolver":151,"@js-sdk/debouncer/es5":12,"@js-sdk/debug-tools/es5":17,"@js-sdk/playback/es5":80,"@spotify-internal/emitter/es5":98,_process:197,tslib:201}],117:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackPlayerServiceContext=void 0;var n=e("@js-sdk/playback/es5"),i=e("../../enums/errors"),o=e("../../error/track_playback/client"),a=function(){function e(e,t){this._stateMachine=null,this._currentState=null,this._currentStateIndex=null,this._pausedState=!1,this._initialPlaybackPosition=null,this._uri=e,this._manifestTrackResolver=t}return e.create=function(t,r){return new e(t,r)},e.prototype.setPaused=function(e){this._pausedState=e},e.prototype.isPaused=function(){return this._currentStateIndex&&this._currentStateIndex<0&&this._currentState&&this._currentState.transitions.advance?!!this._currentState.transitions.advance.paused:this._pausedState},e.prototype.setInitialPosition=function(e){this._initialPlaybackPosition=e},e.prototype.setStateMachine=function(e){this._stateMachine=e},e.prototype.setDeviceId=function(e){this._deviceId=e},e.prototype.startAtState=function(e){var t=this._stateMachine&&this._stateMachine.states[e.state_index];if(!t)throw new o.TrackPlayerAPIClientError(i.HarmonyErrors.TP_MISSING_INITIAL_STATE,"Invalid state reference.");var r=t.transitions;this._currentStateIndex=-1,this._currentState={decoy:!0,paused:!!e.paused,track:-1,state_id:null,transitions:{advance:e,show_next:r.show_next,show_prev:r.show_prev,skip_next:e,skip_prev:r.skip_prev},duration_override:t.duration_override,position_offset:t.position_offset}},e.prototype.setCurrentState=function(e){var t=e.state_index;this._currentStateIndex=t,this._currentState=this._stateMachine&&this._stateMachine.states[t]},e.prototype.getStateMachine=function(){return this._stateMachine},e.prototype.getInternalStateRef=function(){var e=this._pausedState,t=this._currentStateIndex;if(!t)return null;if(t&&t<0){var r=this._currentState&&this._currentState.transitions.advance;r&&(t=r.state_index,e=!!r.paused)}return{paused:e,state_index:t}},e.prototype.getStateRef=function(){var e,t,r=this._stateMachine;if(!r||null===this._currentStateIndex)return null;if(this._currentStateIndex<0){var n=this._currentState&&this._currentState.transitions.advance;n&&(e=r.states[n.state_index],t=n.paused)}else e=r.states[this._currentStateIndex],t=this._pausedState;return e?{state_machine_id:r.state_machine_id,state_id:e.state_id,paused:!!t}:null},e.prototype.getCurrentTrack=function(){var e,t=this._stateMachine;if(!t||null===this._currentStateIndex)return null;if(this._currentStateIndex<0){var r=this._currentState&&this._currentState.transitions.advance;r&&(e=t.states[r.state_index])}else e=t.states[this._currentStateIndex];return e?t.tracks[e.track]:null},e.prototype.startAt=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setShuffle=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setRepeatMode=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.next=function(e){var t=this._currentState,r=null;if(t){var i=t.transitions;switch(e.reason){case n.Reason.FORWARD_BUTTON:"skip_next"in i&&(r=i.skip_next);break;default:"advance"in i&&(r=i.advance)}}return this._transitionTo(e,r,!1)},e.prototype.peekNext=function(e){var t=this._currentState,r=null;if(t){var i=t.transitions;switch(e.reason){case n.Reason.FORWARD_BUTTON:"skip_next"in i&&(r=i.skip_next);break;default:"advance"in i&&(r=i.advance)}}return this._transitionTo(e,r,!0)},e.prototype.previous=function(e){var t=this._currentState,r=null;t&&(r=t.transitions.skip_prev);return this._transitionTo(e,r,!1)},e.prototype.translatePosition=function(e){var t,r;return(null!==(r=null===(t=this._currentState)||void 0===t?void 0:t.position_offset)&&void 0!==r?r:0)+e},e.prototype.translateDuration=function(e){var t,r;return null!==(r=null===(t=this._currentState)||void 0===t?void 0:t.duration_override)&&void 0!==r?r:e},e.prototype.handleSeek=function(e,t){var r;return(null===(r=this._currentState)||void 0===r?void 0:r.duration_override)&&t.reason!==n.Reason.REMOTE?t.listConstants.IGNORE:e},e.prototype.allowSeeking=function(){return!!this._currentState&&!this._currentState.disallow_seeking},e.prototype._transitionTo=function(e,t,r){var n=this;return void 0===r&&(r=!1),new Promise((function(i){var o,a=e.reason,s=e.listConstants;if(!t)return i(s.FORBIDDEN);var u=n._stateMachine;if(!u)return i(s.NULL_VALUE);var l=u.states[t.state_index];if(!l)return i(s.NULL_VALUE);var c=u.tracks[l.track];if(!(null===(o=null==c?void 0:c.metadata)||void 0===o?void 0:o.uri))return i(s.NULL_VALUE);if(!n._currentState)return i(s.NULL_VALUE);var d=n._currentState,_=d.decoy?!!d.paused:t.paused;r||(n._currentState=l,n._currentStateIndex=t.state_index,n._pausedState=!!_);var p=0;return r||null===n._initialPlaybackPosition?"initial_playback_position"in l&&(p=l.initial_playback_position||0):(p=n._initialPlaybackPosition,n._initialPlaybackPosition=null),n._manifestTrackResolver.resolveFromStateTrack(c).then((function(e){if(!e)return i(s.NULL_VALUE);var t=n._uri;c.metadata&&c.metadata.context_uri&&(t=c.metadata.context_uri);var r=a,o=c.ms_played_until_update,u={playbackQuality:e.playbackQuality,hifiStatus:e.hifi_status},d={uri:e.uri,playableURI:e.uri,fileId:e.fileId,resolvedURL:e.resolvedURL,playable:e.playable,isAd:e.isAd,format:e.format,fileFormat:e.fileFormat,mediaType:e.mediaType,noManifest:e.noManifest,metadata:u,options:{position:p,paused:_,playedThreshold:o},logData:{noLog:!!e.noLog,noTSV:!!e.noTSV,noStats:!!e.noStats,deviceId:n._deviceId,playbackId:l.state_id?l.state_id:void 0,reason:r,displayTrack:e.uri,playContext:t,impressionURL:e.impressionURL,impressionURLs:e.impressionURLs,format:{codec:e.format,bitrate:e.bitrate},uriType:e.uriType,displayTitle:c.metadata.name,displayGroup:c.metadata.group_name,displayDuration:c.metadata.duration},stateId:l.state_id?l.state_id:void 0};return i(d)}))}))},e.prototype.getCurrentState=function(){return this._currentState},e}();r.TrackPlayerServiceContext=a},{"../../enums/errors":125,"../../error/track_playback/client":134,"@js-sdk/playback/es5":80}],118:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TPPlaybackStateObserver=void 0;var n=e("tslib"),i=e("spotify-liburi"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/debug-tools/es5"),s=e("@js-sdk/playback/es5"),u=e("../../enums/repeat_mode"),l=e("../../enums/hifi_status"),c=e("../playback_state_observer"),d=a.logging.forTag("tp.stream.PlaybackStateObserver"),_=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this)||this;return n._tpApiClient=t,n._numPreviousTracks=r.numPrevious||2,n._numNextTracks=r.numNextTracks||2,n._currentState=null,n._init(),n}return n.__extends(t,e),t.create=function(e,r){return new t(e,r)},t.prototype._init=function(){this._tpApiClient.on("state_changed",this._onStateChanged.bind(this)),this._tpApiClient.on("state_cleared",this._onStateCleared.bind(this))},t.prototype._onStateChanged=function(e){var t,r,i,o,a,u,_,p,f,h=e.data,y=h.stateMachine,v=h.stateRef,E=h.position,m=h.paused,g=h.loading,T=h.currentTrackInfo,S=null==y?void 0:y.states;if(y&&(null==S?void 0:S.length)&&v){var P=S[v.state_index],b=y.tracks[null==P?void 0:P.track];if(P&&b){var R=null!==(t=T.duration)&&void 0!==t?t:0,A=this._createTrackWindow(y,P,R);R||(R=null!==(i=null===(r=A.current_track)||void 0===r?void 0:r.duration_ms)&&void 0!==i?i:0);var I=c.parseRestrictions(P.restrictions||{},m),L=c.parseDisallows(I),O={timestamp:Date.now(),context:{uri:null!==(a=null===(o=b.metadata)||void 0===o?void 0:o.context_uri)&&void 0!==a?a:null,metadata:{}},position:E,duration:R,paused:m,playback_quality:null!==(u=T.playbackQuality)&&void 0!==u?u:s.PlaybackQuality.UNKNOWN,playback_features:{hifi_status:null!==(_=T.hifiStatus)&&void 0!==_?_:l.HiFiStatus.NONE,change_playback_speed:null!==(p=T.changePlaybackSpeed)&&void 0!==p&&p},shuffle:this._getShuffleSetting(y),repeat_mode:this._getRepeatSetting(y),track_window:A,restrictions:I,disallows:L,loading:g,playback_speed:T.playbackSpeed,playback_id:P.state_id};(null===(f=b.metadata)||void 0===f?void 0:f.context_description)&&(O.context.metadata.context_description=b.metadata.context_description),this._currentState=O,this.emit("state_changed",{state:O?n.__assign({},O):null})}else d.warn("_onStateChanged called with no current state or track",e)}else d.warn("_onStateChanged called with no current state",e)},t.prototype._createTrackWindow=function(e,t,r){var n=this,i=e.states;return{current_track:this._getTrackMetadata(e,t,r),next_tracks:this._getNextStates(t,i).map((function(t){return n._getTrackMetadata(e,t,null)})).filter((function(e){return!!e})),previous_tracks:this._getPreviousStates(t,i).map((function(t){return n._getTrackMetadata(e,t,null)})).filter((function(e){return!!e}))}},t.prototype._onStateCleared=function(){this._currentState=null,this.emit("state_changed",{state:null})},t.prototype._getRepeatSetting=function(e){var t=e.attributes.options;return t.repeating_track?u.RepeatMode.TRACK:t.repeating_context?u.RepeatMode.CONTEXT:u.RepeatMode.OFF},t.prototype._getShuffleSetting=function(e){return e.attributes.options.shuffling_context},t.prototype._getNextStates=function(e,t){for(var r=this._numNextTracks,n=[],i=e;i&&"show_next"in i.transitions&&i.transitions.show_next;){var o=t[i.transitions.show_next.state_index];if(o&&n.push(o),i=o,n.length>=r)break}return n},t.prototype._getPreviousStates=function(e,t){for(var r=this._numPreviousTracks,n=[],i=e;i&&"show_prev"in i.transitions&&i.transitions.show_prev;){var o=t[i.transitions.show_prev.state_index];if(o&&n.unshift(o),i=o,n.length>=r)break}return n},t.prototype._getTrackMetadata=function(e,t,r){var n=null==e?void 0:e.tracks[t.track];if(!(null==n?void 0:n.metadata))return null;var o=n.metadata,a=n.manifest&&"manifest_ids_video"in n.manifest,s=n.track_type.toLowerCase(),u=i.from(o.uri),l=o.linked_from_uri?i.from(o.linked_from_uri):null;return{id:u?i.hexToId(u.id):null,uri:o.uri,type:(null==u?void 0:u.type)||"unknown",uid:t.track_uid,linked_from:{uri:o.linked_from_uri||null,id:l?i.hexToId(l.id):null},media_type:a?"video":"audio",track_type:s,name:o.name,duration_ms:r||o.duration,artists:o.authors,album:{uri:o.group_uri,name:o.group_name,images:o.images},is_playable:!0}},t.prototype.getCurrentState=function(){var e=this._currentState;if(e&&!e.paused){var t=Date.now(),r=e.position+(t-e.timestamp);e.position=r,e.timestamp=t}return Promise.resolve(this._currentState?n.__assign({},this._currentState):null)},t}(o.EventEmitter);r.TPPlaybackStateObserver=_},{"../../enums/hifi_status":127,"../../enums/repeat_mode":129,"../playback_state_observer":113,"@js-sdk/debug-tools/es5":17,"@js-sdk/playback/es5":80,"@spotify-internal/emitter/es5":98,"spotify-liburi":199,tslib:201}],119:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createHarmonyClient=void 0;var n=e("./_internal/client");r.createHarmonyClient=function(e){return n.HarmonyClient.create(e)}},{"./_internal/client":99}],120:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createControllerForClient=void 0;var n=e("@spotify-internal/transport/es5/server_time"),i=e("./_internal/controller"),o=e("./_internal/connect_state/client");r.createControllerForClient=function(e,t){void 0===t&&(t={});var r=e.getPublicTransport(),a=e.getVersionDescriptor().tagged,s=o.PlayerAPIClient.create({autoregister:!("autoregister"in t)||t.autoregister,descriptor:e.getClientDescriptor(),transport:r});return i.HarmonyController.create({client:e,playerClient:s,version:a,serverTime:n.ServerTime.create(r),decorateTrackWindow:"boolean"!=typeof t.decorateTrackWindow||t.decorateTrackWindow,disableProgress:t.disableProgress})}},{"./_internal/connect_state/client":104,"./_internal/controller":105,"@spotify-internal/transport/es5/server_time":189}],121:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DebugSource=void 0,function(e){e.TRACK_DATA_FINALIZED="track_data_finalized",e.DEREGISTER="deregister",e.REGISTER="register",e.BEFORE_TRACK_LOAD="before_track_load",e.CAPPED="capped",e.ERROR="error",e.PAUSE="pause",e.RESUME="resume",e.PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.POSITION_CHANGED="position_changed",e.SPEED_CHANGED="speed_changed",e.STARTED_PLAYING="started_playing",e.PROGRESS="progress",e.PING="ping",e.MODIFY_CURRENT_STATE="modify_current_state",e.STATE_CLEAR="state_clear"}(r.DebugSource||(r.DebugSource={}))},{}],122:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceDeactivatedReason=void 0,function(e){e.LOCAL_PLAYER_DISABLED="local_player_disabled",e.STOPPED="stopped",e.REMOTE_ACTIVATED="remote_activated",e.UNKNOWN="unknown"}(r.DeviceDeactivatedReason||(r.DeviceDeactivatedReason={}))},{}],123:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceType=void 0,function(e){e.UNKNOWN="unknown",e.COMPUTER="computer",e.TABLET="tablet",e.SMARTPHONE="smartphone",e.SPEAKER="speaker",e.TV="tv",e.AVR="avr",e.STB="stb",e.AUDIO_DONGLE="audio_dongle",e.GAME_CONSOLE="game_console",e.CAST_VIDEO="cast_video",e.CAST_AUDIO="cast_audio",e.AUTOMOBILE="automobile",e.SMARTWATCH="smartwatch",e.CHROMEBOOK="chromebook"}(r.DeviceType||(r.DeviceType={}))},{}],124:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyErrorSource=void 0,function(e){e.CLOUD_PLAYBACK="cloud-playback",e.CONNECT_API="connect-api",e.HARMONY="harmony",e.PLAYBACK="playback",e.TRACK_PLAYBACK="track-playback",e.TRANSPORT="transport"}(r.HarmonyErrorSource||(r.HarmonyErrorSource={}))},{}],125:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyErrors=void 0,function(e){e.USER_INFO_REQUEST_EMPTY_RESPONSE="USER_INFO_REQUEST_EMPTY_RESPONSE",e.USER_INFO_REQUEST_FAILED_WITH_STATUS="USER_INFO_REQUEST_FAILED_WITH_STATUS",e.HARMONY_NO_TRACKS_LOADED="HARMONY_NO_TRACKS_LOADED",e.HARMONY_OPERATION_FORBIDDEN="HARMONY_OPERATION_FORBIDDEN",e.HARMONY_LOCAL_PLAYER_DISABLED="HARMONY_LOCAL_PLAYER_DISABLED",e.HARMONY_INVALID_DESCRIPTOR_ID="HARMONY_INVALID_DESCRIPTOR_ID",e.CONNECTAPI_CLIENT_INVALID_ARGUMENTS="CONNECTAPI_CLIENT_INVALID_ARGUMENTS",e.CONNECTAPI_CLIENT_MISSING_DEVICE_ID="CONNECTAPI_CLIENT_MISSING_DEVICE_ID",e.CONNECTAPI_CLIENT_NO_CONNECTION_ID="CONNECT_API_CLIENT_NO_CONNECTION_ID",e.CONNECTAPI_CLIENT_NO_DEVICE="CONNECTAPI_CLIENT_NO_DEVICE",e.CONNECTAPI_CLIENT_NO_SESSION_ID="CONNECTAPI_CLIENT_NO_SESSION_ID",e.CONNECTAPI_CLIENT_NO_STATE="CONNECTAPI_CLIENT_NO_STATE",e.CONNECTAPI_CLIENT_INVALID_POSITION="CONNECT_API_CLIENT_INVALID_POSITION",e.CONNECTAPI_CLIENT_INVALID_VOLUME="CONNECT_API_CLIENT_INVALID_VOLUME",e.CONNECTAPI_MAX_SUBSCRIPTIONS_REACHED="CONNECTAPI_MAX_SUBSCRIPTIONS_REACHED",e.CONNECTAPI_REGISTRATION_FAILED_WITH_STATUS="CONNECTAPI_REGISTRATION_FAILED_WITH_STATUS",e.CP_NO_DEVICE_DESCRIPTOR="CP_NO_DEVICE_DESCRIPTOR",e.CP_NO_CONNECTION_ID="CP_NO_CONNECTION_ID",e.CP_REGISTRATION_FAILED_WITH_STATUS="CP_REGISTRATION_FAILED_WITH_STATUS",e.CP_REQUEST_FAILED_WITH_STATUS="CP_REQUEST_FAILED_WITH_STATUS",e.CP_NO_DEVICE_ID="CP_NO_DEVICE_ID",e.CP_NO_COMMAND_ID="CP_NO_COMMAND_ID",e.CP_NO_RESPONSE_BODY="CP_NO_RESPONSE_BODY",e.CP_NO_TRACKING_DATA="CP_NO_TRACKING_DATA",e.CP_INVALID_STATE="CP_INVALID_STATE",e.QUEUE_MANAGER_NO_STATE="QUEUE_MANAGER_NO_STATE",e.QUEUE_OPERATION_STALE_REVISION="QUEUE_OPERATION_STALE_REVISION",e.TP_NO_RESPONSE_BODY="TP_NO_RESPONSE_BODY",e.TP_REGISTRATION_FAILED_NON_PREMIUM="TP_REGISTRATION_FAILED_NON_PREMIUM",e.TP_REGISTRATION_FAILED_WITH_STATUS="TP_REGISTRATION_FAILED_WITH_STATUS",e.TP_MAX_SUBSCRIPTIONS_REACHED="TP_MAX_SUBSCRIPTIONS_REACHED",e.TP_UPDATE_REQUEST_EMPTY_RESPONSE="TP_UPDATE_REQUEST_EMPTY_RESPONSE",e.TP_PARSE_STATE_UPDATE_FAILED_WITH_STATUS="TP_PARSE_STATE_UPDATE_FAILED_WITH_STATUS",e.TP_UNKNOWN_COMMAND="TP_UNKNOWN_COMMAND",e.TP_CANNOT_CREATE_STATE_REF="TP_CANNOT_CREATE_STATE_REF",e.TP_MISSING_INITIAL_STATE="TP_MISSING_INITIAL_STATE",e.TP_INVALID_STATE_REFERENCE="TP_INVALID_STATE_REFERENCE",e.TP_CONFLICT_REQUEST_FAILED_WITH_STATUS="TP_CONFLICT_REQUEST_FAILED_WITH_STATUS"}(r.HarmonyErrors||(r.HarmonyErrors={}))},{}],126:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyEvent=void 0,function(e){e.AUTHENTICATED="authenticated",e.AUTHENTICATION_ERROR="authentication_error",e.AUTOPLAY_FAILED="autoplay_failed",e.BEFORE_DISCONNECT="before_disconnect",e.BEFORE_VOLUME_CHANGE="before_volume_change",e.BUFFER_STALLED="stalled",e.BUFFERING_END="buffering_end",e.BUFFERING_START="buffering_start",e.CONNECTED="connected",e.CONNECTION_ERROR="connection_error",e.DEVICES_CHANGED="devices_changed",e.DEVICE_DEACTIVATED="device_deactivated",e.DEVICE_DESCRIPTOR_CHANGED="descriptor_changed",e.DISCONNECTED="disconnected",e.DURATION_CHANGED="duration_changed",e.ERROR="error",e.LAST_ACTIVE_DEVICE_INFO_CHANGED="last_active_device_info_changed",e.LOCAL_CONTEXT_ENDED="local_context_ended",e.LOCAL_PLAYER_DISABLED="local_player_disabled",e.LOCAL_PLAYER_ENABLED="local_player_enabled",e.LOCAL_PLAYER_LOGGED_OUT="local_player_logged_out",e.LOGGED_OUT="logged_out",e.MAX_LIST_ERRORS_REACHED="max_list_errors_reached",e.MAX_SUBSCRIPTIONS_REACHED="max_subscriptions_reached",e.PLAYBACK_CAPPED="playback_capped",e.PLAYER_INITIALIZATION_DONE="player_initialization_done",e.PLAYER_INITIALIZATION_FAILED="player_initialization_failed",e.PRODUCT_STATE_CHANGED="product_state_changed",e.PROGRESS="progress",e.PLAYER_QUEUE_CHANGED="player_queue_changed",e.RECONNECTED="reconnected",e.RECONNECTING="reconnecting",e.REMOTE_OBSERVER_DISABLED="remote_observer_disabled",e.REMOTE_OBSERVER_ENABLED="remote_observer_enabled",e.SERVICE_REGISTRATION_ERROR="service_registration_error",e.STATE_CHANGED="state_changed",e.STOPPED_ON_BACKGROUND="stopped_on_background",e.TRACK_ENDED="track_ended",e.UNRECOVERABLE_FAILURE="unrecoverable_failure",e.VIDEO_ELEMENT_APPENDED="video_element_appended",e.VIDEO_ELEMENT_REMOVED="video_element_removed",e.VOLUME_CHANGED="volume_changed",e.DISPLAYED_CUES_CHANGED="displayed_cues_changed",e.SUBTITLE_LANGUAGES_LOADED="subtitle_languages_loaded",e.SPEED_CHANGED="speed_changed"}(r.HarmonyEvent||(r.HarmonyEvent={}))},{}],127:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HiFiStatus=void 0,function(e){e.ON="ON",e.OFF="OFF",e.NONE="NONE"}(r.HiFiStatus||(r.HiFiStatus={}))},{}],128:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ManifestFormat=void 0,function(e){e.FILE_URLS_MP3="file_urls_mp3",e.FILE_URLS_EXTERNAL="file_urls_external",e.FILE_IDS_MP3="file_ids_mp3",e.FILE_IDS_MP4="file_ids_mp4",e.FILE_IDS_MP4_DUAL="file_ids_mp4_dual",e.FILE_IDS_CBCS="file_ids_mp4_cbcs",e.FILE_IDS_MP4FLAC="file_ids_mp4flac",e.MANIFEST_IDS_VIDEO="manifest_ids_video"}(r.ManifestFormat||(r.ManifestFormat={}))},{}],129:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RepeatMode=void 0,function(e){e[e.OFF=0]="OFF",e[e.CONTEXT=1]="CONTEXT",e[e.TRACK=2]="TRACK"}(r.RepeatMode||(r.RepeatMode={}))},{}],130:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CloudPlaybackClientError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.unrecoverable=!1,n.debug={},n.code=t,n.name="CloudPlaybackClientError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.CloudPlaybackClientError=i},{tslib:201}],131:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerAPIClientError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.maxedSubscriptions=!1,n.unrecoverable=!1,n.debug={},n.code=t,n.name="PlayerAPIClientError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.PlayerAPIClientError=i},{tslib:201}],132:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.unrecoverable=!1,n.debug={},n.code=t,n.name="HarmonyError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.HarmonyError=i},{tslib:201}],133:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerQueueError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.unrecoverable=!1,n.code=t,n.name="PlayerQueueError",n}return n.__extends(t,e),t}(Error);r.PlayerQueueError=i},{tslib:201}],134:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackPlayerAPIClientError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.maxedSubscriptions=!1,n.unrecoverable=!1,n.debug={},n.registration=!1,n.code=t,n.name="TrackPlayerAPIClientError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.TrackPlayerAPIClientError=i},{tslib:201}],135:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createHarmonyAndTransport=r.createHarmony=r.HarmonyError=r.LOCAL_DEVICE_ID=r.HiFiStatus=r.DeviceDeactivatedReason=r.RepeatMode=r.HarmonyEvent=r.HarmonyErrorSource=r.DeviceType=r.PlaybackQuality=r.Robustness=r.MediaCodec=r.KeySystem=void 0;var n=e("tslib"),i=e("@js-sdk/playback/es5/enums/errors"),o=e("@spotify-internal/transport/es5/enums/errors"),a=e("./enums/errors"),s=e("./utils/create_transport"),u=e("./_internal/harmony"),l=e("./client"),c=e("./streamer"),d=e("./controller"),_=e("@js-sdk/playback/es5");Object.defineProperty(r,"KeySystem",{enumerable:!0,get:function(){return _.KeySystem}}),Object.defineProperty(r,"MediaCodec",{enumerable:!0,get:function(){return _.MediaCodec}}),Object.defineProperty(r,"Robustness",{enumerable:!0,get:function(){return _.Robustness}}),Object.defineProperty(r,"PlaybackQuality",{enumerable:!0,get:function(){return _.PlaybackQuality}});var p=e("./enums/device_type");Object.defineProperty(r,"DeviceType",{enumerable:!0,get:function(){return p.DeviceType}});var f=e("./enums/error_source");Object.defineProperty(r,"HarmonyErrorSource",{enumerable:!0,get:function(){return f.HarmonyErrorSource}});var h=e("./enums/harmony_event");Object.defineProperty(r,"HarmonyEvent",{enumerable:!0,get:function(){return h.HarmonyEvent}});var y=e("./enums/repeat_mode");Object.defineProperty(r,"RepeatMode",{enumerable:!0,get:function(){return y.RepeatMode}});var v=e("./enums/device_deactivated_reason");Object.defineProperty(r,"DeviceDeactivatedReason",{enumerable:!0,get:function(){return v.DeviceDeactivatedReason}});var E=e("./enums/hifi_status");Object.defineProperty(r,"HiFiStatus",{enumerable:!0,get:function(){return E.HiFiStatus}});var m=e("./typedefs");function g(e){var t,r=e.transport;if(!r)throw new TypeError("No Transport instance provided");var i=n.__assign(n.__assign({},e.client),{transport:r,hidden:!!e.hidden,playTokenLostBehavior:e.hidden&&!e.onlyLocalState?"stop":"pause"}),o=l.createHarmonyClient(i),a=e.streamer||{},s=e.controller||{},_=void 0,p=!1;e.streamer&&e.streamer.disabled?(e.hidden=!0,e.onlyLocalState=!1,e.claimInactivePlayerStates=!1,p=!0):(_=c.createStreamerForClient(o,a),s.autoregister=!1,e.onlyLocalState&&(s.decorateTrackWindow=!1,s.disableProgress=!0));var f=d.createControllerForClient(o,s);return u.Harmony.create({transport:r,client:o,streamer:_,controller:f,enableControllerWithoutStreamer:p,hidden:e.hidden,onlyLocalState:e.onlyLocalState,claimInactivePlayerStates:e.claimInactivePlayerStates,autoActivateElement:null!==(t=e.autoActivateElement)&&void 0!==t?t:"undefined"!=typeof WebKitMediaKeys,experimentalDeactivateOnStop:e.experimentalDeactivateOnStop})}Object.defineProperty(r,"LOCAL_DEVICE_ID",{enumerable:!0,get:function(){return m.LOCAL_DEVICE_ID}}),r.HarmonyError=n.__assign(n.__assign(n.__assign({},a.HarmonyErrors),o.TransportErrors),i.Errors),r.createHarmony=g,r.createHarmonyAndTransport=function(e){var t=s.createTransportForHarmony(e);return{harmony:g(n.__assign(n.__assign({},e),{transport:t})),transport:t}}},{"./_internal/harmony":107,"./client":119,"./controller":120,"./enums/device_deactivated_reason":122,"./enums/device_type":123,"./enums/error_source":124,"./enums/errors":125,"./enums/harmony_event":126,"./enums/hifi_status":127,"./enums/repeat_mode":129,"./streamer":137,"./typedefs":138,"./utils/create_transport":140,"@js-sdk/playback/es5":80,"@js-sdk/playback/es5/enums/errors":58,"@spotify-internal/transport/es5/enums/errors":163,tslib:201}],136:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createHarmonyWithPlaybackService=r.PlaybackServiceCreators=void 0;var n=e("tslib"),i=e("./_internal/harmony"),o=e("./client"),a=e("./controller"),s=e("./streamer"),u=e("./_internal/cloud_playback/client"),l=e("./_internal/cloud_playback/playback_state_observer"),c=e("./_internal/track_playback/client"),d=e("./_internal/track_playback/context"),_=e("./_internal/track_playback/playback_state_observer");n.__exportStar(e("./index"),r),r.PlaybackServiceCreators={"cloud-playback":function(e){var t=u.CloudPlaybackClient.create(e);return{playbackServiceClient:t,playbackStateObserver:l.CPPlaybackStateObserver.create(t)}},"track-playback":function(e){var t=c.TrackPlaybackServiceClient.create(n.__assign(n.__assign({},e),{ListClass:d.TrackPlayerServiceContext}));return{playbackServiceClient:t,playbackStateObserver:_.TPPlaybackStateObserver.create(t)}}},r.createHarmonyWithPlaybackService=function(e){var t,u,l,c=e.transport;if(!c)throw new TypeError("No Transport instance provided");var d=n.__assign(n.__assign({},e.client),{transport:c,hidden:!!e.hidden,playTokenLostBehavior:e.hidden&&!e.onlyLocalState?"stop":"pause"}),_=o.createHarmonyClient(d),p=e.streamer||{},f=e.controller||{},h=void 0,y=!1;if(e.streamer&&e.streamer.disabled)e.hidden=!0,e.onlyLocalState=!1,e.claimInactivePlayerStates=!1,y=!0;else{var v=null!==(u=null===(t=e.streamer)||void 0===t?void 0:t.playbackService)&&void 0!==u?u:"track-playback";h=s.createStreamerForClientWithPlaybackService(_,r.PlaybackServiceCreators[v],p),f.autoregister=!1,e.onlyLocalState&&(f.decorateTrackWindow=!1,f.disableProgress=!0)}var E=a.createControllerForClient(_,f);return i.Harmony.create({transport:c,client:_,streamer:h,controller:E,enableControllerWithoutStreamer:y,hidden:e.hidden,onlyLocalState:e.onlyLocalState,claimInactivePlayerStates:e.claimInactivePlayerStates,autoActivateElement:null!==(l=e.autoActivateElement)&&void 0!==l?l:"undefined"!=typeof WebKitMediaKeys,experimentalDeactivateOnStop:e.experimentalDeactivateOnStop})}},{"./_internal/cloud_playback/client":100,"./_internal/cloud_playback/playback_state_observer":103,"./_internal/harmony":107,"./_internal/track_playback/client":116,"./_internal/track_playback/context":117,"./_internal/track_playback/playback_state_observer":118,"./client":119,"./controller":120,"./index":135,"./streamer":137,tslib:201}],137:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.of=r.createStreamerForClient=r.createStreamerForClientWithPlaybackService=r.HarmonyStreamer=void 0;var n=e("tslib"),i=e("@js-sdk/playback/es5"),o=e("./enums/manifest_format"),a=e("./_internal/streamer");Object.defineProperty(r,"HarmonyStreamer",{enumerable:!0,get:function(){return a.HarmonyStreamer}});var s=e("./_internal/track_playback/context"),u=e("./_internal/track_playback/playback_state_observer"),l=e("./_internal/manifest_track_resolver"),c=e("./_internal/track_playback/client");function d(e,t,r){var s,u,c,d,_,p;void 0===r&&(r={});var f=e.getSDKId(),h=e.getPublicTransport(),y=e.getLogger(),v=e.getDeviceDescriptor(),E="initialVolume"in r&&void 0!==r.initialVolume?r.initialVolume:1,m=n.__assign(n.__assign({},r),{transport:h,sdkId:e.getUntaggedSDKId(),loggerOptions:{disableMux:null===(c=null!==(u=null===(s=null==r?void 0:r.mux)||void 0===s?void 0:s.disable)&&void 0!==u?u:null==r?void 0:r.disableMux)||void 0===c||c,muxEnvKey:null!==(_=null===(d=null==r?void 0:r.mux)||void 0===d?void 0:d.envKey)&&void 0!==_?_:null==r?void 0:r.muxEnvKey,deviceInfo:v.then((function(e){return{platform_name:e.getPlatformName(),platform:e.getPlatformIdentifier(),version:e.getPlatformVersion(),brand:e.getBrand(),model:e.getModel(),type:e.getType()}})),muxCustomDimensions:null===(p=null==r?void 0:r.mux)||void 0===p?void 0:p.customDimensions,platform:e.getPlatformIdentifier(),clientVersion:e.getPlatformVersion()}}),g=i.createPlayer(m).then((function(e){return e.player})),T=g.then((function(e){return e.getMediaConfig()})),S=Promise.all([v,T]).then((function(e){var t=e[0],n=e[1];return t.getCapability("audio_podcasts")&&!r.disableExternalFiles&&t.appendManifestFormat(o.ManifestFormat.FILE_URLS_EXTERNAL),n.keysystem===i.KeySystem.FAIRPLAY?t.appendManifestFormat(o.ManifestFormat.FILE_IDS_CBCS):n.keysystem!==i.KeySystem.WIDEVINE||r.preferMultiDRMFormat?t.appendManifestFormat(o.ManifestFormat.FILE_IDS_MP4_DUAL,o.ManifestFormat.FILE_IDS_MP4):(-1!==n.formats.audio.indexOf('audio/mp4; codecs="flac"')&&t.getCapability("lossless_playback")&&t.appendManifestFormat(o.ManifestFormat.FILE_IDS_MP4FLAC),t.appendManifestFormat(o.ManifestFormat.FILE_IDS_MP4,o.ManifestFormat.FILE_IDS_MP4_DUAL)),n.supports.protected_video&&t.getCapability("video_playback")&&t.prependManifestFormat(o.ManifestFormat.MANIFEST_IDS_VIDEO),t})),P=i.ListPlayer.create({trackPlayer:g}),b=l.ManifestTrackResolver.create({descriptor:v,listPlayer:P}),R=t({initialVolume:E,listPlayer:P,logger:y,transport:h,clientVersion:f,descriptor:S,endpoint:r.endpoint,manifestTrackResolver:b}),A=R.playbackServiceClient,I=R.playbackStateObserver,L="stopOnBackground"in r?r.stopOnBackground:"undefined"==typeof MediaSource;return new a.HarmonyStreamer({client:e,playbackServiceClient:A,playbackStateObserver:I,initialVolume:E,playerPromise:g,listPlayer:P,stopOnBackground:L})}r.createStreamerForClientWithPlaybackService=d,r.createStreamerForClient=function(e,t){return void 0===t&&(t={}),d(e,(function(e){var t=c.TrackPlaybackServiceClient.create(n.__assign(n.__assign({},e),{ListClass:s.TrackPlayerServiceContext}));return{playbackServiceClient:t,playbackStateObserver:u.TPPlaybackStateObserver.create(t)}}),t)},r.of=function(e){var t=e._streamer;if(!(t instanceof a.HarmonyStreamer))throw new Error("The harmony instance has an invalid `_streamer`.");return t}},{"./_internal/manifest_track_resolver":111,"./_internal/streamer":115,"./_internal/track_playback/client":116,"./_internal/track_playback/context":117,"./_internal/track_playback/playback_state_observer":118,"./enums/manifest_format":128,"@js-sdk/playback/es5":80,tslib:201}],138:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GAIA_VOLUME=r.LOCAL_DEVICE_ID=void 0,r.LOCAL_DEVICE_ID="@local",r.GAIA_VOLUME=65535},{}],139:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.assert=void 0,r.assert=function(e,t){if(!e)throw new Error("Assertion failed: "+t)}},{}],140:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createTransportForHarmony=void 0;var n=e("@spotify-internal/transport/es5/providers/endpoints/xresolve"),i=e("@spotify-internal/transport/es5");function o(e){return"string"==typeof e}r.createTransportForHarmony=function(e){if("function"!=typeof e.getToken)throw new TypeError("Argument options.getToken must be a function");var t=n.createProvider(e.xresolve);return i.createTransport({providers:{endpoints:function(r){return t(r).then((function(t){var r=e.endpoints;if(r)for(var n in r)if(r.hasOwnProperty(n)){var i=r[n];o(i)&&(t[n]=i)}return t}))},token:function(){return new Promise((function(t){e.getToken((function(e,r){t(void 0===r?e:[e,r])}))}))}},disconnectBeforeUnload:e.disconnectBeforeUnload,forcePolyfillTypes:e.forcePolyfillTypes,reconnectionRetries:e.reconnectionRetries,requestMode:e.requestMode||"fetch"})}},{"@spotify-internal/transport/es5":181,"@spotify-internal/transport/es5/providers/endpoints/xresolve":188}],141:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceId=void 0;var n=e("@js-sdk/encoding/es5");function i(){var e=new Uint8Array(16);return crypto.getRandomValues(e),n.Base62.toHex(e.join(""),40).slice(0,40)}function o(){for(var e=new Array(27),t=e.length;t--;)e[t]=Math.floor(8*Math.random());return n.Base62.toHex(e.join(""),40)}var a="undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues?i:o;r.DeviceId={get:function(e,t){if(void 0===t&&(t=!1),e&&"string"==typeof e)return e;if(t)return a();var r=localStorage.getItem("_spharmony_device_id");return r||(r=a(),localStorage.setItem("_spharmony_device_id",r)),r},generate:a,generateWithCrypto:i,generateWithRandom:o}},{"@js-sdk/encoding/es5":21}],142:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={tagged:"4.24.0-ed6fca3",version:"4.24.0",revision:"ed6fca3"}},{}],143:[function(e,t,r){arguments[4][83][0].apply(r,arguments)},{"./logger":149,"./promise_resolver":151,"./user_agent":152,dup:83,tslib:201}],144:[function(e,t,r){arguments[4][84][0].apply(r,arguments)},{dup:84}],145:[function(e,t,r){arguments[4][85][0].apply(r,arguments)},{dup:85,tslib:201}],146:[function(e,t,r){arguments[4][86][0].apply(r,arguments)},{dup:86}],147:[function(e,t,r){arguments[4][87][0].apply(r,arguments)},{dup:87}],148:[function(e,t,r){arguments[4][88][0].apply(r,arguments)},{dup:88}],149:[function(e,t,r){arguments[4][89][0].apply(r,arguments)},{"./enums/errors":147,"./enums/log_values":148,"./logger":150,dup:89,tslib:201}],150:[function(e,t,r){arguments[4][90][0].apply(r,arguments)},{"./_internal/group_by":144,"./_internal/logging_error":145,"./_internal/url_utils":146,"./enums/errors":147,"./enums/log_values":148,dup:90,tslib:201}],151:[function(e,t,r){arguments[4][7][0].apply(r,arguments)},{dup:7}],152:[function(e,t,r){arguments[4][8][0].apply(r,arguments)},{"./interpolate_ua":153,"./parse_ua":154,dup:8,tslib:201}],153:[function(e,t,r){arguments[4][9][0].apply(r,arguments)},{"./parse_ua":154,dup:9}],154:[function(e,t,r){arguments[4][10][0].apply(r,arguments)},{dup:10}],155:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ListNode=r.LinkedList=void 0;var n=e("tslib"),i=e("./linkedlist");Object.defineProperty(r,"LinkedList",{enumerable:!0,get:function(){return i.LinkedList}}),Object.defineProperty(r,"ListNode",{enumerable:!0,get:function(){return i.ListNode}}),n.__exportStar(e("./lrucache"),r)},{"./linkedlist":156,"./lrucache":157,tslib:201}],156:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LinkedList=r.ListNode=void 0;var n=function(e){this.listId=null,this.key="",this.prev=null,this.next=null,this.value=null,this.value=e};r.ListNode=n;var i=function(){function e(){this._id={},this.length=0,this.first=null,this.last=null}return e.prototype.append=function(e){if(e.listId)throw new Error("Node already exists in another list!");return e.listId=this._id,this.first?this.last&&(e.prev=this.last,e.next=null,this.last.next=e,this.last=e):(this.first=e,this.last=e),++this.length},e.prototype.insertAfter=function(e,t){if(t.listId)throw new Error("Node already exists in another list!");return t.listId=this._id,t.prev=e,t.next=e.next,e.next&&(e.next.prev=t),e.next=t,t.prev===this.last&&(this.last=t),++this.length},e.prototype.remove=function(e){return!(!this.length||e.listId!==this._id)&&(this.length>1?(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first?this.first=e.next:e===this.last&&(this.last=e.prev)):(this.first=null,this.last=null),e.listId=null,e.prev=null,e.next=null,this.length--,!0)},e}();r.LinkedList=i},{}],157:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LRUCache=void 0;var n=e("./linkedlist"),i=function(){function e(e){this._limit=100,this._list=new n.LinkedList,this._map={},this._limit=e}return e.prototype.get=function(e){var t=this._map[e];if(!t)return null;var r=this._list;return r.remove(t),r.append(t),t.value},e.prototype.set=function(e,t){if(!e)throw new TypeError("Cache key cannot be empty.");var r=this._list,i=this._map;if(r.length>=this._limit){var o=r.first;i[o.key]=null,r.remove(o)}var a=i[e];a?(r.remove(a),a.value=t):(a=new n.ListNode(t)).key=e,r.append(a),i[e]=a},e.prototype.remove=function(e){var t=this._map,r=t[e];return r?(this._list.remove(r),t[e]=null,r.value):null},e.prototype.keys=function(){for(var e=[],t=this._list.first;t;)e.push(t.key),t=t.next;return e.reverse()},e.prototype.values=function(){for(var e=[],t=this._list.first;t;)e.push(t.value),t=t.next;return e.reverse()},e.prototype.size=function(){return this._list.length},e.prototype.clear=function(){var e=this._list.length;return this._list=new n.LinkedList,this._map={},e},e}();r.LRUCache=i},{"./linkedlist":156}],158:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BrowserConnectionObserver=r.ConnectionObserver=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/event"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(i.EventEmitter);r.ConnectionObserver=a;var s=function(e){function t(t){var r=e.call(this)||this,n="undefined"!=typeof window,i=t&&t.notifyBeforeUnload;return r._navigator=n&&window.navigator||null,n&&"function"==typeof window.addEventListener&&(window.addEventListener("online",r.emitSync.bind(r,o.Event.CONNECTION_ONLINE,null)),window.addEventListener("offline",r.emitSync.bind(r,o.Event.CONNECTION_OFFLINE,null)),i&&window.addEventListener(o.Event.WINDOW_BEFORE_UNLOAD,r.emitSync.bind(r,o.Event.WINDOW_BEFORE_UNLOAD,null))),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype.isOnline=function(){var e=this._navigator;return!e||!("onLine"in e)||e.onLine},t}(a);r.BrowserConnectionObserver=s},{"../enums/event":164,"@spotify-internal/emitter/es5":98,tslib:192}],159:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OperationMetricsTracker=void 0;var n=function(){function e(){this._startTime=null,this._endTime=null}return e.create=function(){return new e},e.prototype.start=function(){if(null!==this._startTime)throw new Error("Measurement is already in progress.");this._startTime=Date.now()},e.prototype.end=function(){if(null===this._startTime||null!==this._endTime)throw new Error("Measurement is not in progress.");this._endTime=Date.now()},e.prototype.getMetrics=function(){if(null===this._startTime||null===this._endTime)throw new Error("Measurement is not done.");return{start_time:this._startTime,end_time:this._endTime}},e}();r.OperationMetricsTracker=n},{}],160:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PublicTransport=void 0;var n,i=e("tslib"),o=e("@spotify-internal/emitter/es5"),a=e("../enums/event"),s=e("../enums/status_code"),u=e("../enums/status_family");!function(e){e.EVENT_ACCESS_TOKEN="access_token",e.EVENT_CONNECTION_ID="connection_id",e.EVENT_CONNECTION_OFFLINE="connection_offline",e.EVENT_CONNECTION_ONLINE="connection_online",e.EVENT_ENDPOINTS_RESOLVED="endpoints_resolved"}(n||(n={}));var l=function(e){function t(t,r){var o=e.call(this)||this;o.EVENT_ACCESS_TOKEN=n.EVENT_ACCESS_TOKEN,o.EVENT_CONNECTION_ID=n.EVENT_CONNECTION_ID,o.EVENT_CONNECTION_OFFLINE=n.EVENT_CONNECTION_OFFLINE,o.EVENT_CONNECTION_ONLINE=n.EVENT_CONNECTION_ONLINE,o.EVENT_ENDPOINTS_RESOLVED=n.EVENT_ENDPOINTS_RESOLVED,o.StatusCode=s.StatusCode,o.StatusFamily=u.StatusFamily,o.getConnectionId=t.getConnectionId.bind(t),o.getEndpoints=t.getEndpoints.bind(t),o.getInitTime=t.getInitTime.bind(t),o.getLastToken=t.getLastToken.bind(t),o.matchMessages=t.matchMessages.bind(t),o.unmatchMessages=t.unmatchMessages.bind(t),o.handlePushRequests=t.handlePushRequests.bind(t),o.unhandlePushRequests=t.unhandlePushRequests.bind(t),o.hasPlugin=t.hasPlugin.bind(t),o.getPluginAPI=t.getPluginAPI.bind(t);var l=t.request.bind(t);return(null==r?void 0:r.requestOptions)?o.request=function(e,t){return l(e,t?i.__assign(i.__assign(i.__assign({},null==r?void 0:r.requestOptions),t),{metadata:i.__assign(i.__assign({},r.requestOptions.metadata),null==t?void 0:t.metadata),retry:i.__assign(i.__assign({},r.requestOptions.retry),null==t?void 0:t.retry)}):r.requestOptions)}:o.request=l,o.proxyEmit(t,a.Event.ACCESS_TOKEN,n.EVENT_ACCESS_TOKEN),o.proxyEmit(t,a.Event.CONNECTION_OFFLINE,n.EVENT_CONNECTION_OFFLINE),o.proxyEmit(t,a.Event.CONNECTION_ONLINE,n.EVENT_CONNECTION_ONLINE),o.proxyEmit(t,a.Event.ENDPOINTS_RESOLVED,n.EVENT_ENDPOINTS_RESOLVED),o.onAddListener(n.EVENT_CONNECTION_ID,o._onAddConnectionIdListener.bind(o,t.on.bind(t))),o.onRemoveListener(n.EVENT_CONNECTION_ID,o._onRemoveConnectionIdListener.bind(o,t.removeListener.bind(t))),o}return i.__extends(t,e),t.prototype._onAddConnectionIdListener=function(e,t){var r=this;t.preventDefault();var i=t.data.listener,o=function(e){var t=r.createEvent(n.EVENT_CONNECTION_ID,e.data);i.call(r,t)};i.$proxy_wrapper=o,e(a.Event.CONNECTION_ID,o,t.data.options)},t.prototype._onRemoveConnectionIdListener=function(e,t){t.preventDefault();var r=t.data.listener;r.$proxy_wrapper&&e(a.Event.CONNECTION_ID,r.$proxy_wrapper,t.data.options)},t.prototype.removeAllListeners=function(){return this},t}(o.EventEmitter);r.PublicTransport=l},{"../enums/event":164,"../enums/status_code":168,"../enums/status_family":169,"@spotify-internal/emitter/es5":98,tslib:192}],161:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AllowsPayload=void 0,r.AllowsPayload={POST:!0,PUT:!0,DELETE:!0}},{}],162:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DisconnectionReason=void 0,function(e){e.RECONNECTION_FAILED="reconnection_failed",e.EXPLICIT="explicit",e.LOG_OUT="log_out",e.WINDOW_BEFORE_UNLOAD="window_before_unload"}(r.DisconnectionReason||(r.DisconnectionReason={}))},{}],163:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TransportErrors=void 0,function(e){e.HTTP_REQUEST_ABORTED="HTTP_REQUEST_ABORTED",e.HTTP_REQUEST_FAILED="HTTP_REQUEST_FAILED",e.LOGGING_REQUEST_FAILED="LOGGING_REQUEST_FAILED",e.TRANSPORT_ENDPOINTS_PROVIDER_ERROR="TRANSPORT_ENDPOINTS_PROVIDER_ERROR",e.TRANSPORT_INVALID_STATE="TRANSPORT_INVALID_STATE",e.TRANSPORT_INVALID_TOKEN="TRANSPORT_INVALID_TOKEN",e.TRANSPORT_STALE_TOKEN="TRANSPORT_STALE_TOKEN ",e.TRANSPORT_TOKEN_PROVIDER_ERROR="TRANSPORT_TOKEN_PROVIDER_ERROR",e.TRANSPORT_LIFECYCLE_DISABLED="TRANSPORT_LIFECYCLE_DISABLED",e.TRANSPORT_UNSUPPORTED_OPTION="TRANSPORT_UNSUPPORTED_OPTION",e.XRESOLVE_INCOMPLETE_RESPONSE="XRESOLVE_INCOMPLETE_RESPONSE",e.XRESOLVE_INVALID_RESPONSE="XRESOLVE_INVALID_RESPONSE",e.XRESOLVE_REQUEST_FAILED_WITH_STATUS="XRESOLVE_REQUEST_FAILED_WITH_STATUS"}(r.TransportErrors||(r.TransportErrors={}))},{}],164:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Event=void 0,function(e){e.CONNECTION_ONLINE="online",e.CONNECTION_OFFLINE="offline",e.PRODUCT_STATE_CHANGED="product_state_changed",e.ACCESS_TOKEN="access_token",e.AUTHENTICATED="authenticated",e.AUTHENTICATION_FAILED="authentication_failed",e.BEFORE_OFFLINE_DISCONNECT="before_offline_disconnect",e.BEFORE_ONLINE_DISCONNECT="before_online_disconnect",e.CONNECTED="connected",e.CONNECTION_FAILED="connection_failed",e.CONNECTION_ID="connection_id",e.DISCONNECTED="disconnected",e.ENDPOINTS_RESOLVED="endpoints_resolved",e.LOGGED_OUT="logged_out",e.SHORT_SESSION_DISCONNECTED="short_session_disconnected",e.TOKEN_PROVIDER_ERROR="token_provider_error",e.RECONNECTED="reconnected",e.RECONNECTING="reconnecting",e.WINDOW_BEFORE_UNLOAD="beforeunload"}(r.Event||(r.Event={}))},{}],165:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalSocketCode=void 0,function(e){e[e.CLOSE=4e3]="CLOSE",e[e.TIMEOUT=4001]="TIMEOUT"}(r.InternalSocketCode||(r.InternalSocketCode={}))},{}],166:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Method=void 0,function(e){e.DELETE="DELETE",e.GET="GET",e.OPTIONS="OPTIONS",e.PATCH="PATCH",e.POST="POST",e.PUT="PUT",e.TRACE="TRACE"}(r.Method||(r.Method={}))},{}],167:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PluginEvent=void 0,function(e){e.TRANSPORT_AUTHENTICATE="transport_authenticate",e.TRANSPORT_AUTHENTICATE_FAILED="transport_authenticate_failed",e.TRANSPORT_CONNECT="transport_connect",e.TRANSPORT_DISCONNECT="transport_disconnect",e.TRANSPORT_ENDPOINTS_RESOLVED="transport_endpoints_resolved",e.TRANSPORT_BEFORE_PROCESS_REQUEST="transport_before_process_request",e.TRANSPORT_BEFORE_SEND_REQUEST="transport_before_send_request",e.TRANSPORT_BEFORE_RETURN_RESPONSE="transport_before_return_response",e.TRANSPORT_REQUEST="transport_request",e.PLUGIN_CONNECTION_INFO="plugin_connection_info",e.PLUGIN_DISCONNECTED="plugin_disconnected",e.PLUGIN_MESSAGE="plugin_message",e.PLUGIN_REQUEST="plugin_request",e.PLUGIN_ERROR="plugin_error"}(r.PluginEvent||(r.PluginEvent={}))},{}],168:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusCode=void 0,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.TIMED_OUT=408]="TIMED_OUT",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.CONFLICT=409]="CONFLICT",e[e.GONE=410]="GONE",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.REQUEST_ENTITY_TOO_LARGE=413]="REQUEST_ENTITY_TOO_LARGE",e[e.REQUEST_URI_TOO_LONG=414]="REQUEST_URI_TOO_LONG",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.REQUESTED_RANGE_NOT_SATISFIABLE=416]="REQUESTED_RANGE_NOT_SATISFIABLE",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED"}(r.StatusCode||(r.StatusCode={}))},{}],169:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusFamily=void 0,function(e){e[e.CONNECTION_ERROR=0]="CONNECTION_ERROR",e[e.INFORMATIONAL=1]="INFORMATIONAL",e[e.SUCCESS=2]="SUCCESS",e[e.REDIRECTION=3]="REDIRECTION",e[e.CLIENT_ERROR=4]="CLIENT_ERROR",e[e.SERVER_ERROR=5]="SERVER_ERROR"}(r.StatusFamily||(r.StatusFamily={}))},{}],170:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RequestAbortedError=r.RequestError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.name="RequestError",i.message=t,i.code=r,i.status=n||0,i}return n.__extends(t,e),t}(Error);r.RequestError=o;var a=function(e){function t(){var t=e.call(this,"Request aborted by signal.",i.TransportErrors.HTTP_REQUEST_ABORTED,0)||this;return t.name="RequestAbortedError",t.message="Request aborted by signal.",t}return n.__extends(t,e),t}(o);r.RequestAbortedError=a},{"../enums/errors":163,tslib:192}],171:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TransportError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n){void 0===n&&(n=null);var i=e.call(this,r)||this;return i.name="TransportError",i.message=r,i.code=t,i.origin=n,i}return n.__extends(t,e),t}(Error);r.TransportError=i},{tslib:192}],172:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.XResolveError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n){void 0===n&&(n=-1);var i=e.call(this,r)||this;return i.name="XResolveError",i.message=r,i.code=t,i.status=n,i}return n.__extends(t,e),t}(Error);r.XResolveError=i},{tslib:192}],173:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.raceSignals=r.createAbortControllerLike=r.hasNativeAbortController=r.AbortControllerMicrofill=r.AbortSignalMicrofill=void 0;var n=e("tslib"),i=function(e){function t(){var t=e.call(this)||this;return t._aborted=!1,t.onabort=null,t.on("abort",(function(){var e;return null===(e=t.onabort)||void 0===e?void 0:e.call(t)})),t}return n.__extends(t,e),t.abort=function(){var e=new t;return e._aborted=!0,e},t.signalAbort=function(e){"_aborted"in e&&!e._aborted&&(e._aborted=!0,e.emit("abort",null))},Object.defineProperty(t.prototype,"aborted",{get:function(){return this._aborted},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.addEventListener=function(e,t){this.addListener(e,t)},t.prototype.removeEventListener=function(e,t){this.removeListener(e,t)},t.prototype.dispatchEvent=function(){},t}(e("@spotify-internal/emitter/es5").EventEmitter);r.AbortSignalMicrofill=i;var o=function(){function e(){this.signal=new i}return e.prototype.abort=function(){var e=this.signal;i.signalAbort(e)},e}();function a(){return"undefined"!=typeof window&&"function"==typeof window.AbortController}r.AbortControllerMicrofill=o,r.hasNativeAbortController=a,r.createAbortControllerLike=a()?function(){return new AbortController}:function(){return new o},r.raceSignals=function(e){for(var t=r.createAbortControllerLike(),i=n.__spreadArray([],e),o=function e(){for(var r=0,n=i;r<n.length;r++){n[r].removeEventListener("abort",e)}t.abort()},a=0,s=n.__spreadArray([],e);a<s.length;a++){s[a].addEventListener("abort",o)}return t.signal}},{"@spotify-internal/emitter/es5":98,tslib:192}],174:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FetchHeaders=void 0;var n=function(){function e(e){this.get=e.get.bind(e),this.has=e.has.bind(e)}return e.prototype.get=function(e){return null},e.prototype.has=function(e){return!1},e}();r.FetchHeaders=n},{}],175:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.request=r.isSupported=void 0;var n=e("@js-sdk/debug-tools/es5"),i=e("../../enums/allows_payload"),o=e("../../enums/status_code"),a=e("../../error/request"),s=e("./headers"),u=e("../response"),l=n.logging.forTag("transport.http.fetch"),c={json:!0,text:!0,arraybuffer:!0,blob:!0};function d(){return"function"==typeof fetch}r.isSupported=d,r.request=function(e){if(!d())return Promise.reject(new TypeError("Fetch is not supported"));var t=e.options.signal;if(null==t?void 0:t.aborted)return Promise.reject(new a.RequestAbortedError);if(!e.url)return Promise.reject(new TypeError("Request URL cannot be blank."));var r=e.method||"GET",n=e.url,_=null;if(r in i.AllowsPayload&&e.payload?_=e.payload:e.payload&&(n+="?"+e.payload),e.options.responseType&&!(e.options.responseType in c))return Promise.reject(new TypeError("Cannot set responseType: not supported in browser."));var p={mode:e.options.mode||"cors",credentials:e.options.credentials||"same-origin",redirect:e.options.redirect||"follow",signal:t,method:r};e.headers.count()&&(p.headers=e.headers.toJSON()),_&&(p.body=_);var f=Date.now();return fetch(n,p).then((function(t){var r;r=e.options.ignoreResponseBody||t.status===o.StatusCode.NO_CONTENT?null:"json"===e.options.responseType?t.json().catch((function(e){return l.warn("Could not parse response as JSON:",e),null})):"arraybuffer"===e.options.responseType?t.arrayBuffer():"blob"===e.options.responseType?t.blob():t.text();var n=e.options.parseResponseHeaders||t.status>299?new s.FetchHeaders(t.headers):null;return Promise.all([t.url,t.status,n,r])})).then((function(t){var r=t[0],n=t[1],i=t[2],o=t[3],a=new u.HTTPResponse(r,n);if(a.body=o,a.headers=i,e.options.timing){var s=Date.now()-f;a.timing={completed:s}}return a})).catch((function(t){if("AbortError"===(null==t?void 0:t.name))throw new a.RequestAbortedError;var r=new u.HTTPResponse(n);if(e.options.timing){var i=Date.now()-f;r.timing={completed:i}}return r})).then((function(t){return e.options.connectionObserver&&(t.offline=!e.options.connectionObserver.isOnline()),t}))}},{"../../enums/allows_payload":161,"../../enums/status_code":168,"../../error/request":170,"../response":178,"./headers":174,"@js-sdk/debug-tools/es5":17}],176:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HTTPRequest=void 0;var n=e("./request_headers"),i=function(){function e(e,t){this.url=e,this.method=(null==t?void 0:t.method)||"GET",this.headers=new n.HTTPRequestHeaders(null==t?void 0:t.headers),this.options=(null==t?void 0:t.options)||{},this.payload=null==t?void 0:t.payload,this.urlExpanded=(null==t?void 0:t.urlExpanded)||!1,this.retryOptions=(null==t?void 0:t.retryOptions)||{}}return e.create=function(t,r){return new e(t,r)},e.prototype.clone=function(){var t=new e(this.url);return t.method=this.method,t.headers=new n.HTTPRequestHeaders(this.headers.toJSON()),t.options=this.options,t.payload=this.payload,t.urlExpanded=this.urlExpanded,t.retryOptions=this.retryOptions,t},e}();r.HTTPRequest=i},{"./request_headers":177}],177:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HTTPRequestHeaders=void 0;var n=e("tslib"),i=function(){function e(e){this._headers={},this._count=0,this._setAll(e)}return e.prototype._setAll=function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&e[r]&&(this._headers[r.toLowerCase()]=e[r],t++);this._count=t},e.prototype.get=function(e){return this._headers[e.toLowerCase()]||null},e.prototype.has=function(e){return!!this._headers[e.toLowerCase()]},e.prototype.set=function(e,t){this._headers[e.toLowerCase()]=t,this._count++},e.prototype.delete=function(e){var t=e.toLowerCase();this._headers[t]&&this._count--,delete this._headers[e.toLowerCase()]},e.prototype.count=function(){return this._count},e.prototype.toJSON=function(){return n.__assign({},this._headers)},e}();r.HTTPRequestHeaders=i},{tslib:192}],178:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HTTPResponse=void 0;var n=function(){function e(e,t){void 0===t&&(t=0),this.url="",this.status=0,this.headers=null,this.body=null,this.offline=!1,this.timing=null,this.metadata=null,this.retries={count:0},this.url=e,this.status=t,this.ok=t>=200&&t<=299}return e.prototype.getStatusFamily=function(){return 0|this.status/100},e}();r.HTTPResponse=n},{}],179:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.XHRHeaders=void 0;var n=function(){function e(e){this._headers={},this._init(e)}return e.prototype._init=function(e){if(e)for(var t=0,r=e.split("\r\n");t<r.length;t++){var n=r[t],i=n.indexOf(": ");if(i>0){var o=n.substring(0,i).toLowerCase(),a=n.substring(i+2);this._headers[o]=a}}},e.prototype.get=function(e){return this._headers[e.toLowerCase()]||null},e.prototype.has=function(e){return this._headers.hasOwnProperty(e.toLowerCase())},e}();r.XHRHeaders=n},{}],180:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.request=void 0;var n=e("@js-sdk/debug-tools/es5"),i=e("../../enums/allows_payload"),o=e("../../enums/errors"),a=e("../../enums/status_code"),s=e("../../error/request"),u=e("../response"),l=e("./headers"),c=n.logging.forTag("transport.http.xhr"),d=function(){},_={json:!0,text:!0,document:!0};function p(){this.onabort=d,this.onerror=d,this.onload=d,this.onloadend=d}function f(e,t,r){var n,i;if(!(null===(n=e.options.signal)||void 0===n?void 0:n.aborted)){var o=Date.now(),s=this.status,d=new u.HTTPResponse(this.responseURL||e.url,s);d.body=null;var _=e.options;if(_.timing&&(d.timing={completed:o-t}),(null===(i=_.connectionObserver)||void 0===i?void 0:i.isOnline)&&(d.offline=!_.connectionObserver.isOnline()),(_.parseResponseHeaders||s>299)&&(d.headers=new l.XHRHeaders(this.getAllResponseHeaders())),!_.ignoreResponseBody&&s!==a.StatusCode.NO_CONTENT){var p=_.responseType||"";if(!_.forcePolyfill&&"response"in this&&p===this.responseType)d.body=this.response;else if("document"===p)d.body=this.responseXML;else if("json"===p)try{d.body=JSON.parse(this.responseText)}catch(e){c.warn("Could not parse response as JSON:",e),d.body=null}else"text"!==p&&""!==p||(d.body=this.responseText)}r(d)}}function h(e,t,r){4===this.readyState?t(new u.HTTPResponse(this.responseURL||e,this.status)):r(new s.RequestError(o.TransportErrors.HTTP_REQUEST_FAILED,"Request cannot be completed.",this.status))}function y(e){var t=e.options.signal;return new Promise((function(r,n){if(null==t?void 0:t.aborted)n(new s.RequestAbortedError);else{var o=new XMLHttpRequest,a=e.url;if(a){var u=null,l=e.method||"GET",c=e.payload||"";l in i.AllowsPayload&&c?u=c:c&&(a+="?"+c),o.open(l,a,!0),o.onerror=h.bind(o,a,r,n),o.onabort=p,o.onloadend=p,o.onprogress=d;var y=e.options;"include"===y.credentials&&(o.withCredentials=!0);var v=y.responseType;if(v)if(y.forcePolyfill){if(!(v in _))return void n(new TypeError('Cannot polyfill responseType "'+v+'"'))}else{if(!("responseType"in o)&&!(v in _))return void n(new TypeError("Cannot set responseType: not supported in browser."));try{o.responseType=v}catch(e){return void n(new TypeError('Unknown responseType "'+v+'".'))}if(o&&v!==o.responseType&&!(v in _))return void n(new TypeError('Unknown responseType "'+v+'".'))}var E=e.headers.count()?e.headers.toJSON():null;if(E)for(var m in E)if(E.hasOwnProperty(m)&&E[m])try{o.setRequestHeader(m,E[m])}catch(e){return void n(e)}t&&t.addEventListener("abort",(function e(){t.removeEventListener("abort",e),o.abort(),n(new s.RequestAbortedError)})),o.onload=f.bind(o,e,Date.now(),r);try{o.send(u)}catch(e){return void n(e)}}else n(new TypeError("Request URL cannot be blank."))}}))}r.request=function(e){return y(e)}},{"../../enums/allows_payload":161,"../../enums/errors":163,"../../enums/status_code":168,"../../error/request":170,"../response":178,"./headers":179,"@js-sdk/debug-tools/es5":17}],181:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createTransport=r.createBaseTransport=r.DEALER_PLUGIN_NAME=r.createXResolveProvider=r.createAbortControllerLike=r.ConnectionObserver=r.DisconnectionReason=r.PluginEvent=r.Method=r.TransportEvent=r.TransportErrors=void 0;var n=e("tslib"),i=e("./enums/errors");Object.defineProperty(r,"TransportErrors",{enumerable:!0,get:function(){return i.TransportErrors}});var o=e("./enums/event");Object.defineProperty(r,"TransportEvent",{enumerable:!0,get:function(){return o.Event}});var a=e("./enums/method");Object.defineProperty(r,"Method",{enumerable:!0,get:function(){return a.Method}});var s=e("./enums/plugin_event");Object.defineProperty(r,"PluginEvent",{enumerable:!0,get:function(){return s.PluginEvent}});var u=e("./enums/disconnection_reason");Object.defineProperty(r,"DisconnectionReason",{enumerable:!0,get:function(){return u.DisconnectionReason}});var l=e("./_internal/connection_observer");Object.defineProperty(r,"ConnectionObserver",{enumerable:!0,get:function(){return l.ConnectionObserver}});var c=e("./helpers/abortcontroller");Object.defineProperty(r,"createAbortControllerLike",{enumerable:!0,get:function(){return c.createAbortControllerLike}});var d=e("./plugins/dealer"),_=e("./http/fetch"),p=e("./transport"),f=e("./http/xhr"),h=(e("./http/response"),e("./http/request"),e("./_internal/public_transport"),e("./providers/endpoints/xresolve"));Object.defineProperty(r,"createXResolveProvider",{enumerable:!0,get:function(){return h.createProvider}});var y=e("./plugins/dealer");function v(e){var t=n.__assign({},e);return t.XHR||(t.XHR=f),t.Fetch=_,p.Transport.create(t)}Object.defineProperty(r,"DEALER_PLUGIN_NAME",{enumerable:!0,get:function(){return y.DEALER_PLUGIN_NAME}}),r.createBaseTransport=v,r.createTransport=function(e){var t=v(e);return t.addPlugin(d.dealerCreator,{WebSocket:WebSocket}),t}},{"./_internal/connection_observer":158,"./_internal/public_transport":160,"./enums/disconnection_reason":162,"./enums/errors":163,"./enums/event":164,"./enums/method":166,"./enums/plugin_event":167,"./helpers/abortcontroller":173,"./http/fetch":175,"./http/request":176,"./http/response":178,"./http/xhr":180,"./plugins/dealer":185,"./providers/endpoints/xresolve":188,"./transport":190,tslib:192}],182:[function(e,t,r){(function(t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Dealer=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/promise_resolver"),a=e("./typedefs"),s=e("../../enums/internal_socket_code"),u=e("./error"),l=e("./event"),c=function(){},d=/hm:\/\/pusher\/(?:[^]+)?\/connections\/([^]+)/,_="undefined"!=typeof window,p=function(e){function r(t){var r=e.call(this)||this;return r._socket=null,r._lastPingDeferred=null,r._waitingForConnectionId=!0,r._connectionId=null,r._connectionURI=null,r._heartbeatToken=0,r._heartbeatTimeoutToken=0,r._connected=!1,r._endpoint=null,r._WebSocket=t.WebSocket||WebSocket,r._heartbeatTimeout=t.heartbeatTimeout||1e4,r}return n.__extends(r,e),r.create=function(e){return new r(e)},r.prototype._startHeartbeat=function(e){var t=this,r=function(){t.ping().then((function(){return t._onHeartbeatSuccess()}),(function(){return t._onHeartbeatError()})),t._heartbeatTimeoutToken=setTimeout((function(){return t._onHeartbeatError()}),t._heartbeatTimeout)};e?r():this._heartbeatToken=setTimeout((function(){return r()}),3e4)},r.prototype._onHeartbeatError=function(){this._stopHeartbeat(),this._socket&&this._socket.close(s.InternalSocketCode.TIMEOUT,"internal-timeout")},r.prototype._onHeartbeatSuccess=function(){this._stopHeartbeat(),this._startHeartbeat()},r.prototype._stopHeartbeat=function(){null!==this._heartbeatToken&&clearTimeout(this._heartbeatToken),null!==this._heartbeatTimeoutToken&&clearTimeout(this._heartbeatTimeoutToken)},r.prototype._prepareConnectionId=function(e){var t;if(!e.uri)return!1;var r,n=(null!==(t=e.uri.match(d))&&void 0!==t?t:[])[1];return!!n&&(r=e.headers&&e.headers["Spotify-Connection-Id"]?e.headers["Spotify-Connection-Id"]:decodeURIComponent(n),this._connectionId=r,this._connectionURI=e.uri,this.emit(l.DealerEvent.CONNECTION_ID,{id:r,uri:e.uri}),!0)},r.prototype._reply=function(e,t){if(!e)throw new TypeError("Invalid key.");var r=this._socket;if(r&&1===r.readyState){var n={type:"reply",key:e,payload:t};r.send(JSON.stringify(n))}},r.prototype._parseMessage=function(e){var t;try{t=JSON.parse(e)}catch(e){return}if("message"===t.type)this._waitingForConnectionId&&this._prepareConnectionId(t)?(this._waitingForConnectionId=!1,this._startHeartbeat(!0)):this.emit(l.DealerEvent.MESSAGE,{message:t});else if("pong"===t.type&&this._lastPingDeferred)this._lastPingDeferred.resolve(!0),this._lastPingDeferred=null;else if("request"===t.type){var r=t.key;r&&this.emit(l.DealerEvent.REQUEST,{request:t,reply:this._reply.bind(this,r)})}},r.prototype._handleOpen=function(e){e.resolve(!0),this._connected=!0,this.emit(l.DealerEvent.AUTHENTICATED,null)},r.prototype._handleMessage=function(e){var r=this,n=e.data;if(_&&window.Blob&&n instanceof window.Blob){var i=new FileReader;i.onloadend=function(){if(this.result){var e;if(this.result instanceof ArrayBuffer){e="";for(var t=new Uint8Array(this.result),n=0;n<t.length;n++)e+=String.fromCharCode(t[n])}else e=this.result;r._parseMessage(e)}},i.readAsText(n)}else void 0!==t&&"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer?this._parseMessage(new t(n).toString("ascii")):this._parseMessage(n)},r.prototype._handleClose=function(e){var t=this._connected;if(this._connected=!1,t)this.emitSync(l.DealerEvent.DISCONNECTED,{wsCode:e.code,reason:e.reason});else{var r=new u.DealerError(a.DealerErrors.DEALER_AUTHENTICATION_FAILED,"Dealer connection error",e);this.emit(l.DealerEvent.AUTHENTICATION_FAILED,{error:r})}},r.prototype._handleError=function(e){var t=new u.DealerError(a.DealerErrors.DEALER_CONNECTION_ERROR,"Cannot connect to dealer");e.reject(t),this._connected=!1,this.emit(l.DealerEvent.ERROR,{error:t})},r.prototype.connect=function(e){return this._endpoint=e,this._waitingForConnectionId=!0,this.emit(l.DealerEvent.CONNECTED,null),Promise.resolve(!0)},r.prototype.authenticate=function(e){var t=o.createPromiseResolver(),r=this._endpoint+"?access_token="+e,n=this._socket=new this._WebSocket(r);return n.onopen=this._handleOpen.bind(this,t),n.onclose=this._handleClose.bind(this),n.onerror=this._handleError.bind(this,t),n.onmessage=this._handleMessage.bind(this),t.promise},r.prototype.disconnect=function(){this._socket&&(this._stopHeartbeat(),this._waitingForConnectionId=!0,this._connected=!1,this._socket.close(s.InternalSocketCode.CLOSE,"internal-close"),this._socket.onopen=c,this._socket.onerror=c,this._socket.onmessage=c,this._socket.onclose=c,this._socket=null,this.emitSync(l.DealerEvent.DISCONNECTED,{wsCode:s.InternalSocketCode.CLOSE,reason:"internal-close"}))},r.prototype.ping=function(){return this._socket&&1===this._socket.readyState?(this._lastPingDeferred=o.createPromiseResolver(),this._socket.send('{"type":"ping"}'),this._lastPingDeferred.promise):Promise.reject(new u.DealerError(a.DealerErrors.DEALER_CONNECTION_ERROR,"Dealer connection error"))},r.prototype.getConnectionId=function(){var e=this;return this._waitingForConnectionId?new Promise((function(t){e.once(l.DealerEvent.CONNECTION_ID,(function(e){t(e.data.id)}))})):Promise.resolve(this._connectionId)},r.prototype.getConnectionInfo=function(){var e=this;return this._waitingForConnectionId?new Promise((function(t){e.once(l.DealerEvent.CONNECTION_ID,(function(e){t({id:e.data.id,uri:e.data.uri})}))})):Promise.resolve({id:this._connectionId,uri:this._connectionURI})},r.prototype.hasConnectionId=function(){return!this._waitingForConnectionId&&!!this._connectionId},r}(i.EventEmitter);r.Dealer=p}).call(this)}).call(this,e("buffer").Buffer)},{"../../enums/internal_socket_code":165,"./error":183,"./event":184,"./typedefs":186,"@js-sdk/common/es5/promise_resolver":191,"@spotify-internal/emitter/es5":98,buffer:194,tslib:192}],183:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DealerError=void 0;var n=e("tslib"),i=e("./typedefs"),o=function(e){function t(t,r,n){void 0===t&&(t=i.DealerErrors.DEALER_ERROR),void 0===n&&(n={});var o=e.call(this,r)||this;return o.name="DealerError",o.message=r,o.code=t,o.raw=n,o.wsCode=n.code||null,o.wsReason=n.reason||null,o}return n.__extends(t,e),t}(Error);r.DealerError=o},{"./typedefs":186,tslib:192}],184:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DealerEvent=void 0,function(e){e.AUTHENTICATED="authenticated",e.AUTHENTICATION_FAILED="authentication_failed",e.CONNECTED="connected",e.CONNECTION_ID="connection_id",e.ERROR="error",e.DISCONNECTED="disconnected",e.MESSAGE="message",e.REQUEST="request"}(r.DealerEvent||(r.DealerEvent={}))},{}],185:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.dealerCreator=r.DealerErrors=r.DEALER_PLUGIN_NAME=void 0;var n=e("tslib"),i=e("./typedefs");Object.defineProperty(r,"DealerErrors",{enumerable:!0,get:function(){return i.DealerErrors}});var o=e("../../enums/plugin_event"),a=e("./error"),s=e("./event"),u=e("./dealer");r.DEALER_PLUGIN_NAME="dealer";var l=function(){function e(e){var t=this;this.name=r.DEALER_PLUGIN_NAME,this._dealer=new u.Dealer(e),this.api={hasConnectionInfo:function(){return t._dealer.hasConnectionId()},getConnectionInfo:function(){return t._dealer.getConnectionInfo().then((function(e){return n.__assign({plugin:t.name},e)}))}},this._onDealerConnectionId=this._onDealerConnectionId.bind(this),this._onDealerDisconnected=this._onDealerDisconnected.bind(this),this._onDealerMessage=this._onDealerMessage.bind(this),this._onDealerRequest=this._onDealerRequest.bind(this),this._onTransportConnect=this._onTransportConnect.bind(this),this._onTransportAuthenticate=this._onTransportAuthenticate.bind(this),this._onTransportDisconnect=this._onTransportDisconnect.bind(this)}return e.prototype._onDealerConnectionId=function(e){this._mediator&&this._mediator.emit(o.PluginEvent.PLUGIN_CONNECTION_INFO,n.__assign({plugin:this.name},e.data))},e.prototype._onDealerDisconnected=function(e){if(this._mediator){var t=e.data;this._mediator.emit(o.PluginEvent.PLUGIN_DISCONNECTED,{plugin:this.name,code:t.wsCode,reason:t.reason})}},e.prototype._onDealerMessage=function(e){this._mediator&&this._mediator.emit(o.PluginEvent.PLUGIN_MESSAGE,n.__assign({plugin:this.name},e.data))},e.prototype._onDealerRequest=function(e){this._mediator&&this._mediator.emit(o.PluginEvent.PLUGIN_REQUEST,n.__assign({plugin:this.name},e.data))},e.prototype._onTransportConnect=function(e){var t=e.data.endpoints,r=e.data.awaitPromise;t.dealer?/^wss:/.test(t.dealer)?r(this._dealer.connect(t.dealer)):r(Promise.reject(new a.DealerError(i.DealerErrors.INVALID_ENDPOINT,"Dealer endpoint needs to be wss://"))):r(Promise.reject(new a.DealerError(i.DealerErrors.ENDPOINT_NOT_DEFINED,'No "dealer" endpoint defined.')))},e.prototype._onTransportAuthenticate=function(e){var t=e.data;t.awaitPromise(this._dealer.authenticate(t.token))},e.prototype._onTransportDisconnect=function(){this._dealer.disconnect()},e.prototype._onDealerError=function(e){var t;null===(t=this._mediator)||void 0===t||t.emit(o.PluginEvent.PLUGIN_ERROR,{plugin:this.name,error:e.data.error})},e.prototype.attach=function(e,t){var r,n;this._mediator=t,t.addListeners(((r={})[o.PluginEvent.TRANSPORT_CONNECT]=this._onTransportConnect,r[o.PluginEvent.TRANSPORT_AUTHENTICATE]=this._onTransportAuthenticate,r[o.PluginEvent.TRANSPORT_DISCONNECT]=this._onTransportDisconnect,r)),this._dealer.addListeners(((n={})[s.DealerEvent.DISCONNECTED]=this._onDealerDisconnected,n[s.DealerEvent.CONNECTION_ID]=this._onDealerConnectionId,n[s.DealerEvent.MESSAGE]=this._onDealerMessage,n[s.DealerEvent.REQUEST]=this._onDealerRequest,n[s.DealerEvent.ERROR]=this._onDealerError,n))},e.prototype.detach=function(e,t){var r,n;this._mediator=void 0,t.removeListeners(((r={})[o.PluginEvent.TRANSPORT_CONNECT]=this._onTransportConnect,r[o.PluginEvent.TRANSPORT_AUTHENTICATE]=this._onTransportAuthenticate,r[o.PluginEvent.TRANSPORT_DISCONNECT]=this._onTransportDisconnect,r)),this._dealer.removeListeners(((n={})[s.DealerEvent.DISCONNECTED]=this._onDealerDisconnected,n[s.DealerEvent.CONNECTION_ID]=this._onDealerConnectionId,n[s.DealerEvent.MESSAGE]=this._onDealerMessage,n[s.DealerEvent.REQUEST]=this._onDealerRequest,n[s.DealerEvent.ERROR]=this._onDealerError,n))},e}();r.dealerCreator=function(e,t){return new l(t)}},{"../../enums/plugin_event":167,"./dealer":182,"./error":183,"./event":184,"./typedefs":186,tslib:192}],186:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DealerErrors=void 0,function(e){e.DEALER_CONNECTION_ERROR="DEALER_CONNECTION_ERROR",e.DEALER_AUTHENTICATION_FAILED="DEALER_AUTHENTICATION_FAILED",e.DEALER_ERROR="DEALER_ERROR",e.ENDPOINT_NOT_DEFINED="ENDPOINT_NOT_DEFINED",e.INVALID_ENDPOINT="INVALID_ENDPOINT"}(r.DealerErrors||(r.DealerErrors={}))},{}],187:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProductStateObserver=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("./enums/status_code"),a=e("./enums/event"),s=function(e){function t(t){var r=e.call(this)||this;return r._currentState=null,r._transport=t.transport,r._endpoint=t.endpoint||"@webgate/melody",r._handleUserUpdate=r._handleUserUpdate.bind(r),r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){this.register()},t.prototype._handleUserUpdate=function(){var e=this;clearTimeout(this._debounce),this._debounce=setTimeout((function(){e._transport.forceTokenRefresh().catch((function(){})),e.getCurrentState(!0).then((function(t){e.emit(a.Event.PRODUCT_STATE_CHANGED,{productState:t})}))}),300)},t.prototype._shouldRetry=function(e,t){var r=e.getStatusFamily();return r===t.SERVER_ERROR||r===t.CONNECTION_ERROR},t.prototype.getCurrentState=function(e){var t=this;return!e&&this._currentState?Promise.resolve(this._currentState):this._transport.request(this._endpoint+"/v1/product_state",{method:"GET",responseType:"json",retry:{condition:this._shouldRetry}}).then((function(e){if(e.status!==o.StatusCode.OK||!e.body)throw t._currentState=null,new Error("Cannot get the user's product state.");return t._currentState=e.body,e.body}))},t.prototype.register=function(){return this._transport.matchMessages("spotify:user:attributes:mutated",this._handleUserUpdate),Promise.resolve(!0)},t.prototype.deregister=function(){return this._transport.unmatchMessages("spotify:user:attributes:mutated",this._handleUserUpdate),Promise.resolve(!0)},t}(i.EventEmitter);r.ProductStateObserver=s},{"./enums/event":164,"./enums/status_code":168,"@spotify-internal/emitter/es5":98,tslib:192}],188:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createProvider=void 0;var n=e("../../enums/errors"),i=e("../../error/xresolve"),o="dealer",a="spclient",s={spclient:"spclient.wg.spotify.com",exp:"exp.wg.spotify.com",partners:"partners.wg.spotify.com"};r.createProvider=function(e){void 0===e&&(e={});var t=e.dealer||o,r=e.webgate||a,u="https://apresolve.spotify.com/?type="+t+"&type="+r;return function(e){return e.request(u,{forcePolyfill:!0,responseType:"json",retry:{maxRetries:3,curve:"exponential",condition:function(e,t){return e.getStatusFamily()!==t.SUCCESS}},metadata:{noRequestTransform:!0}}).then((function(e){var o,a,u,l,c,d=e.body,_={dealer:null!==(a=null===(o=null==d?void 0:d[t])||void 0===o?void 0:o[0])&&void 0!==a?a:"dealer.spotify.com",webgate:null!==(c=null!==(l=null===(u=null==d?void 0:d[r])||void 0===u?void 0:u[0])&&void 0!==l?l:s[r])&&void 0!==c?c:s.spclient,webapi:"https://api.spotify.com/"};if(!_.dealer||!_.webgate)throw new i.XResolveError(n.TransportErrors.XRESOLVE_INCOMPLETE_RESPONSE,"X-Resolve responded with incomplete results.",e.status);return _})).then((function(e){return e.dealer="wss://"+e.dealer.replace(/:443$/,""),e.webgate="https://"+e.webgate.replace(/:443$/,""),e}))}}},{"../../enums/errors":163,"../../error/xresolve":172}],189:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerTime=void 0;var n=e("@js-sdk/debug-tools/es5"),i=e("./enums/status_code"),o=n.logging.forTag("transport.server_time"),a=function(){function e(e){this._serverTime=0,this._serverTimeFetchedAt=0,this._transport=e}return e.create=function(t){return new e(t)},e.prototype._parseServiceResponse=function(e,t){var r=Date.now(),n=t.status;return n===i.StatusCode.OK?this._serverTime=parseInt(t.body.timestamp,10)+Math.round((r-e)/2):(o.error("Cannot fetch server time. Service responded with "+n),this._serverTime=r),this._serverTimeFetchedAt=r,this._serverTime},e.prototype.get=function(){var e=Date.now();return this._transport.request("@webgate/melody/v1/time",{responseType:"json"}).then(this._parseServiceResponse.bind(this,e))},e.prototype.getApproximate=function(){if(!this._serverTime)return this.get(),Date.now();var e=Date.now()-this._serverTimeFetchedAt;return e>18e4&&this.get(),this._serverTime+e},e}();r.ServerTime=a},{"./enums/status_code":168,"@js-sdk/debug-tools/es5":17}],190:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Transport=void 0;var n=e("tslib"),i=e("@js-sdk/backoff/es5"),o=e("@js-sdk/backoff/es5/counter"),a=e("@js-sdk/debug-tools/es5"),s=e("@spotify-internal/emitter/es5"),u=e("./enums/errors"),l=e("./enums/event"),c=e("./enums/plugin_event"),d=e("./enums/internal_socket_code"),_=e("./enums/status_code"),p=e("./enums/status_family"),f=e("./enums/disconnection_reason"),h=e("./error/transport"),y=e("./error/request"),v=e("./_internal/connection_observer"),E=e("./http/response"),m=e("./http/request"),g=e("./_internal/public_transport"),T=e("./_internal/operation_metrics_tracker"),S=e("./helpers/abortcontroller"),P=a.logging.forTag("transport.transport"),b=/^(?:https?:\/\/)?@([^\/]+)\//,R=/^(ws|http)s?:\/\/.*[^\/]$/,A=/^([a-zA-Z]{3},\ \d{1,2}\ [a-zA-Z]{3}\ (\d{1,2}.){3})/,I={xhr:!0,fetch:!0},L=1,O=4;function C(e,t){var r="access_token="+encodeURIComponent(t),n=e.split("?"),i=n[0],o=n[1];if(!o)return i+"?"+r;var a=o.replace(/access_token=[^&]*(&|$)/,r+"$1");return a!==o?i+"?"+a:i+"?"+r+"&"+o}var D=function(e){function t(t){var r=e.call(this)||this;if(r._plugins={},r._pluginMediator=new s.EventEmitter,r._connectCalled=!1,r._authenticateCalled=!1,r._endpoints=null,r._lastToken=null,r._lastTokenExpiry=0,r._refreshTokenPromise=null,r._authenticationPromise=null,r._reconnectTimeout=0,r._isReconnecting=!1,r._initTime=0,r._lastDisconnect=0,r._stateMask=0,r._quickDisconnectCount=0,r._counter=new o.Counter({curve:"exponential",baseTime:5e3,ceiling:15e3}),r._stateAwareListeners={connected:[],authenticated:[],connection_id:[],transport_connect:[],transport_authenticate:[]},r._stateAwareOperationMetrics={authenticated:null},r._stateAwareRunners={connected:null,authenticated:null,connection_id:null,transport_connect:null,transport_authenticate:null},!t)throw new TypeError("Argument `options` for Transport cannot be null.");if(!t.providers)throw new TypeError("Argument `options.providers` for Transport cannot be null.");r._ownerRef="ownerRef"in t?Object(t.ownerRef):{},r._tokenProvider=t.providers.token,r._endpointsProvider=t.providers.endpoints,r._XHR=t.XHR,r._Fetch=t.Fetch,r._reconnectionRetries=t.reconnectionRetries>=0?t.reconnectionRetries:3,r._requestMode=t.requestMode in I?t.requestMode:"xhr",r._forcePolyfillTypes=t.forcePolyfillTypes||{},r._disableAutoLogout="disableAutoLogout"in t&&!!t.disableAutoLogout,r._disconnectBeforeUnload=t.disconnectBeforeUnload||!1;var n=t.createConnectionObserver||v.BrowserConnectionObserver.create;return r._connectionObserver=n({notifyBeforeUnload:r._disconnectBeforeUnload}),r.authenticate=r.authenticate.bind(r),r._authenticateWithToken=r._authenticateWithToken.bind(r),r._connectToEndpoints=r._connectToEndpoints.bind(r),r._parseProvidedToken=r._parseProvidedToken.bind(r),r._onConnected=r._onConnected.bind(r),r._onAuthenticated=r._onAuthenticated.bind(r),r._onAuthenticationFailed=r._onAuthenticationFailed.bind(r),r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e,t=this;this.onAddListener(l.Event.CONNECTED,this._onAddListener.bind(this,"connected")),this.onAddListener(l.Event.AUTHENTICATED,this._onAddListener.bind(this,"authenticated")),this.onAddListener(l.Event.CONNECTION_ID,this._onAddListener.bind(this,"connection_id")),this.onRemoveListener(l.Event.CONNECTED,this._onRemoveListener.bind(this,"connected")),this.onRemoveListener(l.Event.AUTHENTICATED,this._onRemoveListener.bind(this,"authenticated")),this.onRemoveListener(l.Event.CONNECTION_ID,this._onRemoveListener.bind(this,"connection_id")),this._pluginMediator.onAddListener(c.PluginEvent.TRANSPORT_CONNECT,this._onAddListener.bind(this,"transport_connect")),this._pluginMediator.onAddListener(c.PluginEvent.TRANSPORT_AUTHENTICATE,this._onAddListener.bind(this,"transport_authenticate")),this._pluginMediator.onRemoveListener(c.PluginEvent.TRANSPORT_CONNECT,this._onRemoveListener.bind(this,"transport_connect")),this._pluginMediator.onRemoveListener(c.PluginEvent.TRANSPORT_AUTHENTICATE,this._onRemoveListener.bind(this,"transport_authenticate")),"fetch"!==this._requestMode||this._Fetch&&this._Fetch.isSupported()||(P.warn('Default "fetch" request mode unavailable; Fallback to "xhr"'),this._requestMode="xhr");var r=this._pluginMediator;r.addListeners(((e={})[c.PluginEvent.PLUGIN_DISCONNECTED]=this._onPluginDisconnected.bind(this),e)),this.proxyEmit(r,c.PluginEvent.PLUGIN_CONNECTION_INFO,l.Event.CONNECTION_ID),this._disableAutoLogout||this.matchMessages("client:logout",(function(){return t._onLogout()})),this._connectionObserver.on(l.Event.CONNECTION_ONLINE,(function(){return t._onOnline()})),this._connectionObserver.on(l.Event.CONNECTION_OFFLINE,(function(){return t._onOffline()})),this._connectionObserver.on(l.Event.WINDOW_BEFORE_UNLOAD,(function(){return t._disconnect(f.DisconnectionReason.WINDOW_BEFORE_UNLOAD)}))},t.prototype._runStateAwareQueues=function(e,t){for(var r=0,n=this._stateAwareListeners[e].splice(0);r<n.length;r++){n[r].call(this,t)}this._stateAwareRunners[e]=null},t.prototype._connect=function(){var e=this;return this._stateMask&L?Promise.resolve(!1):this._connectionObserver.isOnline()?this._performConnect():new Promise((function(t,r){P.info("Waiting to go online before connecting"),e._connectionObserver.once(l.Event.CONNECTION_ONLINE,(function(){e._performConnect().then(t,r)}))}))},t.prototype._performConnect=function(){var e=this;return new Promise((function(t){P.info("Resolving endpoints"),t(e._endpointsProvider(e.toPublic()))})).catch((function(e){var t=(null==e?void 0:e.code)?e:new h.TransportError(u.TransportErrors.TRANSPORT_ENDPOINTS_PROVIDER_ERROR,(null==e?void 0:e.message)||"Endpoints provider error",null!=e?e:null);return P.error("Endpoints resolution failed",t),Promise.reject(t)})).then(this._connectToEndpoints).then(this._onConnected).catch((function(t){var r=t&&t.error?t.error:t;return e.emit(l.Event.CONNECTION_FAILED,{error:r}),P.error("Connection failed",r),Promise.reject(r)}))},t.prototype._connectToEndpoints=function(e){var t=this,r={webgate:"",webapi:""};for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];o&&(R.test(o)&&(o+="/"),r[i]=o)}this._endpoints=r,this.emit(l.Event.ENDPOINTS_RESOLVED,{endpoints:n.__assign({},r)}),P.info("Endpoints resolved");var a=[],s=function(e){a.push(e)};return P.info("Waiting for plugins to connect"),new Promise((function(e,i){t._pluginMediator.emitAndWait(c.PluginEvent.TRANSPORT_CONNECT,{endpoints:n.__assign({},r),awaitPromise:s},(function(){Promise.all(a).then((function(){return e(!0)}),i)}))}))},t.prototype._refreshToken=function(e){var t=this;if(void 0===e&&(e=!1),this._refreshTokenPromise)return this._refreshTokenPromise;if(!e&&this._lastToken&&this._lastTokenExpiry>Date.now())return Promise.resolve(this._lastToken);this._refreshTokenPromise=new Promise((function(e){P.info("Requesting token from provider"),e(t._tokenProvider())})).then(this._parseProvidedToken);var r=function(){t._refreshTokenPromise=null};return this._refreshTokenPromise.then(r,r),this._refreshTokenPromise.catch((function(e){var r=(null==e?void 0:e.code)?e:new h.TransportError(u.TransportErrors.TRANSPORT_TOKEN_PROVIDER_ERROR,(null==e?void 0:e.message)||"Token provider error",e);return t.emit(l.Event.TOKEN_PROVIDER_ERROR,{error:r}),P.error("Token provider error",r),Promise.reject(r)}))},t.prototype._parseProvidedToken=function(e){var t,r;if(Array.isArray(e)?(t=e[0],r=parseInt(e[1],10),isNaN(r)&&(r=3540)):(t=e,r=3540),!t)throw this._lastToken=null,this._lastTokenExpiry=0,P.error("No token was provided"),new h.TransportError(u.TransportErrors.TRANSPORT_INVALID_TOKEN,'Token provider returned an invalid token, "'+t+'"');if(this._lastToken===t){P.error("TokenProvider returned same token twice.");var n=new h.TransportError(u.TransportErrors.TRANSPORT_STALE_TOKEN,"Token provider returned the same token twice.");throw this._lastToken=null,this._lastTokenExpiry=0,n}return this._lastToken=t,this._lastTokenExpiry=Date.now()+1e3*r,this.emit(l.Event.ACCESS_TOKEN,{token:t}),P.info("Access token set"),t},t.prototype._authenticateWithToken=function(e){var t=this;if(!this._endpoints)return Promise.resolve(!0);var r=[],n=function(e){r.push(e)};return P.info("Waiting for plugins to authenticate"),new Promise((function(i,o){t._pluginMediator.emitAndWait(c.PluginEvent.TRANSPORT_AUTHENTICATE,{token:e,awaitPromise:n},(function(){Promise.all(r).then((function(){return i(!0)}),o)}))}))},t.prototype._authenticate=function(e){var t=this;if(!(this._stateMask&L))return Promise.reject(new h.TransportError(u.TransportErrors.TRANSPORT_INVALID_STATE,"Cannot authenticate disconnected transport."));if(this._authenticationPromise)return this._authenticationPromise;var r=T.OperationMetricsTracker.create();return r.start(),this._authenticationPromise=i.Backoff.init((function(){return P.info("Authenticating"),t._refreshToken(e).then(t._authenticateWithToken)}),{curve:"exponential",maxRetries:2,baseTime:500,retryPredicate:function(e){return P.warn("Retrying authentication due to failure",e),!0}}).then((function(){return t._onAuthenticated(r)})).catch((function(e){return t._onAuthenticationFailed(e,r)})),this._authenticationPromise},t.prototype._performDisconnect=function(e){this._stateMask=0;var t=!e;return e&&(this.emit(l.Event.DISCONNECTED,{reason:e}),P.info("Disconnected")),P.info("Waiting for plugins to disconnect."),this._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_DISCONNECT,{supressed:t}),!0},t.prototype._createReconnector=function(){var e=this,t=!1;return function(){return e._isReconnecting=!0,e.emit(l.Event.RECONNECTING,null),P.info("Reconnecting"),e._performDisconnect(),e._connect().then((function(){return!!e._authenticateCalled&&e._authenticate(t).then((function(e){return t=!1,e}),(function(e){return t=!0,Promise.reject(e)}))})).then((function(){return e._isReconnecting=!1,e.emit(l.Event.RECONNECTED,null),P.info("Reconnected"),!0}))}},t.prototype._tryToReconnect=function(){var e=this;this._isReconnecting?P.warn("Reconnection triggered while already reconnecting"):(this._stateMask=0,i.Backoff.init(this._createReconnector(),{baseTime:1e3,maxTime:15e3,maxRetries:this._reconnectionRetries,retryPredicate:function(e){return P.warn("Retrying reconnection due to failure",e),!0}}).catch((function(){e._stateMask=0,e._isReconnecting=!1,e.emit(l.Event.DISCONNECTED,{reason:f.DisconnectionReason.RECONNECTION_FAILED}),P.info("Disconnected: reconnection failed")})))},t.prototype._sendRequest=function(e,t,r){var n=this;void 0===t&&(t={}),void 0===r&&(r={});var i=t.signal;return(null==i?void 0:i.aborted)?Promise.reject(new y.RequestAbortedError):this._processRequestArgs(e,t).then((function(e){return(null==i?void 0:i.aborted)?Promise.reject(new y.RequestAbortedError):e.options.forget?n._sendFireAndForgetRequest(e):n._sendRetriedRequest(e,r)}))},t.prototype._processRequestArgs=function(e,t){var r,i;if(void 0===t&&(t={}),null===(r=t.signal)||void 0===r?void 0:r.aborted)return Promise.reject(new y.RequestAbortedError);var o=e,a=!1,s=n.__assign(n.__assign({},t),{forcePolyfill:!(!t.responseType||!(t.responseType in this._forcePolyfillTypes)),requestMode:null!==(i=null==t?void 0:t.requestMode)&&void 0!==i?i:this._requestMode,connectionObserver:this._connectionObserver,metadata:(null==t?void 0:t.metadata)||null});if((null==t?void 0:t.signal)&&!S.hasNativeAbortController()&&("fetch"===t.requestMode?P.warn("Request with `{requestMode: fetch}` but no native AbortController."):s.requestMode="xhr"),b.test(o)){a=!0;try{o=this._tryExpandSpecialURL(o)}catch(e){return Promise.reject(e)}"authorize"in s||(s.authorize=!0,s.autoAuthorized=!0)}var u=n.__assign(n.__assign({maxRetries:2,curve:"exponential"},t.retry),{retryPredicate:function(e){return!(e instanceof y.RequestAbortedError)}});return Promise.resolve(m.HTTPRequest.create(o,{method:t.method,headers:t.headers,payload:t.payload,options:s,urlExpanded:a,retryOptions:u}))},t.prototype._tryExpandSpecialURL=function(e){var t=this._endpoints;return e.replace(b,(function(e,r){if(!t.hasOwnProperty(r))throw new TypeError("Cannot replace endpoint @"+r+": endpoint not defined.");return t[r]}))},t.prototype._sendFireAndForgetRequest=function(e){var t,r=e.url,n=e.method,i=e.options;if(null===(t=i.signal)||void 0===t?void 0:t.aborted)return Promise.reject(new y.RequestAbortedError);if("GET"!==n&&"POST"!==n)return Promise.reject(new h.TransportError(u.TransportErrors.TRANSPORT_UNSUPPORTED_OPTION,"Option 'forget' cannot be used for "+n+" request."));if(!i.autoAuthorized&&i.authorize)return Promise.reject(new h.TransportError(u.TransportErrors.TRANSPORT_UNSUPPORTED_OPTION,"Option 'forget' cannot be used for authorized request."));if(i.requestMode="xhr",i.authorize=!1,i.ignoreResponseBody=!0,"GET"===n)if("function"==typeof fetch){var o={mode:"no-cors"};i.signal&&S.hasNativeAbortController()&&(o.signal=i.signal),fetch(r,o).catch((function(){}))}else"function"==typeof Image?(new Image).src=r:this._sendRetriedRequest(e,{}).catch((function(){}));else if("POST"===n)if("undefined"!=typeof navigator&&(null===navigator||void 0===navigator?void 0:navigator.sendBeacon))navigator.sendBeacon(e.url,e.payload);else if("function"==typeof fetch){o={method:"POST",mode:"no-cors",body:e.payload};i.signal&&S.hasNativeAbortController()&&(o.signal=i.signal),fetch(r,o).catch((function(){}))}else this._sendRetriedRequest(e,{}).catch((function(){}));return Promise.resolve(new E.HTTPResponse(r,0))},t.prototype._sendRetriedRequest=function(e,t){var r=this,n=e.retryOptions,o=e.options.signal,a=!1,s=function(){return(null==o?void 0:o.aborted)?Promise.reject(new y.RequestAbortedError):r._setAuthHeader(e,a)},u=this._connectionObserver,d=new i.Backoff((function(){return(u.isOnline()||e.options.allowOffline?s():new Promise((function(e,t){u.once(l.Event.CONNECTION_ONLINE,(function(){s().then(e,t)}))}))).then((function(){if(null==o?void 0:o.aborted)return Promise.reject(new y.RequestAbortedError);var n;if(r._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_BEFORE_SEND_REQUEST,{request:e,context:t}),"fetch"===e.options.requestMode&&r._Fetch&&r._Fetch.isSupported())n=r._Fetch.request(e);else{if(!r._XHR)throw new Error("No available request mechanisms.");n=r._XHR.request(e)}return n})).then((function(t){if(null==o?void 0:o.aborted)return Promise.reject(new y.RequestAbortedError);var r=null;if(t.headers&&(r=t.headers.get("Retry-After")),t.status===_.StatusCode.UNAUTHORIZED&&!e.options.ignoreUnauthorized)return a=!0,Promise.reject(t);if("function"==typeof(null==n?void 0:n.condition)&&(n.condition(t,p.StatusFamily)||r)){if(null!==r)if(A.test(r))t.retryAfter=new Date(r).getTime()-Date.now();else{var i=parseInt(r,10);i>0&&(t.retryAfter=1e3*i)}return Promise.reject(t)}return Promise.resolve(t)}))}),n);return d.start().catch(this._handleRetriedRequestError).then((function(n){return(null==o?void 0:o.aborted)?Promise.reject(new y.RequestAbortedError):(n.metadata=e.options.metadata,n.retries=n.retries||{},n.retries.count=d.getRetryCount(),r._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_BEFORE_RETURN_RESPONSE,{context:t,response:n}),e.options.rejectNotOk&&!n.ok?Promise.reject(n):n)}))},t.prototype._setAuthHeader=function(e,t){var r=this;if(!e.options.authorize)return Promise.resolve(e);var n=function(){return r._refreshToken(t).then((function(t){return e.headers.set("Authorization","Bearer "+t),e}))};return this._stateMask&O?n():new Promise((function(e,t){P.info("Auth header setting awaiting authentication."),r.once(l.Event.AUTHENTICATED,(function(){P.info("Auth header set after authentication."),n().then(e,t)}))}))},t.prototype._handleRetriedRequestError=function(e){return e instanceof E.HTTPResponse?Promise.resolve(e):Promise.reject(e)},t.prototype._onAddListener=function(e,t){var r=this,i=t.data.options;if(!i.ignoreCurrentState){var o;switch(e){case"connected":if(!this.isConnected())return;o=Promise.resolve(this.createEvent(l.Event.CONNECTED,null));break;case"authenticated":if(!this.isAuthenticated())return;var a=this._stateAwareOperationMetrics.authenticated;o=Promise.resolve(this.createEvent(l.Event.AUTHENTICATED,{timing:a}));break;case"connection_id":var s=this.getPluginAPI("dealer");if(!s||!s.hasConnectionInfo())return;o=s.getConnectionInfo().then((function(e){return r.createEvent(l.Event.CONNECTION_ID,e)}));break;case"transport_connect":if(!this.isConnected()||!this._endpoints)return;o=Promise.resolve(this._pluginMediator.createEvent(c.PluginEvent.TRANSPORT_CONNECT,{endpoints:n.__assign({},this._endpoints),awaitPromise:function(e){}}));break;case"transport_authenticate":if(!this.isAuthenticated())return;o=this._refreshToken().then((function(e){return r._pluginMediator.createEvent(c.PluginEvent.TRANSPORT_AUTHENTICATE,{token:e,awaitPromise:function(e){}})}));break;default:return}var u=t.data.listener;this._stateAwareListeners[e].push(u);var d=this._stateAwareRunners;d[e]||(d[e]=o.then(this._runStateAwareQueues.bind(this,e)),i.once&&t.preventDefault())}},t.prototype._onRemoveListener=function(e,t){var r=t.data.options;if(!r.ignoreCurrentState&&!r.once){var n=t.data.listener,i=this._stateAwareListeners[e].indexOf(n);-1!==i&&this._stateAwareListeners[e].splice(i,1)}},t.prototype._getQuickDisconnectTimeout=function(){return this._counter.getTime(this._quickDisconnectCount)},t.prototype._onPluginDisconnected=function(e){var t=Date.now(),r=t-this._lastDisconnect;if(this._performDisconnect(),e.data.code===d.InternalSocketCode.CLOSE)return P.info('Plugin "'+e.data.plugin+'" explicitly disconnected'),void(this._quickDisconnectCount=0);this._connectionObserver.isOnline()&&(P.info('Plugin "'+e.data.plugin+'" unexpectedly disconnect; trying to reconnect'),r<5e3?(this._reconnectTimeout&&clearTimeout(this._reconnectTimeout),this._quickDisconnectCount++,this.emit(l.Event.SHORT_SESSION_DISCONNECTED,{disconnectCount:this._quickDisconnectCount,sessionLength:r}),this._reconnectTimeout=setTimeout(this._tryToReconnect.bind(this),this._getQuickDisconnectTimeout())):(this._quickDisconnectCount=0,this._lastDisconnect=t,this._tryToReconnect()))},t.prototype._onOnline=function(){this.emit(l.Event.CONNECTION_ONLINE,null),P.info("ConnectionObserver online"),this._connectCalled&&this._tryToReconnect()},t.prototype._onOffline=function(){this.emit(l.Event.CONNECTION_OFFLINE,null),P.info("ConnectioObserver offline"),this._performDisconnect()},t.prototype._onConnected=function(){return this._stateMask|=L,this.emit(l.Event.CONNECTED,null),P.info("Connected"),Promise.resolve(!0)},t.prototype._onAuthenticated=function(e){e.end(),clearTimeout(this._reconnectTimeout),this._authenticationPromise=null,this._stateMask|=O,this._initTime=Date.now();var t=e.getMetrics();return this.emit(l.Event.AUTHENTICATED,{timing:t}),this._stateAwareOperationMetrics.authenticated=t,P.info("Authenticated"),Promise.resolve(!0)},t.prototype._onAuthenticationFailed=function(e,t){t.end();var r=e&&e.error?e.error:e;this._authenticationPromise=null,this._stateMask&=~O;var n={error:r,timing:t.getMetrics()};return this.emit(l.Event.AUTHENTICATION_FAILED,n),this._pluginMediator.emit(c.PluginEvent.TRANSPORT_AUTHENTICATE_FAILED,n),P.info("Authentication failed",r),Promise.reject(r)},t.prototype._onLogout=function(){var e=this,t=function(){e._lastToken=null,e._lastTokenExpiry=0,e.emit(l.Event.LOGGED_OUT,null)};this._disconnect(f.DisconnectionReason.LOG_OUT).then(t,t)},t.prototype._disconnect=function(e){var t=this;if(!this._connectCalled)return Promise.resolve(!1);this._connectCalled=!1,this._authenticateCalled=!1;var r=this.isConnected()?l.Event.BEFORE_ONLINE_DISCONNECT:l.Event.BEFORE_OFFLINE_DISCONNECT,n=[];return this.emitSync(r,{awaitPromise:function(e){n.push(e.catch((function(){})))}}),Promise.all(n).then((function(){return t._performDisconnect(e)}))},t.prototype.isConnected=function(){return!!(this._stateMask&L)},t.prototype.isAuthenticated=function(){return!!(this._stateMask&O)},t.prototype.isReconnecting=function(){return this._isReconnecting},t.prototype.isOnline=function(){return this._connectionObserver.isOnline()},t.prototype.connect=function(){return this._connectCalled=!0,this._connect()},t.prototype.authenticate=function(){return this._authenticateCalled=!0,this._authenticate(!0)},t.prototype.disconnect=function(){return this._disconnect(f.DisconnectionReason.EXPLICIT)},t.prototype.forceDisconnect=function(){return this._connectCalled?(this._connectCalled=!1,this._authenticateCalled=!1,this._performDisconnect(f.DisconnectionReason.EXPLICIT),Promise.resolve(!0)):Promise.resolve(!1)},t.prototype.forceTokenRefresh=function(){return this._refreshToken(!0).then((function(){return!0}))},t.prototype.getInitTime=function(){return this._initTime},t.prototype.getEndpoints=function(){return this._endpoints?n.__assign({},this._endpoints):null},t.prototype.getLastToken=function(){return this._lastToken},t.prototype.toPublic=function(e){return new g.PublicTransport(this,e)},t.prototype.hasOwnerRef=function(e){return this._ownerRef===e},t.prototype.appendTokenQuery=function(e){return this._refreshToken().then((function(t){return C(e,t)}))},t.prototype.appendLastTokenQuery=function(e){return this._lastToken?C(e,this._lastToken):e},t.prototype.matchMessages=function(e,t,r){if(!e)throw new TypeError('Message "matcher" cannot be null.');if("function"!=typeof t)throw new TypeError("Message callback cannot be null.");var n=function(n){var i=n.data.message;!i.uri||!i.uri.match(e)||r&&r!==n.data.plugin||t(i)};n.__matchMessagesExp=e,n.__matchMessagesPlugin=r,t.__matchMessagesWrapper=n,this._pluginMediator.on(c.PluginEvent.PLUGIN_MESSAGE,n)},t.prototype.unmatchMessages=function(e,t,r){if("function"!=typeof t)throw new TypeError("Message callback cannot be null.");var n=t.__matchMessagesWrapper;return!(!n||n.__matchMessagesExp!==e||n.__matchMessagesPlugin!==r)&&(this._pluginMediator.removeListener(c.PluginEvent.PLUGIN_MESSAGE,n),!0)},t.prototype.handlePushRequests=function(e,t,r){if(!e)throw new TypeError('Push request "matcher" cannot be null.');if("function"!=typeof t)throw new TypeError("Push request callback cannot be null.");var n=function(n){var i=n.data.request;!i.message_ident||!i.message_ident.match(e)||r&&r!==n.data.plugin||Promise.resolve(t(i)).then(n.data.reply)};n.__matchRequestExp=e,n.__matchRequestPlugin=r,t.__matchRequestWrapper=n,this._pluginMediator.on(c.PluginEvent.PLUGIN_REQUEST,n)},t.prototype.unhandlePushRequests=function(e,t,r){if("function"!=typeof t)throw new TypeError("Push request callback cannot be null.");var n=t.__matchRequestWrapper;return!(!n||n.__matchRequestExp!==e||n.__matchRequestPlugin!==r)&&(this._pluginMediator.removeListener(c.PluginEvent.PLUGIN_REQUEST,n),!0)},t.prototype.request=function(e,t){var r,n=this,i={uri:e,options:t,context:{}};this._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_BEFORE_PROCESS_REQUEST,i);var o=this._sendRequest.bind(this,i.uri,i.options,i.context);return!this._endpoints&&b.test(i.uri)?(P.info("Request queued until endpoints resolved",i.uri),new Promise((function(e,t){n.once(l.Event.ENDPOINTS_RESOLVED,(function(){P.info("Sending endpoints-queued request",i.uri),o().then(e,t)}))}))):!this._connectionObserver.isOnline()&&!(null===(r=i.options)||void 0===r?void 0:r.allowOffline)?(P.info("Request queued until online",i.uri),new Promise((function(e,t){n.once(l.Event.CONNECTION_ONLINE,(function(){P.info("Sending offline-queued request",i.uri),o().then(e,t)}))}))):o()},t.prototype.addPlugin=function(e,t){var r=e(this,t),n=r.name;if(this._plugins[n])throw new TypeError("Plugin is already added.");return r.attach(this,this._pluginMediator),this._plugins[n]=r,n},t.prototype.removePlugin=function(e){var t=this._plugins[e];return!!t&&(t.detach(this,this._pluginMediator),this._plugins[e]=void 0,!0)},t.prototype.hasPlugin=function(e){return!!this._plugins[e]},t.prototype.getPluginAPI=function(e){var t=this._plugins[e];return t&&t.api?t.api:null},t.prototype.getConnectionId=function(e){void 0===e&&(e="dealer");var t=this._plugins[e];return t?t.api&&function(e){return"getConnectionInfo"in e.api}(t)?t.api.getConnectionInfo().then((function(e){return e.id})):Promise.reject(new TypeError("Plugin "+t+" is not a socket plugin.")):Promise.reject(new TypeError("Cannot retrieve connection id for plugin "+t+"."))},t.prototype.removeAllListeners=function(){return this},t}(s.EventEmitter);r.Transport=D},{"./_internal/connection_observer":158,"./_internal/operation_metrics_tracker":159,"./_internal/public_transport":160,"./enums/disconnection_reason":162,"./enums/errors":163,"./enums/event":164,"./enums/internal_socket_code":165,"./enums/plugin_event":167,"./enums/status_code":168,"./enums/status_family":169,"./error/request":170,"./error/transport":171,"./helpers/abortcontroller":173,"./http/request":176,"./http/response":178,"@js-sdk/backoff/es5":4,"@js-sdk/backoff/es5/counter":3,"@js-sdk/debug-tools/es5":17,"@spotify-internal/emitter/es5":98,tslib:192}],191:[function(e,t,r){arguments[4][7][0].apply(r,arguments)},{dup:7}],192:[function(e,t,r){(function(e){(function(){
  /*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
  var r,n,i,o,a,s,u,l,c,d,_,p,f,h,y,v,E,m,g,T,S,P,b,R;!function(r){var n="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function i(e,t){return e!==n&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}"function"==typeof define&&define.amd?define("tslib",["exports"],(function(e){r(i(n,i(e)))})):"object"==typeof t&&"object"==typeof t.exports?r(i(n,i(t.exports))):r(i(n))}((function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};r=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},o=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){return function(r,n){t(r,n,e)}},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},l=function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||R(t,e,r)},R=Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},d=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},p=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e},f=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},h=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},y=function(e){return this instanceof y?(this.v=e,this):new y(e)},v=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=i[e](t)).value instanceof y?Promise.resolve(r.value.v).then(u,l):c(o[0][2],r)}catch(e){c(o[0][3],e)}var r}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},E=function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:y(e[n](t)),done:"return"===n}:i?i(t):t}:i}},m=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=d(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},g=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};var A=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};T=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&R(t,e,r);return A(t,e),t},S=function(e){return e&&e.__esModule?e:{default:e}},P=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},b=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},e("__extends",r),e("__assign",n),e("__rest",i),e("__decorate",o),e("__param",a),e("__metadata",s),e("__awaiter",u),e("__generator",l),e("__exportStar",c),e("__createBinding",R),e("__values",d),e("__read",_),e("__spread",p),e("__spreadArrays",f),e("__spreadArray",h),e("__await",y),e("__asyncGenerator",v),e("__asyncDelegator",E),e("__asyncValues",m),e("__makeTemplateObject",g),e("__importStar",T),e("__importDefault",S),e("__classPrivateFieldGet",P),e("__classPrivateFieldSet",b)}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],193:[function(e,t,r){"use strict";r.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){var t,r,n=l(e),a=n[0],s=n[1],u=new o(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),c=0,d=s>0?a-4:a;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[c++]=255&t);1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t);return u},r.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(c(e,a,a+16383>s?s:a+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],194:[function(e,t,r){(function(t){(function(){
  /*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   */
  "use strict";var t=e("base64-js"),n=e("ieee754");r.Buffer=o,r.SlowBuffer=function(e){+e!=e&&(e=0);return o.alloc(+e)},r.INSPECT_MAX_BYTES=50;function i(e){if(e>2147483647)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=o.prototype,t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return a(e,t,r)}function a(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|d(e,t),n=i(r),a=n.write(e,t);a!==r&&(n=n.slice(0,a));return n}(e,t);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(x(e,ArrayBuffer)||e&&x(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=o.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);var a=function(e){if(o.isBuffer(e)){var t=0|c(e.length),r=i(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||j(e.length)?i(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return s(e),i(e<0?0:0|c(e))}function l(e){for(var t=e.length<0?0:0|c(e.length),r=i(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function d(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||x(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(i)return n?-1:M(e).length;t=(""+t).toLowerCase(),i=!0}}function _(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,r);case"utf8":case"utf-8":return P(this,t,r);case"ascii":return b(this,t,r);case"latin1":case"binary":return R(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function f(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),j(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:h(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):h(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function h(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=r;o<s;o++)if(l(e,o)===l(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var d=!0,_=0;_<u;_++)if(l(e,o+_)!==l(t,_)){d=!1;break}if(d)return o}return-1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(j(s))return a;e[r+a]=s}return a}function v(e,t,r,n){return F(M(t,e.length-r),e,r,n)}function E(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function m(e,t,r,n){return E(e,t,r,n)}function g(e,t,r,n){return F(U(t),e,r,n)}function T(e,t,r,n){return F(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function S(e,r,n){return 0===r&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,n))}function P(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,l=e[i],c=null,d=l>239?4:l>223?3:l>191?2:1;if(i+d<=r)switch(d){case 1:l<128&&(c=l);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&l)<<6|63&o)>127&&(c=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&l)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,d=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}r.kMaxLength=2147483647,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.poolSize=8192,o.from=function(e,t,r){return a(e,t,r)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(e,t,r){return function(e,t,r){return s(e),e<=0?i(e):void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)}(e,t,r)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),x(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(x(a,Uint8Array)&&(a=o.from(a)),!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?P(this,0,e):_.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},o.prototype.compare=function(e,t,r,n,i){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),u=Math.min(a,s),l=this.slice(n,i),c=e.slice(t,r),d=0;d<u;++d)if(l[d]!==c[d]){a=l[d],s=c[d];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return f(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return f(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return E(this,e,t,r);case"latin1":case"binary":return m(this,e,t,r);case"base64":return g(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function b(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function A(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=k(e[o]);return i}function I(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,r,n,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function C(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,i,o){return t=+t,r>>>=0,o||C(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function N(e,t,r,i,o){return t=+t,r>>>=0,o||C(e,0,r,8),n.write(e,t,r,i,52,8),r+8}o.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=o.prototype,n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||L(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||L(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||L(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||L(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||O(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||O(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);O(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);O(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return N(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return N(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var a=i-1;a>=0;--a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=o.isBuffer(e)?e:o.from(e,n),u=s.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=s[a%u]}return this};var w=/[^+/0-9A-Za-z-_]/g;function k(e){return e<16?"0"+e.toString(16):e.toString(16)}function M(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function U(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(w,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function x(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function j(e){return e!=e}}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":193,buffer:194,ieee754:196}],195:[function(e,t,r){(function(n,i){(function(){
  /*!
   * @overview es6-promise - a tiny implementation of Promises/A+.
   * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
   * @license   Licensed under MIT license
   *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
   * @version   v4.2.8+1e68dce6
   */
  !function(e,n){"object"==typeof r&&void 0!==t?t.exports=n():"function"==typeof define&&define.amd?define(n):e.ES6Promise=n()}(this,(function(){"use strict";function t(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,a=void 0,s=void 0,u=function(e,t){h[o]=e,h[o+1]=t,2===(o+=2)&&(s?s(y):T())};var l="undefined"!=typeof window?window:void 0,c=l||{},d=c.MutationObserver||c.WebKitMutationObserver,_="undefined"==typeof self&&void 0!==n&&"[object process]"==={}.toString.call(n),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(y,1)}}var h=new Array(1e3);function y(){for(var e=0;e<o;e+=2){(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0}o=0}var v,E,m,g,T=void 0;function S(e,t){var r=this,n=new this.constructor(R);void 0===n[b]&&M(n);var i=r._state;if(i){var o=arguments[i-1];u((function(){return w(i,n,o,r._result)}))}else D(r,n,e,t);return n}function P(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(R);return I(t,e),t}_?T=function(){return n.nextTick(y)}:d?(E=0,m=new d(y),g=document.createTextNode(""),m.observe(g,{characterData:!0}),T=function(){g.data=E=++E%2}):p?((v=new MessageChannel).port1.onmessage=y,T=function(){return v.port2.postMessage(0)}):T=void 0===l&&"function"==typeof e?function(){try{var e=Function("return this")().require("vertx");return void 0!==(a=e.runOnLoop||e.runOnContext)?function(){a(y)}:f()}catch(e){return f()}}():f();var b=Math.random().toString(36).substring(2);function R(){}function A(e,r,n){r.constructor===e.constructor&&n===S&&r.constructor.resolve===P?function(e,t){1===t._state?O(e,t._result):2===t._state?C(e,t._result):D(t,void 0,(function(t){return I(e,t)}),(function(t){return C(e,t)}))}(e,r):void 0===n?O(e,r):t(n)?function(e,t,r){u((function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,(function(r){n||(n=!0,t!==r?I(e,r):O(e,r))}),(function(t){n||(n=!0,C(e,t))}),e._label);!n&&i&&(n=!0,C(e,i))}),e)}(e,r,n):O(e,r)}function I(e,t){if(e===t)C(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)O(e,t);else{var r=void 0;try{r=t.then}catch(t){return void C(e,t)}A(e,t,r)}var n,i}function L(e){e._onerror&&e._onerror(e._result),N(e)}function O(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&u(N,e))}function C(e,t){void 0===e._state&&(e._state=2,e._result=t,u(L,e))}function D(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+1]=r,i[o+2]=n,0===o&&e._state&&u(N,e)}function N(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+r],n?w(r,n,i,o):i(o);e._subscribers.length=0}}function w(e,r,n,i){var o=t(n),a=void 0,s=void 0,u=!0;if(o){try{a=n(i)}catch(e){u=!1,s=e}if(r===a)return void C(r,new TypeError("A promises callback cannot return that same promise."))}else a=i;void 0!==r._state||(o&&u?I(r,a):!1===u?C(r,s):1===e?O(r,a):2===e&&C(r,a))}var k=0;function M(e){e[b]=k++,e._state=void 0,e._result=void 0,e._subscribers=[]}var U=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(R),this.promise[b]||M(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&O(this.promise,this._result))):C(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===P){var i=void 0,o=void 0,a=!1;try{i=e.then}catch(e){a=!0,o=e}if(i===S&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===F){var s=new r(R);a?C(s,o):A(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?C(n,r):this._result[t]=r),0===this._remaining&&O(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;D(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}();var F=function(){function e(t){this[b]=k++,this._result=this._state=void 0,this._subscribers=[],R!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t((function(t){I(e,t)}),(function(t){C(e,t)}))}catch(t){C(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var r=this.constructor;return t(e)?this.then((function(t){return r.resolve(e()).then((function(){return t}))}),(function(t){return r.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return F.prototype.then=S,F.all=function(e){return new U(this,e).promise},F.race=function(e){var t=this;return r(e)?new t((function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},F.resolve=P,F.reject=function(e){var t=new this(R);return C(t,e),t},F._setScheduler=function(e){s=e},F._setAsap=function(e){u=e},F._asap=u,F.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=F},F.Promise=F,F}))}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:197}],196:[function(e,t,r){
  /*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
  r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,d=r?i-1:0,_=r?-1:1,p=e[t+d];for(d+=_,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+d],d+=_,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+e[t+d],d+=_,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=l}return(p?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,d=c>>1,_=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+d>=1?_/u:_*Math.pow(2,1-d))*u>=2&&(a++,u/=2),a+d>=c?(s=0,a=c):a+d>=1?(s=(t*u-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[r+p]=255&s,p+=f,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[r+p]=255&a,p+=f,a/=256,l-=8);e[r+p-f]|=128*h}},{}],197:[function(e,t,r){var n,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,c=[],d=!1,_=-1;function p(){d&&l&&(d=!1,l.length?c=l.concat(c):_=-1,c.length&&f())}function f(){if(!d){var e=u(p);d=!0;for(var t=c.length;t;){for(l=c,c=[];++_<t;)l&&l[_].run();_=-1,t=c.length}l=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||d||u(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],198:[function(e,t,r){!function(){var e="0123456789abcdef",r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=[];n.length=256;for(var i=0;i<256;i++)n[i]=e[i>>4]+e[15&i];var o=[];o.length=128;for(i=0;i<r.length;++i)o[r.charCodeAt(i)]=i;var a=[];for(i=0;i<16;i++)a[e.charCodeAt(i)]=i;for(i=0;i<6;i++)a["ABCDEF".charCodeAt(i)]=10+i;var s={toHex:function(e){if(22!==e.length)return null;var t,r,i,a,s,u=2.3283064365386963e-10,l=4294967296,c=238328;return t=56800235584*o[e.charCodeAt(0)]+916132832*o[e.charCodeAt(1)]+14776336*o[e.charCodeAt(2)]+238328*o[e.charCodeAt(3)]+3844*o[e.charCodeAt(4)]+62*o[e.charCodeAt(5)]+o[e.charCodeAt(6)],t=(t-=(r=t*u|0)*l)*c+(s=3844*o[e.charCodeAt(7)]+62*o[e.charCodeAt(8)]+o[e.charCodeAt(9)]),t-=(s=t*u|0)*l,r=r*c+s,t=t*c+(s=3844*o[e.charCodeAt(10)]+62*o[e.charCodeAt(11)]+o[e.charCodeAt(12)]),t-=(s=t*u|0)*l,r=r*c+s,r-=(s=r*u|0)*l,i=s,t=t*c+(s=3844*o[e.charCodeAt(13)]+62*o[e.charCodeAt(14)]+o[e.charCodeAt(15)]),t-=(s=t*u|0)*l,r=r*c+s,r-=(s=r*u|0)*l,i=i*c+s,t=t*c+(s=3844*o[e.charCodeAt(16)]+62*o[e.charCodeAt(17)]+o[e.charCodeAt(18)]),t-=(s=t*u|0)*l,r=r*c+s,r-=(s=r*u|0)*l,i=i*c+s,i-=(s=i*u|0)*l,a=s,t=t*c+(s=3844*o[e.charCodeAt(19)]+62*o[e.charCodeAt(20)]+o[e.charCodeAt(21)]),t-=(s=t*u|0)*l,r=r*c+s,r-=(s=r*u|0)*l,i=i*c+s,i-=(s=i*u|0)*l,a=a*c+s,a-=(s=a*u|0)*l,s?null:n[a>>>24]+n[a>>>16&255]+n[a>>>8&255]+n[255&a]+n[i>>>24]+n[i>>>16&255]+n[i>>>8&255]+n[255&i]+n[r>>>24]+n[r>>>16&255]+n[r>>>8&255]+n[255&r]+n[t>>>24]+n[t>>>16&255]+n[t>>>8&255]+n[255&t]},fromHex:function(e){var t,n=0,i=0,o=0;for(t=0;t<10;t++)o=16*o+a[e.charCodeAt(t)];for(t=0;t<11;t++)i=16*i+a[e.charCodeAt(t+10)];for(t=0;t<11;t++)n=16*n+a[e.charCodeAt(t+21)];if(isNaN(n+i+o))return null;var s,u=17592186044416,l="";for(t=0;t<7;++t)s=((s=((s=o)-62*(o=Math.floor(s*(1/62))))*u+i)-62*(i=Math.floor(s*(1/62))))*u+n,n=Math.floor(s*(1/62)),l=r[s-62*n]+l;for(i+=o*u;t<15;++t)s=((s=i)-62*(i=Math.floor(s*(1/62))))*u+n,n=Math.floor(s*(1/62)),l=r[s-62*n]+l;for(n+=i*u;t<21;++t)s=n,n=Math.floor(s*(1/62)),l=r[s-62*n]+l;return r[n]+l},HEX256:n,ID16:a,ID62:o};void 0!==t&&void 0!==t.exports?t.exports=s:window.Base62=s}()},{}],199:[function(e,t,r){"use strict";var n=e("./base62"),i=new TypeError("Invalid Spotify URI!"),o=(new TypeError("Not implemented!"),0),a=1,s=function(e,t){return e=encodeURIComponent(e),t===o&&(e=e.replace(/%20/g,"+")),e=(e=e.replace(/[!'()]/g,escape)).replace(/\*/g,"%2A")},u=function(e,t){var r=t==o?e.replace(/\+/g,"%20"):e;return decodeURIComponent(r)},l=function(e,t){var r,n,o,a;switch(e.id&&(r=e._base62Id),e.type){case p.Type.ALBUM:return n=[p.Type.ALBUM,r],e.disc&&n.push(e.disc),n;case p.Type.AD:return[p.Type.AD,e._base62Id];case p.Type.ARTIST:return[p.Type.ARTIST,r];case p.Type.ARTIST_TOPLIST:return[p.Type.ARTIST,r,p.Type.TOP,e.toplist];case p.Type.DAILY_MIX:return[p.Type.DAILY_MIX,r];case p.Type.SEARCH:return[p.Type.SEARCH,s(e.query,t)];case p.Type.TRACK:return(e.context||e.play)&&(r+=c({context:e.context,play:e.play})),e.anchor&&(r+="#"+e.anchor),[p.Type.TRACK,r];case p.Type.TRACKSET:var u=[];for(o=0,a=e.tracks.length;o<a;o++)u.push(e.tracks[o]._base62Id);return u=[u.join(",")],null!==e.index&&u.push("#",e.index),[p.Type.TRACKSET,s(e.name)].concat(u);case p.Type.FACEBOOK:return[p.Type.USER,p.Type.FACEBOOK,e.uid];case p.Type.AUDIO_FILE:return[p.Type.AUDIO_FILE,e.extension,e._base62Id];case p.Type.FOLDER:return[p.Type.USER,s(e.username,t),p.Type.FOLDER,e._base62Id];case p.Type.FOLLOWERS:return[p.Type.USER,s(e.username,t),p.Type.FOLLOWERS];case p.Type.FOLLOWING:return[p.Type.USER,s(e.username,t),p.Type.FOLLOWING];case p.Type.PLAYLIST:return[p.Type.USER,s(e.username,t),p.Type.PLAYLIST,r];case p.Type.PLAYLIST_V2:return[p.Type.PLAYLIST,r];case p.Type.STARRED:return[p.Type.USER,s(e.username,t),p.Type.STARRED];case p.Type.TEMP_PLAYLIST:return[p.Type.TEMP_PLAYLIST,e.origin,e.data];case p.Type.CONTEXT_GROUP:return[p.Type.CONTEXT_GROUP,e.origin,e.name];case p.Type.USER_TOPLIST:return[p.Type.USER,s(e.username,t),p.Type.TOP,e.toplist];case p.Type.USER_TOP_TRACKS:return[p.Type.USER,s(e.username,t),p.Type.TOPLIST];case p.Type.TOPLIST:return[p.Type.TOP,e.toplist].concat(e.global?[p.Type.GLOBAL]:["country",e.country]);case p.Type.INBOX:return[p.Type.USER,s(e.username,t),p.Type.INBOX];case p.Type.ROOTLIST:return[p.Type.USER,s(e.username,t),p.Type.ROOTLIST];case p.Type.PUBLISHED_ROOTLIST:return[p.Type.USER,s(e.username,t),p.Type.PUBLISHED_ROOTLIST];case p.Type.COLLECTION_TRACK_LIST:return[p.Type.USER,s(e.username,t),p.Type.COLLECTION_TRACK_LIST,r];case p.Type.PROFILE:return e.args&&e.args.length>0?[p.Type.USER,s(e.username,t)].concat(e.args):[p.Type.USER,s(e.username,t)];case p.Type.LOCAL_ARTIST:return[p.Type.LOCAL,s(e.artist,t)];case p.Type.LOCAL_ALBUM:return[p.Type.LOCAL,s(e.artist,t),s(e.album,t)];case p.Type.LOCAL:return[p.Type.LOCAL,s(e.artist,t),s(e.album,t),s(e.track,t),e.duration];case p.Type.LIBRARY:return[p.Type.USER,s(e.username,t),p.Type.LIBRARY].concat(e.category?[e.category]:[]);case p.Type.IMAGE:return[p.Type.IMAGE,e._base62Id];case p.Type.MOSAIC:return(n=e.ids.slice(0)).unshift(p.Type.MOSAIC),n;case p.Type.RADIO:return[p.Type.RADIO,e.args];case p.Type.SPECIAL:for(n=[p.Type.SPECIAL],o=0,a=(l=e.args||[]).length;o<a;++o)n.push(s(l[o],t));return n;case p.Type.STATION:for(n=[p.Type.STATION],o=0,a=(l=e.args||[]).length;o<a;o++)n.push(s(l[o],t));return n;case p.Type.APPLICATION:var l;for(n=[p.Type.APP,e._base62Id],o=0,a=(l=e.args||[]).length;o<a;++o)n.push(s(l[o],t));return n;case p.Type.COLLECTION_ALBUM:return[p.Type.USER,s(e.username,t),p.Type.COLLECTION,p.Type.ALBUM,r];case p.Type.COLLECTION_MISSING_ALBUM:return[p.Type.USER,s(e.username,t),p.Type.COLLECTION,p.Type.ALBUM,r,"missing"];case p.Type.COLLECTION_ARTIST:return[p.Type.USER,s(e.username,t),p.Type.COLLECTION,p.Type.ARTIST,r];case p.Type.COLLECTION:return[p.Type.USER,s(e.username,t),p.Type.COLLECTION].concat(e.category?[e.category]:[]);case p.Type.EPISODE:return(e.context||e.play)&&(r+=c({context:e.context,play:e.play})),[p.Type.EPISODE,r];case p.Type.SHOW:return[p.Type.SHOW,r];case p.Type.LIVE:return[p.Type.LIVE,r];case p.Type.CONCERT:return[p.Type.CONCERT,r];case p.Type.SOCIAL_SESSION:return[p.Type.SOCIAL_SESSION,r];case p.Type.INTERRUPTION:return[p.Type.INTERRUPTION,e.id];default:throw i}},c=function(e){var t="?";for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(t.length>1&&(t+="&"),t+=r+"="+encodeURIComponent(e[r]));return t},d=function(e){return e.split("&").reduce((function(e,t){return e[(t=t.split("="))[0]]=decodeURIComponent(t[1]),e}),{})},_=function(e,t,r){var n=0;r=r||{};var a,l,c,d=function(){const t=e[n++];if(/\s/.test(t))throw i;return t},_=function(){var e=d();if(!e||e.length>22)throw i;return e},f=function(){var e=d();if(!e||22!==e.length)throw i;if(!/^[a-zA-Z0-9]+$/.test(e))throw i;return e},h=function(){return e.slice(n)},y=function(){var r=t==o?":":"/";return e.slice(n).join(r)},v=d();switch(v){case p.Type.ALBUM:return p.albumURI(f(),parseInt(d(),10));case p.Type.AD:return p.adURI(d());case p.Type.ARTIST:return a=f(),d()==p.Type.TOP?p.artistToplistURI(a,d()):p.artistURI(a);case p.Type.AUDIO_FILE:return p.audioFileURI(d(),d());case p.Type.DAILY_MIX:return p.dailyMixURI(_());case p.Type.TEMP_PLAYLIST:return p.temporaryPlaylistURI(d(),y());case p.Type.PLAYLIST:return p.playlistV2URI(f());case p.Type.SEARCH:return p.searchURI(u(y(),t));case p.Type.TRACK:return p.trackURI(f(),d(),r.context,r.play);case p.Type.TRACKSET:var E=u(d()),m=d(),g=d(),T=parseInt(d(),10);("%23"!==g||isNaN(T))&&(T=null);var S=[];if(m)for(l=0,c=(m=u(m).split(",")).length;l<c;l++){var P=m[l];S.push(p.trackURI(P))}return p.tracksetURI(S,E,T);case p.Type.CONTEXT_GROUP:return p.contextGroupURI(d(),d());case p.Type.TOP:var b=d();return d()==p.Type.GLOBAL?p.toplistURI(b,null,!0):p.toplistURI(b,d(),!1);case p.Type.USER:var R=u(d(),t),A=d();if(R===p.Type.FACEBOOK&&A)return p.facebookURI(parseInt(A,10));if(A)switch(A){case p.Type.PLAYLIST:return p.playlistURI(R,f());case p.Type.FOLDER:return p.folderURI(R,_());case p.Type.COLLECTION_TRACK_LIST:return p.collectionTrackList(R,_());case p.Type.COLLECTION:var I=d();switch(I){case p.Type.ALBUM:return a=_(),"missing"===d()?p.collectionMissingAlbumURI(R,a):p.collectionAlbumURI(R,a);case p.Type.ARTIST:return p.collectionArtistURI(R,_());default:return p.collectionURI(R,I)}case p.Type.STARRED:return p.starredURI(R);case p.Type.FOLLOWERS:return p.followersURI(R);case p.Type.FOLLOWING:return p.followingURI(R);case p.Type.TOP:return p.userToplistURI(R,d());case p.Type.INBOX:return p.inboxURI(R);case p.Type.ROOTLIST:return p.rootlistURI(R);case p.Type.PUBLISHED_ROOTLIST:return p.publishedRootlistURI(R);case p.Type.TOPLIST:return p.userTopTracksURI(R);case p.Type.LIBRARY:return p.libraryURI(R,d())}var L=h();if(A&&L.length>0)return p.profileURI(R,[A].concat(L));if(A)return p.profileURI(R,[A]);if(R)return p.profileURI(R);throw i;case p.Type.LOCAL:var O=d(),C=O&&u(O,t),D=d(),N=D&&u(D,t),w=d(),k=w&&u(w,t),M=d(),U=parseInt(M,10);return void 0!==w?p.localURI(C,N,k,U):void 0!==D?p.localAlbumURI(C,N):p.localArtistURI(C);case p.Type.IMAGE:return p.imageURI(_());case p.Type.MOSAIC:return p.mosaicURI(e.slice(n));case p.Type.RADIO:return p.radioURI(y());case p.Type.SPECIAL:for(l=0,c=(F=h()).length;l<c;++l)F[l]=u(F[l],t);return p.specialURI(F);case p.Type.STATION:return p.stationURI(h());case p.Type.EPISODE:return p.episodeURI(f(),r.context,r.play);case p.Type.SHOW:return p.showURI(f());case p.Type.LIVE:return p.liveURI(_());case p.Type.CONCERT:return p.concertURI(_());case"":break;case p.Type.SOCIAL_SESSION:return p.socialSessionURI(d());case p.Type.INTERRUPTION:return p.interruptionURI(d());default:a=v===p.Type.APP?d():v;var F,x=u(a,t);if(s(x,t)!==a)break;for(l=0,c=(F=h()).length;l<c;++l)F[l]=u(F[l],t);return p.applicationURI(x,F)}throw i};function p(e,t){for(var r in this.type=e,t)"function"!=typeof t[r]&&(this[r]=t[r])}Object.defineProperty(p.prototype,"id",{get:function(){return this._hexId||(this._hexId=this._base62Id?p.idToHex(this._base62Id):void 0),this._hexId},set:function(e){this._base62Id=e?p.hexToId(e):void 0,this._hexId=void 0},enumerable:!0,configurable:!0}),p.prototype.toAppType=function(){if(this.type==p.Type.APPLICATION)return p.applicationURI(this.id,this.args);var e=l(this,a),t=e.shift(),r=e.length;if(r)for(;r--;)e[r]=u(e[r],a);return this.type==p.Type.RADIO&&(e=e.shift().split(":")),p.applicationURI(t,e)},p.prototype.toRealType=function(){return this.type==p.Type.APPLICATION?_([this.id].concat(this.args),o):new p(null,this)},p.prototype.toURI=function(){return"spotify:"+l(this,o).join(":")},p.prototype.toString=function(){return this.toURI()},p.prototype.toURLPath=function(e){var t=l(this,a);t[0]===p.Type.APP&&t.shift();var r=t[0]===p.Type.TRACKSET,n=t[0]===p.Type.LOCAL;if(!r&&!n){for(var i=[],o=0,s=t.length;o<s;o++){var u=t[o];u&&i.push(u)}t=i}var c=t.join("/");return e?"/"+c:c},p.prototype.toPlayURL=function(){return"https://play.spotify.com/"+this.toURLPath()},p.prototype.toURL=function(){return this.toPlayURL()},p.prototype.toOpenURL=function(){return"https://open.spotify.com/"+this.toURLPath()},p.prototype.toSecurePlayURL=function(){return this.toPlayURL()},p.prototype.toSecureURL=function(){return this.toPlayURL()},p.prototype.toSecureOpenURL=function(){return this.toOpenURL()},p.prototype.idToByteString=function(){var e=n.toHex(this._base62Id);if(!e){for(var t="",r=0;r<16;r++)t+=String.fromCharCode(0);return t}var i="";for(r=0;r<32;r+=2){var o=(n.ID16[e.charCodeAt(r)]<<4)+n.ID16[e.charCodeAt(r+1)];i+=String.fromCharCode(o)}return i},p.prototype.getPath=function(){return this.toString().replace(/[#?].*/,"")},p.prototype.getBase62Id=function(){return this._base62Id},p.prototype.isSameIdentity=function(e){var t=p.from(e);if(!t)return!1;if(this.toString()===e.toString())return!0;if(this.type!==p.Type.PLAYLIST&&this.type!==p.Type.PLAYLIST_V2||t.type!==p.Type.PLAYLIST&&t.type!==p.Type.PLAYLIST_V2){if(this.type===p.Type.STATION&&t.type===p.Type.STATION){var r=_(this.args,o);return!!r&&r.isSameIdentity(_(t.args,o))}return!1}return this.id===t.id},p.Type={EMPTY:"empty",ALBUM:"album",AD:"ad",APP:"app",APPLICATION:"application",ARTIST:"artist",ARTIST_TOPLIST:"artist-toplist",AUDIO_FILE:"audiofile",COLLECTION:"collection",COLLECTION_ALBUM:"collection-album",COLLECTION_MISSING_ALBUM:"collection-missing-album",COLLECTION_ARTIST:"collection-artist",CONTEXT_GROUP:"context-group",DAILY_MIX:"dailymix",EPISODE:"episode",FACEBOOK:"facebook",FOLDER:"folder",FOLLOWERS:"followers",FOLLOWING:"following",GLOBAL:"global",IMAGE:"image",INBOX:"inbox",INTERRUPTION:"interruption",LOCAL_ARTIST:"local-artist",LOCAL_ALBUM:"local-album",LOCAL:"local",LIBRARY:"library",LIVE:"live",MOSAIC:"mosaic",PLAYLIST:"playlist",PLAYLIST_V2:"playlist-v2",PROFILE:"profile",PUBLISHED_ROOTLIST:"published-rootlist",RADIO:"radio",ROOTLIST:"rootlist",COLLECTION_TRACK_LIST:"collectiontracklist",SEARCH:"search",SHOW:"show",SOCIAL_SESSION:"socialsession",CONCERT:"concert",SPECIAL:"special",STARRED:"starred",STATION:"station",TEMP_PLAYLIST:"temp-playlist",TOP:"top",TOPLIST:"toplist",TRACK:"track",TRACKSET:"trackset",USER:"user",USER_TOPLIST:"user-toplist",USER_TOP_TRACKS:"user-top-tracks",USET_TOP_TRACKS:"user-top-tracks"},p.fromString=function(e){var t=function(e){var t,r,n,s,u=e.split("?");if(u.length>1){e=u.shift();var l=(n=u.pop()).split("#");l.length>1&&(n=l.shift(),s=l.pop()),n=d(n)}var c=e.split("#");if(c.length>1&&(e=c.shift(),s=c.pop()),0===e.indexOf("spotify:"))t=e.slice("spotify:".length).split(":"),r=o;else{if(0===(e=e.split("?")[0]).indexOf("http://play.spotify.com/"))t=e.slice("http://play.spotify.com/".length).split("/");else if(0===e.indexOf("https://play.spotify.com/"))t=e.slice("https://play.spotify.com/".length).split("/");else if(0===e.indexOf("http://open.spotify.com/"))t=e.slice("http://open.spotify.com/".length).split("/");else if(0===e.indexOf("https://open.spotify.com/"))t=e.slice("https://open.spotify.com/".length).split("/");else{if(0!==e.indexOf("/"))throw i;t=e.slice("/".length).split("/")}r=a}return s&&t.push(s),{format:r,components:t,query:n}}(e);return _(t.components,t.format,t.query)},p.from=function(e){try{return e instanceof p?e:"object"==typeof e&&e.type?new p(null,e):p.fromString(e.toString())}catch(e){return null}},p.fromByteString=function(e,t,r){for(;16!=t.length;)t=String.fromCharCode(0)+t;for(var i="",o=0;o<t.length;o++){var a=t.charCodeAt(o);i+=n.HEX256[a]}var s=n.fromHex(i),u=r||{};return u.id=s,new p(e,u)},p.clone=function(e){return e instanceof p?new p(null,e):null},p.getCanonical=function(e){return this.getCanonical(e)},p.getCanonicalUsername=function(e){return s(e,o)},p.getDisplayUsername=function(e){return u(e,o)},p.idToHex=function(e){return 22==e.length?n.toHex(e):e},p.hexToId=function(e){return 32==e.length?n.fromHex(e):e},p.emptyURI=function(){return new p(p.Type.EMPTY,{})},p.albumURI=function(e,t){return new p(p.Type.ALBUM,{id:e,disc:t})},p.adURI=function(e){return new p(p.Type.AD,{id:e})},p.audioFileURI=function(e,t){return new p(p.Type.AUDIO_FILE,{id:t,extension:e})},p.artistURI=function(e){return new p(p.Type.ARTIST,{id:e})},p.artistToplistURI=function(e,t){return new p(p.Type.ARTIST_TOPLIST,{id:e,toplist:t})},p.dailyMixURI=function(e){return new p(p.Type.DAILY_MIX,{id:e})},p.searchURI=function(e){return new p(p.Type.SEARCH,{query:e})},p.trackURI=function(e,t,r,n){return new p(p.Type.TRACK,{id:e,anchor:t,context:r?p.fromString(r):r,play:n})},p.tracksetURI=function(e,t,r){return new p(p.Type.TRACKSET,{tracks:e,name:t||"",index:isNaN(r)?null:r})},p.facebookURI=function(e){return new p(p.Type.FACEBOOK,{uid:e})},p.followersURI=function(e){return new p(p.Type.FOLLOWERS,{username:e})},p.followingURI=function(e){return new p(p.Type.FOLLOWING,{username:e})},p.playlistURI=function(e,t){return new p(p.Type.PLAYLIST,{username:e,id:t})},p.playlistV2URI=function(e){return new p(p.Type.PLAYLIST_V2,{id:e})},p.folderURI=function(e,t){return new p(p.Type.FOLDER,{username:e,id:t})},p.collectionTrackList=function(e,t){return new p(p.Type.COLLECTION_TRACK_LIST,{username:e,id:t})},p.starredURI=function(e){return new p(p.Type.STARRED,{username:e})},p.userToplistURI=function(e,t){return new p(p.Type.USER_TOPLIST,{username:e,toplist:t})},p.userTopTracksURI=function(e){return new p(p.Type.USER_TOP_TRACKS,{username:e})},p.toplistURI=function(e,t,r){return new p(p.Type.TOPLIST,{toplist:e,country:t,global:!!r})},p.inboxURI=function(e){return new p(p.Type.INBOX,{username:e})},p.rootlistURI=function(e){return new p(p.Type.ROOTLIST,{username:e})},p.publishedRootlistURI=function(e){return new p(p.Type.PUBLISHED_ROOTLIST,{username:e})},p.localArtistURI=function(e){return new p(p.Type.LOCAL_ARTIST,{artist:e})},p.localAlbumURI=function(e,t){return new p(p.Type.LOCAL_ALBUM,{artist:e,album:t})},p.localURI=function(e,t,r,n){return new p(p.Type.LOCAL,{artist:e,album:t,track:r,duration:n})},p.libraryURI=function(e,t){return new p(p.Type.LIBRARY,{username:e,category:t})},p.collectionURI=function(e,t){return new p(p.Type.COLLECTION,{username:e,category:t})},p.temporaryPlaylistURI=function(e,t){return new p(p.Type.TEMP_PLAYLIST,{origin:e,data:t})},p.contextGroupURI=function(e,t){return new p(p.Type.CONTEXT_GROUP,{origin:e,name:t})},p.profileURI=function(e,t){return new p(p.Type.PROFILE,{username:e,args:t})},p.imageURI=function(e){return new p(p.Type.IMAGE,{id:e})},p.mosaicURI=function(e){return new p(p.Type.MOSAIC,{ids:e})},p.radioURI=function(e){return e=void 0===e?"":e,new p(p.Type.RADIO,{args:e})},p.specialURI=function(e){return e=void 0===e?[]:e,new p(p.Type.SPECIAL,{args:e})},p.stationURI=function(e){return e=void 0===e?[]:e,new p(p.Type.STATION,{args:e})},p.applicationURI=function(e,t){return t=void 0===t?[]:t,new p(p.Type.APPLICATION,{id:e,args:t})},p.collectionAlbumURI=function(e,t){return new p(p.Type.COLLECTION_ALBUM,{username:e,id:t})},p.collectionMissingAlbumURI=function(e,t){return new p(p.Type.COLLECTION_MISSING_ALBUM,{username:e,id:t})},p.collectionArtistURI=function(e,t){return new p(p.Type.COLLECTION_ARTIST,{username:e,id:t})},p.episodeURI=function(e,t,r){return new p(p.Type.EPISODE,{id:e,context:t?p.fromString(t):t,play:r})},p.showURI=function(e){return new p(p.Type.SHOW,{id:e})},p.liveURI=function(e){return new p(p.Type.LIVE,{id:e})},p.concertURI=function(e){return new p(p.Type.CONCERT,{id:e})},p.socialSessionURI=function(e){return new p(p.Type.SOCIAL_SESSION,{id:e})},p.interruptionURI=function(e){return new p(p.Type.INTERRUPTION,{id:e})},p.isAlbum=function(e){return(p.from(e)||{}).type===p.Type.ALBUM},p.isAd=function(e){return(p.from(e)||{}).type===p.Type.AD},p.isApplication=function(e){return(p.from(e)||{}).type===p.Type.APPLICATION},p.isArtist=function(e){return(p.from(e)||{}).type===p.Type.ARTIST},p.isCollection=function(e){return(p.from(e)||{}).type===p.Type.COLLECTION},p.isCollectionAlbum=function(e){return(p.from(e)||{}).type===p.Type.COLLECTION_ALBUM},p.isCollectionArtist=function(e){return(p.from(e)||{}).type===p.Type.COLLECTION_ARTIST},p.isDailyMix=function(e){return(p.from(e)||{}).type===p.Type.DAILY_MIX},p.isEpisode=function(e){return(p.from(e)||{}).type===p.Type.EPISODE},p.isFacebook=function(e){return(p.from(e)||{}).type===p.Type.FACEBOOK},p.isFolder=function(e){return(p.from(e)||{}).type===p.Type.FOLDER},p.isLocalArtist=function(e){return(p.from(e)||{}).type===p.Type.LOCAL_ARTIST},p.isLocalAlbum=function(e){return(p.from(e)||{}).type===p.Type.LOCAL_ALBUM},p.isLocalTrack=function(e){return(p.from(e)||{}).type===p.Type.LOCAL},p.isMosaic=function(e){return(p.from(e)||{}).type===p.Type.MOSAIC},p.isPlaylistV1=function(e){return(p.from(e)||{}).type===p.Type.PLAYLIST},p.isPlaylistV2=function(e){return(p.from(e)||{}).type===p.Type.PLAYLIST_V2},p.isRadio=function(e){return(p.from(e)||{}).type===p.Type.RADIO},p.isRootlist=function(e){return(p.from(e)||{}).type===p.Type.ROOTLIST},p.isSearch=function(e){return(p.from(e)||{}).type===p.Type.SEARCH},p.isShow=function(e){return(p.from(e)||{}).type===p.Type.SHOW},p.isLive=function(e){return(p.from(e)||{}).type===p.Type.LIVE},p.isConcert=function(e){return(p.from(e)||{}).type===p.Type.CONCERT},p.isStation=function(e){return(p.from(e)||{}).type===p.Type.STATION},p.isTrack=function(e){return(p.from(e)||{}).type===p.Type.TRACK},p.isProfile=function(e){return(p.from(e)||{}).type===p.Type.PROFILE},p.isPlaylistV1OrV2=function(e){var t=p.from(e);return!!t&&(t.type===p.Type.PLAYLIST||t.type===p.Type.PLAYLIST_V2)},p.isSocialSession=function(e){return(p.from(e)||{}).type===p.Type.SOCIAL_SESSION},p.isInterruption=function(e){return(p.from(e)||{}).type===p.Type.INTERRUPTION},t.exports=p},{"./base62":198}],200:[function(e,t,r){(function(t,n){(function(){var i=e("process/browser.js").nextTick,o=Function.prototype.apply,a=Array.prototype.slice,s={},u=0;function l(e,t){this._id=e,this._clearFn=t}r.setTimeout=function(){return new l(o.call(setTimeout,window,arguments),clearTimeout)},r.setInterval=function(){return new l(o.call(setInterval,window,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(e){e.close()},l.prototype.unref=l.prototype.ref=function(){},l.prototype.close=function(){this._clearFn.call(window,this._id)},r.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},r.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},r._unrefActive=r.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r.setImmediate="function"==typeof t?t:function(e){var t=u++,n=!(arguments.length<2)&&a.call(arguments,1);return s[t]=!0,i((function(){s[t]&&(n?e.apply(null,n):e.call(null),r.clearImmediate(t))})),t},r.clearImmediate="function"==typeof n?n:function(e){delete s[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":197,timers:200}],201:[function(e,t,r){(function(e){(function(){
  /*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
  var r,n,i,o,a,s,u,l,c,d,_,p,f,h,y,v,E,m,g,T,S,P,b,R;!function(r){var n="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function i(e,t){return e!==n&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}"function"==typeof define&&define.amd?define("tslib",["exports"],(function(e){r(i(n,i(e)))})):"object"==typeof t&&"object"==typeof t.exports?r(i(n,i(t.exports))):r(i(n))}((function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};r=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},o=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){return function(r,n){t(r,n,e)}},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},l=function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||R(t,e,r)},R=Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},d=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},p=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e},f=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},h=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||t)},y=function(e){return this instanceof y?(this.v=e,this):new y(e)},v=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=i[e](t)).value instanceof y?Promise.resolve(r.value.v).then(u,l):c(o[0][2],r)}catch(e){c(o[0][3],e)}var r}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},E=function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:y(e[n](t)),done:"return"===n}:i?i(t):t}:i}},m=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=d(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},g=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};var A=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};T=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&R(t,e,r);return A(t,e),t},S=function(e){return e&&e.__esModule?e:{default:e}},P=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},b=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},e("__extends",r),e("__assign",n),e("__rest",i),e("__decorate",o),e("__param",a),e("__metadata",s),e("__awaiter",u),e("__generator",l),e("__exportStar",c),e("__createBinding",R),e("__values",d),e("__read",_),e("__spread",p),e("__spreadArrays",f),e("__spreadArray",h),e("__await",y),e("__asyncGenerator",v),e("__asyncDelegator",E),e("__asyncValues",m),e("__makeTemplateObject",g),e("__importStar",T),e("__importDefault",S),e("__classPrivateFieldGet",P),e("__classPrivateFieldSet",b)}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],202:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),e("es6-promise").polyfill();var n=e("../enums/errors"),i=e("../error/player_error"),o=e("./player_wrapper");window.addEventListener("load",(function(){if(window.parent===window)throw new i.PlayerError(n.Errors.MISSING_IFRAME,"Embedded player needs to be in an iframe");o.PlayerWrapper.create(window,window.parent).listen()}))},{"../enums/errors":204,"../error/player_error":206,"./player_wrapper":203,"es6-promise":195}],203:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerWrapper=void 0;var n=e("@spotify-internal/harmony/es5/streamer"),i=e("@spotify-internal/harmony"),o=e("@spotify-internal/transport/es5/_internal/connection_observer"),a=e("@spotify-internal/harmony/es5/client"),s=e("@spotify-internal/harmony/es5/next"),u=e("@spotify-internal/transport"),l=e("@spotify-internal/harmony/es5/utils/create_transport"),c=e("@js-sdk/common"),d=e("../enums/messages"),_=e("../shared/messages_factory"),p=e("../shared/message_dispatcher"),f=function(){function e(e,t){var r;this._client=null,this._streamer=null,this._transport=null,this._getTokenRequests={},this._messageHandlers=((r={})[d.Messages.INIT]=this._onInit.bind(this),r[d.Messages.CONNECT]=this._onConnect.bind(this),r[d.Messages.DISCONNECT]=this._onDisconnect.bind(this),r[d.Messages.TOKEN]=this._onToken.bind(this),r[d.Messages.GET_CURRENT_STATE]=this._onGetCurrentState.bind(this),r[d.Messages.GET_VOLUME]=this._onGetVolume.bind(this),r[d.Messages.SET_VOLUME]=this._onSetVolume.bind(this),r[d.Messages.SET_NAME]=this._onSetName.bind(this),r[d.Messages.ACTIVATE_ELEMENT]=this._onActivateElement.bind(this),r[d.Messages.PAUSE]=this._onPause.bind(this),r[d.Messages.RESUME]=this._onResume.bind(this),r[d.Messages.TOGGLE_PLAY]=this._onTogglePlay.bind(this),r[d.Messages.SEEK]=this._onSeek.bind(this),r[d.Messages.PREV_TRACK]=this._onPrevTrack.bind(this),r[d.Messages.NEXT_TRACK]=this._onNextTrack.bind(this),r),this._currentWindow=e,this._loaderWindow=t,this._msgDispatcher=p.MessageDispatcher.create(),this._getToken=this._getToken.bind(this),this._onAuthError=this._onAuthError.bind(this),this._onAutoplayFailed=this._onAutoplayFailed.bind(this),this._onClientError=this._onClientError.bind(this),this._onLocalPlayerEnabled=this._onLocalPlayerEnabled.bind(this),this._onPlayerInitError=this._onPlayerInitError.bind(this),this._onProductStateChanged=this._onProductStateChanged.bind(this),this._onRegistrationError=this._onRegistrationError.bind(this),this._onStateChanged=this._onStateChanged.bind(this),this._verifyToken=this._verifyToken.bind(this),this._handleMessages=this._handleMessages.bind(this)}return e.create=function(t,r){return new e(t,r)},e.prototype._onConnect=function(e,t){var r=this,n=this._transport;n&&n.connect().then((function(){return n.authenticate()})).then((function(e){r._sendMessage(_.messages.connected(e,t))})).catch((function(){r._sendMessage(_.messages.connected(!1,t))}))},e.prototype._getFlags=function(){var e,t=this,r=function(){var e,r=null===(e=t._transport)||void 0===e?void 0:e.request("@webgate/melody/v1/flags",{authorize:!0,responseType:"json"}),n=new Promise((function(e){setTimeout(e,5e3)}));return Promise.race([r,n])};return((null===(e=this._transport)||void 0===e?void 0:e.isConnected())?r():new Promise((function(e,n){var i;null===(i=t._transport)||void 0===i||i.once(u.TransportEvent.CONNECTED,(function(){r().then(e,n)}))}))).then((function(e){var t;return{useCloudPlayback:200===(null==e?void 0:e.status)&&!!(null===(t=e.body)||void 0===t?void 0:t.anthemUseCloudPlayback)}})).catch((function(){return{useCloudPlayback:!1}}))},e.prototype._onInit=function(e){var t=this;this._transport=l.createTransportForHarmony({getToken:this._getToken,endpoints:{webgate:"https://api.spotify.com/v1"}});var r=c.createPromiseResolver(),d=a.createHarmonyClient({transport:this._transport,descriptor:r.promise});this._client=d,this._getFlags().then((function(a){var l,_;t._streamer=n.createStreamerForClientWithPlaybackService(d,s.PlaybackServiceCreators[a.useCloudPlayback?"cloud-playback":"track-playback"],{initialVolume:e.volume}),"volume"in e&&t._streamer.once("registered",(function(){t._streamer&&t._streamer.setVolume(e.volume)})),t._streamer.addListeners(((l={}).registered=t._onLocalPlayerEnabled,l.autoplay_failed=t._onAutoplayFailed,l.state_changed=t._onStateChanged,l.player_initialization_failed=t._onPlayerInitError,l)),t._streamer.on("registration_error",t._onRegistrationError),d.addListeners(((_={})[i.HarmonyEvent.AUTHENTICATION_ERROR]=t._onAuthError,_[i.HarmonyEvent.ERROR]=t._onClientError,_[i.HarmonyEvent.PRODUCT_STATE_CHANGED]=t._onProductStateChanged,_));var p=o.BrowserConnectionObserver.create();p.on(u.TransportEvent.CONNECTION_ONLINE,t._onLocalPlayerEnabled),p.on(u.TransportEvent.CONNECTION_OFFLINE,t._onLocalPlayerDisabled),r.resolve({id:null,name:e.name,brand:"public_js-sdk",randomizeId:!0,platform_identifier:c.interpolateUA("Partner public_js-sdk harmony-{{name}}.{{version}}-{{platform}}"+(a.useCloudPlayback?";cp":""))})}))},e.prototype._onToken=function(e){var t,r=e.ref,n=e.token;null===(t=this._getTokenRequests[r])||void 0===t||t.resolve(n)},e.prototype._onGetCurrentState=function(e,t){var r=this;this._streamer.getCurrentState().then((function(e){r._sendMessage(_.messages.currentState(e,t))}))},e.prototype._onProductStateChanged=function(){var e=this;this._client.getProductState().then((function(t){"1"===t.ads&&(e._sendMessage(_.messages.accountError("This functionality is restricted to premium users only")),e._transport.disconnect())}))},e.prototype._onGetVolume=function(e,t){var r=this;this._streamer.getVolume().then((function(e){r._sendMessage(_.messages.volume(e,t))}))},e.prototype._onSetName=function(e){this._client.setName(e)},e.prototype._onSetVolume=function(e){this._streamer.setVolume(e)},e.prototype._onDisconnect=function(){this._transport.disconnect()},e.prototype._onLocalPlayerEnabled=function(){var e=this;this._client.getClientDescriptor().then((function(t){var r=t.id;e._sendMessage(_.messages.playerReady({device_id:r}))}))},e.prototype._onLocalPlayerDisabled=function(){var e=this;this._client.getClientDescriptor().then((function(t){var r=t.id;e._sendMessage(_.messages.playerNotReady({device_id:r}))}))},e.prototype._onStateChanged=function(e){this._sendMessage(_.messages.playerStateChanged(e.data.state))},e.prototype._getToken=function(e){var t,r=this._sendMessage(_.messages.getToken());this._getTokenRequests[r]=c.createPromiseResolver(),null===(t=this._getTokenRequests[r])||void 0===t||t.promise.then(this._verifyToken).then(e)},e.prototype._verifyToken=function(e){var t=this;return this._client?this._client.request("@webgate/melody/v1/check_scope?scope=web-playback",{authorize:!1,headers:{Authorization:"Bearer "+e}}).then((function(r){return 403===r.status&&t._sendMessage(_.messages.authError({message:"Invalid token scopes."})),e})).catch((function(){return e})):Promise.resolve(e)},e.prototype._handleMessages=function(e,t,r){"function"==typeof this._messageHandlers[e]?this._messageHandlers[e](t,r):console.info("No handler for",e)},e.prototype._onAuthError=function(){this._sendMessage(_.messages.authError({message:"Authentication failed"}))},e.prototype._onActivateElement=function(){var e,t=this;null===(e=this._streamer)||void 0===e||e.activateElement().catch((function(e){var r=e.message;t._sendMessage(_.messages.activateElementError({message:r}))}))},e.prototype._onPause=function(){var e,t=this;null===(e=this._streamer)||void 0===e||e.pause().catch((function(e){var r=e.message;t._sendMessage(_.messages.playbackError({message:r}))}))},e.prototype._onResume=function(){var e=this;this._streamer.resume().catch((function(t){var r=t.message;e._sendMessage(_.messages.playbackError({message:r}))}))},e.prototype._onTogglePlay=function(){var e=this;this._streamer.togglePlay().catch((function(t){var r=t.message;e._sendMessage(_.messages.playbackError({message:r}))}))},e.prototype._onSeek=function(e){var t=this;this._streamer.seek(e).catch((function(e){var r=e.message;t._sendMessage(_.messages.playbackError({message:r}))}))},e.prototype._onPrevTrack=function(e){var t=this;this._streamer.previousTrack(e).catch((function(e){var r=e.message;t._sendMessage(_.messages.playbackError({message:r}))}))},e.prototype._onNextTrack=function(e){var t=this;this._streamer.nextTrack(e).catch((function(e){var r=e.message;t._sendMessage(_.messages.playbackError({message:r}))}))},e.prototype._onPlayerInitError=function(){this._sendMessage(_.messages.playerInitError({message:"Failed to initialize player"}))},e.prototype._onAutoplayFailed=function(){this._sendMessage(_.messages.autoplayFailed({message:"Browser prevented autoplay due to lack of interaction"}))},e.prototype._onRegistrationError=function(e){e.data.error.code===i.HarmonyError.TP_REGISTRATION_FAILED_NON_PREMIUM&&this._sendMessage(_.messages.accountError("This functionality is restricted to premium users only"))},e.prototype._onClientError=function(e){var t=e.data.source;t!==i.HarmonyErrorSource.HARMONY&&t!==i.HarmonyErrorSource.PLAYBACK||this._sendMessage(_.messages.playbackError({message:"Playback error"}))},e.prototype._sendMessage=function(e){return this._msgDispatcher.send(this._loaderWindow,e)},e.prototype.listen=function(){var e=this;this._msgDispatcher.listen(this._currentWindow,this._handleMessages),this._currentWindow.addEventListener("beforeunload",(function(){e._client&&e._transport.disconnect()})),this._sendMessage(_.messages.embeddedLoaded())},e}();r.PlayerWrapper=f},{"../enums/messages":205,"../shared/message_dispatcher":207,"../shared/messages_factory":208,"@js-sdk/common":6,"@spotify-internal/harmony":135,"@spotify-internal/harmony/es5/client":119,"@spotify-internal/harmony/es5/next":136,"@spotify-internal/harmony/es5/streamer":137,"@spotify-internal/harmony/es5/utils/create_transport":140,"@spotify-internal/transport":181,"@spotify-internal/transport/es5/_internal/connection_observer":158}],204:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Errors=void 0,function(e){e.INVALID_LISTENER="INVALID_LISTENER",e.INVALID_WEBPLAYBACK="INVALID_WEBPLAYBACK",e.NO_BODY="NO_BODY",e.NO_EVENT="NO_EVENT",e.INVALID_OAUTH="INVALID_OAUTH",e.MISSING_IFRAME="MISSING_IFRAME",e.AUTOPLAY_FAILED="AUTOPLAY_FAILED"}(r.Errors||(r.Errors={}))},{}],205:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Messages=void 0,function(e){e.SPOTIFY_MESSAGE="SP_MESSAGE",e.ACCOUNT_ERROR="ACCOUNT_ERROR",e.AUTH_ERROR="AUTH_ERROR",e.CONNECT="CONNECT",e.CONNECTED="CONNECTED",e.CURRENT_STATE="CURRENT_STATE",e.DISCONNECT="DISCONNECT",e.EVENT="EVENT",e.GET_CURRENT_STATE="GET_CURRENT_STATE",e.GET_TOKEN="GET_TOKEN",e.GET_VOLUME="GET_VOLUME",e.INIT="INIT",e.LOADED="LOADED",e.NEXT_TRACK="NEXT_TRACK",e.PAUSE="PAUSE",e.PLAYBACK_ERROR="PLAYBACK_ERROR",e.ACTIVATE_ELEMENT="ACTIVATE_ELEMENT",e.ACTIVATE_ELEMENT_ERROR="ACTIVATE_ELEMENT_ERROR",e.PLAYER_INIT_ERROR="PLAYER_INIT_ERROR",e.PLAYER_READY="PLAYER_READY",e.PLAYER_NOT_READY="PLAYER_NOT_READY",e.PLAYER_STATE_CHANGED="PLAYER_STATE_CHANGED",e.PREV_TRACK="PREV_TRACK",e.RESUME="RESUME",e.SEEK="SEEK",e.SET_NAME="SET_NAME",e.SET_VOLUME="SET_VOLUME",e.TOGGLE_PLAY="TOGGLE_PLAY",e.TOKEN="TOKEN",e.VOLUME="VOLUME",e.AUTOPLAY_FAILED="AUTOPLAY_FAILED"}(r.Messages||(r.Messages={}))},{}],206:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.code=t,n.message=r,n.name="AnthemError",n}return n.__extends(t,e),t}(Error);r.PlayerError=i},{tslib:201}],207:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MessageDispatcher=void 0;var n=e("../enums/messages"),i=function(){function e(){this._seq=0,this._onMessageCallback=function(){},this._receiveMessage=this._receiveMessage.bind(this)}return e.create=function(){return new e},e.prototype._addMessageId=function(e){return e.seq=this._seq++,e},e.prototype._receiveMessage=function(e){if(e.data){var t=e.data,r=t.type,i=t.body,o=t.seq;r===n.Messages.SPOTIFY_MESSAGE&&(null==i?void 0:i.topic)&&this._onMessageCallback(i.topic,i.data,o)}},e.prototype.listen=function(e,t){this._onMessageCallback=t,e.addEventListener("message",this._receiveMessage)},e.prototype.stopListening=function(e){e.removeEventListener("message",this._receiveMessage)},e.prototype.send=function(e,t,r){void 0===r&&(r="*");var n=this._addMessageId(t);return e.postMessage(n,r),n.seq},e}();r.MessageDispatcher=i},{"../enums/messages":205}],208:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.messages=void 0;var n=e("../enums/messages"),i=function(){function e(){}return e.create=function(){return new e},e.prototype._createEventMessage=function(e,t){return this._createMessage(n.Messages.EVENT,{name:e,eventData:t})},e.prototype._createMessage=function(e,t){return{type:n.Messages.SPOTIFY_MESSAGE,body:{topic:e,data:void 0!==t?JSON.parse(JSON.stringify(t)):void 0}}},e.prototype.accountError=function(e){return this._createEventMessage(n.Messages.ACCOUNT_ERROR,{message:e})},e.prototype.authError=function(e){return this._createEventMessage(n.Messages.AUTH_ERROR,e)},e.prototype.autoplayFailed=function(e){return this._createEventMessage(n.Messages.AUTOPLAY_FAILED,e)},e.prototype.playbackError=function(e){return this._createEventMessage(n.Messages.PLAYBACK_ERROR,e)},e.prototype.playerReady=function(e){return this._createEventMessage(n.Messages.PLAYER_READY,e)},e.prototype.playerNotReady=function(e){return this._createEventMessage(n.Messages.PLAYER_NOT_READY,e)},e.prototype.connect=function(){return this._createMessage(n.Messages.CONNECT)},e.prototype.connected=function(e,t){return this._createMessage(n.Messages.CONNECTED,{connected:e,ref:t})},e.prototype.disconnect=function(){return this._createMessage(n.Messages.DISCONNECT)},e.prototype.init=function(e){return this._createMessage(n.Messages.INIT,e)},e.prototype.playerInitError=function(e){return this._createEventMessage(n.Messages.PLAYER_INIT_ERROR,e)},e.prototype.getToken=function(){return this._createMessage(n.Messages.GET_TOKEN)},e.prototype.token=function(e,t){return this._createMessage(n.Messages.TOKEN,{token:e,ref:t})},e.prototype.activateElement=function(){return this._createMessage(n.Messages.ACTIVATE_ELEMENT)},e.prototype.activateElementError=function(e){return this._createEventMessage(n.Messages.ACTIVATE_ELEMENT_ERROR,e)},e.prototype.pause=function(){return this._createMessage(n.Messages.PAUSE)},e.prototype.resume=function(){return this._createMessage(n.Messages.RESUME)},e.prototype.togglePlay=function(){return this._createMessage(n.Messages.TOGGLE_PLAY)},e.prototype.seek=function(e){return this._createMessage(n.Messages.SEEK,e)},e.prototype.nextTrack=function(e){return this._createMessage(n.Messages.NEXT_TRACK,e)},e.prototype.previousTrack=function(e){return this._createMessage(n.Messages.PREV_TRACK,e)},e.prototype.getCurrentState=function(){return this._createMessage(n.Messages.GET_CURRENT_STATE)},e.prototype.currentState=function(e,t){return this._createMessage(n.Messages.CURRENT_STATE,{state:e,ref:t})},e.prototype.playerStateChanged=function(e){return this._createEventMessage(n.Messages.PLAYER_STATE_CHANGED,e)},e.prototype.getVolume=function(){return this._createMessage(n.Messages.GET_VOLUME)},e.prototype.volume=function(e,t){return this._createMessage(n.Messages.VOLUME,{volume:e,ref:t})},e.prototype.setVolume=function(e){return this._createMessage(n.Messages.SET_VOLUME,e)},e.prototype.setName=function(e){return this._createMessage(n.Messages.SET_NAME,e)},e.prototype.embeddedLoaded=function(){return this._createMessage(n.Messages.LOADED)},e}();r.messages=i.create()},{"../enums/messages":205}]},{},[202]);